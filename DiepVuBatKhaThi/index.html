<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ƒêi·ªáp V·ª• B·∫•t Kh·∫£ Thi - To√°n 9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=VT323&display=swap');

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: #0d0d0d;
            color: #00ff41;
            overflow: hidden;
            margin: 0;
            user-select: none;
        }

        /* --- Matrix Background --- */
        #matrix-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            opacity: 0.15;
        }

        /* --- Game Panels --- */
        .terminal-panel {
            background: rgba(0, 20, 0, 0.95);
            border: 2px solid #00ff41;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
            border-radius: 8px;
            position: relative;
        }

        .terminal-panel::before {
            content: "TOP SECRET // CLASSIFIED";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #0d0d0d;
            padding: 0 10px;
            font-size: 0.8rem;
            color: #00ff41;
            font-weight: bold;
        }

        /* --- Buttons --- */
        .btn-hack {
            background: #001a00;
            border: 1px solid #00ff41;
            color: #00ff41;
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn-hack:hover {
            background: #003300;
            box-shadow: 0 0 10px #00ff41;
            cursor: pointer;
        }

        .btn-hack:active { transform: scale(0.98); }

        .btn-hack.correct {
            background: #004d00 !important;
            border-color: #00ff41 !important;
            box-shadow: inset 0 0 20px #00ff41;
            color: #fff;
        }

        .btn-hack.wrong {
            background: #4d0000 !important;
            border-color: #ff0000 !important;
            box-shadow: inset 0 0 20px #ff0000;
            color: #ffaaaa;
        }

        /* --- Explanation Box --- */
        #explanation-box {
            border-left: 4px solid;
            transition: all 0.3s ease;
            transform: scaleY(0);
            transform-origin: top;
            height: 0;
            opacity: 0;
        }

        #explanation-box.show {
            transform: scaleY(1);
            height: auto;
            opacity: 1;
            margin-top: 1rem;
            padding: 1rem;
        }

        /* --- Math Display --- */
        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            margin: 0 2px;
            font-size: 0.9em;
        }
        .fraction > span { display: block; padding: 0.1em; }
        .fraction span.numerator { border-bottom: 1px solid currentColor; }
        .fraction span.denominator { border-top: 1px solid transparent; }

        /* --- Glitch Effect for Title --- */
        .glitch {
            position: relative;
            color: #00ff41;
        }
        .glitch::before, .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
        }
        .glitch::before {
            left: 2px; text-shadow: -1px 0 #ff0000; clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        .glitch::after {
            left: -2px; text-shadow: -1px 0 #0000ff; clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip: rect(10px, 9999px, 30px, 0); }
            20% { clip: rect(80px, 9999px, 100px, 0); }
            40% { clip: rect(10px, 9999px, 50px, 0); }
            100% { clip: rect(60px, 9999px, 80px, 0); }
        }
        @keyframes glitch-anim-2 {
            0% { clip: rect(60px, 9999px, 90px, 0); }
            20% { clip: rect(10px, 9999px, 50px, 0); }
            100% { clip: rect(30px, 9999px, 70px, 0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <canvas id="matrix-bg"></canvas>

    <!-- Start Screen -->
    <div id="start-screen" class="terminal-panel p-10 text-center max-w-3xl w-full z-10">
        <h1 class="glitch text-6xl md:text-7xl mb-4 font-bold tracking-tighter" data-text="MISSION: IMPOSSIBLE">MISSION: IMPOSSIBLE</h1>
        <h2 class="text-2xl text-green-400 mb-8 font-mono">CODE: GI·∫¢I M√É B·∫§T PH∆Ø∆†NG TR√åNH</h2>

        <div class="text-left bg-black/50 p-6 rounded mb-8 font-mono text-lg border-l-4 border-green-500">
            <p class="mb-2">&gt; TARGET: Gi·∫£i m√£ 15 m·∫≠t th∆∞ to√°n h·ªçc.</p>
            <p class="mb-2">&gt; SUBJECT: B·∫•t ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t m·ªôt ·∫©n.</p>
            <p class="mb-2">&gt; WARNING: Sai l·∫ßm s·∫Ω k√≠ch ho·∫°t b√°o ƒë·ªông.</p>
            <p class="text-yellow-400"> &gt; WAITING FOR AGENT INPUT...</p>
        </div>

        <button onclick="startGame()" class="btn-hack px-12 py-4 rounded text-2xl font-bold w-full md:w-auto">
            [ CH·∫§P NH·∫¨N NHI·ªÜM V·ª§ ]
        </button>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="hidden w-full max-w-5xl z-10 flex-col h-full justify-center">
        <!-- Header -->
        <div class="flex justify-between items-end mb-4 px-2 font-mono">
            <div>
                <div class="text-xs text-green-700">DIFFICULTY LEVEL</div>
                <div id="level-badge" class="text-xl font-bold text-green-400">NH·∫¨N BI·∫æT</div>
            </div>
            <div class="text-right">
                <div class="text-xs text-green-700">DATA DECRYPTED</div>
                <div class="text-3xl font-bold text-green-400"><span id="score">0</span>%</div>
            </div>
        </div>

        <!-- Question Panel -->
        <div class="terminal-panel p-6 md:p-8 mb-6 relative min-h-[150px] flex flex-col justify-center">
            <div class="absolute top-4 right-4 text-xs text-green-800 font-mono">ID: Q-<span id="q-number">01</span></div>
            <div id="question-text" class="text-2xl md:text-3xl font-bold text-green-100 text-center leading-relaxed">
                Initializing...
            </div>
        </div>

        <!-- Explanation Area -->
        <div id="explanation-box" class="bg-black/80 text-green-300 text-lg mb-6 border-green-500 rounded font-mono"></div>

        <!-- Options Grid -->
        <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"></div>

        <!-- Next Button -->
        <div id="next-btn-container" class="hidden text-center">
            <button onclick="nextQuestion()" class="btn-hack px-8 py-3 rounded text-xl">
                &gt;&gt; TI·∫æP T·ª§C GI·∫¢I M√É &gt;&gt;
            </button>
        </div>
    </div>

    <!-- End Screen -->
    <div id="end-screen" class="hidden fixed inset-0 flex items-center justify-center z-50 bg-black/90">
        <div class="terminal-panel p-12 text-center max-w-2xl w-full border-4 border-green-500">
            <div class="text-8xl mb-6">üîì</div>
            <h2 class="text-5xl font-bold text-green-400 mb-4 font-mono">M·∫¨T M√É ƒê√É M·ªû!</h2>
            <p class="text-xl text-green-200 mb-8">ƒêi·ªáp vi√™n xu·∫•t s·∫Øc. D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c b·∫£o v·ªá.</p>

            <div class="inline-block bg-green-900/30 p-6 rounded-lg mb-8 border border-green-500 w-full">
                <div class="text-sm text-green-600 uppercase mb-2">ƒê·ªô ch√≠nh x√°c nhi·ªám v·ª•</div>
                <div class="text-7xl font-bold text-white font-mono" id="final-score">0%</div>
            </div>

            <div>
                <button onclick="location.reload()" class="btn-hack px-10 py-4 rounded text-xl w-full">
                    [ T√ÅI KH·ªûI ƒê·ªòNG ]
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- QUESTIONS: 15 c√¢u, chia ƒë·ªÅu ABCD ---
        const questions = [
            // 1 ‚Äì NB, ƒë√∫ng A
            {
                q: "B·∫•t ph∆∞∆°ng tr√¨nh n√†o sau ƒë√¢y l√† b·∫•t ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t m·ªôt ·∫©n?",
                a: [
                    "2x - 5 &gt; 0",
                    "0x + 3 &lt; 0",
                    "x<sup>2</sup> + 1 &ge; 0",
                    "1/x - 2 &le; 0"
                ],
                correct: 0,
                rationale: "<b>Gi·∫£i th√≠ch:</b> D·∫°ng t·ªïng qu√°t: ax + b &gt; 0 v·ªõi a &ne; 0. Ch·ªâ ph∆∞∆°ng √°n A c√≥ h·ªá s·ªë c·ªßa x kh√°c 0.",
                level: "NH·∫¨N BI·∫æT"
            },
            // 2 ‚Äì NB, ƒë√∫ng B
            {
                q: "Gi√° tr·ªã x = 2 l√† nghi·ªám c·ªßa b·∫•t ph∆∞∆°ng tr√¨nh n√†o?",
                a: [
                    "3x + 1 &gt; 7",
                    "2x - 1 &gt; 2",
                    "4 - x &lt; 1",
                    "x + 3 &le; 4"
                ],
                correct: 1,
                rationale: "<b>Ki·ªÉm tra x = 2:</b> A: 3¬∑2 + 1 = 7 &not;&gt; 7; B: 2¬∑2 - 1 = 3 &gt; 2 (ƒë√∫ng); C: 4 - 2 = 2 &not;&lt; 1; D: 2 + 3 = 5 &not;&le; 4.",
                level: "NH·∫¨N BI·∫æT"
            },
            // 3 ‚Äì NB, ƒë√∫ng C
            {
                q: "H·ªá s·ªë a v√† b c·ªßa b·∫•t ph∆∞∆°ng tr√¨nh -2x + 5 &ge; 0 l·∫ßn l∆∞·ª£t l√†:",
                a: [
                    "a = 2, b = 5",
                    "a = -2, b = -5",
                    "a = -2, b = 5",
                    "a = 5, b = -2"
                ],
                correct: 2,
                rationale: "<b>Gi·∫£i th√≠ch:</b> So v·ªõi d·∫°ng ax + b &ge; 0, ta c√≥ a = -2 (h·ªá s·ªë c·ªßa x), b = 5 (h·∫±ng s·ªë).",
                level: "NH·∫¨N BI·∫æT"
            },
            // 4 ‚Äì NB, ƒë√∫ng D
            {
                q: "Gi·∫£i b·∫•t ph∆∞∆°ng tr√¨nh x - 3 &gt; 5.",
                a: [
                    "x &gt; 2",
                    "x &gt; 5",
                    "x &lt; 8",
                    "x &gt; 8"
                ],
                correct: 3,
                rationale: "<b>Gi·∫£i:</b> x - 3 &gt; 5 &hArr; x &gt; 8.",
                level: "NH·∫¨N BI·∫æT"
            },
            // 5 ‚Äì NB, ƒë√∫ng A
            {
                q: "Khi nh√¢n hai v·∫ø c·ªßa b·∫•t ph∆∞∆°ng tr√¨nh -2x &lt; 6 v·ªõi -1/2, ta ƒë∆∞·ª£c:",
                a: [
                    "x &gt; -3",
                    "x &lt; -3",
                    "x &gt; 3",
                    "x &lt; 3"
                ],
                correct: 0,
                rationale: "<b>L∆∞u √Ω:</b> Nh√¢n v·ªõi s·ªë √¢m l√†m <b>ƒë·ªïi chi·ªÅu</b> b·∫•t ph∆∞∆°ng tr√¨nh. Ta c√≥ x &gt; -3.",
                level: "NH·∫¨N BI·∫æT"
            },
            // 6 ‚Äì NB, ƒë√∫ng B
            {
                q: "Ph√°t bi·ªÉu n√†o sau ƒë√¢y ƒê√öNG v·ªÅ t·∫≠p nghi·ªám c·ªßa b·∫•t ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t m·ªôt ·∫©n?",
                a: [
                    "Lu√¥n ch·ªâ c√≥ m·ªôt s·ªë duy nh·∫•t",
                    "C√≥ th·ªÉ l√† m·ªôt kho·∫£ng, m·ªôt n·ª≠a kho·∫£ng ho·∫∑c m·ªôt ƒëi·ªÉm",
                    "Lu√¥n l√† t·∫≠p t·∫•t c·∫£ c√°c s·ªë nguy√™n",
                    "Lu√¥n kh√¥ng c√≥ nghi·ªám"
                ],
                correct: 1,
                rationale: "<b>Gi·∫£i th√≠ch:</b> T·∫≠p nghi·ªám c·ªßa b·∫•t ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t th∆∞·ªùng l√† m·ªôt kho·∫£ng, n·ª≠a kho·∫£ng ho·∫∑c m·ªôt ƒëi·ªÉm (tr∆∞·ªùng h·ª£p bi√™n).",
                level: "NH·∫¨N BI·∫æT"
            },
            // 7 ‚Äì TH, ƒë√∫ng C
            {
                q: "Nghi·ªám c·ªßa b·∫•t ph∆∞∆°ng tr√¨nh 2x - 8 &gt; 0 l√†:",
                a: [
                    "x &lt; 4",
                    "x &ge; 4",
                    "x &gt; 4",
                    "x &gt; 8"
                ],
                correct: 2,
                rationale: "<b>Gi·∫£i:</b> 2x - 8 &gt; 0 &hArr; 2x &gt; 8 &hArr; x &gt; 4.",
                level: "TH√îNG HI·ªÇU"
            },
            // 8 ‚Äì TH, ƒë√∫ng D
            {
                q: "Gi·∫£i b·∫•t ph∆∞∆°ng tr√¨nh 5 - x &le; 2:",
                a: [
                    "x &le; 3",
                    "x &gt; 3",
                    "x &lt; 3",
                    "x &ge; 3"
                ],
                correct: 3,
                rationale: "<b>Gi·∫£i:</b> 5 - x &le; 2 &hArr; -x &le; -3 &hArr; x &ge; 3 (nh√¢n v·ªõi -1 ƒë·ªïi chi·ªÅu).",
                level: "TH√îNG HI·ªÇU"
            },
            // 9 ‚Äì TH, ƒë√∫ng A
            {
                q: "T·∫≠p nghi·ªám c·ªßa b·∫•t ph∆∞∆°ng tr√¨nh 3x + 4 &lt; x - 2 l√†:",
                a: [
                    "x &lt; -3",
                    "x &gt; -3",
                    "x &lt; 1",
                    "x &lt; -1"
                ],
                correct: 0,
                rationale: "<b>Gi·∫£i:</b> 3x - x &lt; -2 - 4 &hArr; 2x &lt; -6 &hArr; x &lt; -3.",
                level: "TH√îNG HI·ªÇU"
            },
            // 10 ‚Äì TH, ƒë√∫ng B
            {
                q: "Gi·∫£i b·∫•t ph∆∞∆°ng tr√¨nh 2(x+1) - 3(2x-1) &gt; 1:",
                a: [
                    "x &gt; 1",
                    "x &lt; 1",
                    "x &ge; 1",
                    "x &le; 1"
                ],
                correct: 1,
                rationale: "<b>Gi·∫£i:</b> 2x + 2 - 6x + 3 &gt; 1 &hArr; -4x + 5 &gt; 1 &hArr; -4x &gt; -4 &hArr; x &lt; 1.",
                level: "TH√îNG HI·ªÇU"
            },
            // 11 ‚Äì TH, ƒë√∫ng C
            {
                q: "S·ªë nguy√™n d∆∞∆°ng n√†o th·ªèa m√£n 3x - 5 &lt; 2?",
                a: [
                    "x = 1",
                    "x = 2",
                    "x &in; {1; 2}",
                    "x &in; {0; 1; 2}"
                ],
                correct: 2,
                rationale: "<b>Gi·∫£i:</b> 3x &lt; 7 &hArr; x &lt; 7/3 &approx; 2,33. S·ªë nguy√™n d∆∞∆°ng th·ªèa l√† 1 v√† 2.",
                level: "TH√îNG HI·ªÇU"
            },
            // 12 ‚Äì VD, ƒë√∫ng D
            {
                q: "Gi·∫£i b·∫•t ph∆∞∆°ng tr√¨nh: <div class='fraction'><span class='numerator'>x</span><span class='denominator'>2</span></div> - <div class='fraction'><span class='numerator'>x-1</span><span class='denominator'>3</span></div> &gt; 1",
                a: [
                    "x &gt; 1",
                    "x &lt; 4",
                    "x &gt; 2",
                    "x &gt; 4"
                ],
                correct: 3,
                rationale: "<b>Quy ƒë·ªìng m·∫´u 6:</b> 3x - 2(x-1) &gt; 6 &hArr; 3x - 2x + 2 &gt; 6 &hArr; x &gt; 4.",
                level: "V·∫¨N D·ª§NG"
            },
            // 13 ‚Äì VD, ƒë√∫ng A
            {
                q: "(Th·ª±c t·∫ø) H√¨nh ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i 15m. T√¨m chi·ªÅu r·ªông x ƒë·ªÉ chu vi kh√¥ng nh·ªè h∆°n 50m.",
                a: [
                    "x &ge; 10",
                    "x &le; 10",
                    "x &gt; 10",
                    "x &ge; 20"
                ],
                correct: 0,
                rationale: "<b>Thi·∫øt l·∫≠p:</b> Chu vi P = 2(15 + x). ƒêi·ªÅu ki·ªán P &ge; 50 &hArr; 15 + x &ge; 25 &hArr; x &ge; 10.",
                level: "V·∫¨N D·ª§NG"
            },
            // 14 ‚Äì VD, ƒë√∫ng B
            {
                q: "T√¨m x ƒë·ªÉ cƒÉn th·ª©c &radic;(2x - 1) x√°c ƒë·ªãnh:",
                a: [
                    "x &gt; 1/2",
                    "x &ge; 1/2",
                    "x &le; 1/2",
                    "x &ge; -1/2"
                ],
                correct: 1,
                rationale: "<b>ƒêi·ªÅu ki·ªán c√≥ nghƒ©a:</b> 2x - 1 &ge; 0 &hArr; x &ge; 1/2.",
                level: "V·∫¨N D·ª§NG"
            },
            // 15 ‚Äì VDC, ƒë√∫ng C
            {
                q: "T√¨m m ƒë·ªÉ ph∆∞∆°ng tr√¨nh 2x + m = x - 3 c√≥ nghi·ªám x &gt; 2.",
                a: [
                    "m &gt; -5",
                    "m &lt; 5",
                    "m &lt; -5",
                    "m &gt; 5"
                ],
                correct: 2,
                rationale: "<b>Gi·∫£i:</b> 2x + m = x - 3 &hArr; x = -m - 3. ƒêi·ªÅu ki·ªán x &gt; 2 &hArr; -m - 3 &gt; 2 &hArr; -m &gt; 5 &hArr; m &lt; -5.",
                level: "V·∫¨N D·ª§NG CAO"
            }
        ];

        // --- GAME STATE ---
        let currentQIndex = 0;
        let score = 0;
        let correctCount = 0;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'type') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                osc.start(now);
                osc.stop(now + 0.05);
            } else if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.linearRampToValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'win') {
                [523.25, 659.25, 783.99, 1046.50].forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    o.type = 'triangle';
                    o.frequency.value = f;
                    g.gain.setValueAtTime(0.2, now + i * 0.15);
                    g.gain.exponentialRampToValueAtTime(0.001, now + i * 0.15 + 0.5);
                    o.start(now + i * 0.15);
                    o.stop(now + i * 0.15 + 0.5);
                });
            }
        }

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('flex');

            currentQIndex = 0;
            score = 0;
            correctCount = 0;
            loadQuestion();
        }

        function loadQuestion() {
            const q = questions[currentQIndex];

            document.getElementById('q-number').innerText = (currentQIndex + 1).toString().padStart(2, '0');
            document.getElementById('level-badge').innerText = q.level;
            document.getElementById('question-text').innerHTML = q.q;

            const badge = document.getElementById('level-badge');
            if (q.level === "NH·∫¨N BI·∫æT") badge.className = "text-xl font-bold text-green-400";
            else if (q.level === "TH√îNG HI·ªÇU") badge.className = "text-xl font-bold text-blue-400";
            else if (q.level === "V·∫¨N D·ª§NG") badge.className = "text-xl font-bold text-yellow-400";
            else badge.className = "text-xl font-bold text-red-500";

            const expBox = document.getElementById('explanation-box');
            expBox.classList.remove('show');
            document.getElementById('next-btn-container').classList.add('hidden');

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';

            q.a.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "btn-hack w-full p-4 rounded text-xl";
                btn.innerHTML = opt;
                btn.onclick = () => handleAnswer(idx, q.correct, btn);
                grid.appendChild(btn);
            });
        }

        function handleAnswer(selected, correct, btn) {
            const btns = document.querySelectorAll('#options-grid .btn-hack');
            btns.forEach(b => b.disabled = true);

            const q = questions[currentQIndex];
            const expBox = document.getElementById('explanation-box');

            expBox.innerHTML = q.rationale;
            expBox.classList.add('show');

            if (selected === correct) {
                btn.classList.add('correct');
                playSound('correct');
                correctCount++;
                score = Math.round((correctCount / questions.length) * 100);
                document.getElementById('score').innerText = score;
                expBox.classList.add('border-green-500');
                expBox.classList.remove('border-red-500');
            } else {
                btn.classList.add('wrong');
                btns[correct].classList.add('correct');
                playSound('wrong');
                expBox.classList.add('border-red-500');
                expBox.classList.remove('border-green-500');
            }

            document.getElementById('next-btn-container').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex < questions.length) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            document.getElementById('game-screen').classList.remove('flex');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score + "%";
            playSound('win');
        }

        // --- MATRIX RAIN EFFECT ---
        const canvas = document.getElementById('matrix-bg');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const katakana = '„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É£„É©„ÉØ„Ç¨„Ç∂„ÉÄ„Éê„Éë„Ç§„Ç£„Ç≠„Ç∑„ÉÅ„Éã„Éí„Éü„É™„É∞„ÇÆ„Ç∏„ÉÇ„Éì„Éî„Ç¶„Ç•„ÇØ„Çπ„ÉÑ„Éå„Éï„É†„É¶„É•„É´„Ç∞„Ç∫„Éñ„ÉÖ„Éó„Ç®„Çß„Ç±„Çª„ÉÜ„Éç„Éò„É°„É¨„É±„Ç≤„Çº„Éá„Éô„Éö„Ç™„Ç©„Ç≥„ÇΩ„Éà„Éé„Éõ„É¢„É®„Éß„É≠„É≤„Ç¥„Çæ„Éâ„Éú„Éùvu0123456789XYZ';
        const alphabet = katakana.split('');

        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = [];
        for (let x = 0; x < columns; x++) drops[x] = 1;

        function draw() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#0F0';
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = alphabet[Math.floor(Math.random() * alphabet.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        setInterval(draw, 33);

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
