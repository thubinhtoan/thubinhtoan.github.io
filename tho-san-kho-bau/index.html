<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Th·ª£ SƒÉn Kho B√°u ‚Äì B√≠ ·∫®n CƒÉn Th·ª©c</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <style>
    body {
      background: #0f172a;
      color: white;
      overflow: hidden;
      font-family: system-ui, sans-serif;
    }
    .game-font { font-family: 'Patrick Hand', cursive; }

    /* ===== FIX 1 D√íNG + K√âO NGANG ===== */
    .nowrap-line{
      white-space: nowrap !important;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
    }

    /* √âp MathJax kh√¥ng t·∫°o block xu·ªëng d√≤ng */
    .mjx-container,
    .MathJax,
    .MathJax_Display{
      display: inline !important;
      white-space: nowrap !important;
      margin: 0 !important;
    }

    .confetti {
      position: absolute;
      width: 8px;
      height: 8px;
      animation: fall linear forwards;
    }
    @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
  </style>
</head>

<body>
  <div id="root"></div>

<script type="text/babel">
const { useEffect, useMemo, useState } = React;

/* ===== UTIL FIX HI·ªÇN TH·ªä 1 D√íNG ===== */
function oneLine(input){
  return (input ?? "")
    .replace(/<br\s*\/?>/gi, " ")    // <br/> -> space
    .replace(/\r?\n/g, " ")         // newline th·∫≠t -> space
    .replace(/\\n/g, " ")           // "\n" trong string -> space
    .replace(/\\\[/g, "\\(")        // \[  -> \(
    .replace(/\\\]/g, "\\)")        // \]  -> \)
    .replace(/\s+/g, " ")
    .trim();
}

/* ===== DATA 15 C√ÇU (gi·ªØ nguy√™n n·ªôi dung c√¥ g·ª≠i) ===== */
const rawQuestions = [
  // Nh·∫≠n bi·∫øt
  {
    id: 1,
    level: "Nh·∫≠n bi·∫øt",
    text:
      "C√¥ng th·ª©c kh·ª≠ m·∫´u c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[\\sqrt{\\frac{A}{B}}\\]<br/>" +
      "v·ªõi $AB \\ge 0$ v√† $B \\ne 0$ l√† g√¨?",
    options: [
      "$\\frac{\\sqrt{AB}}{B}$",
      "$\\frac{\\sqrt{AB}}{|B|}$",
      "$\\frac{A\\sqrt{B}}{B}$",
      "$A\\sqrt{B}$"
    ],
    correct: 1,
    rationale:
      "Theo quy t·∫Øc kh·ª≠ m·∫´u, ta nh√¢n c·∫£ t·ª≠ v√† m·∫´u v·ªõi $B$ ƒë·ªÉ m·∫´u tr·ªü th√†nh b√¨nh ph∆∞∆°ng: " +
      "$\\sqrt{\\frac{A}{B}} = \\sqrt{\\frac{AB}{B^2}} = \\frac{\\sqrt{AB}}{|B|}$."
  },
  {
    id: 2,
    level: "Nh·∫≠n bi·∫øt",
    text:
      "Bi·ªÉu th·ª©c li√™n h·ª£p c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[\\sqrt{3} - 1\\]<br/>" +
      "d√πng ƒë·ªÉ tr·ª•c cƒÉn th·ª©c ·ªü m·∫´u l√† g√¨?",
    options: [
      "$\\sqrt{3} - 1$",
      "$-\\sqrt{3} + 1$",
      "$\\sqrt{3} + 1$",
      "$\\sqrt{3}$"
    ],
    correct: 2,
    rationale:
      "ƒê·ªÉ t·∫°o ra h·∫±ng ƒë·∫≥ng th·ª©c hi·ªáu hai b√¨nh ph∆∞∆°ng $A^2 - B^2$, bi·ªÉu th·ª©c li√™n h·ª£p c·ªßa " +
      "$\\sqrt{A} - B$ l√† $\\sqrt{A} + B$. V·∫≠y li√™n h·ª£p c·ªßa $\\sqrt{3}-1$ l√† $\\sqrt{3}+1$."
  },
  {
    id: 3,
    level: "Nh·∫≠n bi·∫øt",
    text:
      "K·∫øt qu·∫£ c·ªßa ph√©p ƒë∆∞a th·ª´a s·ªë ra ngo√†i d·∫•u cƒÉn c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[\\sqrt{12}\\]<br/>" +
      "l√†:",
    options: [
      "$2\\sqrt{3}$",
      "$3\\sqrt{2}$",
      "$4\\sqrt{3}$",
      "$6\\sqrt{2}$"
    ],
    correct: 0,
    rationale:
      "Ta ph√¢n t√≠ch $12 = 4\\cdot3 = 2^2\\cdot3$. ƒê∆∞a th·ª´a s·ªë $2$ ra ngo√†i d·∫•u cƒÉn ta ƒë∆∞·ª£c $2\\sqrt{3}$."
  },
  {
    id: 4,
    level: "Nh·∫≠n bi·∫øt",
    text:
      "ƒê∆∞a th·ª´a s·ªë v√†o trong d·∫•u cƒÉn c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[3\\sqrt{2}\\]<br/>" +
      "ta ƒë∆∞·ª£c:",
    options: [
      "$\\sqrt{6}$",
      "$\\sqrt{12}$",
      "$\\sqrt{18}$",
      "$\\sqrt{36}$"
    ],
    correct: 2,
    rationale:
      "ƒê∆∞a th·ª´a s·ªë d∆∞∆°ng v√†o trong cƒÉn: $3\\sqrt{2} = \\sqrt{3^2\\cdot2} = \\sqrt{9\\cdot2} = \\sqrt{18}$."
  },
  {
    id: 5,
    level: "Nh·∫≠n bi·∫øt",
    text: "Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y l√† SAI v·ªÅ ph√©p tr·ª•c cƒÉn th·ª©c ·ªü m·∫´u?",
    options: [
      "$\\frac{2}{\\sqrt{3}} = \\frac{2\\sqrt{3}}{3}$",
      "$\\frac{1}{2+\\sqrt{3}} = 2-\\sqrt{3}$",
      "$\\frac{a}{\\sqrt{b}} = \\frac{a\\sqrt{b}}{b} (b>0)$",
      "$\\frac{1}{\\sqrt{5}} = \\frac{1}{5}$"
    ],
    correct: 3,
    rationale:
      "Kh·∫≥ng ƒë·ªãnh D sai. ƒê√∫ng ph·∫£i l√†: $\\frac{1}{\\sqrt{5}} = \\frac{\\sqrt{5}}{5}$."
  },
  {
    id: 6,
    level: "Nh·∫≠n bi·∫øt",
    text:
      "V·ªõi $x \\ge 0$, gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[\\sqrt{x}(\\sqrt{x} + 2)\\]<br/>" +
      "b·∫±ng:",
    options: [
      "$x + 2$",
      "$\\sqrt{x} + 2\\sqrt{x}$",
      "$2x$",
      "$x + 2\\sqrt{x}$"
    ],
    correct: 3,
    rationale:
      "$\\sqrt{x}(\\sqrt{x}+2) = (\\sqrt{x})^2 + 2\\sqrt{x} = x + 2\\sqrt{x}$."
  },

  // Th√¥ng hi·ªÉu
  {
    id: 7,
    level: "Th√¥ng hi·ªÉu",
    text:
      "R√∫t g·ªçn bi·ªÉu th·ª©c:<br/>" +
      "\\[M = 2\\sqrt{3} + \\sqrt{27} - \\sqrt{12}\\]<br/>" +
      "ta ƒë∆∞·ª£c:",
    options: [
      "$3\\sqrt{3}$",
      "$4\\sqrt{3}$",
      "$\\sqrt{3}$",
      "$5\\sqrt{3}$"
    ],
    correct: 0,
    rationale:
      "$M = 2\\sqrt{3} + \\sqrt{9\\cdot3} - \\sqrt{4\\cdot3} = 2\\sqrt{3} + 3\\sqrt{3} - 2\\sqrt{3} = 3\\sqrt{3}$."
  },
  {
    id: 8,
    level: "Th√¥ng hi·ªÉu",
    text:
      "Tr·ª•c cƒÉn th·ª©c ·ªü m·∫´u c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[\\frac{4}{\\sqrt{5}-1}\\]<br/>" +
      "ta ƒë∆∞·ª£c k·∫øt qu·∫£ l√†:",
    options: [
      "$4(\\sqrt{5}+1)$",
      "$\\sqrt{5}+1$",
      "$\\sqrt{5}-1$",
      "$2(\\sqrt{5}+1)$"
    ],
    correct: 1,
    rationale:
      "$\\frac{4}{\\sqrt{5}-1} = \\frac{4(\\sqrt{5}+1)}{5-1} = \\sqrt{5}+1$."
  },
  {
    id: 9,
    level: "Th√¥ng hi·ªÉu",
    text:
      "R√∫t g·ªçn bi·ªÉu th·ª©c:<br/>" +
      "\\[\\sqrt{18a^2}\\]<br/>" +
      "v·ªõi $a < 0$.",
    options: [
      "$3a\\sqrt{2}$",
      "$-3a\\sqrt{2}$",
      "$3\\sqrt{2a}$",
      "$-3\\sqrt{2a}$"
    ],
    correct: 1,
    rationale:
      "$\\sqrt{18a^2} = \\sqrt{9\\cdot2\\cdot a^2} = 3\\sqrt{2}|a|$. V√¨ $a<0$ n√™n $|a|=-a$, ƒë∆∞·ª£c $-3a\\sqrt{2}$."
  },
  {
    id: 10,
    level: "Th√¥ng hi·ªÉu",
    text:
      "Gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[(\\sqrt{3}-2)(\\sqrt{3}+2)\\]<br/>" +
      "l√†:",
    options: ["7","1","-1","-7"],
    correct: 2,
    rationale:
      "$(\\sqrt{3}-2)(\\sqrt{3}+2) = (\\sqrt{3})^2 - 2^2 = 3-4 = -1$."
  },
  {
    id: 11,
    level: "Th√¥ng hi·ªÉu",
    text:
      "Kh·ª≠ m·∫´u c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[\\sqrt{\\frac{5a}{2}}\\]<br/>" +
      "v·ªõi $a > 0$ ta ƒë∆∞·ª£c:",
    options: [
      "$\\frac{5\\sqrt{a}}{2}$",
      "$\\frac{\\sqrt{5a}}{2}$",
      "$\\frac{\\sqrt{10a}}{4}$",
      "$\\frac{\\sqrt{10a}}{2}$"
    ],
    correct: 3,
    rationale:
      "$\\sqrt{\\frac{5a}{2}} = \\sqrt{\\frac{5a\\cdot2}{2\\cdot2}} = \\frac{\\sqrt{10a}}{\\sqrt{4}} = \\frac{\\sqrt{10a}}{2}$."
  },

  // V·∫≠n d·ª•ng
  {
    id: 12,
    level: "V·∫≠n d·ª•ng",
    text:
      "R√∫t g·ªçn bi·ªÉu th·ª©c:<br/>" +
      "\\[P = \\frac{a - \\sqrt{a}}{\\sqrt{a} - 1}\\]<br/>" +
      "v·ªõi $a \\ge 0, a \\ne 1$.",
    options: ["$\\sqrt{a}$","$\\sqrt{a} + 1$","$\\sqrt{a} - 1$","$a$"],
    correct: 0,
    rationale:
      "$a-\\sqrt{a} = \\sqrt{a}(\\sqrt{a}-1)$ n√™n $P = \\sqrt{a}$."
  },
  {
    id: 13,
    level: "V·∫≠n d·ª•ng",
    text:
      "T√¨m $x$ bi·∫øt:<br/>" +
      "\\[\\sqrt{4x} + \\sqrt{x} = 6\\]<br/>" +
      "(v·ªõi $x \\ge 0$).",
    options: ["$x = 2$","$x = 4$","$x = 9$","$x = 16$"],
    correct: 1,
    rationale:
      "$\\sqrt{4x}=2\\sqrt{x}$ n√™n $3\\sqrt{x}=6 \\Rightarrow \\sqrt{x}=2 \\Rightarrow x=4$."
  },
  {
    id: 14,
    level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
    text:
      "M·ªôt m·∫£nh v∆∞·ªùn h√¨nh ch·ªØ nh·∫≠t c√≥:<br/>" +
      "Chi·ªÅu d√†i $\\sqrt{32}$ m, chi·ªÅu r·ªông $\\sqrt{8}$ m.<br/>" +
      "Di·ªán t√≠ch c·ªßa m·∫£nh v∆∞·ªùn l√†:",
    options: ["$8 m^2$","$12 m^2$","$16 m^2$","$32 m^2$"],
    correct: 2,
    rationale:
      "Di·ªán t√≠ch $=\\sqrt{32}\\cdot\\sqrt{8}=\\sqrt{256}=16\\,m^2$."
  },

  // V·∫≠n d·ª•ng cao
  {
    id: 15,
    level: "V·∫≠n d·ª•ng cao",
    text:
      "T√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c:<br/>" +
      "\\[A = \\frac{1}{\\sqrt{2}+1} + \\frac{1}{\\sqrt{3}+\\sqrt{2}} + \\frac{1}{\\sqrt{4}+\\sqrt{3}}\\]",
    options: ["1","2","3","$\\sqrt{2}$"],
    correct: 0,
    rationale:
      "Tr·ª•c cƒÉn: $A=(\\sqrt{2}-1)+ (\\sqrt{3}-\\sqrt{2}) + (\\sqrt{4}-\\sqrt{3}) = -1+2 = 1$."
  }
];

/* ===== RANDOM OPTIONS (gi·ªØ ƒë√∫ng ƒë√°p √°n) ===== */
function shuffleKeepCorrect(q){
  const idx = q.options.map((_, i) => i);
  for (let i = idx.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [idx[i], idx[j]] = [idx[j], idx[i]];
  }
  const newOptions = idx.map(i => q.options[i]);
  const newCorrect = idx.indexOf(q.correct);
  return { ...q, options: newOptions, correct: newCorrect };
}

/* ===== CONFETTI ===== */
const Confetti = () => {
  const [ps, setPs] = useState([]);
  useEffect(() => {
    setPs(Array.from({ length: 40 }).map((_, i) => ({
      id: i,
      left: Math.random() * 100 + "vw",
      color: `hsl(${Math.random() * 360},100%,50%)`,
      duration: Math.random() * 2 + 2 + "s"
    })));
  }, []);
  return (
    <div className="fixed inset-0 pointer-events-none z-50">
      {ps.map(p => (
        <div
          key={p.id}
          className="confetti"
          style={{ left: p.left, background: p.color, animationDuration: p.duration, top: "-20px" }}
        />
      ))}
    </div>
  );
};

const Start = ({ onStart }) => (
  <div className="min-h-screen flex items-center justify-center p-4">
    <div className="max-w-xl w-full bg-slate-800/60 border border-slate-700 rounded-2xl p-8 text-center">
      <div className="text-5xl game-font text-yellow-300 mb-2">TH·ª¢ SƒÇN KHO B√ÅU</div>
      <div className="text-xl text-blue-200 mb-6">B√≠ ·∫®n CƒÉn Th·ª©c B·∫≠c Hai</div>
      <p className="text-slate-200 mb-6">15 c√¢u h·ªèi ‚Äì ch·ªçn ƒë√°p √°n v√† xem gi·∫£i th√≠ch ngay sau khi tr·∫£ l·ªùi.</p>
      <button
        onClick={onStart}
        className="px-8 py-3 rounded-full bg-green-600 hover:bg-green-500 font-bold shadow-lg"
      >
        B·∫ÆT ƒê·∫¶U
      </button>
    </div>
  </div>
);

const Result = ({ score, total, onRestart }) => (
  <div className="min-h-screen flex items-center justify-center p-4">
    <div className="max-w-xl w-full bg-slate-800/60 border border-slate-700 rounded-2xl p-8 text-center">
      <div className="text-6xl mb-2">üèÜ</div>
      <div className="text-3xl font-bold text-yellow-300 mb-2">HO√ÄN TH√ÄNH</div>
      <div className="text-xl text-slate-200 mb-6">ƒêi·ªÉm: <b className="text-white">{score}</b> / {total}</div>
      <button
        onClick={onRestart}
        className="px-8 py-3 rounded-full bg-indigo-600 hover:bg-indigo-500 font-bold shadow-lg"
      >
        CH∆†I L·∫†I
      </button>
      {score >= Math.ceil(total * 0.6) && <Confetti />}
    </div>
  </div>
);

const Game = ({ data, onFinish }) => {
  const [i, setI] = useState(0);
  const [chosen, setChosen] = useState(null);
  const [showExplain, setShowExplain] = useState(false);
  const [score, setScore] = useState(0);

  const q = data[i];

  useEffect(() => {
    if (window.MathJax?.typesetPromise) {
      window.MathJax.typesetClear?.();
      window.MathJax.typesetPromise();
    }
  }, [q, showExplain]);

  const choose = (idx) => {
    if (chosen !== null) return;
    setChosen(idx);
    setShowExplain(true);
    if (idx === q.correct) setScore(s => s + 1);
  };

  const next = () => {
    const nextIdx = i + 1;
    if (nextIdx >= data.length) onFinish(score + (chosen === q.correct ? 0 : 0)); // score ƒë√£ c·∫≠p nh·∫≠t r·ªìi
    else {
      setI(nextIdx);
      setChosen(null);
      setShowExplain(false);
    }
  };

  const questionHTML = oneLine(q.text);
  const rationaleHTML = oneLine(q.rationale);

  return (
    <div className="min-h-screen flex items-center justify-center p-4">
      <div className="bg-white text-slate-800 max-w-3xl w-full rounded-2xl p-6 shadow-xl">
        <div className="flex items-center justify-between mb-4">
          <div className="text-sm font-bold text-slate-500">
            C√¢u {i + 1}/{data.length} ‚Ä¢ {q.level}
          </div>
          <div className="text-sm font-bold text-indigo-600">
            ƒêi·ªÉm: {score}/{data.length}
          </div>
        </div>

        <h3
          className="text-xl md:text-2xl font-bold mb-4 nowrap-line"
          dangerouslySetInnerHTML={{ __html: questionHTML }}
        />

        <div className="grid md:grid-cols-2 gap-3 mb-4">
          {q.options.map((o, idx) => {
            const isCorrect = idx === q.correct;
            const isChosen = idx === chosen;
            const locked = chosen !== null;

            let cls = "border rounded-lg p-3 text-left nowrap-line transition ";
            if (!locked) cls += "hover:bg-blue-50";
            else if (isCorrect) cls += "bg-green-100 border-green-500";
            else if (isChosen) cls += "bg-red-100 border-red-500";
            else cls += "opacity-50";

            return (
              <button key={idx} onClick={() => choose(idx)} disabled={locked} className={cls}>
                <span className="font-bold mr-2">{String.fromCharCode(65 + idx)}.</span>
                <span dangerouslySetInnerHTML={{ __html: oneLine(o) }} />
              </button>
            );
          })}
        </div>

        {showExplain && (
          <div className="border-t pt-4 mt-4">
            <div className="font-bold text-blue-600 mb-1">
              üí° Gi·∫£i th√≠ch {chosen === q.correct ? "‚úÖ" : "‚ùå"}
            </div>
            <p className="nowrap-line" dangerouslySetInnerHTML={{ __html: rationaleHTML }} />
            <button
              onClick={next}
              className="mt-4 w-full py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-bold"
            >
              {i < data.length - 1 ? "C√ÇU TI·∫æP THEO ‚ûú" : "XEM K·∫æT QU·∫¢ üèÜ"}
            </button>
          </div>
        )}

        {chosen !== null && chosen === q.correct && <Confetti />}
      </div>
    </div>
  );
};

const App = () => {
  const [state, setState] = useState("start"); // start | playing | result
  const [final, setFinal] = useState(0);

  const prepared = useMemo(() => {
    // chu·∫©n h√≥a hi·ªÉn th·ªã 1 d√≤ng ngay t·ª´ data + random ƒë√°p √°n
    return rawQuestions.map(q => shuffleKeepCorrect({
      ...q,
      text: oneLine(q.text),
      rationale: oneLine(q.rationale),
      options: q.options.map(oneLine)
    }));
  }, []);

  const start = () => { setFinal(0); setState("playing"); };
  const finish = (score) => { setFinal(score); setState("result"); };

  if (state === "start") return <Start onStart={start} />;
  if (state === "result") return <Result score={final} total={prepared.length} onRestart={start} />;
  return <Game data={prepared} onFinish={finish} />;
};

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
