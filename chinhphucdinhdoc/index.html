<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinh Ph·ª•c ƒê·ªânh D·ªëc: Bi·ªát ƒê·ªôi H·ªá S·ªë G√≥c</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Condensed', sans-serif;
            background: #1a2a6c;
            background: linear-gradient(to right, #fdbb2d, #b21f1f, #1a2a6c);
            overflow-x: hidden;
            color: #fff;
        }

        .font-sport { font-family: 'Russo One', sans-serif; }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            border: 4px solid #fff;
            color: #333;
        }

        .btn-action {
            background: linear-gradient(45deg, #FF512F 0%, #DD2476 100%);
            box-shadow: 0 4px 15px rgba(221, 36, 118, 0.4);
            transition: all 0.2s ease;
        }
        .btn-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(221, 36, 118, 0.6);
        }
        .btn-action:active { transform: scale(0.95); }

        .option-card {
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            border-left: 6px solid transparent;
        }
        .option-card:hover {
            transform: translateX(10px);
            background-color: #f0f4f8;
            border-left: 6px solid #FF512F;
        }

        @keyframes mountainClimb {
            0% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }
        .climber-icon { animation: mountainClimb 2s infinite ease-in-out; }

        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 1; }
            80%, 100% { opacity: 0; }
        }
        .ring-anim::before {
            content: '';
            position: absolute;
            left: -10px; top: -10px; right: -10px; bottom: -10px;
            border: 2px solid #FF512F;
            border-radius: 50%;
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        .mountain-path {
            clip-path: polygon(0% 100%, 10% 80%, 20% 90%, 30% 60%, 40% 70%, 50% 40%, 60% 50%, 70% 20%, 80% 30%, 90% 10%, 100% 0%, 100% 100%);
            background: rgba(255,255,255,0.2);
        }
        .climber-progress { transition: left 0.5s ease, bottom 0.5s ease; }

        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #f00;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

    <!-- START SCREEN -->
    <div id="start-screen" class="glass-card p-8 max-w-2xl w-full text-center relative overflow-hidden">
        <div class="absolute top-0 right-0 p-4 opacity-20">
            <i class="fas fa-mountain text-9xl text-blue-900"></i>
        </div>

        <div class="mb-6 flex justify-center">
            <div class="bg-orange-100 p-6 rounded-full border-4 border-orange-500 ring-anim relative">
                <i class="fas fa-hiking text-6xl text-orange-600 climber-icon"></i>
            </div>
        </div>

        <h1 class="font-sport text-5xl md:text-6xl text-transparent bg-clip-text bg-gradient-to-r from-orange-600 to-red-600 mb-2 uppercase tracking-tighter">
            Chinh Ph·ª•c<br>ƒê·ªânh D·ªëc
        </h1>
        <p class="text-xl text-gray-600 font-bold mb-8 uppercase tracking-widest">Bi·ªát ƒê·ªôi H·ªá S·ªë G√≥c üìê</p>

        <div class="grid grid-cols-2 gap-4 text-left mb-8 bg-gray-50 p-6 rounded-xl border border-gray-200">
            <div class="flex items-center">
                <span class="bg-green-500 text-white w-8 h-8 rounded flex items-center justify-center font-bold mr-3">6</span>
                <span class="font-bold text-gray-700">Nh·∫≠n bi·∫øt</span>
            </div>
            <div class="flex items-center">
                <span class="bg-blue-500 text-white w-8 h-8 rounded flex items-center justify-center font-bold mr-3">5</span>
                <span class="font-bold text-gray-700">Th√¥ng hi·ªÉu</span>
            </div>
            <div class="flex items-center">
                <span class="bg-orange-500 text-white w-8 h-8 rounded flex items-center justify-center font-bold mr-3">3</span>
                <span class="font-bold text-gray-700">V·∫≠n d·ª•ng</span>
            </div>
            <div class="flex items-center">
                <span class="bg-red-600 text-white w-8 h-8 rounded flex items-center justify-center font-bold mr-3">1</span>
                <span class="font-bold text-gray-700">V·∫≠n d·ª•ng cao</span>
            </div>
        </div>

        <button onclick="startGame()" class="btn-action w-full text-white text-2xl py-4 rounded-xl font-sport uppercase tracking-wide">
            B·∫Øt ƒë·∫ßu leo n√∫i! <i class="fas fa-arrow-up ml-2"></i>
        </button>
    </div>

    <!-- QUIZ SCREEN -->
    <div id="quiz-screen" class="hidden w-full max-w-4xl flex flex-col h-[90vh]">
        <!-- HUD -->
        <div class="flex justify-between items-end mb-4 px-2">
            <div>
                <span class="text-orange-300 font-bold uppercase text-sm">ƒê·ªô cao hi·ªán t·∫°i</span>
                <div class="text-4xl font-sport text-white"><span id="score">0</span>m</div>
            </div>
            <div class="text-right">
                <span class="text-blue-200 font-bold uppercase text-sm">C√¢u h·ªèi</span>
                <div class="text-2xl font-sport text-white"><span id="q-current">1</span>/15</div>
            </div>
        </div>

        <!-- Progress Mountain -->
        <div class="relative h-16 w-full bg-white/10 rounded-lg mb-6 overflow-hidden border border-white/20">
            <div class="mountain-path absolute bottom-0 w-full h-full bg-orange-500/30"></div>
            <div id="climber-avatar" class="climber-progress absolute bottom-0 left-0">
                <i class="fas fa-hiking text-3xl text-yellow-300 drop-shadow-lg" style="transform: scaleX(-1);"></i>
            </div>
        </div>

        <!-- Main Card -->
        <div class="glass-card flex-1 flex flex-col overflow-hidden relative">
            <div id="level-badge" class="absolute top-0 right-0 bg-gray-800 text-white px-6 py-2 rounded-bl-xl font-bold uppercase text-sm z-10">
                Kh·ªüi ƒë·ªông
            </div>

            <div class="p-6 md:p-10 flex-1 overflow-y-auto">
                <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-gray-800 mb-8 leading-tight">
                    Loading question...
                </h2>

                <div id="options-container" class="grid grid-cols-1 gap-4"></div>
            </div>

            <!-- Feedback Panel -->
            <div id="feedback-panel" class="hidden bg-gray-900 text-white p-6 absolute bottom-0 w-full transform translate-y-full transition-transform duration-300 border-t-4 border-orange-500">
                <div class="flex items-start">
                    <div id="fb-icon" class="text-4xl mr-4 mt-1"></div>
                    <div class="flex-1">
                        <h3 id="fb-title" class="font-sport text-xl text-orange-400 mb-1 uppercase"></h3>
                        <p id="fb-text" class="text-gray-300 leading-relaxed"></p>
                    </div>
                </div>
                <button onclick="nextQuestion()" class="mt-4 w-full bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-lg font-bold uppercase">
                    Ti·∫øp t·ª•c <i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="result-screen" class="hidden glass-card p-8 max-w-md w-full text-center relative z-20">
        <div class="absolute -top-12 left-1/2 transform -translate-x-1/2 bg-white rounded-full p-4 shadow-xl border-4 border-yellow-400">
            <i class="fas fa-flag-checkered text-5xl text-black"></i>
        </div>

        <h2 class="font-sport text-4xl text-gray-800 mt-8 mb-2 uppercase">Chinh Ph·ª•c!</h2>
        <p class="text-gray-500 font-bold mb-6">B·∫°n ƒë√£ leo ƒë∆∞·ª£c bao nhi√™u m√©t?</p>

        <div class="bg-gradient-to-br from-orange-500 to-red-600 text-white rounded-2xl p-8 mb-8 shadow-inner">
            <div class="text-6xl font-sport mb-2"><span id="final-score">0</span>m</div>
            <div class="text-orange-200 text-sm font-bold uppercase tracking-widest">ƒê·ªô cao t·ªëi ƒëa: 1500m</div>
        </div>

        <p id="result-msg" class="text-lg font-bold text-blue-900 mb-8 px-4"></p>

        <button onclick="restartGame()" class="btn-action w-full text-white font-bold py-4 rounded-xl uppercase tracking-wider shadow-lg">
            <i class="fas fa-redo-alt mr-2"></i> Leo l·∫°i t·ª´ ƒë·∫ßu
        </button>
    </div>

    <script>
        /* =========================
           SOUND ENGINE (kh·ªüi t·∫°o sau click ƒë·ªÉ tr√°nh b·ªã ch·∫∑n)
           ========================= */
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playSound(type) {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const now = audioCtx.currentTime;

            if (type === 'correct') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);

                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
                gain.gain.setValueAtTime(0.12, now);
                gain.gain.linearRampToValueAtTime(0.001, now + 0.3);

                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'wrong') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);

                osc.type = 'square';
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.2);
                gain.gain.setValueAtTime(0.12, now);
                gain.gain.linearRampToValueAtTime(0.001, now + 0.2);

                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'win') {
                const notes = [523.25, 659.25, 783.99, 1046.50];
                notes.forEach((freq, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);

                    o.type = 'triangle';
                    o.frequency.value = freq;

                    const t0 = now + i * 0.1;
                    g.gain.setValueAtTime(0.10, t0);
                    g.gain.exponentialRampToValueAtTime(0.01, t0 + 0.5);

                    o.start(t0);
                    o.stop(t0 + 0.5);
                });
            }
        }

        /* =========================
           DATA (ƒê√É C√ÇN ƒê·ªÄU ABCD)
           - A = 4, B = 4, C = 4, D = 3
           - Sau ƒë√≥ s·∫Ω SHUFFLE ƒë√°p √°n khi hi·ªÉn th·ªã (random)
           ========================= */
        const questions = [
            // 1 (A)
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "Trong h√†m s·ªë b·∫≠c nh·∫•t y = ax + b (a ‚â† 0), h·ªá s·ªë a ƒë∆∞·ª£c g·ªçi l√† g√¨?",
                options: ["H·ªá s·ªë g√≥c", "H·ªá s·ªë t·ª± do", "Tung ƒë·ªô g·ªëc", "Ho√†nh ƒë·ªô g·ªëc"],
                correct: 0,
                rationale: "Trong ph∆∞∆°ng tr√¨nh y=ax+b, a ƒë∆∞·ª£c g·ªçi l√† h·ªá s·ªë g√≥c c·ªßa ƒë∆∞·ªùng th·∫≥ng."
            },
            // 2 (B)
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "T√¨m h·ªá s·ªë g√≥c a c·ªßa ƒë∆∞·ªùng th·∫≥ng y = 3x - 5.",
                options: ["a = -5", "a = 3", "a = 5", "a = -3"],
                correct: 1,
                rationale: "H·ªá s·ªë g√≥c l√† h·ªá s·ªë ƒëi k√®m v·ªõi bi·∫øn x. ·ªû ƒë√¢y a = 3."
            },
            // 3 (C)
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "ƒê∆∞·ªùng th·∫≥ng n√†o sau ƒë√¢y c√≥ h·ªá s·ªë g√≥c a = -2?",
                options: ["y = 2x - 2", "y = x - 2", "y = -2x + 1", "y = 2 - 2x"],
                correct: 2,
                rationale: "Ph∆∞∆°ng tr√¨nh y = -2x + 1 c√≥ h·ªá s·ªë c·ªßa x l√† -2."
            },
            // 4 (D)
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "G√≥c t·∫°o b·ªüi ƒë∆∞·ªùng th·∫≥ng y = ax + b v√† tr·ª•c Ox l√† g√≥c nh·ªçn khi n√†o?",
                options: ["a < 0", "a = 0", "b > 0", "a > 0"],
                correct: 3,
                rationale: "Khi h·ªá s·ªë g√≥c a > 0, ƒë∆∞·ªùng th·∫≥ng ƒëi l√™n t·ª´ tr√°i sang ph·∫£i, t·∫°o v·ªõi tr·ª•c Ox m·ªôt g√≥c nh·ªçn."
            },
            // 5 (A)
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "Hai ƒë∆∞·ªùng th·∫≥ng y = ax + b v√† y = a'x + b' song song v·ªõi nhau khi n√†o?",
                options: ["a = a' v√† b ‚â† b'", "a ‚â† a'", "a = a' v√† b = b'", "b = b'"],
                correct: 0,
                rationale: "Hai ƒë∆∞·ªùng th·∫≥ng song song c√≥ c√πng h·ªá s·ªë g√≥c (a = a') nh∆∞ng tung ƒë·ªô g·ªëc kh√°c nhau (b ‚â† b')."
            },
            // 6 (B)
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "Hai ƒë∆∞·ªùng th·∫≥ng c·∫Øt nhau khi v√† ch·ªâ khi:",
                options: ["a = a'", "a ‚â† a'", "b ‚â† b'", "a . a' = 1"],
                correct: 1,
                rationale: "ƒêi·ªÅu ki·ªán ƒë·ªÉ hai ƒë∆∞·ªùng th·∫≥ng c·∫Øt nhau l√† h·ªá s·ªë g√≥c c·ªßa ch√∫ng ph·∫£i kh√°c nhau (a ‚â† a')."
            },

            // 7 (C)
            {
                level: "Th√¥ng hi·ªÉu",
                text: "Cho hai ƒë∆∞·ªùng th·∫≥ng (d1): y = 2x + 1 v√† (d2): y = 2x - 3. Kh·∫≥ng ƒë·ªãnh n√†o ƒë√∫ng?",
                options: ["(d1) c·∫Øt (d2)", "(d1) vu√¥ng g√≥c (d2)", "(d1) song song (d2)", "(d1) tr√πng (d2)"],
                correct: 2,
                rationale: "a1 = 2 v√† a2 = 2; b1 = 1 ‚â† b2 = -3 ‚áí song song."
            },
            // 8 (D)
            {
                level: "Th√¥ng hi·ªÉu",
                text: "So s√°nh g√≥c t·∫°o b·ªüi c√°c ƒë∆∞·ªùng th·∫≥ng y = 2x + 1 (g√≥c Œ±) v√† y = 4x + 1 (g√≥c Œ≤) v·ªõi tr·ª•c Ox.",
                options: ["Œ± > Œ≤", "Œ± = Œ≤", "Kh√¥ng so s√°nh ƒë∆∞·ª£c", "Œ± < Œ≤"],
                correct: 3,
                rationale: "V·ªõi a>0, a c√†ng l·ªõn th√¨ g√≥c c√†ng l·ªõn. V√¨ 2 < 4 n√™n Œ± < Œ≤."
            },
            // 9 (A)
            {
                level: "Th√¥ng hi·ªÉu",
                text: "H·ªá s·ªë g√≥c c·ªßa ƒë∆∞·ªùng th·∫≥ng ƒëi qua g·ªëc t·ªça ƒë·ªô O(0;0) v√† ƒëi·ªÉm M(1; 3) l√† bao nhi√™u?",
                options: ["3", "1/3", "-3", "1"],
                correct: 0,
                rationale: "Qua O ‚áí y=ax. Qua M(1;3) ‚áí a=3."
            },
            // 10 (B)
            {
                level: "Th√¥ng hi·ªÉu",
                text: "T√¨m m ƒë·ªÉ ƒë∆∞·ªùng th·∫≥ng y = (m-1)x + 2 song song v·ªõi ƒë∆∞·ªùng th·∫≥ng y = 3x - 1.",
                options: ["m = 3", "m = 4", "m = 2", "m = -2"],
                correct: 1,
                rationale: "Song song ‚áí m-1 = 3 ‚áí m = 4."
            },
            // 11 (C)
            {
                level: "Th√¥ng hi·ªÉu",
                text: "Trong c√°c ƒë∆∞·ªùng th·∫≥ng sau, ƒë∆∞·ªùng th·∫≥ng n√†o t·∫°o v·ªõi tr·ª•c Ox g√≥c t√π?",
                options: ["y = x + 5", "y = 3x", "y = -0.5x + 4", "y = 100x"],
                correct: 2,
                rationale: "G√≥c t√π khi a < 0. Ch·ªâ c√≥ a = -0.5."
            },

            // 12 (D)
            {
                level: "V·∫≠n d·ª•ng",
                text: "Vi·∫øt ph∆∞∆°ng tr√¨nh ƒë∆∞·ªùng th·∫≥ng ƒëi qua ƒëi·ªÉm A(0; 3) v√† song song v·ªõi ƒë∆∞·ªùng th·∫≥ng y = -2x + 1.",
                options: ["y = 2x + 3", "y = -2x + 1", "y = 3x - 2", "y = -2x + 3"],
                correct: 3,
                rationale: "Song song ‚áí a=-2. Qua A(0;3) ‚áí b=3 ‚áí y=-2x+3."
            },
            // 13 (A)
            {
                level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
                text: "M·ªôt c√°i d·ªëc c√≥ ƒë·ªô d·ªëc 10% (ƒëi ngang 100m th√¨ l√™n 10m). H·ªá s·ªë g√≥c a l√† bao nhi√™u?",
                options: ["a = 0.1", "a = 10", "a = 1", "a = 100"],
                correct: 0,
                rationale: "a = 10/100 = 0.1."
            },
            // 14 (B)
            {
                level: "V·∫≠n d·ª•ng",
                text: "T√¨m gi√° tr·ªã c·ªßa m ƒë·ªÉ hai ƒë∆∞·ªùng th·∫≥ng y = 2x + 3 v√† y = (m+1)x + 2 c·∫Øt nhau.",
                options: ["m = 1", "m ‚â† 1", "m ‚â† 2", "m ‚â† -1"],
                correct: 1,
                rationale: "C·∫Øt nhau ‚áí h·ªá s·ªë g√≥c kh√°c nhau: m+1 ‚â† 2 ‚áí m ‚â† 1."
            },

            // 15 (C)
            {
                level: "V·∫≠n d·ª•ng cao",
                text: "Cho ba ƒëi·ªÉm A(2; -1), B(1; 1), C(3; k). T√¨m k ƒë·ªÉ ba ƒëi·ªÉm A, B, C th·∫≥ng h√†ng.",
                options: ["k = 3", "k = -2", "k = -3", "k = -5"],
                correct: 2,
                rationale: "a_AB = (1-(-1))/(1-2)=2/(-1)=-2 ‚áí y=-2x+3. Thay x=3 ‚áí k=-2¬∑3+3=-3."
            }
        ];

        /* =========================
           RANDOM TH·ª® T·ª∞ ƒê√ÅP √ÅN
           ========================= */
        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }

        function prepareQuestion(q) {
            const nq = { ...q, options: [...q.options] };
            const correctText = nq.options[nq.correct];
            shuffleArray(nq.options);
            nq.correct = nq.options.indexOf(correctText);
            return nq;
        }

        let currentIdx = 0;
        let score = 0;      // m·ªói c√¢u ƒë√∫ng +100m
        let isLocked = false;
        let currentQ = null;

        function setLevelBadge(level) {
            const badge = document.getElementById('level-badge');
            badge.innerText = level;

            if (level.includes("Nh·∫≠n bi·∫øt"))
                badge.className = "absolute top-0 right-0 bg-green-600 text-white px-6 py-2 rounded-bl-xl font-bold uppercase text-sm z-10";
            else if (level.includes("Th√¥ng hi·ªÉu"))
                badge.className = "absolute top-0 right-0 bg-blue-600 text-white px-6 py-2 rounded-bl-xl font-bold uppercase text-sm z-10";
            else if (level.includes("V·∫≠n d·ª•ng cao"))
                badge.className = "absolute top-0 right-0 bg-red-600 text-white px-6 py-2 rounded-bl-xl font-bold uppercase text-sm z-10";
            else
                badge.className = "absolute top-0 right-0 bg-orange-500 text-white px-6 py-2 rounded-bl-xl font-bold uppercase text-sm z-10";
        }

        function startGame() {
            initAudio();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            document.getElementById('quiz-screen').classList.add('flex');
            loadQuestion();
        }

        function loadQuestion() {
            isLocked = false;

            // random ƒë√°p √°n m·ªói l·∫ßn load c√¢u
            currentQ = prepareQuestion(questions[currentIdx]);

            document.getElementById('q-current').innerText = currentIdx + 1;
            document.getElementById('question-text').innerText = currentQ.text;
            setLevelBadge(currentQ.level);

            // Climber progress (ƒëi t·ªõi 100% ·ªü c√¢u cu·ªëi)
            const climber = document.getElementById('climber-avatar');
            const denom = Math.max(1, questions.length - 1);
            const pct = (currentIdx / denom) * 100;
            climber.style.left = `${pct}%`;
            climber.style.bottom = `${pct / 3}%`;

            // hide feedback panel m∆∞·ª£t
            const fbPanel = document.getElementById('feedback-panel');
            fbPanel.classList.add('translate-y-full');
            fbPanel.classList.add('hidden');

            const container = document.getElementById('options-container');
            container.innerHTML = '';

            currentQ.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "option-card w-full p-5 bg-white border border-gray-200 rounded-lg text-left text-lg text-gray-700 font-medium shadow-sm hover:shadow-md relative overflow-hidden";
                btn.innerHTML = `<span class="inline-block w-8 font-bold text-gray-400 mr-2">${String.fromCharCode(65 + idx)}.</span> ${opt}`;
                btn.onclick = () => checkAnswer(idx, btn);
                container.appendChild(btn);
            });
        }

        function checkAnswer(selectedIdx, btn) {
            if (isLocked) return;
            isLocked = true;

            const q = currentQ;
            const isCorrect = selectedIdx === q.correct;
            const allBtns = document.getElementById('options-container').children;

            if (isCorrect) {
                score += 100;
                document.getElementById('score').innerText = score;
                playSound('correct');
                fireConfetti();

                btn.classList.add('bg-green-100', 'border-green-500', 'text-green-900');
                btn.innerHTML += `<i class="fas fa-check-circle absolute right-4 top-1/2 -translate-y-1/2 text-green-500 text-2xl"></i>`;
                showFeedback(true, q.rationale);
            } else {
                playSound('wrong');

                btn.classList.add('bg-red-50', 'border-red-500', 'text-red-900');
                btn.innerHTML += `<i class="fas fa-times-circle absolute right-4 top-1/2 -translate-y-1/2 text-red-500 text-2xl"></i>`;

                const correctBtn = allBtns[q.correct];
                correctBtn.classList.add('bg-green-50', 'border-green-500');
                correctBtn.innerHTML += `<i class="fas fa-check-circle absolute right-4 top-1/2 -translate-y-1/2 text-green-500 text-2xl opacity-50"></i>`;
                showFeedback(false, q.rationale);
            }

            Array.from(allBtns).forEach(b => b.disabled = true);
        }

        function showFeedback(isCorrect, text) {
            const panel = document.getElementById('feedback-panel');
            const title = document.getElementById('fb-title');
            const icon = document.getElementById('fb-icon');
            const content = document.getElementById('fb-text');

            panel.classList.remove('hidden');

            // ƒë·ªÉ transition ch·∫°y m∆∞·ª£t
            requestAnimationFrame(() => panel.classList.remove('translate-y-full'));

            if (isCorrect) {
                panel.className = "bg-green-900 text-white p-6 absolute bottom-0 w-full transform transition-transform duration-300 border-t-4 border-green-500 shadow-2xl z-20";
                icon.innerHTML = "üßó";
                title.innerText = "Ch√≠nh x√°c! Leo ti·∫øp th√¥i!";
                title.className = "font-sport text-xl text-green-400 mb-1 uppercase";
            } else {
                panel.className = "bg-red-900 text-white p-6 absolute bottom-0 w-full transform transition-transform duration-300 border-t-4 border-red-500 shadow-2xl z-20";
                icon.innerHTML = "‚ö†Ô∏è";
                title.innerText = "Tr∆∞·ª£t ch√¢n r·ªìi!";
                title.className = "font-sport text-xl text-red-400 mb-1 uppercase";
            }

            content.innerHTML = `<strong class="text-white">Gi·∫£i th√≠ch:</strong> ${text}`;
        }

        function nextQuestion() {
            currentIdx++;
            if (currentIdx < questions.length) loadQuestion();
            else showResult();
        }

        function showResult() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;

            const msg = document.getElementById('result-msg');
            playSound('win');
            fireConfetti();

            if (score === 1500) msg.innerText = "ƒê·ªàNH C·ª¶A CH√ìP! B·∫°n ƒë√£ chinh ph·ª•c ƒë·ªânh Everest to√°n h·ªçc! üèîÔ∏èüëë";
            else if (score >= 1200) msg.innerText = "TUY·ªÜT V·ªúI! M·ªôt nh√† leo n√∫i t√†i ba v·ªõi ki·∫øn th·ª©c v·ªØng v√†ng! üßó‚Äç‚ôÇÔ∏è";
            else if (score >= 800) msg.innerText = "KH√Å L·∫ÆM! B·∫°n ƒë√£ v∆∞·ª£t qua n·ª≠a ch·∫∑ng ƒë∆∞·ªùng, c·ªë l√™n nh√©! üí™";
            else msg.innerText = "ƒê·ª™NG N·∫¢N CH√ç! H√£y r√®n luy·ªán th√™m k·ªπ nƒÉng leo n√∫i (v√† to√°n h·ªçc) nh√©! üéí";
        }

        function restartGame() {
            currentIdx = 0;
            score = 0;
            document.getElementById('score').innerText = '0';
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }

        function fireConfetti() {
            const colors = ['#FF512F', '#DD2476', '#FFD700', '#ffffff'];
            for (let i = 0; i < 60; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.animationDuration = (Math.random() * 2 + 1) + 's';
                conf.style.top = '-10px';
                document.body.appendChild(conf);
                setTimeout(() => conf.remove(), 3000);
            }
        }
    </script>
</body>
</html>
