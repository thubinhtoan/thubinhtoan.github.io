<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BÃ­ Máº­t Kim Tá»± ThÃ¡p - HÃ¬nh chÃ³p tam giÃ¡c & tá»© giÃ¡c Ä‘á»u</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Josefin+Sans:wght@400;600;700&display=swap');

        :root {
            --sand: #f4d28b;
            --dark-sand: #c79b4b;
            --night: #0b1020;
            --gold: #ffd54f;
        }

        body {
            margin: 0;
            font-family: 'Josefin Sans', system-ui, sans-serif;
            background: radial-gradient(circle at top, #243b53 0%, #020308 60%);
            color: #fefce8;
            overflow: hidden;
            user-select: none;
        }

        .title-font {
            font-family: 'Alfa Slab One', cursive;
        }

        /* --- Background Desert & Stars --- */
        #bg-layer {
            position: fixed;
            inset: 0;
            z-index: -2;
            overflow: hidden;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            opacity: 0.5;
            animation: twinkle 2s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.4); }
        }

        .desert {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 130%;
            height: 30%;
            background: radial-gradient(circle at top, #ffecb3 0%, #c79b4b 45%, #8d5a2b 100%);
            transform: translateX(-10%);
        }

        /* --- Pyramid --- */
        #game-area {
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
            border: 2px solid rgba(253, 224, 71, 0.5);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
            background: radial-gradient(circle at top, #1f2937 0%, #020617 60%);
        }

        .pyramid {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 230px;
            height: 160px;
            perspective: 800px;
        }

        .pyramid-face {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 120px solid transparent;
            border-right: 120px solid transparent;
            border-bottom: 190px solid #d7b46a;
            filter: drop-shadow(0 0 20px rgba(0, 0, 0, 0.7));
        }

        .pyramid-face::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.35), transparent 40%, rgba(0,0,0,0.45));
            mix-blend-mode: screen;
        }

        .pyramid-shadow {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%) skewX(-20deg);
            width: 260px;
            height: 40px;
            background: radial-gradient(circle, rgba(0,0,0,0.6), transparent 70%);
            filter: blur(4px);
        }

        .pyramid-door {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 40px;
            height: 55px;
            transform: translateX(-50%);
            background: linear-gradient(to top, #4b2f16, #8d5524);
            border-radius: 4px 4px 0 0;
            box-shadow: 0 0 12px rgba(0,0,0,0.9);
        }

        .pyramid-door::after {
            content: "";
            position: absolute;
            inset: 8px;
            border-radius: 3px 3px 0 0;
            border: 2px solid rgba(255, 215, 64, 0.4);
        }

        .door-glow {
            box-shadow: 0 0 25px rgba(255, 235, 59, 0.9);
            background: radial-gradient(circle at top, #fff7c2 0%, #f59e0b 45%, #7c2d12 100%);
        }

        .explorer {
            position: absolute;
            bottom: 10px;
            left: 15%;
            font-size: 3rem;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.7));
            transition: transform 0.3s ease;
        }

        .explorer.jump {
            transform: translateY(-10px);
        }

        /* --- Buttons --- */
        .btn-answer {
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(148,163,184,0.8);
            color: #e5e7eb;
            transition: all 0.18s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .btn-answer:hover {
            background: rgba(30,64,175,0.7);
            border-color: #fbbf24;
            transform: translateX(4px);
            box-shadow: 0 0 12px rgba(251,191,36,0.5);
        }

        .btn-answer.correct {
            background: linear-gradient(to right, #166534, #22c55e) !important;
            border-color: #bbf7d0 !important;
            color: #ecfdf5 !important;
            box-shadow: 0 0 18px rgba(34,197,94,0.9);
        }

        .btn-answer.wrong {
            background: linear-gradient(to right, #7f1d1d, #b91c1c) !important;
            border-color: #fecaca !important;
            color: #fee2e2 !important;
            box-shadow: 0 0 18px rgba(248,113,113,0.9);
        }

        /* --- Explanation Box --- */
        #explanation-box {
            background: rgba(15, 23, 42, 0.96);
            border-left: 4px solid #facc15;
            border-radius: 0.75rem;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        #explanation-box.show {
            max-height: 400px;
            opacity: 1;
            padding: 0.75rem 1rem 1rem 1rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 0 18px rgba(0,0,0,0.6);
        }

        /* --- Feedback Emoji Overlay --- */
        #feedback-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 40;
        }

        #feedback-emoji {
            font-size: 6rem;
            opacity: 0;
            transform: scale(0);
            transition: all 0.4s cubic-bezier(0.22, 0.61, 0.36, 1);
        }

        #feedback-emoji.show {
            opacity: 1;
            transform: scale(1.3);
        }

        /* --- Shake for wrong --- */
        .shake {
            animation: shake 0.45s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Confetti canvas is full screen; CSS in tag */

    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-3 md:p-6">

    <!-- Background -->
    <div id="bg-layer">
        <div class="desert"></div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="fixed inset-0 flex items-center justify-center z-30 bg-black/90">
        <div class="max-w-3xl w-full mx-4 panel bg-slate-900/90 border border-yellow-500 rounded-2xl p-8 shadow-[0_0_40px_rgba(250,204,21,0.35)]">
            <h1 class="title-font text-4xl md:text-5xl text-yellow-300 text-center mb-3 tracking-[0.2em]">
                BÃ Máº¬T KIM Tá»° THÃP
            </h1>
            <p class="text-center text-sm uppercase tracking-[0.3em] text-amber-200 mb-6">
                HÃ¬nh chÃ³p tam giÃ¡c & tá»© giÃ¡c Ä‘á»u â€“ ToÃ¡n 8
            </p>

            <p class="text-amber-100 text-center mb-6">
                Má»—i cÃ¢u tráº£ lá»i Ä‘Ãºng sáº½ má»Ÿ thÃªm má»™t <span class="font-semibold text-yellow-300">cá»­a háº§m bÃ­ máº­t</span> trong Kim Tá»± ThÃ¡p.  
                Tráº£ lá»i sai, cÃ¡t sáº½ sá»¥t xuá»‘ng vÃ  báº¡n pháº£i tháº­t cáº©n tháº­n!
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm mb-6">
                <div class="bg-slate-800/80 rounded-lg p-3 border border-amber-500/60">
                    <div class="font-bold text-amber-300 mb-1">Cáº¥p Ä‘á»™ 1 â€“ Cá»­a háº§m bÃ­ máº­t</div>
                    <div class="text-amber-100">6 cÃ¢u Nháº­n biáº¿t: nháº­n diá»‡n Ä‘Ã¡y, máº·t, cáº¡nh, Ä‘Æ°á»ng cao.</div>
                </div>
                <div class="bg-slate-800/80 rounded-lg p-3 border border-sky-400/60">
                    <div class="font-bold text-sky-300 mb-1">Cáº¥p Ä‘á»™ 2 â€“ HÃ nh lang mÃª cung</div>
                    <div class="text-amber-100">5 cÃ¢u ThÃ´ng hiá»ƒu: trung Ä‘oáº¡n, thá»ƒ tÃ­ch, tÃ­nh cháº¥t hÃ¬nh chÃ³p.</div>
                </div>
                <div class="bg-slate-800/80 rounded-lg p-3 border border-lime-400/60">
                    <div class="font-bold text-lime-300 mb-1">Cáº¥p Ä‘á»™ 3 â€“ Máº­t mÃ£ kho bÃ¡u</div>
                    <div class="text-amber-100">3 cÃ¢u Váº­n dá»¥ng: bÃ i toÃ¡n thá»±c táº¿ vá» S<sub>xq</sub>, V.</div>
                </div>
                <div class="bg-slate-800/80 rounded-lg p-3 border border-red-500/80">
                    <div class="font-bold text-red-300 mb-1">Cáº¥p Ä‘á»™ 4 â€“ Ngai vÃ ng Pharaoh</div>
                    <div class="text-amber-100">1 cÃ¢u Váº­n dá»¥ng cao: káº¿t há»£p Pytago & hÃ¬nh chÃ³p.</div>
                </div>
            </div>

            <button
                onclick="startGame()"
                class="w-full md:w-auto mx-auto block px-10 py-3 rounded-xl bg-gradient-to-r from-amber-500 via-yellow-400 to-amber-600 text-slate-900 font-bold text-lg shadow-[0_0_25px_rgba(250,204,21,0.8)] hover:scale-105 transition transform"
            >
                Báº®T Äáº¦U KHAM PHÃ â›ï¸
            </button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="hidden w-full max-w-5xl flex-col gap-3">
        <!-- Header -->
        <div class="flex justify-between items-end gap-3">
            <div class="bg-slate-900/80 border border-yellow-500/60 rounded-xl px-4 py-2">
                <div class="text-[0.65rem] uppercase text-yellow-300/80 tracking-[0.3em] mb-1">
                    Cáº¥p Ä‘á»™
                </div>
                <div id="level-label" class="font-semibold text-sm text-yellow-100">
                    Cá»­a háº§m bÃ­ máº­t â€“ Nháº­n biáº¿t
                </div>
            </div>

            <div class="flex-1">
                <div class="flex justify-between text-[0.65rem] text-slate-200 uppercase mb-1">
                    <span>0%</span><span>Tiáº¿n Ä‘á»™</span><span>100%</span>
                </div>
                <div class="w-full h-2 rounded-full bg-slate-800 overflow-hidden">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-amber-400 via-yellow-300 to-lime-300 w-0 transition-all duration-300"></div>
                </div>
            </div>

            <div class="bg-slate-900/80 border border-sky-400/60 rounded-xl px-4 py-2 text-right">
                <div class="text-[0.65rem] uppercase text-sky-300/80 tracking-[0.3em] mb-1">
                    Äiá»ƒm sá»‘
                </div>
                <div id="score" class="font-mono text-3xl font-bold text-amber-200">
                    0000
                </div>
            </div>
        </div>

        <!-- Visual Area -->
        <div id="game-area" class="mt-1 h-[210px] md:h-[240px]">
            <div class="pyramid">
                <div class="pyramid-face"></div>
                <div id="pyramid-door" class="pyramid-door"></div>
                <div class="pyramid-shadow"></div>
            </div>
            <div id="explorer" class="explorer">ğŸ§‘â€ğŸ“</div>
        </div>

        <!-- Question Panel -->
        <div class="bg-slate-900/90 border border-slate-600/70 rounded-2xl p-4 md:p-5 relative">
            <div class="absolute top-0 right-0 rounded-bl-xl rounded-tr-2xl px-3 py-1 bg-amber-500/90 text-slate-900 text-xs font-bold flex items-center gap-1">
                CÃ‚U <span id="question-number">1</span>/15
            </div>
            <div id="question-text" class="text-base md:text-xl leading-relaxed text-amber-50 text-center px-1 md:px-4 mt-3 md:mt-4">
                Äang táº£i cÃ¢u há»i...
            </div>
        </div>

        <!-- Explanation -->
        <div id="explanation-box" class="text-sm md:text-base">
            <div class="flex items-center gap-2 mb-1 text-yellow-300 font-semibold">
                <span>ğŸ“œ</span>
                <span>Giáº£i mÃ£ bÃ­ máº­t:</span>
            </div>
            <div id="explanation-content" class="text-amber-50 leading-relaxed"></div>
        </div>

        <!-- Options -->
        <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-1">
            <!-- Buttons injected here -->
        </div>

        <!-- Next button -->
        <div id="next-btn-container" class="hidden text-center pb-2">
            <button
                onclick="nextQuestion()"
                class="inline-flex items-center gap-2 px-8 py-2.5 rounded-xl bg-sky-600 hover:bg-sky-500 text-slate-50 font-semibold shadow-lg border border-sky-300 transition"
            >
                Cá»¬A BÃ Máº¬T TIáº¾P THEO â†’
            </button>
        </div>
    </div>

    <!-- End Screen -->
    <div id="end-screen" class="hidden fixed inset-0 z-30 flex items-center justify-center bg-black/90">
        <div class="max-w-xl w-full mx-4 bg-slate-900/95 border-2 border-amber-400 rounded-2xl p-8 text-center shadow-[0_0_40px_rgba(250,204,21,0.7)]">
            <div class="text-6xl mb-4">ğŸ‘‘</div>
            <h2 class="title-font text-4xl text-yellow-300 mb-3 tracking-[0.2em]">
                PHARAOH TOÃN Há»ŒC
            </h2>
            <p class="text-amber-100 mb-6">
                Báº¡n Ä‘Ã£ má»Ÿ háº¿t má»i cÃ¡nh cá»­a vÃ  chinh phá»¥c <span class="font-semibold text-yellow-300">BÃ­ Máº­t Kim Tá»± ThÃ¡p</span>!
            </p>
            <div class="inline-block px-6 py-4 rounded-xl bg-slate-800/90 border border-amber-300 mb-6">
                <div class="text-xs uppercase text-amber-200/80 tracking-[0.25em] mb-1">
                    Tá»•ng Ä‘iá»ƒm
                </div>
                <div id="final-score" class="font-mono text-5xl text-amber-100 font-bold">
                    0
                </div>
            </div>
            <button
                onclick="location.reload()"
                class="px-8 py-3 rounded-xl bg-gradient-to-r from-sky-500 to-emerald-400 text-slate-900 font-semibold shadow-lg hover:scale-105 transition"
            >
                CHÆ I Láº I Tá»ª Äáº¦U ğŸ”
            </button>
        </div>
    </div>

    <!-- Feedback Emoji -->
    <div id="feedback-overlay">
        <div id="feedback-emoji">ğŸŒŸ</div>
    </div>

    <!-- Confetti -->
    <canvas id="confetti-canvas" class="fixed inset-0 pointer-events-none z-20 w-full h-full"></canvas>

    <script>
        // ----------------------
        // Dá»® LIá»†U CÃ‚U Há»I
        // ----------------------
        const questions = [
            // Cáº¤P 1: NHáº¬N BIáº¾T
            {
                q: "Quan sÃ¡t hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u S.ABC. Máº·t Ä‘Ã¡y ABC lÃ  hÃ¬nh gÃ¬?",
                a: [
                    "Tam giÃ¡c cÃ¢n",
                    "Tam giÃ¡c vuÃ´ng",
                    "Tam giÃ¡c Ä‘á»u",
                    "Tam giÃ¡c thÆ°á»ng"
                ],
                correct: 2, // C
                rationale: "Trong hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u, Ä‘Ã¡y lÃ  tam giÃ¡c Ä‘á»u nÃªn ba cáº¡nh Ä‘Ã¡y báº±ng nhau vÃ  ba gÃ³c á»Ÿ Ä‘Ã¡y cÅ©ng báº±ng nhau.",
                level: "NHáº¬N BIáº¾T"
            },
            {
                q: "HÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u cÃ³ bao nhiÃªu máº·t bÃªn?",
                a: [
                    "4 máº·t",
                    "3 máº·t",
                    "5 máº·t",
                    "6 máº·t"
                ],
                correct: 0, // A
                rationale: "ÄÃ¡y lÃ  hÃ¬nh vuÃ´ng nÃªn cÃ³ 4 cáº¡nh Ä‘Ã¡y, tÆ°Æ¡ng á»©ng cÃ³ 4 máº·t bÃªn lÃ  4 tam giÃ¡c cÃ¢n.",
                level: "NHáº¬N BIáº¾T"
            },
            {
                q: "Trong hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u, chÃ¢n Ä‘Æ°á»ng cao trÃ¹ng vá»›i Ä‘iá»ƒm nÃ o sau Ä‘Ã¢y?",
                a: [
                    "Má»™t Ä‘á»‰nh cá»§a Ä‘Ã¡y",
                    "Trung Ä‘iá»ƒm cá»§a má»™t cáº¡nh Ä‘Ã¡y",
                    "Trá»ng tÃ¢m cá»§a má»™t máº·t bÃªn",
                    "Giao Ä‘iá»ƒm hai Ä‘Æ°á»ng chÃ©o cá»§a Ä‘Ã¡y"
                ],
                correct: 3, // D
                rationale: "TÃ¢m Ä‘Ã¡y cá»§a hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u lÃ  giao Ä‘iá»ƒm hai Ä‘Æ°á»ng chÃ©o cá»§a hÃ¬nh vuÃ´ng Ä‘Ã¡y, nÃªn Ä‘Æ°á»ng cao Ä‘i qua Ä‘iá»ƒm nÃ y.",
                level: "NHáº¬N BIáº¾T"
            },
            {
                q: "TÃªn gá»i cá»§a Ä‘oáº¡n tháº³ng ná»‘i tá»« Ä‘á»‰nh hÃ¬nh chÃ³p vuÃ´ng gÃ³c xuá»‘ng tÃ¢m cá»§a Ä‘Ã¡y lÃ  gÃ¬?",
                a: [
                    "Trung Ä‘oáº¡n",
                    "Cáº¡nh bÃªn",
                    "Chiá»u cao (Ä‘Æ°á»ng cao)",
                    "ÄÆ°á»ng trung tuyáº¿n"
                ],
                correct: 2, // C
                rationale: "Äoáº¡n tháº³ng ná»‘i Ä‘á»‰nh vÃ  vuÃ´ng gÃ³c vá»›i máº·t Ä‘Ã¡y chÃ­nh lÃ  chiá»u cao (hay Ä‘Æ°á»ng cao) cá»§a hÃ¬nh chÃ³p.",
                level: "NHáº¬N BIáº¾T"
            },
            {
                q: "CÃ¡c máº·t bÃªn cá»§a chÃ³p tam giÃ¡c Ä‘á»u lÃ  hÃ¬nh gÃ¬?",
                a: [
                    "Tam giÃ¡c Ä‘á»u",
                    "Tam giÃ¡c cÃ¢n",
                    "Tam giÃ¡c vuÃ´ng",
                    "HÃ¬nh chá»¯ nháº­t"
                ],
                correct: 1, // B
                rationale: "Ba cáº¡nh bÃªn báº±ng nhau vÃ  táº¡o vá»›i máº·t Ä‘Ã¡y nhá»¯ng gÃ³c báº±ng nhau nÃªn má»—i máº·t bÃªn lÃ  tam giÃ¡c cÃ¢n cÃ³ Ä‘Ã¡y lÃ  cáº¡nh cá»§a tam giÃ¡c Ä‘Ã¡y.",
                level: "NHáº¬N BIáº¾T"
            },
            {
                q: "HÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u cÃ³ bao nhiÃªu cáº¡nh (tá»•ng cáº¡nh bÃªn vÃ  cáº¡nh Ä‘Ã¡y)?",
                a: [
                    "4 cáº¡nh",
                    "6 cáº¡nh",
                    "8 cáº¡nh",
                    "5 cáº¡nh"
                ],
                correct: 1, // B
                rationale: "ÄÃ¡y lÃ  tam giÃ¡c nÃªn cÃ³ 3 cáº¡nh Ä‘Ã¡y, thÃªm 3 cáº¡nh bÃªn ná»‘i Ä‘á»‰nh vá»›i 3 Ä‘á»‰nh Ä‘Ã¡y, tá»•ng cá»™ng lÃ  6 cáº¡nh.",
                level: "NHáº¬N BIáº¾T"
            },

            // Cáº¤P 2: THÃ”NG HIá»‚U
            {
                q: "Trung Ä‘oáº¡n cá»§a hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u lÃ  Ä‘oáº¡n tháº³ng ná»‘i tá»« Ä‘á»‰nh hÃ¬nh chÃ³p Ä‘áº¿n:",
                a: [
                    "TÃ¢m cá»§a Ä‘Ã¡y",
                    "Má»™t Ä‘á»‰nh cá»§a Ä‘Ã¡y",
                    "Trá»ng tÃ¢m máº·t Ä‘Ã¡y",
                    "Trung Ä‘iá»ƒm cá»§a má»™t cáº¡nh Ä‘Ã¡y"
                ],
                correct: 3, // D
                rationale: "Theo Ä‘á»‹nh nghÄ©a trong bÃ i há»c, trung Ä‘oáº¡n cá»§a hÃ¬nh chÃ³p ná»‘i Ä‘á»‰nh hÃ¬nh chÃ³p vá»›i trung Ä‘iá»ƒm cá»§a má»™t cáº¡nh Ä‘Ã¡y.",
                level: "THÃ”NG HIá»‚U"
            },
            {
                q: "Má»™t hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u cÃ³ cáº¡nh Ä‘Ã¡y 10cm, chiá»u cao máº·t bÃªn (Ä‘Æ°á»ng cao cÃ¡c tam giÃ¡c bÃªn) báº±ng 12cm. Diá»‡n tÃ­ch xung quanh S<sub>xq</sub> cá»§a hÃ¬nh chÃ³p lÃ :",
                a: [
                    "240 cm<sup>2</sup>",
                    "120 cm<sup>2</sup>",
                    "480 cm<sup>2</sup>",
                    "60 cm<sup>2</sup>"
                ],
                correct: 0, // A
                rationale: "ÄÃ¡y lÃ  hÃ¬nh vuÃ´ng cáº¡nh 10 nÃªn chu vi Ä‘Ã¡y lÃ  40, ná»­a chu vi p = 20. Ta cÃ³ S<sub>xq</sub> = p.d = 20 Â· 12 = 240 cm<sup>2</sup>.",
                level: "THÃ”NG HIá»‚U"
            },
            {
                q: "Khi khai triá»ƒn (tráº£i pháº³ng) má»™t hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u, ta sáº½ thu Ä‘Æ°á»£c:",
                a: [
                    "1 tam giÃ¡c Ä‘á»u vÃ  3 tam giÃ¡c cÃ¢n báº±ng nhau chung Ä‘Ã¡y vá»›i tam giÃ¡c Ä‘á»u Ä‘Ã³",
                    "4 tam giÃ¡c Ä‘á»u báº±ng nhau",
                    "1 hÃ¬nh vuÃ´ng vÃ  4 tam giÃ¡c cÃ¢n",
                    "3 tam giÃ¡c Ä‘á»u vÃ  1 tam giÃ¡c cÃ¢n"
                ],
                correct: 0, // A
                rationale: "ÄÃ¡y lÃ  tam giÃ¡c Ä‘á»u, má»—i máº·t bÃªn lÃ  tam giÃ¡c cÃ¢n cÃ³ chung cáº¡nh Ä‘Ã¡y vá»›i tam giÃ¡c Ä‘á»u nÃªn khi khai triá»ƒn ta Ä‘Æ°á»£c 1 tam giÃ¡c Ä‘á»u á»Ÿ giá»¯a vÃ  3 tam giÃ¡c cÃ¢n xung quanh.",
                level: "THÃ”NG HIá»‚U"
            },
            {
                q: "Cho hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u S.DEF cÃ³ cáº¡nh Ä‘Ã¡y a. Kháº³ng Ä‘á»‹nh nÃ o sau Ä‘Ã¢y SAI?",
                a: [
                    "DE = EF = FD = a",
                    "CÃ¡c cáº¡nh bÃªn SD, SE, SF báº±ng nhau",
                    "CÃ¡c cáº¡nh bÃªn báº±ng luÃ´n cáº¡nh Ä‘Ã¡y (SD = DE)",
                    "CÃ¡c gÃ³c á»Ÿ Ä‘Ã¡y cá»§a cÃ¡c máº·t bÃªn báº±ng nhau"
                ],
                correct: 2, // C
                rationale: "HÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u chá»‰ yÃªu cáº§u Ä‘Ã¡y lÃ  tam giÃ¡c Ä‘á»u vÃ  cÃ¡c cáº¡nh bÃªn báº±ng nhau; khÃ´ng báº¯t buá»™c cáº¡nh bÃªn pháº£i báº±ng cáº¡nh Ä‘Ã¡y, nÃªn kháº³ng Ä‘á»‹nh (C) lÃ  sai.",
                level: "THÃ”NG HIá»‚U"
            },
            {
                q: "CÃ´ng thá»©c tÃ­nh thá»ƒ tÃ­ch cá»§a hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u lÃ :",
                a: [
                    "V = S<sub>Ä‘Ã¡y</sub> Â· h",
                    "V = \\( \\dfrac{1}{3} \\) Â· S<sub>Ä‘Ã¡y</sub> Â· h",
                    "V = \\( \\dfrac{1}{2} \\) Â· S<sub>Ä‘Ã¡y</sub> Â· h",
                    "V = 3 Â· S<sub>Ä‘Ã¡y</sub> Â· h"
                ],
                correct: 1, // B
                rationale: "Thá»ƒ tÃ­ch má»i hÃ¬nh chÃ³p Ä‘á»u Ä‘Æ°á»£c tÃ­nh theo cÃ´ng thá»©c chung: V = \\( \\dfrac{1}{3} \\) Â· S<sub>Ä‘Ã¡y</sub> Â· h.",
                level: "THÃ”NG HIá»‚U"
            },

            // Cáº¤P 3: Váº¬N Dá»¤NG
            {
                q: "TÃ­nh thá»ƒ tÃ­ch cá»§a má»™t hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u biáº¿t chiá»u cao h = 9cm vÃ  cáº¡nh Ä‘Ã¡y a = 4cm.",
                a: [
                    "144 cm<sup>3</sup>",
                    "36 cm<sup>3</sup>",
                    "48 cm<sup>3</sup>",
                    "12 cm<sup>3</sup>"
                ],
                correct: 2, // C
                rationale: "ÄÃ¡y lÃ  hÃ¬nh vuÃ´ng cáº¡nh 4cm â‡’ S<sub>Ä‘Ã¡y</sub> = 4<sup>2</sup> = 16. Do Ä‘Ã³ V = \\( \\dfrac{1}{3} \\) Â· 16 Â· 9 = 48 cm<sup>3</sup>.",
                level: "Váº¬N Dá»¤NG"
            },
            {
                q: "Báº¡n Nam lÃ m má»™t chiáº¿c Ä‘Ã¨n lá»“ng hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u cÃ³ cáº¡nh Ä‘Ã¡y 20cm vÃ  chiá»u cao máº·t bÃªn lÃ  30cm. Nam cáº§n Ã­t nháº¥t bao nhiÃªu cm<sup>2</sup> giáº¥y mÃ u Ä‘á»ƒ dÃ¡n kÃ­n 3 máº·t bÃªn (bá» qua khung)?",
                a: [
                    "600 cm<sup>2</sup>",
                    "300 cm<sup>2</sup>",
                    "1800 cm<sup>2</sup>",
                    "900 cm<sup>2</sup>"
                ],
                correct: 3, // D
                rationale: "Chu vi Ä‘Ã¡y lÃ  20 Â· 3 = 60. Diá»‡n tÃ­ch xung quanh cá»§a chÃ³p tam giÃ¡c Ä‘á»u: S<sub>xq</sub> = \\( \\dfrac{1}{2} \\) Â· chu vi Ä‘Ã¡y Â· chiá»u cao máº·t bÃªn = \\( \\dfrac{1}{2} \\) Â· 60 Â· 30 = 900 cm<sup>2</sup>.",
                level: "Váº¬N Dá»¤NG"
            },
            {
                q: "Má»™t hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u cÃ³ thá»ƒ tÃ­ch 50 cm<sup>3</sup> vÃ  chiá»u cao 6cm. Äá»™ dÃ i cáº¡nh Ä‘Ã¡y cá»§a hÃ¬nh chÃ³p Ä‘Ã³ báº±ng:",
                a: [
                    "5 cm",
                    "25 cm",
                    "10 cm",
                    "&radic;50 cm"
                ],
                correct: 0, // A
                rationale: "V = \\( \\dfrac{1}{3} \\) a<sup>2</sup> Â· h â‡’ 50 = \\( \\dfrac{1}{3} \\) Â· a<sup>2</sup> Â· 6 â‡’ a<sup>2</sup> = 25 â‡’ a = 5 cm.",
                level: "Váº¬N Dá»¤NG"
            },

            // Cáº¤P 4: Váº¬N Dá»¤NG CAO
            {
                q: "Má»™t kim tá»± thÃ¡p kÃ­nh (hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u) cÃ³ chiá»u cao h = 21m vÃ  cáº¡nh Ä‘Ã¡y a = 35m. Gá»i d lÃ  Ä‘á»™ dÃ i Ä‘oáº¡n tháº³ng ná»‘i tá»« Ä‘á»‰nh kim tá»± thÃ¡p Ä‘áº¿n trung Ä‘iá»ƒm má»™t cáº¡nh Ä‘Ã¡y. GiÃ¡ trá»‹ gáº§n Ä‘Ãºng cá»§a d (lÃ m trÃ²n Ä‘áº¿n má»™t chá»¯ sá»‘ tháº­p phÃ¢n) lÃ :",
                a: [
                    "40,8m",
                    "27,3m",
                    "25,5m",
                    "30,1m"
                ],
                correct: 1, // B
                rationale: "Trong tam giÃ¡c vuÃ´ng táº¡o bá»Ÿi chiá»u cao h vÃ  Ä‘oáº¡n tá»« tÃ¢m Ä‘Ã¡y Ä‘áº¿n trung Ä‘iá»ƒm cáº¡nh Ä‘Ã¡y, ta cÃ³: a/2 = 17,5m. Do Ä‘Ã³ d<sup>2</sup> = 21<sup>2</sup> + 17,5<sup>2</sup> â‰ˆ 747,25 â‡’ d â‰ˆ 27,3m.",
                level: "Váº¬N Dá»¤NG CAO"
            }
        ];

        // ----------------------
        // GAME STATE
        // ----------------------
        let currentIndex = 0;
        let score = 0;
        let isAnswering = false;

        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');

        const questionNumberEl = document.getElementById('question-number');
        const questionTextEl = document.getElementById('question-text');
        const levelLabelEl = document.getElementById('level-label');
        const scoreEl = document.getElementById('score');
        const progressBarEl = document.getElementById('progress-bar');

        const optionsGrid = document.getElementById('options-grid');
        const explanationBox = document.getElementById('explanation-box');
        const explanationContent = document.getElementById('explanation-content');
        const nextBtnContainer = document.getElementById('next-btn-container');
        const finalScoreEl = document.getElementById('final-score');

        const gameArea = document.getElementById('game-area');
        const pyramidDoor = document.getElementById('pyramid-door');
        const explorerEl = document.getElementById('explorer');
        const feedbackEmoji = document.getElementById('feedback-emoji');

        // ----------------------
        // AUDIO
        // ----------------------
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTone(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'start') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, now);
                gain.gain.setValueAtTime(0.18, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(660, now);
                osc.frequency.exponentialRampToValueAtTime(990, now + 0.15);
                gain.gain.setValueAtTime(0.22, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);
                osc.start(now);
                osc.stop(now + 0.35);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(80, now + 0.25);
                gain.gain.setValueAtTime(0.18, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.25);
                osc.start(now);
                osc.stop(now + 0.25);
            } else if (type === 'win') {
                const notes = [523, 659, 784, 1046];
                notes.forEach((f, i) => {
                    setTimeout(() => {
                        const o = audioCtx.createOscillator();
                        const g = audioCtx.createGain();
                        o.connect(g);
                        g.connect(audioCtx.destination);
                        o.type = 'square';
                        o.frequency.value = f;
                        g.gain.setValueAtTime(0.15, audioCtx.currentTime);
                        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                        o.start();
                        o.stop(audioCtx.currentTime + 0.3);
                    }, i * 160);
                });
            }
        }

        // ----------------------
        // GAME FLOW
        // ----------------------
        function startGame() {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('flex');

            currentIndex = 0;
            score = 0;
            updateUI();
            playTone('start');
            createStars();
            loadQuestion();
        }

        function loadQuestion() {
            if (currentIndex >= questions.length) {
                endGame();
                return;
            }

            const q = questions[currentIndex];
            isAnswering = false;

            // Level label
            let levelText = "";
            if (q.level === "NHáº¬N BIáº¾T") levelText = "Cáº¥p 1 â€“ Cá»­a háº§m bÃ­ máº­t (Nháº­n biáº¿t)";
            else if (q.level === "THÃ”NG HIá»‚U") levelText = "Cáº¥p 2 â€“ HÃ nh lang mÃª cung (ThÃ´ng hiá»ƒu)";
            else if (q.level === "Váº¬N Dá»¤NG") levelText = "Cáº¥p 3 â€“ Máº­t mÃ£ kho bÃ¡u (Váº­n dá»¥ng)";
            else levelText = "Cáº¥p 4 â€“ Ngai vÃ ng Pharaoh (Váº­n dá»¥ng cao)";
            levelLabelEl.textContent = levelText;

            questionNumberEl.textContent = currentIndex + 1;
            questionTextEl.innerHTML = q.q;

            // Reset explanation
            explanationBox.classList.remove('show');
            explanationContent.innerHTML = "";

            // Reset visuals
            pyramidDoor.classList.remove('door-glow');
            explorerEl.classList.remove('jump');
            gameArea.classList.remove('shake');

            // Build answer buttons
            optionsGrid.innerHTML = "";
            q.a.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className =
                    "btn-answer w-full px-4 py-3 rounded-xl text-sm md:text-base font-medium shadow-md";
                btn.innerHTML = `<span class="font-bold mr-2">${String.fromCharCode(
                    65 + idx
                )}.</span> ${opt}`;
                btn.onclick = () => handleAnswer(idx, q.correct, btn);
                optionsGrid.appendChild(btn);
            });

            nextBtnContainer.classList.add('hidden');
            updateUI();
        }

        function handleAnswer(selectedIndex, correctIndex, clickedBtn) {
            if (isAnswering) return;
            isAnswering = true;

            const q = questions[currentIndex];
            const buttons = optionsGrid.querySelectorAll('.btn-answer');

            // Disable all buttons
            buttons.forEach(b => (b.disabled = true));

            // Show explanation
            explanationContent.innerHTML = q.rationale;
            explanationBox.classList.add('show');

            if (selectedIndex === correctIndex) {
                clickedBtn.classList.add('correct');
                score += 100;

                // Visual effects
                pyramidDoor.classList.add('door-glow');
                explorerEl.classList.add('jump');
                showFeedback("ğŸ”“");
                playTone('correct');
                fireConfetti(30);
            } else {
                clickedBtn.classList.add('wrong');
                if (buttons[correctIndex]) {
                    buttons[correctIndex].classList.add('correct');
                }
                showFeedback("ğŸ’¥");
                playTone('wrong');
                gameArea.classList.add('shake');
                setTimeout(() => gameArea.classList.remove('shake'), 500);
            }

            updateUI();
            nextBtnContainer.classList.remove('hidden');
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < questions.length) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        function updateUI() {
            scoreEl.textContent = score.toString().padStart(4, "0");
            const progress = ((currentIndex) / questions.length) * 100;
            progressBarEl.style.width = progress + "%";
        }

        function endGame() {
            gameScreen.classList.add('hidden');
            gameScreen.classList.remove('flex');
            endScreen.classList.remove('hidden');
            finalScoreEl.textContent = score;
            playTone('win');
            fireConfetti(80);
            setInterval(() => fireConfetti(40), 1200);
        }

        // ----------------------
        // Stars Background
        // ----------------------
        function createStars() {
            const bg = document.getElementById('bg-layer');
            // trÃ¡nh táº¡o láº¡i náº¿u Ä‘Ã£ cÃ³
            if (bg.dataset.starsCreated) return;
            bg.dataset.starsCreated = "true";

            for (let i = 0; i < 90; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                const size = Math.random() * 2 + 1;
                s.style.width = size + "px";
                s.style.height = size + "px";
                s.style.left = Math.random() * 100 + "%";
                s.style.top = Math.random() * 70 + "%";
                s.style.animationDelay = (Math.random() * 2).toFixed(2) + "s";
                bg.appendChild(s);
            }
        }

        // ----------------------
        // Feedback Emoji
        // ----------------------
        function showFeedback(emoji) {
            feedbackEmoji.textContent = emoji;
            feedbackEmoji.classList.add('show');
            setTimeout(() => {
                feedbackEmoji.classList.remove('show');
            }, 900);
        }

        // ----------------------
        // CONFETTI
        // ----------------------
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        function fireConfetti(amount) {
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 4;

            for (let i = 0; i < amount; i++) {
                particles.push({
                    x: cx,
                    y: cy,
                    vx: (Math.random() - 0.5) * 12,
                    vy: (Math.random() - 0.5) * 12,
                    life: 80 + Math.random() * 40,
                    size: 3 + Math.random() * 4,
                    color: `hsl(${40 + Math.random() * 40}, 95%, 60%)`
                });
            }

            if (particles.length <= amount * 1.2) {
                requestAnimationFrame(updateConfetti);
            }
        }

        function updateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < particles.length; i++) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2; // gravity
                p.life--;

                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);

                if (p.life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            if (particles.length > 0) {
                requestAnimationFrame(updateConfetti);
            }
        }
    </script>
</body>
</html>
