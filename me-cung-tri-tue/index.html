<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√™ Cung Tr√≠ Tu·ªá - To√°n 9: G√≥c ·ªü t√¢m, g√≥c n·ªôi ti·∫øp</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #game-container {
            width: 100%;
            max-width: 950px;
            background: rgba(255,255,255,0.97);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.25);
        }
        header {
            background: #1e3a8a;
            color: white;
            padding: 1.5rem;
            text-align: center;
            border-bottom: 4px solid #172554;
        }
        #maze-grid {
            display: grid;
            grid-template-columns: repeat(3,1fr);
            gap: 1rem;
            padding: 1.5rem;
        }
        .maze-door {
            aspect-ratio: 1/1;
            background: #e5e7eb;
            border-radius: 12px;
            font-size: 2.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #cbd5e1;
            transition: .4s;
        }
        .maze-door.unlocked {
            background: #bbf7d0;
            border-color: #4ade80;
            transform: scale(1.08);
        }
        #options-container button {
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
        }
        .option-btn.correct {
            background: #dcfce7 !important;
            border-color: #4ade80 !important;
        }
        .option-btn.wrong {
            background: #fee2e2 !important;
            border-color: #f87171 !important;
        }
        .feedback-effect {
            position: absolute;
            font-size: 4rem;
            animation: fadeUp 1s forwards;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        @keyframes fadeUp {
            from { opacity: 1; transform: translate(-50%, -50%) scale(0.6); }
            to { opacity: 0; transform: translate(-50%, -120%) scale(1.2); }
        }
    </style>
</head>

<body>
<div id="game-container">

    <header>
        <h1 class="text-3xl font-bold">M√™ Cung Tr√≠ Tu·ªá</h1>
        <p>B√†i 3: G√≥c ·ªü t√¢m, g√≥c n·ªôi ti·∫øp - To√°n 9</p>
    </header>

    <main class="md:flex">

        <!-- M√ä CUNG -->
        <div id="maze-grid" class="md:w-2/5 bg-gray-100 border-r">
            <!-- 15 c·ª≠a -->
            <script>
                for (let i = 1; i <= 15; i++) {
                    document.write(`<div id="door-${i}" class="maze-door">${i === 15 ? "üèÜ" : "üö™"}</div>`);
                }
            </script>
        </div>

        <!-- C√ÇU H·ªéI -->
        <div id="quiz-area" class="md:w-3/5 p-6 relative">

            <div id="question-container">
                <div id="question-level" class="text-sm font-semibold bg-blue-100 text-blue-700 px-3 py-1 rounded-full inline-block mb-3">
                    M·ª©c ƒë·ªô
                </div>
                <div id="question-text" class="text-lg font-medium mb-4">ƒê√¢y l√† c√¢u h·ªèi...</div>

                <div id="options-container" class="grid gap-3"></div>
            </div>

            <div id="controls" class="flex justify-between items-center mt-4">
                <span id="progress-text" class="text-sm font-semibold text-gray-700">C·ª≠a 1/15</span>
                <button id="control-btn"
                        class="bg-blue-600 text-white font-semibold px-6 py-2 rounded-lg"
                        disabled>M·ªü c·ª≠a</button>
            </div>

            <div id="feedback-container"></div>

            <div id="end-screen" class="hidden text-center mt-10">
                <h2 class="text-3xl font-bold text-blue-700 mb-4">Ch√∫c m·ª´ng!</h2>
                <p id="end-score" class="text-xl mb-4"></p>
                <button id="restart-btn"
                        class="bg-blue-500 text-white py-2 px-6 rounded-lg font-semibold">Ch∆°i l·∫°i</button>
            </div>
        </div>
    </main>

</div>

<script>
/* ============================
   DANH S√ÅCH C√ÇU H·ªéI (ƒê√É B·ªé $)
   ============================ */
const questions = [
    { level: "Nh·∫≠n bi·∫øt", text: "G√≥c ·ªü t√¢m l√† g√≥c c√≥ ƒë·ªânh tr√πng v·ªõi t√¢m ƒë∆∞·ªùng tr√≤n.",
      options: [
        {text:"ƒê√∫ng", correct:true},
        {text:"Sai", correct:false}
      ]},

    { level:"Nh·∫≠n bi·∫øt", text:"G√≥c n·ªôi ti·∫øp l√† g√≥c c√≥ ƒë·ªânh n·∫±m tr√™n ƒë∆∞·ªùng tr√≤n v√† hai c·∫°nh ch·ª©a hai d√¢y cung.",
      options:[
          {text:"ƒê√∫ng", correct:true},
          {text:"Sai", correct:false}
      ]},

    { level:"Nh·∫≠n bi·∫øt", text:"S·ªë ƒëo g√≥c n·ªôi ti·∫øp b·∫±ng n·ª≠a s·ªë ƒëo cung b·ªã ch·∫Øn.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"Nh·∫≠n bi·∫øt", text:"Cung nh·ªè 70¬∞, th√¨ cung l·ªõn c√πng ch·∫Øn l√† 290¬∞.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"Nh·∫≠n bi·∫øt", text:"G√≥c n·ªôi ti·∫øp ch·∫Øn n·ª≠a ƒë∆∞·ªùng tr√≤n b·∫±ng 90¬∞.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"Th√¥ng hi·ªÉu",
      text:"G√≥c n·ªôi ti·∫øp ch·∫Øn cung 120¬∞ c√≥ s·ªë ƒëo 60¬∞.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"Th√¥ng hi·ªÉu",
      text:"G√≥c ·ªü t√¢m ch·∫Øn cung 80¬∞ c√≥ s·ªë ƒëo 80¬∞.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"Th√¥ng hi·ªÉu",
      text:"G√≥c n·ªôi ti·∫øp 55¬∞ ch·∫Øn cung 110¬∞.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"Th√¥ng hi·ªÉu",
      text:"Hai g√≥c n·ªôi ti·∫øp c√πng ch·∫Øn m·ªôt cung th√¨ b·∫±ng nhau.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"V·∫≠n d·ª•ng",
      text:"Tam gi√°c ABC n·ªôi ti·∫øp, g√≥c A=65¬∞, B=80¬∞. S·ªë ƒëo cung AB b·∫±ng 70¬∞.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"V·∫≠n d·ª•ng",
      text:"Tr√™n ƒë∆∞·ªùng tr√≤n, g√≥c n·ªôi ti·∫øp ADC ch·∫Øn cung 150¬∞ th√¨ g√≥c ADC = 75¬∞.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"V·∫≠n d·ª•ng",
      text:"M·ªôt c·∫ßu th·ªß di chuy·ªÉn tr√™n cung tr√≤n ƒëi qua M, N, A th√¨ g√≥c MAN kh√¥ng ƒë·ªïi.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    },

    { level:"V·∫≠n d·ª•ng cao",
      text:"Trong c·∫•u h√¨nh ABC, CH ‚üÇ AB, M tr√™n cung nh·ªè AC. Khi ƒë√≥ IC = IH.",
      options:[{text:"ƒê√∫ng",correct:true},{text:"Sai",correct:false}]
    }
];

/* ============================
   BI·∫æN TR·∫†NG TH√ÅI
   ============================ */
let current = 0, score = 0;
let selected = null;
let correctSound, wrongSound, soundReady = false;

/* ============================
   DOM
   ============================ */
const questionContainer = document.getElementById("question-container");
const questionLevelEl = document.getElementById("question-level");
const questionTextEl = document.getElementById("question-text");
const optionsContainer = document.getElementById("options-container");
const progressText = document.getElementById("progress-text");
const controlBtn = document.getElementById("control-btn");
const feedbackContainer = document.getElementById("feedback-container");
const endScreen = document.getElementById("end-screen");
const endScoreEl = document.getElementById("end-score");
const restartBtn = document.getElementById("restart-btn");
const controls = document.getElementById("controls");   /* FIX L·ªñI QUAN TR·ªåNG */

/* ============================
   KH·ªûI ƒê·ªòNG GAME
   ============================ */
document.addEventListener("DOMContentLoaded", startGame);

function startGame() {
    document.body.addEventListener("click", initAudio, {once:true});
    current = 0;
    score = 0;

    endScreen.classList.add("hidden");
    questionContainer.classList.remove("hidden");
    controls.classList.remove("hidden");

    for (let i = 1; i <= 15; i++) {
        const d = document.getElementById(`door-${i}`);
        d.classList.remove("unlocked");
        d.textContent = i === 15 ? "üèÜ" : "üö™";
    }

    loadQuestion();
}

function initAudio() {
    if (soundReady) return;
    Tone.start();

    correctSound = new Tone.Synth().toDestination();
    wrongSound = new Tone.Synth({oscillator:{type:"square"}}).toDestination();

    soundReady = true;
}

/* ============================
   HI·ªÇN TH·ªä C√ÇU H·ªéI
   ============================ */
function loadQuestion() {
    if (current >= questions.length) return endGame();

    const q = questions[current];
    questionLevelEl.textContent = "M·ª©c ƒë·ªô: " + q.level;
    questionTextEl.textContent = q.text;

    progressText.textContent = `C·ª≠a ${current+1}/15`;

    optionsContainer.innerHTML = "";
    selected = null;

    q.options.forEach((opt, idx)=>{
        const btn = document.createElement("button");
        btn.className = "option-btn w-full border px-4 py-2 rounded-lg bg-white text-left";
        btn.textContent = opt.text;

        btn.onclick = ()=>{
            document.querySelectorAll(".option-btn").forEach(b=>b.classList.remove("selected"));
            btn.classList.add("selected");
            selected = idx;
            controlBtn.disabled = false;
        };

        optionsContainer.appendChild(btn);
    });

    controlBtn.textContent = "M·ªü c·ª≠a";
    controlBtn.disabled = true;
}

controlBtn.onclick = ()=>{
    if (controlBtn.textContent === "M·ªü c·ª≠a") checkAnswer();
    else nextQuestion();
};

function checkAnswer() {
    const q = questions[current];
    const correctIndex = q.options.findIndex(o=>o.correct);

    const btns = document.querySelectorAll(".option-btn");
    btns.forEach(b=>b.disabled=true);

    if (selected === correctIndex) {
        score++;
        btns[selected].classList.add("correct");
        unlockDoor(current+1);
        playEffect("‚úîÔ∏è");
    } else {
        btns[selected].classList.add("wrong");
        btns[correctIndex].classList.add("correct");
        playEffect("üò¢");
    }

    controlBtn.textContent = "Ti·∫øp t·ª•c";
}

function nextQuestion() {
    current++;
    loadQuestion();
}

function endGame() {
    questionContainer.classList.add("hidden");
    controls.classList.add("hidden");
    endScreen.classList.remove("hidden");
    endScoreEl.textContent = `B·∫°n ƒë√£ m·ªü ƒë√∫ng ${score}/15 c√°nh c·ª≠a!`;

    const d = document.getElementById("door-15");
    d.classList.add("unlocked");
}

restartBtn.onclick = startGame;

/* ============================
   HI·ªÜU ·ª®NG
   ============================ */
function unlockDoor(i) {
    const d = document.getElementById(`door-${i}`);
    d.classList.add("unlocked");
    d.textContent = "‚úîÔ∏è";
}

function playEffect(icon) {
    const eff = document.createElement("div");
    eff.className = "feedback-effect";
    eff.textContent = icon;
    feedbackContainer.appendChild(eff);
    setTimeout(()=>eff.remove(),1000);
}
</script>

</body>
</html>
