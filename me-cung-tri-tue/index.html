<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÃª Cung TrÃ­ Tuá»‡ - ToÃ¡n 9: GÃ³c á»Ÿ tÃ¢m, gÃ³c ná»™i tiáº¿p</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top, #312e81 0%, #1e293b 40%, #020617 100%);
            min-height: 100vh;
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #game-container {
            width: 100%;
            max-width: 950px;
            background: rgba(255,255,255,0.97);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(15,23,42,0.8);
            transition: background 0.6s ease, transform 0.4s ease;
        }
        #game-container.stage-2 {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 40%, #22c55e 100%);
            transform: translateY(-3px);
        }

        header {
            background: linear-gradient(90deg, #4f46e5, #22c55e);
            color: white;
            padding: 1.5rem;
            text-align: center;
            border-bottom: 4px solid rgba(15,23,42,0.6);
        }

        header h1 {
            text-shadow: 0 3px 10px rgba(15,23,42,0.7);
        }

        /* MÃŠ CUNG */
        #maze-grid {
            display: grid;
            grid-template-columns: repeat(3,1fr);
            gap: 1rem;
            padding: 1.5rem;
            background: #e5e7eb;
            border-right: 2px solid #cbd5e1;
            transition: background 0.6s ease;
        }
        #maze-grid.stage-2 {
            background: radial-gradient(circle at top, #bbf7d0 0%, #e5e7eb 40%, #d1fae5 100%);
        }

        .maze-door {
            aspect-ratio: 1/1;
            background: #f3f4f6;
            border-radius: 16px;
            font-size: 2.4rem;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #cbd5e1;
            transition: .35s;
            box-shadow: 0 4px 8px rgba(148,163,184,0.4);
        }
        .maze-door.unlocked {
            background: #bbf7d0;
            border-color: #22c55e;
            transform: scale(1.08) rotate(-1deg);
            box-shadow: 0 6px 14px rgba(34,197,94,0.6);
        }
        #maze-grid.stage-2 .maze-door.unlocked {
            background: #fef3c7;
            border-color: #facc15;
            box-shadow: 0 6px 14px rgba(250,204,21,0.6);
        }

        /* CÃ‚U Há»I & NÃšT */
        #options-container button {
            box-shadow: 0 3px 6px rgba(15,23,42,0.15);
        }
        .option-btn {
            transition: all 0.25s ease;
        }
        .option-btn:hover:not(:disabled) {
            transform: translateY(-1px);
        }
        .option-btn.selected {
            border-color: #4f46e5 !important;
            background: #e0e7ff !important;
        }
        .option-btn.correct {
            background: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #14532d !important;
        }
        .option-btn.wrong {
            background: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #7f1d1d !important;
        }

        .feedback-effect {
            position: absolute;
            font-size: 4rem;
            animation: fadeUp 0.9s forwards;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        @keyframes fadeUp {
            from { opacity: 1; transform: translate(-50%, -50%) scale(0.6); }
            to   { opacity: 0; transform: translate(-50%, -130%) scale(1.3); }
        }

        /* HIá»†U á»¨NG Láº®C */
        .shake {
            animation: shake 0.45s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* MÃ€N CHUYá»‚N STAGE */
        #stage-overlay {
            position: absolute;
            inset: 0;
            background: rgba(15,23,42,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 40;
        }
        #stage-overlay.active {
            display: flex;
        }

        /* MÃ€N Káº¾T */
        #end-screen {
            background-color: rgba(15,23,42,0.9);
        }

        @media (max-width: 768px) {
            body { padding: 0.5rem; }
            main { flex-direction: column; }
            #maze-grid {
                border-right: none;
                border-bottom: 2px solid #cbd5e1;
            }
        }
    </style>
</head>

<body>
<div id="game-container" class="relative">

    <!-- Overlay chuyá»ƒn mÃ n -->
    <div id="stage-overlay">
        <div class="text-center text-white px-6">
            <div class="text-4xl mb-3">ğŸ‰</div>
            <h2 class="text-2xl font-bold mb-2">Báº¡n Ä‘Ã£ vÆ°á»£t qua MÃ n 1!</h2>
            <p class="mb-4 text-sm sm:text-base">
                ChÃ o má»«ng Ä‘áº¿n <span class="font-semibold text-emerald-300">MÃ n 2 â€“ MÃª cung nÃ¢ng cáº¥p</span> vá»›i thá»­ thÃ¡ch khÃ³ hÆ¡n!
            </p>
            <button id="stage-continue-btn"
                    class="bg-emerald-500 hover:bg-emerald-600 text-sm sm:text-base font-semibold px-5 py-2 rounded-full shadow">
                Báº¯t Ä‘áº§u MÃ n 2
            </button>
        </div>
    </div>

    <header>
        <h1 class="text-3xl font-bold">MÃª Cung TrÃ­ Tuá»‡</h1>
        <p class="opacity-90">BÃ i 3: GÃ³c á»Ÿ tÃ¢m, gÃ³c ná»™i tiáº¿p â€“ ToÃ¡n 9</p>
    </header>

    <main class="md:flex">

        <!-- MÃŠ CUNG -->
        <div id="maze-grid" class="md:w-2/5">
            <script>
                for (let i = 1; i <= 15; i++) {
                    document.write(`<div id="door-${i}" class="maze-door">${i === 15 ? "ğŸ†" : "ğŸšª"}</div>`);
                }
            </script>
        </div>

        <!-- CÃ‚U Há»I -->
        <div id="quiz-area" class="md:w-3/5 p-6 relative bg-slate-50">

            <div id="question-container">
                <div id="question-level"
                     class="text-sm font-semibold bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full inline-block mb-3">
                    Má»©c Ä‘á»™
                </div>
                <div id="question-text" class="text-lg font-medium mb-4 min-h-[70px]">
                    ÄÃ¢y lÃ  cÃ¢u há»i...
                </div>

                <div id="options-container" class="grid gap-3"></div>
            </div>

            <div id="controls" class="flex justify-between items-center mt-4">
                <span id="progress-text" class="text-sm font-semibold text-gray-700">
                    MÃ n 1 â€“ Cá»­a 1/15
                </span>
                <button id="control-btn"
                        class="bg-indigo-600 text-white font-semibold px-6 py-2 rounded-lg disabled:opacity-60 disabled:cursor-not-allowed"
                        disabled>Má»Ÿ cá»­a</button>
            </div>

            <div id="feedback-container"></div>

            <div id="end-screen" class="hidden text-center mt-10 text-white rounded-xl p-6">
                <h2 class="text-3xl font-bold text-emerald-300 mb-4">ChÃºc má»«ng!</h2>
                <p id="end-score" class="text-xl mb-4"></p>
                <button id="restart-btn"
                        class="bg-emerald-500 hover:bg-emerald-600 text-white py-2 px-6 rounded-lg font-semibold">
                    ChÆ¡i láº¡i
                </button>
            </div>
        </div>
    </main>

</div>

<script>
/* ============================
   1. DANH SÃCH CÃ‚U Há»I â€“ 4 ÄÃP ÃN
   ============================ */
const questions = [
    // ----- Má»¨C 1: NHáº¬N BIáº¾T -----
    {
        level: "Nháº­n biáº¿t",
        text: "GÃ³c á»Ÿ tÃ¢m lÃ  gÃ³c nhÆ° tháº¿ nÃ o trong cÃ¡c phÃ¡t biá»ƒu sau?",
        options: [
            { text: "GÃ³c cÃ³ Ä‘á»‰nh trÃ¹ng vá»›i tÃ¢m Ä‘Æ°á»ng trÃ²n.", correct: true },
            { text: "GÃ³c cÃ³ Ä‘á»‰nh náº±m trÃªn Ä‘Æ°á»ng trÃ²n.", correct: false },
            { text: "GÃ³c cÃ³ Ä‘á»‰nh náº±m ngoÃ i Ä‘Æ°á»ng trÃ²n.", correct: false },
            { text: "GÃ³c cÃ³ Ä‘á»‰nh báº¥t kÃ¬ trong máº·t pháº³ng.", correct: false }
        ]
    },
    {
        level: "Nháº­n biáº¿t",
        text: "GÃ³c ná»™i tiáº¿p lÃ  gÃ³c cÃ³:",
        options: [
            { text: "Äá»‰nh á»Ÿ tÃ¢m Ä‘Æ°á»ng trÃ²n, hai cáº¡nh lÃ  hai bÃ¡n kÃ­nh.", correct: false },
            { text: "Äá»‰nh náº±m trÃªn Ä‘Æ°á»ng trÃ²n, hai cáº¡nh chá»©a hai dÃ¢y cung.", correct: true },
            { text: "Äá»‰nh náº±m ngoÃ i Ä‘Æ°á»ng trÃ²n, hai cáº¡nh lÃ  hai tiáº¿p tuyáº¿n.", correct: false },
            { text: "Äá»‰nh báº¥t kÃ¬, hai cáº¡nh lÃ  hai Ä‘Æ°á»ng tháº³ng báº¥t kÃ¬.", correct: false }
        ]
    },
    {
        level: "Nháº­n biáº¿t",
        text: "Trong má»™t Ä‘Æ°á»ng trÃ²n, sá»‘ Ä‘o cá»§a gÃ³c á»Ÿ tÃ¢m cháº¯n cung báº±ng:",
        options: [
            { text: "Ná»­a sá»‘ Ä‘o cung bá»‹ cháº¯n.", correct: false },
            { text: "Báº±ng sá»‘ Ä‘o cung bá»‹ cháº¯n.", correct: true },
            { text: "Gáº¥p Ä‘Ã´i sá»‘ Ä‘o cung bá»‹ cháº¯n.", correct: false },
            { text: "Báº±ng 180Â° trá»« Ä‘i sá»‘ Ä‘o cung.", correct: false }
        ]
    },
    {
        level: "Nháº­n biáº¿t",
        text: "Trong má»™t Ä‘Æ°á»ng trÃ²n, sá»‘ Ä‘o cá»§a gÃ³c ná»™i tiáº¿p cháº¯n cung báº±ng:",
        options: [
            { text: "Báº±ng sá»‘ Ä‘o cung bá»‹ cháº¯n.", correct: false },
            { text: "Gáº¥p Ä‘Ã´i sá»‘ Ä‘o cung bá»‹ cháº¯n.", correct: false },
            { text: "Ná»­a sá»‘ Ä‘o cung bá»‹ cháº¯n.", correct: true },
            { text: "KhÃ´ng phá»¥ thuá»™c vÃ o cung.", correct: false }
        ]
    },

    // ----- Má»¨C 2: THÃ”NG HIá»‚U -----
    {
        level: "ThÃ´ng hiá»ƒu",
        text: "Trong Ä‘Æ°á»ng trÃ²n (O), gÃ³c á»Ÿ tÃ¢m âˆ AOB = 120Â°. Sá»‘ Ä‘o cung AB báº±ng:",
        options: [
            { text: "60Â°", correct: false },
            { text: "90Â°", correct: false },
            { text: "120Â°", correct: true },
            { text: "240Â°", correct: false }
        ]
    },
    {
        level: "ThÃ´ng hiá»ƒu",
        text: "Trong Ä‘Æ°á»ng trÃ²n (O), cung CD cÃ³ sá»‘ Ä‘o 80Â°. GÃ³c ná»™i tiáº¿p âˆ CED cháº¯n cung CD cÃ³ sá»‘ Ä‘o:",
        options: [
            { text: "80Â°", correct: false },
            { text: "40Â°", correct: true },
            { text: "160Â°", correct: false },
            { text: "20Â°", correct: false }
        ]
    },
    {
        level: "ThÃ´ng hiá»ƒu",
        text: "Trong Ä‘Æ°á»ng trÃ²n (O), gÃ³c ná»™i tiáº¿p âˆ ABC = 35Â°. Sá»‘ Ä‘o cung AC bá»‹ cháº¯n báº±ng:",
        options: [
            { text: "35Â°", correct: false },
            { text: "70Â°", correct: true },
            { text: "140Â°", correct: false },
            { text: "110Â°", correct: false }
        ]
    },
    {
        level: "ThÃ´ng hiá»ƒu",
        text: "TrÃªn Ä‘Æ°á»ng trÃ²n (O), hai gÃ³c ná»™i tiáº¿p âˆ AMN vÃ  âˆ ABN cÃ¹ng cháº¯n cung AN. Káº¿t quáº£ nÃ o sau Ä‘Ã¢y Ä‘Ãºng?",
        options: [
            { text: "âˆ AMN = 2âˆ ABN", correct: false },
            { text: "âˆ AMN = âˆ ABN", correct: true },
            { text: "âˆ AMN + âˆ ABN = 180Â°", correct: false },
            { text: "âˆ AMN â€“ âˆ ABN = 90Â°", correct: false }
        ]
    },
    {
        level: "ThÃ´ng hiá»ƒu",
        text: "GÃ³c ná»™i tiáº¿p cháº¯n ná»­a Ä‘Æ°á»ng trÃ²n luÃ´n cÃ³ sá»‘ Ä‘o:",
        options: [
            { text: "45Â°", correct: false },
            { text: "60Â°", correct: false },
            { text: "90Â°", correct: true },
            { text: "120Â°", correct: false }
        ]
    },

    // ----- Má»¨C 3: Váº¬N Dá»¤NG -----
    {
        level: "Váº­n dá»¥ng",
        text: "Trong Ä‘Æ°á»ng trÃ²n (O), âˆ ACB lÃ  gÃ³c ná»™i tiáº¿p cháº¯n cung AB vÃ  âˆ ACB = 28Â°. Sá»‘ Ä‘o gÃ³c á»Ÿ tÃ¢m âˆ AOB cháº¯n cung AB lÃ :",
        options: [
            { text: "14Â°", correct: false },
            { text: "28Â°", correct: false },
            { text: "56Â°", correct: true },
            { text: "84Â°", correct: false }
        ]
    },
    {
        level: "Váº­n dá»¥ng",
        text: "Trong Ä‘Æ°á»ng trÃ²n (O), gÃ³c á»Ÿ tÃ¢m âˆ AOB = 150Â°. GÃ³c ná»™i tiáº¿p âˆ ACB cÃ¹ng cháº¯n cung AB cÃ³ sá»‘ Ä‘o:",
        options: [
            { text: "50Â°", correct: false },
            { text: "75Â°", correct: true },
            { text: "100Â°", correct: false },
            { text: "150Â°", correct: false }
        ]
    },
    {
        level: "Váº­n dá»¥ng",
        text: "Cho tam giÃ¡c ABC ná»™i tiáº¿p Ä‘Æ°á»ng trÃ²n (O). Biáº¿t âˆ A = 60Â°, âˆ B = 50Â°. Sá»‘ Ä‘o cung AB (cung Ä‘á»‘i diá»‡n vá»›i Ä‘á»‰nh C) báº±ng:",
        options: [
            { text: "60Â°", correct: false },
            { text: "70Â°", correct: false },
            { text: "120Â°", correct: false },
            { text: "140Â°", correct: true } // C = 70Â°, cung AB = 2Â·70Â° = 140Â°
        ]
    },
    {
        level: "Váº­n dá»¥ng",
        text: "Trong Ä‘Æ°á»ng trÃ²n (O), Ä‘iá»ƒm D náº±m trÃªn cung lá»›n AC. Biáº¿t âˆ ADC = 40Â°. GÃ³c ná»™i tiáº¿p âˆ ABC cÃ¹ng cháº¯n cung nhá» AC cÃ³ sá»‘ Ä‘o:",
        options: [
            { text: "20Â°", correct: true },
            { text: "40Â°", correct: false },
            { text: "60Â°", correct: false },
            { text: "80Â°", correct: false }
        ]
    },

    // ----- Má»¨C 4: Váº¬N Dá»¤NG CAO -----
    {
        level: "Váº­n dá»¥ng cao",
        text: "Cho Ä‘Æ°á»ng trÃ²n (O), Ä‘Æ°á»ng kÃ­nh AB. Äiá»ƒm C náº±m trÃªn Ä‘Æ°á»ng trÃ²n (khÃ¡c A, B). Kháº³ng Ä‘á»‹nh nÃ o sau Ä‘Ã¢y Ä‘Ãºng?",
        options: [
            { text: "âˆ ACB = 45Â°", correct: false },
            { text: "âˆ ACB = 60Â°", correct: false },
            { text: "âˆ ACB = 90Â°", correct: true },
            { text: "âˆ ACB = 180Â°", correct: false }
        ]
    },
    {
        level: "Váº­n dá»¥ng cao",
        text: "Cho Ä‘Æ°á»ng trÃ²n (O). Äiá»ƒm E thuá»™c cung nhá» AB. Náº¿u âˆ AEB = 45Â° thÃ¬ sá»‘ Ä‘o gÃ³c á»Ÿ tÃ¢m âˆ AOB lÃ :",
        options: [
            { text: "22,5Â°", correct: false },
            { text: "45Â°", correct: false },
            { text: "60Â°", correct: false },
            { text: "90Â°", correct: true }
        ]
    }
];

/* ============================
   2. BIáº¾N TRáº NG THÃI & DOM
   ============================ */
let current = 0;
let score = 0;
let selected = null;
let correctSound, wrongSound, soundReady = false;
let stage = 1;
const STAGE_BREAK = 8; // tá»« cÃ¢u 9 trá»Ÿ Ä‘i lÃ  MÃ n 2

const questionContainer = document.getElementById("question-container");
const questionLevelEl = document.getElementById("question-level");
const questionTextEl = document.getElementById("question-text");
const optionsContainer = document.getElementById("options-container");
const progressText = document.getElementById("progress-text");
const controlBtn = document.getElementById("control-btn");
const feedbackContainer = document.getElementById("feedback-container");
const endScreen = document.getElementById("end-screen");
const endScoreEl = document.getElementById("end-score");
const restartBtn = document.getElementById("restart-btn");
const controls = document.getElementById("controls");
const gameContainer = document.getElementById("game-container");
const mazeGrid = document.getElementById("maze-grid");

const stageOverlay = document.getElementById("stage-overlay");
const stageContinueBtn = document.getElementById("stage-continue-btn");

/* ============================
   3. KHá»I Äá»˜NG GAME
   ============================ */
document.addEventListener("DOMContentLoaded", startGame);

function startGame() {
    document.body.addEventListener("click", initAudio, {once:true});
    current = 0;
    score = 0;
    stage = 1;

    endScreen.classList.add("hidden");
    questionContainer.classList.remove("hidden");
    controls.classList.remove("hidden");
    gameContainer.classList.remove("stage-2");
    mazeGrid.classList.remove("stage-2");
    stageOverlay.classList.remove("active");

    for (let i = 1; i <= 15; i++) {
        const d = document.getElementById(`door-${i}`);
        d.classList.remove("unlocked");
        d.textContent = i === 15 ? "ğŸ†" : "ğŸšª";
    }

    loadQuestion();
}

function initAudio() {
    if (soundReady) return;
    Tone.start();
    correctSound = new Tone.Synth().toDestination();
    wrongSound = new Tone.Synth({oscillator:{type:"square"}}).toDestination();
    soundReady = true;
}

/* ============================
   4. HIá»‚N THá»Š CÃ‚U Há»I + MÃ€N
   ============================ */
function updateStageIfNeeded() {
    const newStage = current < STAGE_BREAK ? 1 : 2;
    if (newStage !== stage) {
        stage = newStage;
        // Báº­t overlay thÃ´ng bÃ¡o chuyá»ƒn mÃ n
        stageOverlay.classList.add("active");
        gameContainer.classList.add("stage-2");
        mazeGrid.classList.add("stage-2");
    }
}

stageContinueBtn.addEventListener("click", () => {
    stageOverlay.classList.remove("active");
});

function loadQuestion() {
    if (current >= questions.length) return endGame();

    updateStageIfNeeded();

    const q = questions[current];
    questionLevelEl.textContent = `Má»©c Ä‘á»™: ${q.level}`;
    questionTextEl.textContent = q.text;

    const stageLabel = stage === 1 ? "MÃ n 1" : "MÃ n 2";
    progressText.textContent = `${stageLabel} â€“ Cá»­a ${current + 1}/15`;

    optionsContainer.innerHTML = "";
    selected = null;

    q.options.forEach((opt, idx) => {
        const btn = document.createElement("button");
        btn.className = "option-btn w-full border px-4 py-2 rounded-lg bg-white text-left";
        btn.textContent = opt.text;

        btn.onclick = () => {
            document.querySelectorAll(".option-btn").forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
            selected = idx;
            controlBtn.disabled = false;
        };

        optionsContainer.appendChild(btn);
    });

    controlBtn.textContent = "Má»Ÿ cá»­a";
    controlBtn.disabled = true;
}

controlBtn.onclick = () => {
    if (controlBtn.textContent === "Má»Ÿ cá»­a") checkAnswer();
    else nextQuestion();
};

/* ============================
   5. KIá»‚M TRA & CHUYá»‚N CÃ‚U
   ============================ */
function checkAnswer() {
    const q = questions[current];
    const correctIndex = q.options.findIndex(o => o.correct);
    const btns = document.querySelectorAll(".option-btn");
    btns.forEach(b => b.disabled = true);

    if (selected === correctIndex) {
        score++;
        btns[selected].classList.add("correct");
        unlockDoor(current + 1);
        playEffect(true);
    } else {
        if (selected !== null) {
            btns[selected].classList.add("wrong");
        }
        btns[correctIndex].classList.add("correct");
        playEffect(false);
        gameContainer.classList.add("shake");
        setTimeout(() => gameContainer.classList.remove("shake"), 450);
    }

    controlBtn.textContent = current === questions.length - 1 ? "Xem káº¿t quáº£" : "Tiáº¿p tá»¥c";
}

function nextQuestion() {
    current++;
    if (current >= questions.length) {
        endGame();
    } else {
        loadQuestion();
    }
}

/* ============================
   6. Káº¾T THÃšC GAME
   ============================ */
function endGame() {
    questionContainer.classList.add("hidden");
    controls.classList.add("hidden");
    endScreen.classList.remove("hidden");
    endScoreEl.textContent = `Báº¡n Ä‘Ã£ má»Ÿ Ä‘Ãºng ${score}/15 cÃ¡nh cá»­a!`;

    const d = document.getElementById("door-15");
    if (d) d.classList.add("unlocked");
}

restartBtn.onclick = startGame;

/* ============================
   7. HIá»†U á»¨NG
   ============================ */
function unlockDoor(i) {
    const d = document.getElementById(`door-${i}`);
    if (!d) return;
    d.classList.add("unlocked");
    d.textContent = i === 15 ? "ğŸ†" : "âœ”ï¸";
}

function playEffect(isCorrect) {
    if (soundReady) {
        if (isCorrect) {
            correctSound.triggerAttackRelease("C5", "0.12", Tone.now());
            correctSound.triggerAttackRelease("E5", "0.12", Tone.now() + 0.12);
            correctSound.triggerAttackRelease("G5", "0.12", Tone.now() + 0.24);
        } else {
            wrongSound.triggerAttackRelease("C3", "0.25", Tone.now());
        }
    }

    const eff = document.createElement("div");
    eff.className = "feedback-effect";
    eff.textContent = isCorrect ? "ğŸ‰" : "ğŸ˜¢";
    feedbackContainer.appendChild(eff);
    setTimeout(() => eff.remove(), 900);
}
</script>

</body>
</html>
