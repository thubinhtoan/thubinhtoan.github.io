<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Ph√°o ƒê√†i H√¨nh Ch·ªØ Nh·∫≠t ‚Äì Thu B√¨nh To√°n (Game 9)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel ƒë·ªÉ d√πng JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="m-0 p-0 bg-slate-950">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // ================== C√ÇU H·ªéI GAME 9 ‚Äì H√åNH CH·ªÆ NH·∫¨T ==================
    // 15 c√¢u, ƒë√£ ki·ªÉm tra ƒë√∫ng/sai v√† c√¢n b·∫±ng ƒë√°p √°n A/B/C/D
    const questions = [
      // --- NH·∫¨N BI·∫æT (6 c√¢u) ---
      {
        id: 1,
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh ch·ªØ nh·∫≠t l√† t·ª© gi√°c c√≥:",
        options: [
          "B·ªën g√≥c vu√¥ng",
          "B·ªën c·∫°nh b·∫±ng nhau",
          "Hai c·∫∑p c·∫°nh ƒë·ªëi song song",
          "Hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau"
        ],
        correct: 0 // A
      },
      {
        id: 2,
        level: "Nh·∫≠n bi·∫øt",
        question: "Trong h√¨nh ch·ªØ nh·∫≠t, kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y ƒë√∫ng v·ªÅ c√°c c·∫°nh?",
        options: [
          "C√°c c·∫°nh k·ªÅ b·∫±ng nhau",
          "C√°c c·∫°nh ƒë·ªëi song song v√† b·∫±ng nhau",
          "B·ªën c·∫°nh ƒë·ªÅu b·∫±ng nhau",
          "Ch·ªâ c√≥ m·ªôt c·∫∑p c·∫°nh ƒë·ªëi song song"
        ],
        correct: 1 // B
      },
      {
        id: 3,
        level: "Nh·∫≠n bi·∫øt",
        question: "Trong h√¨nh ch·ªØ nh·∫≠t, hai ƒë∆∞·ªùng ch√©o c√≥ t√≠nh ch·∫•t g√¨ ƒë·∫∑c bi·ªát?",
        options: [
          "Hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c v·ªõi nhau",
          "Hai ƒë∆∞·ªùng ch√©o kh√¥ng c·∫Øt nhau",
          "Hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau",
          "Hai ƒë∆∞·ªùng ch√©o song song"
        ],
        correct: 2 // C
      },
      {
        id: 4,
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh n√†o sau ƒë√¢y CH·∫ÆC CH·∫ÆN l√† h√¨nh ch·ªØ nh·∫≠t?",
        options: [
          "H√¨nh thoi c√≥ b·ªën c·∫°nh b·∫±ng nhau",
          "H√¨nh thang c√¢n",
          "T·ª© gi√°c c√≥ hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c",
          "H√¨nh b√¨nh h√†nh c√≥ m·ªôt g√≥c vu√¥ng"
        ],
        correct: 3 // D
      },
      {
        id: 5,
        level: "Nh·∫≠n bi·∫øt",
        question: "Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y KH√îNG ƒë√∫ng v·ªÅ h√¨nh ch·ªØ nh·∫≠t?",
        options: [
          "H√¨nh ch·ªØ nh·∫≠t c√≥ b·ªën c·∫°nh b·∫±ng nhau",
          "C√°c c·∫°nh ƒë·ªëi c·ªßa h√¨nh ch·ªØ nh·∫≠t song song",
          "C√°c c·∫°nh ƒë·ªëi c·ªßa h√¨nh ch·ªØ nh·∫≠t b·∫±ng nhau",
          "M·ªói g√≥c c·ªßa h√¨nh ch·ªØ nh·∫≠t ƒë·ªÅu l√† g√≥c vu√¥ng"
        ],
        correct: 0 // A
      },
      {
        id: 6,
        level: "Nh·∫≠n bi·∫øt",
        question: "D·∫•u hi·ªáu n√†o sau ƒë√¢y ƒê·ª¶ ƒë·ªÉ k·∫øt lu·∫≠n m·ªôt h√¨nh b√¨nh h√†nh l√† h√¨nh ch·ªØ nh·∫≠t?",
        options: [
          "H√¨nh b√¨nh h√†nh c√≥ hai c·∫°nh k·ªÅ b·∫±ng nhau",
          "H√¨nh b√¨nh h√†nh c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau",
          "H√¨nh b√¨nh h√†nh c√≥ hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c",
          "H√¨nh b√¨nh h√†nh c√≥ hai g√≥c k·ªÅ b√π nhau"
        ],
        correct: 1 // B
      },

      // --- TH√îNG HI·ªÇU (5 c√¢u) ---
      {
        id: 7,
        level: "Th√¥ng hi·ªÉu",
        question: "M·ªôt h√¨nh ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i 7 cm, chi·ªÅu r·ªông 3 cm. Chu vi c·ªßa h√¨nh ch·ªØ nh·∫≠t l√†:",
        options: [
          "10 cm",
          "14 cm",
          "20 cm",
          "24 cm"
        ],
        correct: 2 // C (P = 2¬∑(7+3) = 20)
      },
      {
        id: 8,
        level: "Th√¥ng hi·ªÉu",
        question: "M·ªôt h√¨nh ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i 8 cm, chi·ªÅu r·ªông 5 cm. Di·ªán t√≠ch h√¨nh ch·ªØ nh·∫≠t l√†:",
        options: [
          "13 cm¬≤",
          "26 cm¬≤",
          "20 cm¬≤",
          "40 cm¬≤"
        ],
        correct: 3 // D (S = 8¬∑5 = 40)
      },
      {
        id: 9,
        level: "Th√¥ng hi·ªÉu",
        question: "M·ªôt h√¨nh ch·ªØ nh·∫≠t c√≥ chu vi 30 cm v√† chi·ªÅu d√†i 8 cm. Chi·ªÅu r·ªông l√†:",
        options: [
          "7 cm",
          "8 cm",
          "15 cm",
          "22 cm"
        ],
        correct: 0 // A (a+b=15 ‚áí b=7)
      },
      {
        id: 10,
        level: "Th√¥ng hi·ªÉu",
        question: "Trong h√¨nh ch·ªØ nh·∫≠t, ƒë∆∞·ªùng ch√©o d√†i 13 cm, m·ªôt c·∫°nh d√†i 5 cm. ƒê·ªô d√†i c·∫°nh c√≤n l·∫°i l√†:",
        options: [
          "5 cm",
          "12 cm",
          "13 cm",
          "10 cm"
        ],
        correct: 1 // B (5¬≤ + b¬≤ = 13¬≤ ‚áí b=12)
      },
      {
        id: 11,
        level: "Th√¥ng hi·ªÉu",
        question: "Trong h√¨nh ch·ªØ nh·∫≠t ABCD, bi·∫øt ‚à†A = 90¬∞. Khi ƒë√≥ ‚à†B b·∫±ng:",
        options: [
          "45¬∞",
          "60¬∞",
          "90¬∞",
          "180¬∞"
        ],
        correct: 2 // C
      },

      // --- V·∫¨N D·ª§NG (3 c√¢u) ---
      {
        id: 12,
        level: "V·∫≠n d·ª•ng",
        question: "M·ªôt l·ªõp h·ªçc h√¨nh ch·ªØ nh·∫≠t c√≥ k√≠ch th∆∞·ªõc 6 m √ó 4 m. Ng∆∞·ªùi ta l√°t n·ªÅn b·∫±ng g·∫°ch h√¨nh vu√¥ng c·∫°nh 0,5 m. S·ªë vi√™n g·∫°ch c·∫ßn d√πng l√†:",
        options: [
          "48 vi√™n",
          "64 vi√™n",
          "80 vi√™n",
          "96 vi√™n"
        ],
        correct: 3 // D (S l·ªõp = 24; S g·∫°ch = 0,25 ‚áí 24 / 0,25 = 96)
      },
      {
        id: 13,
        level: "V·∫≠n d·ª•ng",
        question: "M·ªôt m·∫£nh v∆∞·ªùn h√¨nh ch·ªØ nh·∫≠t c√≥ chi·ªÅu r·ªông 5 m, chi·ªÅu d√†i g·∫•p ƒë√¥i chi·ªÅu r·ªông. Chu vi m·∫£nh v∆∞·ªùn l√†:",
        options: [
          "30 m",
          "15 m",
          "20 m",
          "25 m"
        ],
        correct: 0 // A (d√†i = 10; P = 2¬∑(5+10) = 30)
      },
      {
        id: 14,
        level: "V·∫≠n d·ª•ng",
        question: "M·ªôt h√¨nh ch·ªØ nh·∫≠t c√≥ chu vi 40 m, chi·ªÅu d√†i h∆°n chi·ªÅu r·ªông 4 m. Di·ªán t√≠ch h√¨nh ch·ªØ nh·∫≠t l√†:",
        options: [
          "80 m¬≤",
          "96 m¬≤",
          "48 m¬≤",
          "64 m¬≤"
        ],
        correct: 1 // B (a+b=20, a-b=4 ‚áí a=12, b=8 ‚áí S=96)
      },

      // --- V·∫¨N D·ª§NG CAO (1 c√¢u) ---
      {
        id: 15,
        level: "V·∫≠n d·ª•ng cao",
        question: "Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y ƒë√∫ng?",
        options: [
          "M·ªçi h√¨nh thoi ƒë·ªÅu l√† h√¨nh ch·ªØ nh·∫≠t",
          "M·ªçi h√¨nh ch·ªØ nh·∫≠t ƒë·ªÅu l√† h√¨nh vu√¥ng",
          "M·ªçi h√¨nh vu√¥ng v·ª´a l√† h√¨nh ch·ªØ nh·∫≠t v·ª´a l√† h√¨nh thoi",
          "Kh√¥ng c√≥ h√¨nh vu√¥ng n√†o l√† h√¨nh ch·ªØ nh·∫≠t"
        ],
        correct: 2 // C
      }
    ];

    // ================== √ÇM THANH ƒê∆†N GI·∫¢N ==================
    const playSound = (type) => {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (!AudioContext) return;
      const ctx = new AudioContext();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      const now = ctx.currentTime;

      if (type === "correct") {
        osc.type = "sine";
        osc.frequency.setValueAtTime(440, now);
        osc.frequency.setValueAtTime(660, now + 0.1);
        osc.frequency.setValueAtTime(880, now + 0.2);
        gain.gain.setValueAtTime(0.12, now);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
        osc.start(now);
        osc.stop(now + 0.5);
      } else if (type === "wrong") {
        osc.type = "square";
        osc.frequency.setValueAtTime(160, now);
        osc.frequency.linearRampToValueAtTime(80, now + 0.25);
        gain.gain.setValueAtTime(0.15, now);
        gain.gain.linearRampToValueAtTime(0, now + 0.25);
        osc.start(now);
        osc.stop(now + 0.25);
      }

      osc.connect(gain);
      gain.connect(ctx.destination);
    };

    // ================== CONFETTI ==================
    const Confetti = () => (
      <div className="absolute inset-0 pointer-events-none overflow-hidden z-40">
        {[...Array(30)].map((_, i) => (
          <div
            key={i}
            className="absolute w-2 h-2 rounded-full"
            style={{
              backgroundColor: ['#e5e7eb', '#22c55e', '#38bdf8', '#f97316'][i % 4],
              left: `${Math.random() * 100}%`,
              top: `-10px`,
              animation: `fall ${1 + Math.random() * 2}s linear forwards`,
              animationDelay: `${Math.random() * 0.5}s`
            }}
          />
        ))}
        <style>{`
          @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
          }
        `}</style>
      </div>
    );

    // ================== PH√ÅO ƒê√ÄI H√åNH CH·ªÆ NH·∫¨T ==================
    const FortView = ({ score }) => {
      // s·ªë c√¢u ƒë√∫ng
      const correctCount = score / 10;
      // 4 m·ª©c x√¢y t∆∞·ªùng: 0, 1‚Äì4, 5‚Äì10, 11‚Äì15
      const level =
        correctCount === 0 ? 0 :
        correctCount < 5 ? 1 :
        correctCount < 11 ? 2 : 3;

      const wallClass = "h-2 rounded-full transition-all duration-500";
      return (
        <div className="relative w-full max-w-md mx-auto bg-slate-900/80 border border-emerald-500/40 rounded-2xl p-4 shadow-lg">
          <h3 className="text-sm font-semibold text-emerald-300 mb-2 flex items-center gap-2">
            <span>üß±</span>
            <span>Ti·∫øn ƒë·ªô x√¢y ph√°o ƒë√†i</span>
          </h3>

          {/* Khung ph√°o ƒë√†i d·∫°ng h√¨nh ch·ªØ nh·∫≠t */}
          <div className="relative mx-auto my-2 w-56 h-36 bg-slate-950/80 rounded-xl border-2 border-slate-700 flex items-center justify-center overflow-hidden">
            {/* N·ªÅn c·ªè */}
            <div className="absolute inset-x-0 bottom-0 h-1/3 bg-gradient-to-t from-emerald-700 to-emerald-500" />
            {/* B·ªën g√≥c th√°p */}
            {level >= 1 && (
              <>
                <div className="absolute top-2 left-2 text-xl">üõ°Ô∏è</div>
                <div className="absolute top-2 right-2 text-xl">üõ°Ô∏è</div>
                <div className="absolute bottom-2 left-2 text-xl">üõ°Ô∏è</div>
                <div className="absolute bottom-2 right-2 text-xl">üõ°Ô∏è</div>
              </>
            )}
            {/* T∆∞·ªùng tr√™n & d∆∞·ªõi */}
            {level >= 2 && (
              <>
                <div className="absolute top-8 left-6 right-6 h-3 bg-amber-700 rounded-full shadow-inner" />
                <div className="absolute bottom-8 left-6 right-6 h-3 bg-amber-700 rounded-full shadow-inner" />
              </>
            )}
            {/* C·ªïng & trang tr√≠ khi ho√†n th√†nh cao */}
            {level >= 3 && (
              <>
                <div className="absolute inset-x-[35%] bottom-0 h-10 bg-slate-800 rounded-t-md border-t border-slate-500 flex flex-col items-center justify-center">
                  <span className="text-lg">üö™</span>
                  <span className="text-[10px] text-emerald-300">C·ªïng ch√≠nh</span>
                </div>
                <div className="absolute -top-3 left-1/2 -translate-x-1/2 text-2xl">
                  üëë
                </div>
              </>
            )}
            {/* Binh l√≠nh canh g√°c */}
            {correctCount > 0 && (
              <div className="relative flex gap-1">
                {[...Array(Math.min(correctCount, 5))].map((_, i) => (
                  <span key={i} className="text-xl">ü™ñ</span>
                ))}
              </div>
            )}
          </div>

          {/* Thanh ti·∫øn ƒë·ªô t·ªïng */}
          <div className="mt-3">
            <div className="flex justify-between text-[11px] text-slate-300 mb-1">
              <span>Ho√†n thi·ªán t∆∞·ªùng ph√≤ng th·ªß</span>
              <span>{Math.round((correctCount / questions.length) * 100)}%</span>
            </div>
            <div className="w-full h-2 rounded-full bg-slate-800 overflow-hidden">
              <div
                className={wallClass + " bg-gradient-to-r from-emerald-400 via-yellow-400 to-red-500"}
                style={{ width: `${(correctCount / questions.length) * 100}%` }}
              />
            </div>
          </div>

          <p className="mt-2 text-[11px] text-slate-400">
            M·ªói c√¢u ƒë√∫ng gi√∫p em x√¢y th√™m t∆∞·ªùng, th√°p v√† c·ªïng cho Ph√°o ƒê√†i H√¨nh Ch·ªØ Nh·∫≠t.
          </p>
        </div>
      );
    };

    // ================== MAIN GAME COMPONENT ==================
    function RectFortress() {
      const [gameState, setGameState] = useState("intro"); // intro, playing, end
      const [currentQ, setCurrentQ] = useState(0);
      const [score, setScore] = useState(0);
      const [feedback, setFeedback] = useState(null); // 'correct' | 'wrong' | null
      const [soundOn, setSoundOn] = useState(true);

      const handleStart = () => {
        setGameState("playing");
        setCurrentQ(0);
        setScore(0);
        setFeedback(null);
      };

      const handleAnswer = (index) => {
        if (feedback) return;
        const isCorrect = index === questions[currentQ].correct;

        if (isCorrect) {
          setFeedback("correct");
          setScore((s) => s + 10);
          if (soundOn) playSound("correct");
        } else {
          setFeedback("wrong");
          if (soundOn) playSound("wrong");
        }

        setTimeout(() => {
          setFeedback(null);
          if (currentQ < questions.length - 1) {
            setCurrentQ((q) => q + 1);
          } else {
            setGameState("end");
          }
        }, 1800);
      };

      const correctCount = score / 10;

      return (
        <div className="min-h-screen flex items-center justify-center bg-slate-950 text-white relative overflow-hidden">
          {/* Background */}
          <div className="absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-950 to-emerald-900 opacity-90" />
          <div className="absolute inset-0 pointer-events-none opacity-30">
            {[...Array(25)].map((_, i) => (
              <div
                key={i}
                className="absolute w-1 h-1 rounded-full bg-emerald-300"
                style={{
                  top: `${Math.random() * 100}%`,
                  left: `${Math.random() * 100}%`,
                  boxShadow: "0 0 8px rgba(52,211,153,0.8)"
                }}
              />
            ))}
          </div>

          {/* N√∫t √¢m thanh */}
          <button
            onClick={() => setSoundOn((v) => !v)}
            className="absolute top-4 right-4 z-20 px-3 py-2 text-xs sm:text-sm bg-white/10 hover:bg-white/20 rounded-full"
          >
            {soundOn ? "üîä √Çm thanh: B·∫¨T" : "üîá √Çm thanh: T·∫ÆT"}
          </button>

          {/* MAIN CARD */}
          <div className="relative z-10 w-full max-w-5xl mx-4 bg-slate-900/80 border border-emerald-500/40 rounded-3xl shadow-2xl overflow-hidden backdrop-blur-xl">
            {/* Header */}
            <header className="px-6 sm:px-10 py-4 border-b border-emerald-500/40 bg-gradient-to-r from-emerald-500/40 to-lime-500/20 flex items-center justify-between gap-3 flex-wrap">
              <div>
                <div className="text-xs uppercase tracking-wide text-emerald-200/80 mb-1">
                  Thu B√¨nh To√°n ‚Äì Game 9
                </div>
                <h1 className="text-xl sm:text-2xl font-bold flex items-center gap-2">
                  <span className="text-2xl">üè∞</span>
                  <span>Ph√°o ƒê√†i H√¨nh Ch·ªØ Nh·∫≠t</span>
                </h1>
                <p className="text-xs sm:text-sm text-slate-200/90">
                  To√°n 8 ‚Äì H√¨nh ch·ªØ nh·∫≠t ¬∑ X√¢y t∆∞·ªùng ph√≤ng th·ªß b·∫±ng c√°c c√¢u tr·∫£ l·ªùi ƒë√∫ng.
                </p>
              </div>
              <div className="flex flex-col items-end text-[11px] sm:text-xs text-emerald-100">
                <span>
                  C√¢u:{" "}
                  {gameState === "playing" ? currentQ + 1 : 0}/{questions.length}
                </span>
                <span>ƒêi·ªÉm: {score}</span>
              </div>
            </header>

            {/* BODY */}
            <main className="p-4 sm:p-6 md:p-8">
              {/* INTRO */}
              {gameState === "intro" && (
                <div className="flex flex-col items-center text-center gap-6 py-8">
                  <div className="relative">
                    <div className="absolute inset-0 bg-emerald-400 blur-3xl opacity-40 animate-pulse" />
                    <div className="relative w-32 h-32 sm:w-40 sm:h-40 rounded-3xl border border-emerald-400/60 flex items-center justify-center bg-slate-900/80 shadow-[0_0_40px_rgba(52,211,153,0.8)]">
                      <span className="text-5xl sm:text-6xl">üß±</span>
                    </div>
                  </div>
                  <h2 className="text-3xl sm:text-4xl font-extrabold text-emerald-300 drop-shadow">
                    X√¢y D·ª±ng Ph√°o ƒê√†i H√¨nh Ch·ªØ Nh·∫≠t
                  </h2>
                  <p className="text-sm sm:text-base text-slate-200 max-w-xl">
                    M·ªói c√¢u tr·∫£ l·ªùi ƒë√∫ng gi√∫p em x√¢y th√™m <strong>t∆∞·ªùng g·∫°ch</strong>,{" "}
                    <strong>th√°p canh</strong> v√† <strong>c·ªïng ch√≠nh</strong> cho ph√°o ƒë√†i.
                    Ho√†n th√†nh 15 c√¢u h·ªèi ƒë·ªÉ t·∫°o n√™n m·ªôt ph√°o ƒë√†i b·∫•t kh·∫£ x√¢m ph·∫°m!
                  </p>
                  <button
                    onClick={handleStart}
                    className="mt-2 px-8 py-3 rounded-full bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-bold text-lg shadow-lg shadow-emerald-500/40 transform hover:-translate-y-0.5 active:translate-y-0 transition-all"
                  >
                    B·∫ÆT ƒê·∫¶U X√ÇY T∆Ø·ªúNG üß±
                  </button>
                </div>
              )}

              {/* PLAYING */}
              {gameState === "playing" && (
                <div className="flex flex-col md:flex-row gap-6">
                  {/* C·ªôt tr√°i: Ph√°o ƒë√†i */}
                  <div className="md:w-1/3 flex flex-col items-center gap-4">
                    <FortView score={score} />
                    <div className="text-center text-[11px] text-slate-300 mt-2">
                      C√¢u ƒë√∫ng:{" "}
                      <span className="font-semibold text-emerald-300">
                        {correctCount}
                      </span>{" "}
                      / {questions.length}
                    </div>
                  </div>

                  {/* C·ªôt ph·∫£i: C√¢u h·ªèi */}
                  <div className="md:w-2/3 bg-slate-900/80 border border-slate-700 rounded-2xl p-4 sm:p-6 relative overflow-hidden">
                    <div className="absolute top-0 right-0 w-24 h-24 bg-emerald-500/10 rounded-bl-full pointer-events-none" />
                    <span className="absolute -top-3 -right-3 px-3 py-1 bg-emerald-600 text-xs font-bold rounded-full uppercase tracking-wider border border-emerald-300 shadow-lg">
                      {questions[currentQ].level}
                    </span>

                    <h3 className="text-lg sm:text-xl font-semibold mb-4 text-slate-50">
                      {questions[currentQ].question}
                    </h3>

                    <div className="grid grid-cols-1 gap-3 mt-2">
                      {questions[currentQ].options.map((opt, idx) => {
                        let base =
                          "w-full text-left px-4 py-3 rounded-xl border text-sm sm:text-base transition-all";
                        let style =
                          "border-slate-600 bg-slate-800/80 hover:bg-slate-700/80 text-slate-100";

                        if (feedback) {
                          if (idx === questions[currentQ].correct) {
                            style =
                              "border-emerald-400 bg-emerald-900/50 text-emerald-100 shadow-[0_0_18px_rgba(52,211,153,0.6)]";
                          } else if (feedback === "wrong") {
                            style =
                              "border-slate-700 bg-slate-900/70 text-slate-500 opacity-60";
                          }
                        }

                        return (
                          <button
                            key={idx}
                            disabled={!!feedback}
                            onClick={() => handleAnswer(idx)}
                            className={base + " " + style}
                          >
                            <span className="font-semibold mr-2">
                              {["A.", "B.", "C.", "D."][idx]}
                            </span>
                            {opt}
                          </button>
                        );
                      })}
                    </div>

                    {feedback === "wrong" && (
                      <div className="absolute inset-0 bg-black/40 flex items-center justify-center pointer-events-none">
                        <div className="px-4 py-2 rounded-full bg-red-600 text-white text-sm font-semibold shadow-lg">
                          Sai m·∫•t r·ªìi, t∆∞·ªùng b·ªã n·ª©t m·ªôt ch√∫t! Th·ª≠ c·ªë g·∫Øng ·ªü c√¢u sau nh√© üò¢
                        </div>
                      </div>
                    )}
                    {feedback === "correct" && (
                      <>
                        <Confetti />
                        <div className="absolute inset-0 bg-black/30 flex items-center justify-center pointer-events-none">
                          <div className="px-4 py-2 rounded-full bg-emerald-500 text-slate-900 text-sm font-semibold shadow-lg">
                            Ch√≠nh x√°c! Ph√°o ƒë√†i v·ª´a ƒë∆∞·ª£c x√¢y th√™m m·ªôt ƒëo·∫°n t∆∞·ªùng ch·∫Øc ch·∫Øn üí™
                          </div>
                        </div>
                      </>
                    )}
                  </div>
                </div>
              )}

              {/* END */}
              {gameState === "end" && (
                <div className="flex flex-col items-center text-center gap-6 py-8">
                  <div className="relative">
                    <div className="absolute inset-0 bg-yellow-400 blur-3xl opacity-40 animate-pulse" />
                    <div className="relative w-32 h-32 sm:w-40 sm:h-40 rounded-3xl border border-yellow-400/60 flex items-center justify-center bg-slate-900/80 shadow-[0_0_40px_rgba(250,204,21,0.9)]">
                      <span className="text-5xl sm:text-6xl">üè∞</span>
                    </div>
                  </div>
                  <h2 className="text-3xl sm:text-4xl font-extrabold text-yellow-300 drop-shadow">
                    Ph√°o ƒê√†i ƒê√£ Ho√†n Th√†nh!
                  </h2>
                  <p className="text-sm sm:text-base text-slate-200 max-w-xl">
                    B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng{" "}
                    <span className="font-bold text-emerald-300">
                      {correctCount}
                    </span>{" "}
                    / {questions.length} c√¢u.
                    Nh·ªØng b·ª©c t∆∞·ªùng h√¨nh ch·ªØ nh·∫≠t c·ªßa b·∫°n ƒë√£ tr·ªü n√™n v√¥ c√πng ki√™n c·ªë!
                  </p>

                  <div className="flex flex-col sm:flex-row gap-4 justify-center text-sm sm:text-base">
                    <div className="px-4 py-3 rounded-2xl bg-slate-900/80 border border-slate-700 min-w-[140px]">
                      <div className="text-slate-300 text-xs uppercase mb-1">
                        T·ªïng ƒëi·ªÉm
                      </div>
                      <div className="text-2xl font-bold text-emerald-400">
                        {score}
                      </div>
                    </div>
                    <div className="px-4 py-3 rounded-2xl bg-slate-900/80 border border-slate-700 min-w-[140px]">
                      <div className="text-slate-300 text-xs uppercase mb-1">
                        Danh hi·ªáu
                      </div>
                      <div className="text-lg font-bold text-yellow-300">
                        {score >= 130
                          ? "Ch√∫a T·ªÉ Ph√°o ƒê√†i"
                          : score >= 100
                          ? "Th·ªëng Lƒ©nh Ph√≤ng Th·ªß"
                          : "Chi·∫øn Binh Canh C·ªïng"}
                      </div>
                    </div>
                  </div>

                  <button
                    onClick={() => {
                      setGameState("intro");
                      setCurrentQ(0);
                      setScore(0);
                      setFeedback(null);
                    }}
                    className="mt-2 px-8 py-3 rounded-full bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-bold text-lg shadow-lg shadow-emerald-500/40 transform hover:-translate-y-0.5 active:translate-y-0 transition-all"
                  >
                    CH∆†I L·∫†I T·ª™ ƒê·∫¶U üîÅ
                  </button>
                </div>
              )}
            </main>

            <footer className="px-6 sm:px-10 py-3 text-[11px] text-slate-400 border-t border-slate-800 bg-slate-950/80 text-center">
              To√°n 8 ‚Äì H√¨nh ch·ªØ nh·∫≠t ‚Äì Ph√°o ƒê√†i H√¨nh Ch·ªØ Nh·∫≠t ‚Äì Thu B√¨nh To√°n üíö
            </footer>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<RectFortress />);
  </script>
</body>
</html>
