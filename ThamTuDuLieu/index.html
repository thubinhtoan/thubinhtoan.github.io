<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√°m T·ª≠ D·ªØ Li·ªáu - To√°n 8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background: linear-gradient(135deg, #ccfbf1 0%, #99f6e4 100%); /* Teal theme */
        }

        .card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px -10px rgba(20, 184, 166, 0.2);
            transition: transform 0.3s ease;
        }

        .option-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.15);
            background-color: #f0fdfa;
            border-color: #14b8a6;
        }

        .option-btn.correct {
            background-color: #d1fae5 !important;
            border-color: #059669 !important;
            color: #064e3b !important;
        }

        .option-btn.wrong {
            background-color: #fee2e2 !important;
            border-color: #dc2626 !important;
            color: #7f1d1d !important;
        }

        /* Animation cho Feedback */
        .feedback-enter {
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-bar {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .badge {
            font-size: 0.75rem;
            padding: 0.35rem 0.85rem;
            border-radius: 9999px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-3xl">
        <!-- Start Screen -->
        <div id="start-screen" class="card p-10 text-center">
            <div class="mb-6 inline-flex p-5 bg-teal-100 rounded-full animate-bounce">
                <span class="text-6xl">üîç</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-black text-teal-800 mb-4">Th√°m T·ª≠ D·ªØ Li·ªáu</h1>
            <p class="text-teal-600 mb-10 text-lg font-medium">Chinh ph·ª•c k·ªπ nƒÉng Ph√¢n t√≠ch s·ªë li·ªáu<br>To√°n 8 - Ch∆∞∆°ng 4</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10 text-left">
                <div class="bg-teal-50 p-4 rounded-xl border border-teal-100">
                    <div class="font-bold text-teal-800 mb-1">üéØ M·ª•c ti√™u</div>
                    <div class="text-sm text-teal-600">Ph√°t hi·ªán quy lu·∫≠t & t√≠nh h·ª£p l√Ω</div>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <div class="font-bold text-blue-800 mb-1">üìä K·ªπ nƒÉng</div>
                    <div class="text-sm text-blue-600">ƒê·ªçc & x·ª≠ l√Ω bi·ªÉu ƒë·ªì</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-xl border border-purple-100">
                    <div class="font-bold text-purple-800 mb-1">üèÜ Th·ª≠ th√°ch</div>
                    <div class="text-sm text-purple-600">15 c√¢u h·ªèi h√≥c b√∫a</div>
                </div>
            </div>

            <button onclick="startGame()" class="w-full md:w-auto px-12 py-4 bg-teal-600 hover:bg-teal-700 text-white font-bold rounded-2xl shadow-lg shadow-teal-200 transform transition hover:-translate-y-1 text-xl flex items-center justify-center gap-3 mx-auto">
                <span>B·∫Øt ƒê·∫ßu ƒêi·ªÅu Tra</span> üëâ
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <!-- Header -->
            <div class="flex justify-between items-end mb-6 px-2">
                <div>
                    <span class="text-teal-600 text-xs font-bold uppercase tracking-wider block mb-1">Ti·∫øn ƒë·ªô ƒëi·ªÅu tra</span>
                    <div class="text-2xl font-black text-gray-800"><span id="current-question">1</span><span class="text-gray-400 text-lg">/15</span></div>
                </div>
                <div class="text-right">
                    <div class="inline-flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow-sm">
                        <span class="text-yellow-500 text-xl">‚≠ê</span>
                        <span class="text-2xl font-black text-teal-600" id="score">0</span>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-white rounded-full h-3 mb-8 p-1 shadow-sm">
                <div id="progress" class="bg-teal-500 h-full rounded-full progress-bar" style="width: 0%"></div>
            </div>

            <!-- Question Card -->
            <div class="card p-6 md:p-10 mb-6 relative overflow-hidden border-b-4 border-teal-100">
                <div id="level-badge" class="badge bg-green-100 text-green-700 absolute top-6 right-6">Nh·∫≠n bi·∫øt</div>
                
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 mt-6 mb-8 leading-relaxed">
                    ƒêang t·∫£i d·ªØ li·ªáu v·ª• √°n...
                </h2>

                <div id="options-container" class="grid gap-3 md:gap-4">
                    <!-- Options will be injected here -->
                </div>
            </div>

            <!-- Feedback Area -->
            <div id="feedback-area" class="hidden feedback-enter">
                <div id="feedback-card" class="card p-6 border-l-8 shadow-xl">
                    <div class="flex flex-col md:flex-row items-start gap-5">
                        <div id="feedback-icon" class="text-5xl filter drop-shadow-md">üòé</div>
                        <div class="flex-1">
                            <h3 id="feedback-title" class="text-2xl font-bold mb-2 text-teal-700">Ch√≠nh x√°c!</h3>
                            <div class="text-xs font-bold text-gray-400 uppercase mb-2 tracking-wide">Ph√¢n t√≠ch:</div>
                            <p id="feedback-text" class="text-gray-700 leading-relaxed text-lg font-medium"></p>
                        </div>
                    </div>
                    <button onclick="nextQuestion()" class="mt-6 w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-4 px-6 rounded-xl transition flex items-center justify-center gap-2 shadow-lg">
                        V·ª• √°n ti·∫øp theo <span class="text-xl">‚Üí</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden card p-10 text-center">
            <div class="mb-8">
                <div class="inline-block p-8 rounded-full bg-yellow-50 border-4 border-yellow-200 mb-6 animate-pulse">
                    <span class="text-7xl">üïµÔ∏è</span>
                </div>
                <h2 class="text-4xl font-extrabold text-gray-800 mb-3">H·ªì S∆° Kh√©p L·∫°i!</h2>
                <p class="text-gray-500 text-lg">B·∫°n ƒë√£ ho√†n th√†nh nhi·ªám v·ª• ph√¢n t√≠ch.</p>
            </div>

            <div class="bg-teal-50 rounded-2xl p-8 mb-8 border-2 border-teal-100 border-dashed">
                <div class="text-teal-500 font-bold uppercase text-xs tracking-widest mb-2">T·ªïng ƒëi·ªÉm ƒë·∫°t ƒë∆∞·ª£c</div>
                <div class="text-6xl font-black text-teal-600 mb-4" id="final-score">0</div>
                <p id="result-message" class="text-gray-700 font-bold text-xl">Xu·∫•t s·∫Øc!</p>
            </div>

            <button onclick="location.reload()" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 px-10 rounded-xl shadow-lg transform transition hover:scale-105 flex items-center justify-center gap-2 mx-auto w-full md:w-auto">
                <span class="text-xl">üîÑ</span> Ph√¢n T√≠ch L·∫°i
            </button>
        </div>
    </div>

    <!-- Audio Effects -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3"></audio>
    <audio id="sound-finish" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

   <script>
  const questions = [
    // 6 C√¢u Nh·∫≠n bi·∫øt (1-6)
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Trong b·∫£ng th·ªëng k√™ s·ªë c√¢y tr·ªìng ƒë∆∞·ª£c c·ªßa 4 t·ªï: T·ªï 1 (20), T·ªï 2 (25), T·ªï 3 (18), T·ªï 4 (30). T·ªï n√†o tr·ªìng ƒë∆∞·ª£c nhi·ªÅu c√¢y nh·∫•t?",
      options: ["T·ªï 1", "T·ªï 2", "T·ªï 3", "T·ªï 4"],
      correct: 3,
      rationale: "D·ª±a v√†o b·∫£ng s·ªë li·ªáu, ta so s√°nh c√°c gi√° tr·ªã: 20, 25, 18, 30. Gi√° tr·ªã l·ªõn nh·∫•t l√† 30, t∆∞∆°ng ·ª©ng v·ªõi T·ªï 4."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Bi·ªÉu ƒë·ªì c·ªôt bi·ªÉu di·ªÖn nhi·ªát ƒë·ªô trung b√¨nh c√°c th√°ng. Tr·ª•c tung (tr·ª•c th·∫≥ng ƒë·ª©ng) th∆∞·ªùng bi·ªÉu di·ªÖn ƒë·∫°i l∆∞·ª£ng n√†o?",
      options: ["C√°c th√°ng trong nƒÉm", "Nhi·ªát ƒë·ªô (ƒë·ªô C)", "T√™n th√†nh ph·ªë", "NƒÉm th·ªëng k√™"],
      correct: 1,
      rationale: "Trong bi·ªÉu ƒë·ªì c·ªôt, tr·ª•c ho√†nh th∆∞·ªùng bi·ªÉu di·ªÖn c√°c ƒë·ªëi t∆∞·ª£ng (th√°ng), c√≤n tr·ª•c tung bi·ªÉu di·ªÖn s·ªë li·ªáu c·ªßa ƒë·ªëi t∆∞·ª£ng ƒë√≥ (nhi·ªát ƒë·ªô)."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "ƒê·ªÉ ph√°t hi·ªán m·ªôt gi√° tr·ªã b·∫•t h·ª£p l√Ω trong d√£y s·ªë li·ªáu chi·ªÅu cao h·ªçc sinh l·ªõp 8 (ƒë∆°n v·ªã cm), gi√° tr·ªã n√†o sau ƒë√¢y l√† ƒë√°ng ng·ªù nh·∫•t?",
      options: ["155", "162", "350", "148"],
      correct: 2,
      rationale: "Chi·ªÅu cao 350cm (3.5 m√©t) l√† phi th·ª±c t·∫ø ƒë·ªëi v·ªõi con ng∆∞·ªùi. ƒê√¢y l√† d·ªØ li·ªáu b·∫•t h·ª£p l√Ω c·∫ßn lo·∫°i b·ªè ho·∫∑c ki·ªÉm tra l·∫°i."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Trong bi·ªÉu ƒë·ªì h√¨nh qu·∫°t tr√≤n bi·ªÉu di·ªÖn t·ªâ l·ªá x·∫øp lo·∫°i h·ªçc l·ª±c, ph·∫ßn h√¨nh qu·∫°t l·ªõn nh·∫•t s·∫Ω t∆∞∆°ng ·ª©ng v·ªõi?",
      options: ["Lo·∫°i c√≥ s·ªë l∆∞·ª£ng √≠t nh·∫•t", "Lo·∫°i c√≥ t·ªâ l·ªá ph·∫ßn trƒÉm cao nh·∫•t", "Lo·∫°i trung b√¨nh", "Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c"],
      correct: 1,
      rationale: "Di·ªán t√≠ch (ho·∫∑c g√≥c ·ªü t√¢m) c·ªßa h√¨nh qu·∫°t t·ªâ l·ªá thu·∫≠n v·ªõi ph·∫ßn trƒÉm c·ªßa th√†nh ph·∫ßn ƒë√≥. Ph·∫ßn l·ªõn nh·∫•t ·ª©ng v·ªõi t·ªâ l·ªá cao nh·∫•t."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Bi·ªÉu ƒë·ªì ƒëo·∫°n th·∫≥ng ƒëi xu·ªëng t·ª´ tr√°i sang ph·∫£i trong m·ªôt kho·∫£ng th·ªùi gian th·ªÉ hi·ªán xu h∆∞·ªõng g√¨?",
      options: ["TƒÉng l√™n", "Gi·ªØ nguy√™n", "Gi·∫£m ƒëi", "Bi·∫øn ƒë·ªông m·∫°nh"],
      correct: 2,
      rationale: "ƒê·ªô d·ªëc ƒëi xu·ªëng c·ªßa ƒë∆∞·ªùng g·∫•p kh√∫c trong bi·ªÉu ƒë·ªì ƒëo·∫°n th·∫≥ng th·ªÉ hi·ªán gi√° tr·ªã c·ªßa d·ªØ li·ªáu ƒëang gi·∫£m ƒëi theo th·ªùi gian."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "T·ªïng c√°c t·∫ßn s·ªë (s·ªë l∆∞·ª£ng) c·ªßa c√°c th√†nh ph·∫ßn trong b·∫£ng th·ªëng k√™ ph·∫£i b·∫±ng:",
      options: ["100", "T·ªïng s·ªë ƒë·ªëi t∆∞·ª£ng ƒë∆∞·ª£c ƒëi·ªÅu tra", "Gi√° tr·ªã l·ªõn nh·∫•t", "Gi√° tr·ªã trung b√¨nh"],
      correct: 1,
      rationale: "Khi c·ªông t·∫•t c·∫£ s·ªë l∆∞·ª£ng c·ªßa t·ª´ng nh√≥m con l·∫°i, ta ph·∫£i ƒë∆∞·ª£c t·ªïng s·ªë ƒë·ªëi t∆∞·ª£ng ban ƒë·∫ßu c·ªßa m·∫´u s·ªë li·ªáu."
    },

    // 5 C√¢u Th√¥ng hi·ªÉu (7-11)
    {
      level: "Th√¥ng hi·ªÉu",
      question: "Bi·ªÉu ƒë·ªì qu·∫°t tr√≤n cho bi·∫øt: Lo·∫°i A (25%), Lo·∫°i B (35%), Lo·∫°i C (x%). Gi√° tr·ªã c·ªßa x l√† bao nhi√™u ƒë·ªÉ bi·ªÉu ƒë·ªì h·ª£p l√Ω?",
      options: ["30%", "40%", "50%", "100%"],
      correct: 1,
      rationale: "T·ªïng t·ªâ l·ªá ph·∫ßn trƒÉm ph·∫£i l√† 100%. Ta c√≥ x = 100% - (25% + 35%) = 40%."
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "Doanh thu c√¥ng ty: Th√°ng 1 (10 t·ª∑), Th√°ng 2 (12 t·ª∑), Th√°ng 3 (15 t·ª∑). Nh·∫≠n x√©t n√†o sau ƒë√¢y l√† ƒë√∫ng v·ªÅ xu h∆∞·ªõng doanh thu?",
      options: ["Doanh thu gi·∫£m d·∫ßn", "Doanh thu kh√¥ng ƒë·ªïi", "Doanh thu tƒÉng tr∆∞·ªüng ƒë·ªÅu", "Doanh thu tƒÉng li√™n t·ª•c"],
      correct: 3,
      rationale: "C√°c gi√° tr·ªã 10 < 12 < 15 cho th·∫•y doanh thu tƒÉng li√™n t·ª•c qua c√°c th√°ng."
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "M·ªôt c·ª≠a h√†ng b√°n size gi√†y: 38, 39, 40, 41. S·ªë l∆∞·ª£ng b√°n ƒë∆∞·ª£c l·∫ßn l∆∞·ª£t l√† 5, 15, 20, 2. C·ª≠a h√†ng n√™n nh·∫≠p th√™m size n√†o nhi·ªÅu nh·∫•t?",
      options: ["Size 38", "Size 39", "Size 40", "Size 41"],
      correct: 2,
      rationale: "Size 40 b√°n ƒë∆∞·ª£c nhi·ªÅu nh·∫•t (20 ƒë√¥i), cho th·∫•y nhu c·∫ßu cao nh·∫•t. C·ª≠a h√†ng n√™n ∆∞u ti√™n nh·∫≠p size n√†y."
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "N·∫øu bi·ªÉu ƒë·ªì c·ªôt c√≥ g·ªëc tr·ª•c tung b·∫Øt ƒë·∫ßu t·ª´ 100 thay v√¨ 0, ƒëi·ªÅu n√†y c√≥ th·ªÉ d·∫´n ƒë·∫øn s·ª± hi·ªÉu l·∫ßm n√†o?",
      options: ["L√†m cho s·ªë li·ªáu nh·ªè ƒëi", "Ph√≥ng ƒë·∫°i s·ª± ch√™nh l·ªách gi·ªØa c√°c c·ªôt", "L√†m cho c√°c c·ªôt b·∫±ng nhau", "Kh√¥ng ·∫£nh h∆∞·ªüng g√¨"],
      correct: 1,
      rationale: "Vi·ªác c·∫Øt b·ªõt tr·ª•c tung (kh√¥ng b·∫Øt ƒë·∫ßu t·ª´ 0) l√†m cho t·ªâ l·ªá chi·ªÅu cao c√°c c·ªôt thay ƒë·ªïi, khi·∫øn s·ª± ch√™nh l·ªách tr√¥ng c√≥ v·∫ª l·ªõn h∆°n th·ª±c t·∫ø."
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "ƒêi·ªÉm trung b√¨nh m√¥n To√°n c·ªßa t·ªï 1 l√† 8.0. N·∫øu c√≥ th√™m m·ªôt b·∫°n ƒëi·ªÉm 10 chuy·ªÉn v√†o t·ªï, ƒëi·ªÉm trung b√¨nh m·ªõi s·∫Ω nh∆∞ th·∫ø n√†o?",
      options: ["Gi·∫£m ƒëi", "TƒÉng l√™n", "Kh√¥ng ƒë·ªïi", "B·∫±ng 9.0"],
      correct: 1,
      rationale: "V√¨ ƒëi·ªÉm s·ªë m·ªõi (10) cao h∆°n ƒëi·ªÉm trung b√¨nh hi·ªán t·∫°i (8.0), n√™n n√≥ s·∫Ω k√©o ƒëi·ªÉm trung b√¨nh chung c·ªßa c·∫£ t·ªï tƒÉng l√™n."
    },

    // 3 C√¢u V·∫≠n d·ª•ng (12-14)
    {
      level: "V·∫≠n d·ª•ng",
      question: "L·ªõp 8A c√≥ 40 h·ªçc sinh. Bi·ªÉu ƒë·ªì qu·∫°t tr√≤n cho th·∫•y s·ªë h·ªçc sinh gi·ªèi chi·∫øm 30%. H·ªèi l·ªõp 8A c√≥ bao nhi√™u h·ªçc sinh gi·ªèi?",
      options: ["10 h·ªçc sinh", "12 h·ªçc sinh", "30 h·ªçc sinh", "15 h·ªçc sinh"],
      correct: 1,
      rationale: "S·ªë h·ªçc sinh gi·ªèi = T·ªïng s·ªë h·ªçc sinh √ó T·ªâ l·ªá % = 40 √ó 30% = 12 h·ªçc sinh."
    },
    {
      level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
      question: "Gi√° m·ªôt lo·∫°i c·ªï phi·∫øu trong 3 ng√†y: Ng√†y 1 (100k), Ng√†y 2 (110k), Ng√†y 3 (121k). T·ªâ l·ªá tƒÉng tr∆∞·ªüng c·ªßa Ng√†y 2 so v·ªõi Ng√†y 1 l√† bao nhi√™u?",
      options: ["10%", "11%", "21%", "100%"],
      correct: 0,
      rationale: "M·ª©c tƒÉng l√† 110 - 100 = 10k. T·ªâ l·ªá tƒÉng = (10 / 100) √ó 100% = 10%."
    },
    {
      level: "V·∫≠n d·ª•ng",
      question: "Trung b√¨nh c·ªông s·ªë c√¢n n·∫∑ng c·ªßa 3 b·∫°n l√† 45kg. N·∫øu b·∫°n th·ª© t∆∞ n·∫∑ng 53kg gia nh·∫≠p nh√≥m, trung b√¨nh c·ªông m·ªõi c·ªßa 4 b·∫°n l√† bao nhi√™u?",
      options: ["49 kg", "47 kg", "48 kg", "50 kg"],
      correct: 1,
      rationale: "T·ªïng c√¢n n·∫∑ng 3 b·∫°n ƒë·∫ßu: 45 √ó 3 = 135kg. T·ªïng c√¢n n·∫∑ng 4 b·∫°n: 135 + 53 = 188kg. Trung b√¨nh m·ªõi: 188 : 4 = 47kg."
    },

    // 1 C√¢u V·∫≠n d·ª•ng cao (15) - ƒê√É S·ª¨A ƒê√ÅP √ÅN
    {
      level: "V·∫≠n d·ª•ng cao",
      question: "M·ªôt c√¥ng ty b√°o c√°o: 'Doanh thu nƒÉm nay tƒÉng g·∫•p ƒë√¥i nƒÉm ngo√°i!'. Tuy nhi√™n, khi nh√¨n v√†o bi·ªÉu ƒë·ªì, c·ªôt nƒÉm nay cao g·∫•p ƒë√¥i c·ªôt nƒÉm ngo√°i nh∆∞ng tr·ª•c tung l·∫°i b·∫Øt ƒë·∫ßu t·ª´ 50 t·ª∑ (doanh thu nƒÉm ngo√°i l√† 100 t·ª∑). Th·ª±c t·∫ø doanh thu tƒÉng bao nhi√™u ph·∫ßn trƒÉm?",
      options: ["100% (G·∫•p ƒë√¥i)", "50%", "200%", "Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c"],
      correct: 1,
      rationale: "V√¨ tr·ª•c tung b·∫Øt ƒë·∫ßu t·ª´ 50 n√™n chi·ªÅu cao c·ªôt t·ªâ l·ªá v·ªõi (gi√° tr·ªã ‚àí 50). NƒÉm ngo√°i: 100‚àí50=50. NƒÉm nay cao g·∫•p ƒë√¥i ‚áí (x‚àí50)=100 ‚áí x=150. TƒÉng (150‚àí100)/100=50%."
    }
  ];

  let currentQuestionIndex = 0;
  let score = 0;
  let isAnswering = false;

  // Sound Elements
  const soundCorrect = document.getElementById('sound-correct');
  const soundWrong = document.getElementById('sound-wrong');
  const soundFinish = document.getElementById('sound-finish');

  function playSound(type) {
    if (type === 'correct') { soundCorrect.currentTime = 0; soundCorrect.play().catch(() => {}); }
    if (type === 'wrong') { soundWrong.currentTime = 0; soundWrong.play().catch(() => {}); }
    if (type === 'finish') { soundFinish.currentTime = 0; soundFinish.play().catch(() => {}); }
  }

  // Shuffle options but keep correct answer consistent
  function shuffleWithCorrect(options, correctIndex) {
    const arr = options.map((text, i) => ({ text, isCorrect: i === correctIndex }));
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return {
      options: arr.map(o => o.text),
      correct: arr.findIndex(o => o.isCorrect)
    };
  }

  function startGame() {
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('quiz-screen').classList.remove('hidden');
    loadQuestion();
  }

  function loadQuestion() {
    isAnswering = true;
    const q = questions[currentQuestionIndex];

    // Random options each time load question
    const shuffled = shuffleWithCorrect(q.options, q.correct);
    q.options = shuffled.options;
    q.correct = shuffled.correct;

    // Update UI
    document.getElementById('current-question').innerText = currentQuestionIndex + 1;
    document.getElementById('score').innerText = score;

    // Progress (correct to 100% at last question)
    const progressPercent = ((currentQuestionIndex + 1) / questions.length) * 100;
    document.getElementById('progress').style.width = `${progressPercent}%`;

    // Setup Question Card
    document.getElementById('question-text').innerText = q.question;

    // Badge color based on level
    const badge = document.getElementById('level-badge');
    badge.innerText = q.level;
    if (q.level.includes("Nh·∫≠n bi·∫øt")) badge.className = "badge bg-green-100 text-green-700 absolute top-6 right-6";
    else if (q.level.includes("Th√¥ng hi·ªÉu")) badge.className = "badge bg-blue-100 text-blue-700 absolute top-6 right-6";
    else if (q.level.includes("V·∫≠n d·ª•ng cao")) badge.className = "badge bg-purple-100 text-purple-700 absolute top-6 right-6";
    else badge.className = "badge bg-yellow-100 text-yellow-700 absolute top-6 right-6";

    // Hide feedback area & reset animation class
    const feedbackArea = document.getElementById('feedback-area');
    feedbackArea.classList.add('hidden');
    feedbackArea.classList.remove('feedback-enter');

    // Generate Options
    const container = document.getElementById('options-container');
    container.innerHTML = '';

    q.options.forEach((opt, index) => {
      const btn = document.createElement('button');
      btn.className = `option-btn w-full text-left p-5 rounded-xl border-2 border-teal-50 bg-white text-gray-700 font-bold text-lg flex items-center shadow-sm`;
      btn.onclick = () => checkAnswer(index, btn);
      btn.innerHTML = `
        <span class="inline-flex items-center justify-center w-10 h-10 bg-teal-50 rounded-lg text-teal-600 font-extrabold mr-4 text-lg border border-teal-100 shrink-0">
          ${String.fromCharCode(65 + index)}
        </span>
        <span>${opt}</span>
      `;
      container.appendChild(btn);
    });
  }

  function checkAnswer(selectedIndex, btnElement) {
    if (!isAnswering) return;
    isAnswering = false;

    const q = questions[currentQuestionIndex];
    const isCorrect = selectedIndex === q.correct;
    const buttons = document.querySelectorAll('.option-btn');

    // Disable all buttons
    buttons.forEach(btn => btn.disabled = true);

    // Highlight answers
    if (isCorrect) {
      btnElement.classList.add('correct');
      score += 10;
      document.getElementById('score').innerText = score;
      playSound('correct');
      fireConfetti();
      showFeedback(true, q.rationale);
    } else {
      btnElement.classList.add('wrong');
      if (buttons[q.correct]) buttons[q.correct].classList.add('correct');
      playSound('wrong');
      showFeedback(false, q.rationale);
    }
  }

  function showFeedback(isCorrect, rationale) {
    const area = document.getElementById('feedback-area');
    const card = document.getElementById('feedback-card');
    const title = document.getElementById('feedback-title');
    const text = document.getElementById('feedback-text');
    const icon = document.getElementById('feedback-icon');

    area.classList.remove('hidden');
    void area.offsetWidth; // Trigger reflow
    area.classList.add('feedback-enter');

    if (isCorrect) {
      card.className = "card p-6 border-l-8 border-green-500 bg-green-50 shadow-xl";
      title.className = "text-2xl font-bold mb-2 text-green-700";
      title.innerText = "Ch√≠nh x√°c! üéâ";
      icon.innerText = "ü§©";
    } else {
      card.className = "card p-6 border-l-8 border-red-500 bg-red-50 shadow-xl";
      title.className = "text-2xl font-bold mb-2 text-red-700";
      title.innerText = "Ch∆∞a ch√≠nh x√°c... üßê";
      icon.innerText = "ü§î";
    }

    text.innerText = rationale;
  }

  function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < questions.length) {
      loadQuestion();
    } else {
      showResult();
    }
  }

  function showResult() {
    document.getElementById('quiz-screen').classList.add('hidden');
    document.getElementById('result-screen').classList.remove('hidden');
    document.getElementById('final-score').innerText = score;
    playSound('finish');
    fireConfetti();

    const msg = document.getElementById('result-message');
    if (score >= 130) msg.innerText = "ƒê·ªânh c·ªßa ch√≥p! B·∫°n l√† chuy√™n gia ph√¢n t√≠ch! üåü";
    else if (score >= 100) msg.innerText = "R·∫•t t·ªët! T∆∞ duy ph√¢n t√≠ch s·∫Øc b√©n! üëç";
    else if (score >= 70) msg.innerText = "Kh√° l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
    else msg.innerText = "H√£y √¥n l·∫°i b√†i v√† th·ª≠ l·∫°i nh√©! üìö";
  }

  function fireConfetti() {
    var count = 200;
    var defaults = { origin: { y: 0.7 } };

    function fire(particleRatio, opts) {
      confetti(Object.assign({}, defaults, opts, {
        particleCount: Math.floor(count * particleRatio)
      }));
    }

    fire(0.25, { spread: 26, startVelocity: 55 });
    fire(0.2, { spread: 60 });
    fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
    fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
    fire(0.1, { spread: 120, startVelocity: 45 });
  }
</script>
</body>
</html>
