<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chi·∫øn Binh Ng√¢n H√† ‚Äì T√≠nh ch·∫•t ph√©p khai ph∆∞∆°ng (To√°n 9)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    @keyframes fall-confetti {
      to {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-900 text-white flex items-center justify-center p-4 overflow-hidden select-none">
  <!-- N·ªÅn sao -->
  <div id="star-field" class="absolute inset-0 overflow-hidden pointer-events-none -z-10"></div>

  <!-- Confetti -->
  <div id="confetti-container" class="absolute inset-0 pointer-events-none overflow-hidden z-40"></div>

  <!-- Header: ƒëi·ªÉm + √¢m thanh -->
  <div class="absolute top-4 left-4 right-4 flex justify-between items-center z-20">
    <div class="flex items-center space-x-2 bg-slate-800/80 px-3 py-2 rounded-lg border border-slate-600">
      <span class="text-yellow-400 text-lg">üèÜ</span>
      <span id="score-text" class="font-bold text-lg">0</span>
    </div>
    <button id="sound-toggle"
      class="p-2 bg-slate-800/80 rounded-full border border-slate-600 hover:bg-slate-700 transition">
      üîä
    </button>
  </div>

  <!-- START SCREEN -->
  <div id="start-screen"
    class="z-10 text-center bg-slate-800/90 p-8 rounded-2xl border-2 border-blue-500 shadow-[0_0_50px_rgba(59,130,246,0.5)] max-w-md w-full transform transition-all hover:scale-105">
    <div class="mb-6">
      <div
        class="w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mx-auto flex items-center justify-center shadow-lg animate-bounce text-4xl">
        ‚ö°
      </div>
    </div>
    <h1
      class="text-4xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">
      CHI·∫æN BINH NG√ÇN H√Ä
    </h1>
    <p class="text-slate-300 mb-6">
      To√°n 9 ‚Äì T√≠nh ch·∫•t ph√©p khai ph∆∞∆°ng<br />
      B·ªô s√°ch Ch√¢n tr·ªùi s√°ng t·∫°o.
    </p>
    <div class="space-y-2 mb-8 text-sm text-slate-400">
      <p>‚Ä¢ Tr·∫£ l·ªùi ƒë√∫ng ƒë·ªÉ n·∫°p nƒÉng l∆∞·ª£ng t√†u chi·∫øn</p>
      <p>‚Ä¢ B·∫Øn h·∫° h·∫°m ƒë·ªôi Alien</p>
      <p>‚Ä¢ 15 c√¢u h·ªèi th·ª≠ th√°ch</p>
    </div>
    <button id="start-btn"
      class="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl font-bold text-xl hover:from-blue-500 hover:to-indigo-500 shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2">
      <span>‚ñ∂</span> B·∫ÆT ƒê·∫¶U NHI·ªÜM V·ª§
    </button>
  </div>

  <!-- GAMEPLAY SCREEN -->
  <div id="game-screen" class="hidden z-10 w-full max-w-4xl flex flex-col items-center h-full justify-between py-8">

    <!-- Battle scene -->
    <div class="relative w-full h-64 mb-6 flex justify-center items-center">
      <!-- Boss + thanh m√°u -->
      <div id="boss-wrapper"
        class="absolute top-0 flex flex-col items-center transition-all duration-500">
        <div class="w-48 h-4 bg-slate-700 rounded-full mb-2 overflow-hidden border border-slate-500">
          <div id="enemy-hp-bar" class="h-full bg-red-500 transition-all duration-500" style="width: 100%;"></div>
        </div>
        <svg width="120" height="100" viewBox="0 0 100 80"
          class="drop-shadow-[0_0_15px_rgba(239,68,68,0.6)]">
          <path d="M20,40 Q50,0 80,40 L90,50 L50,70 L10,50 Z" fill="#475569" stroke="#ef4444" stroke-width="2" />
          <circle cx="50" cy="40" r="15" fill="#1e293b" stroke="#ef4444" stroke-width="2" />
          <circle cx="50" cy="40" r="5" fill="#ef4444">
            <animate attributeName="r" values="4;6;4" dur="1s" repeatCount="indefinite" />
          </circle>
          <path d="M10,50 L0,60 M90,50 L100,60" stroke="#ef4444" stroke-width="2" />
        </svg>
      </div>

      <!-- Explosion -->
      <div id="explosion"
        class="hidden absolute w-16 h-16 rounded-full bg-yellow-400/70 shadow-[0_0_40px_rgba(250,204,21,0.9)]"></div>

      <!-- Laser -->
      <div id="laser"
        class="hidden absolute w-2 bg-cyan-400 h-48 bottom-10 left-1/2 transform -translate-x-1/2 shadow-[0_0_20px_#22d3ee] origin-bottom">
      </div>

      <!-- Player ship -->
      <div class="absolute bottom-0">
        <svg width="80" height="80" viewBox="0 0 80 80"
          class="drop-shadow-[0_0_15px_rgba(6,182,212,0.6)]">
          <path d="M40,0 L60,60 L40,50 L20,60 Z" fill="#0f172a" stroke="#06b6d4" stroke-width="2" />
          <rect x="38" y="60" width="4" height="10" fill="#fbbf24">
            <animate attributeName="y" values="60;62;60" dur="0.8s" repeatCount="indefinite" />
          </rect>
        </svg>
      </div>
    </div>

    <!-- Question box -->
    <div class="w-full bg-slate-800/90 backdrop-blur-md rounded-2xl border border-slate-600 p-6 shadow-2xl">
      <div class="flex justify-between items-center mb-4 text-sm text-slate-400">
        <span id="question-counter" class="bg-slate-700 px-3 py-1 rounded-full">C√¢u 1/15</span>
        <span id="question-level"
          class="text-yellow-400 font-semibold uppercase tracking-wider">Nh·∫≠n bi·∫øt</span>
      </div>
      <h2 id="question-text" class="text-xl md:text-2xl font-bold mb-6 text-center leading-relaxed">
        N·ªôi dung c√¢u h·ªèi...
      </h2>
      <div id="answers-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>

    <!-- Feedback overlay -->
    <div id="feedback-correct"
      class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none">
      <div
        class="text-6xl font-bold text-yellow-400 drop-shadow-[0_4px_0_rgba(0,0,0,0.5)] animate-bounce">
        TUY·ªÜT V·ªúI!
      </div>
    </div>
    <div id="feedback-wrong"
      class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none">
      <div
        class="text-6xl font-bold text-red-500 drop-shadow-[0_4px_0_rgba(0,0,0,0.5)] animate-pulse">
        SAI R·ªíI!
      </div>
    </div>

  </div>

  <!-- END SCREEN -->
  <div id="end-screen"
    class="hidden z-10 text-center bg-slate-800/95 p-8 rounded-2xl border-2 border-yellow-500 shadow-2xl max-w-md w-full">
    <div class="w-20 h-20 rounded-full bg-yellow-400/10 flex items-center justify-center mx-auto mb-4 text-4xl">
      üèÜ
    </div>
    <h2 class="text-3xl font-bold mb-2 text-yellow-400">NHI·ªÜM V·ª§ HO√ÄN TH√ÄNH!</h2>
    <p class="text-slate-300 mb-6">B·∫°n ƒë√£ ƒë√°nh b·∫°i h·∫°m ƒë·ªôi Alien.</p>

    <div class="grid grid-cols-2 gap-4 mb-8">
      <div class="bg-slate-700 p-4 rounded-xl">
        <div class="text-slate-400 text-sm">ƒêi·ªÉm s·ªë</div>
        <div id="end-score" class="text-2xl font-bold text-white">0</div>
      </div>
      <div class="bg-slate-700 p-4 rounded-xl">
        <div class="text-slate-400 text-sm">X·∫øp h·∫°ng</div>
        <div id="end-rank" class="text-2xl font-bold text-yellow-400">T√¢n binh</div>
      </div>
    </div>

    <button id="restart-btn"
      class="w-full py-3 bg-green-600 rounded-xl font-bold text-lg hover:bg-green-500 shadow-lg transition-colors flex items-center justify-center gap-2">
      <span>üîÑ</span> CH∆†I L·∫†I
    </button>
  </div>

  <script>
    /* ============== T·∫†O N·ªÄN SAO ============== */
    (function makeStars() {
      const container = document.getElementById('star-field');
      for (let i = 0; i < 60; i++) {
        const s = document.createElement('div');
        const size = Math.random() * 3 + 1;
        s.className = 'absolute bg-white rounded-full opacity-70';
        s.style.width = size + 'px';
        s.style.height = size + 'px';
        s.style.top = Math.random() * 100 + '%';
        s.style.left = Math.random() * 100 + '%';
        s.style.animation = `pulse ${Math.random() * 3 + 2}s ease-in-out infinite`;
        container.appendChild(s);
      }
    })();

    /* ============== D·ªÆ LI·ªÜU C√ÇU H·ªéI ============== */
    const questions = [
      // Nh·∫≠n bi·∫øt
      {
        level: "Nh·∫≠n bi·∫øt",
        question: "V·ªõi hai s·ªë a v√† b kh√¥ng √¢m, kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y l√† ƒë√∫ng?",
        options: [
          "‚àö(a . b) = ‚àöa . ‚àöb",
          "‚àö(a . b) = ‚àöa + ‚àöb",
          "‚àö(a . b) = a . b",
          "‚àö(a . b) = ‚àöa / ‚àöb"
        ],
        correct: 0
      },
      {
        level: "Nh·∫≠n bi·∫øt",
        question: "V·ªõi s·ªë a kh√¥ng √¢m v√† s·ªë b d∆∞∆°ng, quy t·∫Øc khai ph∆∞∆°ng m·ªôt th∆∞∆°ng l√†:",
        options: [
          "‚àö(a / b) = a / b",
          "‚àö(a / b) = ‚àöa / b",
          "‚àö(a / b) = ‚àöa / ‚àöb",
          "‚àö(a / b) = a / ‚àöb"
        ],
        correct: 2
      },
      {
        level: "Nh·∫≠n bi·∫øt",
        question: "T√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c: ‚àö(16 . 25)",
        options: ["20", "40", "9", "400"],
        correct: 0
      },
      {
        level: "Nh·∫≠n bi·∫øt",
        question: "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh ‚àö(100 . 4) l√†:",
        options: ["14", "200", "20", "50"],
        correct: 2
      },
      {
        level: "Nh·∫≠n bi·∫øt",
        question: "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh ‚àö(64 / 4) l√†:",
        options: ["8", "16", "4", "2"],
        correct: 2
      },
      {
        level: "Nh·∫≠n bi·∫øt",
        question: "ƒêi·ªÅu ki·ªán x√°c ƒë·ªãnh ƒë·ªÉ ‚àö(A . B) = ‚àöA . ‚àöB l√†:",
        options: [
          "A ‚â• 0 v√† B ‚â• 0",
          "A < 0 v√† B < 0",
          "A t√πy √Ω, B ‚â• 0",
          "A > 0 v√† B > 0"
        ],
        correct: 0
      },
      // Th√¥ng hi·ªÉu
      {
        level: "Th√¥ng hi·ªÉu",
        question: "T√≠nh gi√° tr·ªã bi·ªÉu th·ª©c: ‚àö12 . ‚àö3",
        options: ["6", "36", "15", "9"],
        correct: 0
      },
      {
        level: "Th√¥ng hi·ªÉu",
        question: "T√≠nh gi√° tr·ªã bi·ªÉu th·ª©c: ‚àö5 . ‚àö20",
        options: ["25", "100", "10", "50"],
        correct: 2
      },
      {
        level: "Th√¥ng hi·ªÉu",
        question: "R√∫t g·ªçn bi·ªÉu th·ª©c: ‚àö72 / ‚àö2",
        options: ["36", "6", "12", "18"],
        correct: 1
      },
      {
        level: "Th√¥ng hi·ªÉu",
        question: "T√≠nh gi√° tr·ªã bi·ªÉu th·ª©c: ‚àö(45 . 80)",
        options: ["50", "60", "125", "40"],
        correct: 1
      },
      {
        level: "Th√¥ng hi·ªÉu",
        question: "V·ªõi a ‚â• 0, k·∫øt qu·∫£ r√∫t g·ªçn c·ªßa ‚àö(9 . a^2) l√†:",
        options: ["3a", "9a", "-3a", "81a"],
        correct: 0
      },
      // V·∫≠n d·ª•ng
      {
        level: "V·∫≠n d·ª•ng",
        question: "T√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c: ‚àö(2,5 . 14,4)",
        options: ["60", "6", "3,6", "0,6"],
        correct: 1
      },
      {
        level: "V·∫≠n d·ª•ng",
        question: "Th·ª±c hi·ªán ph√©p t√≠nh: ‚àö(16,9 . 250)",
        options: ["65", "650", "130", "52"],
        correct: 0
      },
      {
        level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
        question: "M·ªôt khu v∆∞·ªùn h√¨nh ch·ªØ nh·∫≠t c√≥ chi·ªÅu r·ªông l√† ‚àö8 (m) v√† chi·ªÅu d√†i l√† ‚àö18 (m). Di·ªán t√≠ch khu v∆∞·ªùn l√†:",
        options: ["144 m¬≤", "26 m¬≤", "12 m¬≤", "120 m¬≤"],
        correct: 2
      },
      // V·∫≠n d·ª•ng cao
      {
        level: "V·∫≠n d·ª•ng cao",
        question: "Cho bi·ªÉu th·ª©c P = ‚àö(4(x - 1)^2). V·ªõi x < 1, gi√° tr·ªã c·ªßa P b·∫±ng:",
        options: [
          "2(x - 1)",
          "2(1 - x)",
          "4(x - 1)",
          "-2(x + 1)"
        ],
        correct: 1
      }
    ];

    /* ============== BI·∫æN TR·∫†NG TH√ÅI ============== */
    let gameState = 'start';
    let currentQIndex = 0;
    let score = 0;
    let streak = 0;
    let enemyHealth = 100;
    const maxHealth = 100;
    let soundEnabled = true;

    /* ============== DOM ============== */
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const endScreen = document.getElementById('end-screen');

    const startBtn = document.getElementById('start-btn');
    const restartBtn = document.getElementById('restart-btn');
    const soundToggle = document.getElementById('sound-toggle');

    const questionText = document.getElementById('question-text');
    const questionLevel = document.getElementById('question-level');
    const questionCounter = document.getElementById('question-counter');
    const answersContainer = document.getElementById('answers-container');

    const enemyHpBar = document.getElementById('enemy-hp-bar');
    const bossWrapper = document.getElementById('boss-wrapper');
    const laserEl = document.getElementById('laser');
    const explosionEl = document.getElementById('explosion');

    const scoreText = document.getElementById('score-text');
    const endScore = document.getElementById('end-score');
    const endRank = document.getElementById('end-rank');

    const feedbackCorrect = document.getElementById('feedback-correct');
    const feedbackWrong = document.getElementById('feedback-wrong');
    const confettiContainer = document.getElementById('confetti-container');

    /* ============== √ÇM THANH ============== */
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    function playTone(freq, type, duration) {
      if (!soundEnabled || !AudioCtx) return;
      const ctx = new AudioCtx();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0.1, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      osc.stop(ctx.currentTime + duration);
    }
    function playWinSound() {
      playTone(523.25, 'sine', 0.1);
      setTimeout(() => playTone(659.25, 'sine', 0.1), 100);
      setTimeout(() => playTone(783.99, 'sine', 0.2), 200);
      setTimeout(() => playTone(1046.5, 'square', 0.4), 300);
    }
    function playShootSound() {
      playTone(800, 'sawtooth', 0.1);
      setTimeout(() => playTone(400, 'sawtooth', 0.1), 50);
    }
    function playWrongSound() {
      playTone(200, 'sawtooth', 0.3);
      setTimeout(() => playTone(150, 'sawtooth', 0.4), 200);
    }

    /* ============== CONFETTI ============== */
    function spawnConfetti() {
      for (let i = 0; i < 30; i++) {
        const d = document.createElement('div');
        d.className = 'absolute w-3 h-3';
        d.style.backgroundColor = ['#FFD700', '#FF69B4', '#00CED1', '#7FFF00'][i % 4];
        d.style.left = Math.random() * 100 + '%';
        d.style.top = '-20px';
        d.style.opacity = '1';
        d.style.animation = `fall-confetti ${Math.random() * 2 + 1}s linear forwards`;
        confettiContainer.appendChild(d);
        setTimeout(() => d.remove(), 2500);
      }
    }

    /* ============== LOGIC GAME ============== */
    function switchScreen(state) {
      gameState = state;
      startScreen.classList.add('hidden');
      gameScreen.classList.add('hidden');
      endScreen.classList.add('hidden');
      if (state === 'start') startScreen.classList.remove('hidden');
      if (state === 'playing') gameScreen.classList.remove('hidden');
      if (state === 'end') endScreen.classList.remove('hidden');
    }

    function startGame() {
      score = 0;
      streak = 0;
      currentQIndex = 0;
      enemyHealth = maxHealth;
      scoreText.textContent = score;
      enemyHpBar.style.width = enemyHealth + '%';
      switchScreen('playing');
      loadQuestion();
    }

    function loadQuestion() {
      const q = questions[currentQIndex];
      questionText.textContent = q.question;
      questionLevel.textContent = q.level;
      questionCounter.textContent = `C√¢u ${currentQIndex + 1}/${questions.length}`;

      answersContainer.innerHTML = '';
      q.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className =
          'p-4 rounded-xl border-2 font-semibold text-lg transition-all transform active:scale-95 text-left relative bg-slate-700 hover:bg-slate-600 border-slate-500';
        btn.innerHTML = `<span class="inline-block w-6 font-bold text-slate-400 mr-2">${String.fromCharCode(
          65 + idx
        )}.</span>${opt}`;
        btn.onclick = () => handleAnswer(idx);
        answersContainer.appendChild(btn);
      });
    }

    function handleAnswer(index) {
      const q = questions[currentQIndex];
      const buttons = [...answersContainer.querySelectorAll('button')];
      buttons.forEach(b => (b.disabled = true));

      const correctIndex = q.correct;
      const selectedBtn = buttons[index];

      if (index === correctIndex) {
        // ƒê√∫ng
        playShootSound();
        setTimeout(playWinSound, 300);

        // Hi·ªáu ·ª©ng laser + n·ªï
        laserEl.classList.remove('hidden');
        setTimeout(() => {
          laserEl.classList.add('hidden');
          explosionEl.style.left = '50%';
          explosionEl.style.top = '20%';
          explosionEl.classList.remove('hidden');
        }, 200);

        // C·∫≠p nh·∫≠t ƒëi·ªÉm
        score += 10 + streak * 2;
        streak += 1;
        scoreText.textContent = score;

        // Boss b·ªã tr√∫ng
        bossWrapper.style.transform = 'scale(0.9) translateY(-10px)';
        bossWrapper.style.filter = 'brightness(2) sepia(1) hue-rotate(-50deg)';

        // ƒê·ªïi m√†u n√∫t
        buttons[correctIndex].classList.remove('bg-slate-700', 'border-slate-500');
        buttons[correctIndex].classList.add('bg-green-600', 'border-green-400');

        feedbackCorrect.classList.remove('hidden');
        spawnConfetti();

        enemyHealth = Math.max(0, enemyHealth - (100 / questions.length));
        enemyHpBar.style.width = enemyHealth + '%';
      } else {
        // Sai
        playWrongSound();
        streak = 0;

        buttons[correctIndex].classList.remove('bg-slate-700', 'border-slate-500');
        buttons[correctIndex].classList.add('bg-green-600', 'border-green-400');

        selectedBtn.classList.remove('bg-slate-700', 'border-slate-500');
        selectedBtn.classList.add('bg-red-600', 'border-red-400');

        feedbackWrong.classList.remove('hidden');
      }

      setTimeout(() => {
        bossWrapper.style.transform = 'scale(1)';
        bossWrapper.style.filter = 'none';
        explosionEl.classList.add('hidden');
        feedbackCorrect.classList.add('hidden');
        feedbackWrong.classList.add('hidden');

        if (currentQIndex < questions.length - 1) {
          currentQIndex++;
          loadQuestion();
        } else {
          endGame();
        }
      }, 2500);
    }

    function endGame() {
      switchScreen('end');
      endScore.textContent = score;
      let rank = 'T√¢n Binh';
      if (score > 200) rank = 'Huy·ªÅn Tho·∫°i';
      else if (score > 150) rank = 'ƒê·∫°i T√°';
      endRank.textContent = rank;
      spawnConfetti();
      setTimeout(spawnConfetti, 500);
      setTimeout(spawnConfetti, 1000);
    }

    /* ============== S·ª∞ KI·ªÜN ============== */
    startBtn.addEventListener('click', () => startGame());
    restartBtn.addEventListener('click', () => startGame());
    soundToggle.addEventListener('click', () => {
      soundEnabled = !soundEnabled;
      soundToggle.textContent = soundEnabled ? 'üîä' : 'üîà';
    });
  </script>
</body>
</html>
