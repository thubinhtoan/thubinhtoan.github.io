<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Parabol và Đường thẳng</title>

<script src="https://cdn.tailwindcss.com"></script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
body { margin:0; overflow:hidden; background:#111; font-family:Segoe UI }
#canvas-container { width:100vw; height:100vh }

.slider-thumb {
  appearance:none; width:100%; height:6px;
  background:#4b5563; border-radius:3px;
}
.slider-thumb::-webkit-slider-thumb{
  appearance:none; width:18px; height:18px;
  background:#3b82f6; border-radius:50%; cursor:pointer;
}
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
  }
}
</script>
</head>

<body>

<!-- CONTROL PANEL -->
<div class="absolute top-4 left-4 w-80 bg-gray-900/90 text-white p-6 rounded-xl border border-gray-700 z-10">

<h1 class="text-xl font-bold text-blue-400 mb-4">Parabol & Đường thẳng</h1>

<div class="mb-3 text-center text-blue-300" id="func-parabola">
\[
y = 0.5x^2
\]
</div>

<div class="mb-3 text-center text-yellow-300" id="func-line">
\[
y = 1.0x + 0.0
\]
</div>

<!-- a -->
<label class="text-sm">Hệ số a (parabol)</label>
<div class="flex justify-between mb-1">
<span></span><span id="val-a">0.5</span>
</div>
<input type="range" min="-4" max="4" step="0.1" value="0.5"
class="slider-thumb mb-4" id="slider-a">

<!-- m -->
<label class="text-sm">Hệ số m (đường thẳng)</label>
<div class="flex justify-between mb-1">
<span></span><span id="val-m">1.0</span>
</div>
<input type="range" min="-5" max="5" step="0.1" value="1"
class="slider-thumb mb-4" id="slider-m">

<!-- b -->
<label class="text-sm">Hệ số b (đường thẳng)</label>
<div class="flex justify-between mb-1">
<span></span><span id="val-b">0.0</span>
</div>
<input type="range" min="-5" max="5" step="0.1" value="0"
class="slider-thumb mb-4" id="slider-b">

<button id="btn-reset"
class="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded">
Đặt lại
</button>

</div>

<div id="canvas-container"></div>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

let scene, camera, renderer, controls;
let parabolaLine, lineStraight;

const params = { a:0.5, m:1, b:0 };

const sliderA = document.getElementById('slider-a');
const sliderM = document.getElementById('slider-m');
const sliderB = document.getElementById('slider-b');

const valA = document.getElementById('val-a');
const valM = document.getElementById('val-m');
const valB = document.getElementById('val-b');

const dispPara = document.getElementById('func-parabola');
const dispLine = document.getElementById('func-line');

init();

function init(){
scene = new THREE.Scene();
scene.background = new THREE.Color(0x111827);

camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight,0.1,1000);
camera.position.set(15,15,25);

renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.getElementById('canvas-container').appendChild(renderer.domElement);

controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

scene.add(new THREE.GridHelper(40,40));
scene.add(new THREE.AmbientLight(0xffffff,0.7));

createAxes();
createParabola();
createLine();

sliderA.oninput = sliderM.oninput = sliderB.oninput = update;
document.getElementById('btn-reset').onclick = reset;

update();
animate();
}

function createAxes(){
scene.add(new THREE.Line(
new THREE.BufferGeometry().setFromPoints([
new THREE.Vector3(-20,0,0),
new THREE.Vector3(20,0,0)
]),
new THREE.LineBasicMaterial({color:0xff4444})
));
scene.add(new THREE.Line(
new THREE.BufferGeometry().setFromPoints([
new THREE.Vector3(0,-20,0),
new THREE.Vector3(0,20,0)
]),
new THREE.LineBasicMaterial({color:0x44ff44})
));
}

function createParabola(){
const geo = new THREE.BufferGeometry();
geo.setAttribute('position', new THREE.BufferAttribute(new Float32Array(600),3));
parabolaLine = new THREE.Line(geo,new THREE.LineBasicMaterial({color:0x3b82f6}));
scene.add(parabolaLine);
}

function createLine(){
const geo = new THREE.BufferGeometry();
geo.setAttribute('position', new THREE.BufferAttribute(new Float32Array(6),3));
lineStraight = new THREE.Line(geo,new THREE.LineBasicMaterial({color:0xfacc15}));
scene.add(lineStraight);
}

function update(){
params.a = +sliderA.value;
params.m = +sliderM.value;
params.b = +sliderB.value;

valA.innerText = params.a.toFixed(1);
valM.innerText = params.m.toFixed(1);
valB.innerText = params.b.toFixed(1);

dispPara.innerHTML = `\\[ y = ${params.a.toFixed(1)}x^2 \\]`;
dispLine.innerHTML = `\\[ y = ${params.m.toFixed(1)}x + ${params.b.toFixed(1)} \\]`;
MathJax.typesetPromise([dispPara, dispLine]).catch(()=>{});

const p = parabolaLine.geometry.attributes.position;
let i=0;
for(let x=-15;x<=15;x+=0.2){
p.setXYZ(i++,x,params.a*x*x,0);
}
p.needsUpdate=true;

const l = lineStraight.geometry.attributes.position;
l.setXYZ(0,-15,params.m*(-15)+params.b,0);
l.setXYZ(1,15,params.m*15+params.b,0);
l.needsUpdate=true;
}

function reset(){
sliderA.value=0.5;
sliderM.value=1;
sliderB.value=0;
update();
controls.reset();
}

function animate(){
requestAnimationFrame(animate);
controls.update();
renderer.render(scene,camera);
}
</script>

</body>
</html>
