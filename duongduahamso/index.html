<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê∆∞·ªùng ƒêua H√†m S·ªë: T·ªëc ƒê·ªô & Ch√≠nh X√°c</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #FFDEE9;
            background-image: linear-gradient(0deg, #FFDEE9 0%, #B5FFFC 100%);
            overflow-x: hidden;
            user-select: none;
        }

        .font-header { font-family: 'Baloo 2', cursive; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 4px solid #fff;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            border-radius: 24px;
        }

        .btn-pop {
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .btn-pop:active { transform: scale(0.95) translateY(4px); }
        .btn-pop:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        .option-btn { border-bottom-width: 6px; }
        .option-btn:active { border-bottom-width: 2px; transform: translateY(4px); }

        .shape {
            position: absolute;
            filter: blur(5px);
            z-index: -1;
            animation: float 6s infinite ease-in-out;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .slide-up-anim { animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd300;
            top: 0;
            opacity: 0;
        }
        @keyframes makeItRain {
            from { opacity: 1; margin-top: -50px; transform: rotate(0deg); }
            to { opacity: 0; margin-top: 100vh; transform: rotate(720deg); }
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Background Shapes -->
    <div class="shape text-6xl text-pink-300 top-10 left-10">‚úñ</div>
    <div class="shape text-6xl text-blue-300 bottom-20 right-20">‚óè</div>
    <div class="shape text-6xl text-yellow-300 top-1/2 left-1/4">‚òÖ</div>
    <div class="shape text-6xl text-green-300 top-20 right-1/4">y=ax+b</div>

    <!-- START SCREEN -->
    <div id="start-screen" class="glass-panel p-8 max-w-2xl w-full text-center relative z-10">
        <div class="mb-6 inline-block bg-yellow-300 p-4 rounded-full border-4 border-white shadow-lg transform -rotate-6">
            <span class="text-5xl">üèéÔ∏è</span>
        </div>
        <h1 class="font-header text-5xl md:text-6xl text-indigo-600 mb-4 font-black leading-tight drop-shadow-sm">
            ƒê∆∞·ªùng ƒêua<br><span class="text-pink-500">H√†m S·ªë</span>
        </h1>
        <p class="text-slate-600 text-xl mb-8 font-bold">Chinh ph·ª•c 15 ch∆∞·ªõng ng·∫°i v·∫≠t ƒë·ªÉ v·ªÅ ƒë√≠ch!</p>

        <div class="grid grid-cols-2 gap-3 text-left mb-8 max-w-md mx-auto">
            <div class="bg-white p-3 rounded-xl shadow-sm border-l-4 border-green-400">
                <span class="font-bold text-gray-700 block">D·ªÖ (Nh·∫≠n bi·∫øt)</span>
                <span class="text-xs text-gray-500">6 c√¢u kh·ªüi ƒë·ªông</span>
            </div>
            <div class="bg-white p-3 rounded-xl shadow-sm border-l-4 border-blue-400">
                <span class="font-bold text-gray-700 block">V·ª´a (Th√¥ng hi·ªÉu)</span>
                <span class="text-xs text-gray-500">5 c√¢u tƒÉng t·ªëc</span>
            </div>
            <div class="bg-white p-3 rounded-xl shadow-sm border-l-4 border-orange-400">
                <span class="font-bold text-gray-700 block">Kh√≥ (V·∫≠n d·ª•ng)</span>
                <span class="text-xs text-gray-500">3 c√¢u b·ª©t ph√°</span>
            </div>
            <div class="bg-white p-3 rounded-xl shadow-sm border-l-4 border-red-500">
                <span class="font-bold text-gray-700 block">C·ª±c Kh√≥ (VDC)</span>
                <span class="text-xs text-gray-500">1 c√¢u v·ªÅ ƒë√≠ch</span>
            </div>
        </div>

        <button onclick="startGame()" class="btn-pop bg-indigo-600 text-white text-2xl py-4 px-12 rounded-full font-header font-bold shadow-lg border-b-4 border-indigo-800 hover:bg-indigo-500 w-full md:w-auto">
            V√ÄO ƒêUA NGAY! üöÄ
        </button>
    </div>

    <!-- QUIZ SCREEN -->
    <div id="quiz-screen" class="hidden w-full max-w-3xl flex flex-col h-[90vh] relative z-10">
        <!-- Top Bar -->
        <div class="bg-white rounded-3xl p-4 flex justify-between items-center shadow-lg border-b-4 border-slate-100 mb-4">
            <div class="flex flex-col">
                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">C√¢u h·ªèi</span>
                <div class="flex items-baseline">
                    <span id="q-current" class="text-3xl font-black text-indigo-600 font-header">1</span>
                    <span class="text-lg text-slate-400 font-bold">/15</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="flex-1 mx-4 h-4 bg-slate-100 rounded-full overflow-hidden border border-slate-200">
                <div id="progress-bar" class="h-full bg-gradient-to-r from-pink-400 to-indigo-500 transition-all duration-500" style="width: 0%"></div>
            </div>

            <div class="bg-yellow-100 px-4 py-2 rounded-2xl border-2 border-yellow-300">
                <span class="font-header font-bold text-yellow-700 text-xl">üèÜ <span id="score">0</span></span>
            </div>
        </div>

        <!-- Question Card -->
        <div class="flex-1 glass-panel p-6 md:p-8 flex flex-col justify-center mb-4 relative overflow-hidden">
            <div id="level-tag" class="absolute top-4 left-4 text-xs font-bold px-3 py-1 rounded-full uppercase bg-gray-200 text-gray-600">
                M·ª©c ƒë·ªô
            </div>

            <h2 id="question-text" class="font-header text-2xl md:text-3xl text-slate-800 text-center leading-snug mt-6">
                Loading...
            </h2>
        </div>

        <!-- Options Grid -->
        <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-20 md:pb-0"></div>

        <!-- Feedback Modal -->
        <div id="feedback-area" class="hidden fixed bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.2)] z-50 p-6 md:p-8 border-t-8 slide-up-anim border-gray-200 max-w-3xl mx-auto">
            <div class="flex items-start mb-4">
                <div id="feedback-emoji" class="text-5xl mr-4 animate-bounce"></div>
                <div>
                    <h3 id="feedback-title" class="font-header text-2xl font-bold mb-1"></h3>
                    <p id="rationale-text" class="text-slate-600 font-medium text-lg leading-relaxed"></p>
                </div>
            </div>
            <button onclick="nextQuestion()" class="w-full bg-slate-800 text-white font-bold font-header text-xl py-4 rounded-2xl shadow-lg active:scale-95 transition-transform">
                Ti·∫øp T·ª•c <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="result-screen" class="hidden glass-panel p-8 max-w-md w-full text-center relative z-10 animate-pop">
        <div class="absolute -top-10 left-1/2 transform -translate-x-1/2">
            <span class="text-8xl filter drop-shadow-xl">üèÅ</span>
        </div>

        <h2 class="font-header text-4xl text-indigo-700 mt-12 mb-2">ƒê√≠ch ƒê·∫øn!</h2>
        <p class="text-slate-500 font-bold mb-6">K·∫øt qu·∫£ ch·∫∑ng ƒëua c·ªßa b·∫°n</p>

        <div class="bg-indigo-50 rounded-3xl p-8 mb-8 border-4 border-indigo-100">
            <div class="text-7xl font-black text-indigo-600 font-header mb-2" id="final-score">0</div>
            <div class="text-indigo-400 font-bold uppercase tracking-widest">ƒêi·ªÉm s·ªë</div>
        </div>

        <p id="result-message" class="text-xl font-bold text-pink-600 mb-8 font-header leading-tight"></p>

        <button onclick="restartGame()" class="btn-pop w-full bg-green-500 text-white font-header text-2xl py-4 rounded-2xl border-b-4 border-green-700 shadow-lg">
            <i class="fas fa-redo mr-2"></i> ƒêua L·∫°i
        </button>
    </div>

    <script>
        /* =========================
           DATA (ƒê√É S·ª¨A)
           - C√ÇN ƒê√ÅP √ÅN G·ªêC: A=4, B=4, C=4, D=3
           - S·ª¨A C√ÇU TAXI: CH·ªà C√íN 1 ƒê√ÅP √ÅN ƒê√öNG
           ========================= */
        const questions = [
            // --- NH·∫¨N BI·∫æT (6) ---
            // (ƒê√É CH·ªàNH: ƒê√ÅP √ÅN ƒê√öNG -> A ƒë·ªÉ c√¢n)
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "H√†m s·ªë n√†o d∆∞·ªõi ƒë√¢y l√† h√†m s·ªë b·∫≠c nh·∫•t?",
                options: ["y = 2x + 1", "y = 0x + 3", "y = x¬≤ + 1", "y = 2/x + 1"],
                correct: 0,
                rationale: "H√†m s·ªë b·∫≠c nh·∫•t c√≥ d·∫°ng y = ax + b v·ªõi a ‚â† 0. 'y=2x+1' th·ªèa m√£n (a=2)."
            },
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "Trong h√†m s·ªë y = -3x + 5, h·ªá s·ªë g√≥c a b·∫±ng bao nhi√™u?",
                options: ["3", "5", "-3", "-5"],
                correct: 2,
                rationale: "ƒê·ªëi chi·∫øu v·ªõi d·∫°ng y = ax + b, h·ªá s·ªë ƒëi li·ªÅn v·ªõi x l√† a. V·∫≠y a = -3."
            },
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "Trong h√†m s·ªë y = 2x - 4, h·ªá s·ªë b (tung ƒë·ªô g·ªëc) l√† bao nhi√™u?",
                options: ["4", "2", "-4", "-2"],
                correct: 2,
                rationale: "ƒê·ªëi chi·∫øu v·ªõi d·∫°ng y = ax + b, h·ªá s·ªë t·ª± do l√† b. ·ªû ƒë√¢y l√† -4."
            },
            // (ƒê√É CH·ªàNH: ƒê√ÅP √ÅN ƒê√öNG -> D ƒë·ªÉ c√¢n)
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "H√†m s·ªë y = ax + b l√† h√†m s·ªë b·∫≠c nh·∫•t khi v√† ch·ªâ khi:",
                options: ["a = 0", "b ‚â† 0", "b = 0", "a ‚â† 0"],
                correct: 3,
                rationale: "ƒêi·ªÅu ki·ªán ƒë·ªÉ l√† h√†m s·ªë b·∫≠c nh·∫•t l√† h·ªá s·ªë a ph·∫£i kh√°c 0."
            },
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "ƒê·ªì th·ªã c·ªßa h√†m s·ªë b·∫≠c nh·∫•t y = ax + b l√† h√¨nh g√¨?",
                options: ["ƒê∆∞·ªùng cong", "ƒê∆∞·ªùng g·∫•p kh√∫c", "ƒê∆∞·ªùng th·∫≥ng", "ƒê∆∞·ªùng tr√≤n"],
                correct: 2,
                rationale: "ƒê·ªì th·ªã c·ªßa h√†m s·ªë b·∫≠c nh·∫•t lu√¥n l√† m·ªôt ƒë∆∞·ªùng th·∫≥ng."
            },
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "H√†m s·ªë y = 5x + 2 x√°c ƒë·ªãnh v·ªõi gi√° tr·ªã x n√†o?",
                options: ["x > 0", "x < 0", "x ‚â† 0", "M·ªçi s·ªë th·ª±c x"],
                correct: 3,
                rationale: "H√†m ƒëa th·ª©c b·∫≠c nh·∫•t lu√¥n x√°c ƒë·ªãnh v·ªõi m·ªçi gi√° tr·ªã th·ª±c c·ªßa x."
            },

            // --- TH√îNG HI·ªÇU (5) ---
            {
                level: "Th√¥ng hi·ªÉu",
                text: "Cho h√†m s·ªë y = 2x - 1. Gi√° tr·ªã c·ªßa y khi x = 3 l√† bao nhi√™u?",
                options: ["5", "6", "4", "2"],
                correct: 0,
                rationale: "Thay x = 3: y = 2¬∑3 - 1 = 5."
            },
            {
                level: "Th√¥ng hi·ªÉu",
                text: "ƒêi·ªÉm n√†o sau ƒë√¢y thu·ªôc ƒë·ªì th·ªã h√†m s·ªë y = -x + 3?",
                options: ["A(1; 4)", "B(2; 1)", "C(0; 0)", "D(-1; 2)"],
                correct: 1,
                rationale: "Thay B(2;1): 1 = -2 + 3 (ƒë√∫ng)."
            },
            {
                level: "Th√¥ng hi·ªÉu",
                text: "T√¨m x ƒë·ªÉ h√†m s·ªë y = 3x - 6 nh·∫≠n gi√° tr·ªã b·∫±ng 0.",
                options: ["x = 3", "x = 2", "x = -2", "x = 6"],
                correct: 1,
                rationale: "3x - 6 = 0 ‚áí x = 2."
            },
            {
                level: "Th√¥ng hi·ªÉu",
                text: "X√°c ƒë·ªãnh h·ªá s·ªë a bi·∫øt ƒë·ªì th·ªã h√†m s·ªë y = ax + 2 ƒëi qua ƒëi·ªÉm M(1; 5).",
                options: ["a = 3", "a = 2", "a = 7", "a = 5"],
                correct: 0,
                rationale: "5 = a¬∑1 + 2 ‚áí a = 3."
            },
            {
                level: "Th√¥ng hi·ªÉu",
                text: "Hai ƒë∆∞·ªùng th·∫≥ng y = 2x + 1 v√† y = ax - 3 song song v·ªõi nhau khi n√†o?",
                options: ["a = 1", "a = -3", "a = 2", "a = -2"],
                correct: 2,
                rationale: "Song song ‚áí c√πng h·ªá s·ªë g√≥c ‚áí a = 2."
            },

            // --- V·∫¨N D·ª§NG (3) ---
            // (ƒê√É S·ª¨A: b·ªè ƒë√°p √°n tr√πng ƒë√∫ng)
            {
                level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
                text: "Gi√° c∆∞·ªõc taxi: 15.000ƒë cho km ƒë·∫ßu ti√™n v√† 12.000ƒë cho m·ªói km ti·∫øp theo. C√¥ng th·ª©c t√≠nh ti·ªÅn y (ƒë·ªìng) theo s·ªë km x (v·ªõi x > 1) l√† g√¨?",
                options: [
                    "y = 15000 + 12000x",
                    "y = 12000x + 15000",
                    "y = 12000(x - 1)",
                    "y = 12000(x - 1) + 15000"
                ],
                correct: 3,
                rationale: "T·ªïng ti·ªÅn = 15.000 + 12.000(x-1)."
            },
            {
                level: "V·∫≠n d·ª•ng",
                text: "ƒê·ªì th·ªã h√†m s·ªë y = 2x - 4 c·∫Øt tr·ª•c ho√†nh Ox t·∫°i ƒëi·ªÉm c√≥ t·ªça ƒë·ªô l√†:",
                options: ["(0; -4)", "(2; 0)", "(-4; 0)", "(0; 2)"],
                correct: 1,
                rationale: "C·∫Øt Ox ‚áí y=0 ‚áí 2x-4=0 ‚áí x=2 ‚áí (2;0)."
            },
            {
                level: "V·∫≠n d·ª•ng",
                text: "Vi·∫øt ph∆∞∆°ng tr√¨nh ƒë∆∞·ªùng th·∫≥ng ƒëi qua hai ƒëi·ªÉm A(0; 2) v√† B(1; 5).",
                options: ["y = 3x + 2", "y = 2x + 3", "y = 5x + 2", "y = 3x"],
                correct: 0,
                rationale: "Qua A ‚áí b=2. Qua B: 5=a+2 ‚áí a=3 ‚áí y=3x+2."
            },

            // --- V·∫¨N D·ª§NG CAO (1) ---
            {
                level: "V·∫≠n d·ª•ng cao",
                text: "T√≠nh di·ªán t√≠ch tam gi√°c t·∫°o b·ªüi ƒë∆∞·ªùng th·∫≥ng y = x + 4 v√† hai tr·ª•c t·ªça ƒë·ªô Ox, Oy.",
                options: ["16", "4", "8", "2"],
                correct: 2,
                rationale: "Giao Ox: x=-4 ‚áí OA=4. Giao Oy: y=4 ‚áí OB=4. S = 1/2¬∑4¬∑4 = 8."
            }
        ];

        /* ========= RANDOM TH·ª® T·ª∞ ƒê√ÅP √ÅN ========= */
        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }
        function prepareQuestion(q) {
            const nq = { ...q, options: [...q.options] };
            const correctText = nq.options[nq.correct];
            shuffleArray(nq.options);
            nq.correct = nq.options.indexOf(correctText);
            return nq;
        }

        // --- GAME ENGINE ---
        let currentIdx = 0;
        let score = 0;
        let isLocked = false;
        let currentQ = null;

        // Sound System (kh·ªüi t·∫°o sau click ƒë·ªÉ tr√°nh b·ªã ch·∫∑n)
        let audioCtx = null;
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        function playSound(type) {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(880, now);
                osc.frequency.exponentialRampToValueAtTime(1760, now + 0.1);
                gain.gain.setValueAtTime(0.25, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
                osc.start(now);
                osc.stop(now + 0.25);
            } else if (type === 'wrong') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.18);
                gain.gain.setValueAtTime(0.18, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.18);
                osc.start(now);
                osc.stop(now + 0.18);
            } else if (type === 'win') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.setValueAtTime(554, now + 0.12);
                osc.frequency.setValueAtTime(659, now + 0.24);
                gain.gain.setValueAtTime(0.18, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 1.0);
                osc.start(now);
                osc.stop(now + 1.0);
            }
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const conf = document.createElement('div');
                conf.classList.add('confetti-piece');
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = ['#FFD700', '#FF69B4', '#00BFFF', '#32CD32'][Math.floor(Math.random() * 4)];
                conf.style.animation = `makeItRain ${Math.random() * 2 + 1}s linear`;
                document.body.appendChild(conf);
                setTimeout(() => conf.remove(), 3000);
            }
        }

        function getLevelInfo(level) {
            if (level.includes("Nh·∫≠n bi·∫øt")) return { color: "bg-green-100 text-green-700", label: "D·ªÑ" };
            if (level.includes("Th√¥ng hi·ªÉu")) return { color: "bg-blue-100 text-blue-700", label: "V·ª™A" };
            if (level.includes("V·∫≠n d·ª•ng cao")) return { color: "bg-red-100 text-red-700", label: "C·ª∞C KH√ì" };
            return { color: "bg-orange-100 text-orange-700", label: "KH√ì" };
        }

        function startGame() {
            initAudio();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            document.getElementById('quiz-screen').classList.add('flex');
            loadQuestion();
        }

        function loadQuestion() {
            isLocked = false;

            // random ƒë√°p √°n cho c√¢u hi·ªán t·∫°i
            currentQ = prepareQuestion(questions[currentIdx]);

            document.getElementById('q-current').innerText = currentIdx + 1;
            document.getElementById('score').innerText = score;

            // FIX progress: c√¢u 1 ƒë√£ c√≥ % v√† c√¢u cu·ªëi l√™n 100%
            const pct = ((currentIdx + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = pct + '%';

            document.getElementById('question-text').innerText = currentQ.text;

            const lvlInfo = getLevelInfo(currentQ.level);
            const badge = document.getElementById('level-tag');
            badge.className = `absolute top-4 left-4 text-xs font-bold px-3 py-1 rounded-full uppercase ${lvlInfo.color}`;
            badge.innerText = `${lvlInfo.label} (${currentQ.level})`;

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            document.getElementById('feedback-area').classList.add('hidden');

            currentQ.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = `option-btn w-full p-6 rounded-2xl bg-white border-2 border-slate-200 hover:bg-indigo-50 hover:border-indigo-300 text-lg text-slate-700 font-bold text-left transition-all shadow-sm flex items-center group relative overflow-hidden`;

                const letter = `<span class="w-10 h-10 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center mr-4 group-hover:bg-indigo-200 group-hover:text-indigo-700 transition-colors font-header text-xl">${String.fromCharCode(65+idx)}</span>`;
                btn.innerHTML = `${letter} ${opt}`;
                btn.onclick = (e) => checkAnswer(idx, btn, e);
                container.appendChild(btn);
            });
        }

        function checkAnswer(selectedIdx, btn) {
            if (isLocked) return;
            isLocked = true;

            const q = currentQ;
            const isCorrect = selectedIdx === q.correct;
            const fbArea = document.getElementById('feedback-area');
            const allBtns = document.getElementById('options-container').children;

            if (isCorrect) {
                score++;
                document.getElementById('score').innerText = score;
                playSound('correct');
                createConfetti();

                btn.className = "option-btn w-full p-6 rounded-2xl bg-green-500 border-b-4 border-green-700 text-white text-lg font-bold text-left shadow-lg flex items-center transform scale-[1.02] z-10";
                btn.querySelector('span').className = "w-10 h-10 rounded-full bg-green-700 text-white flex items-center justify-center mr-4 font-header text-xl";

                document.getElementById('feedback-emoji').innerText = "ü§©";
                document.getElementById('feedback-title').innerHTML = "<span class='text-green-600'>Tuy·ªát ƒê·ªânh!</span>";
                fbArea.className = "fixed bottom-0 left-0 right-0 bg-green-50 rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.2)] z-50 p-6 md:p-8 border-t-8 slide-up-anim border-green-200 max-w-3xl mx-auto";
            } else {
                playSound('wrong');

                btn.className = "option-btn w-full p-6 rounded-2xl bg-red-500 border-b-4 border-red-700 text-white text-lg font-bold text-left shadow-lg flex items-center opacity-90";
                btn.querySelector('span').className = "w-10 h-10 rounded-full bg-red-700 text-white flex items-center justify-center mr-4 font-header text-xl";

                const correctBtn = allBtns[q.correct];
                correctBtn.className = "option-btn w-full p-6 rounded-2xl bg-green-100 border-2 border-green-500 text-green-800 text-lg font-bold text-left shadow-sm flex items-center";
                correctBtn.querySelector('span').className = "w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center mr-4 font-header text-xl";

                document.getElementById('feedback-emoji').innerText = "üòÖ";
                document.getElementById('feedback-title').innerHTML = "<span class='text-orange-600'>Su√Ωt ƒê√∫ng!</span>";
                fbArea.className = "fixed bottom-0 left-0 right-0 bg-red-50 rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.2)] z-50 p-6 md:p-8 border-t-8 slide-up-anim border-red-200 max-w-3xl mx-auto";
            }

            Array.from(allBtns).forEach(b => {
                b.onclick = null;
                b.disabled = true;
                if (b !== btn && b !== allBtns[q.correct]) b.classList.add('opacity-50', 'grayscale');
            });

            document.getElementById('rationale-text').innerHTML = q.rationale;
            fbArea.classList.remove('hidden');
        }

        function nextQuestion() {
            currentIdx++;
            if (currentIdx < questions.length) loadQuestion();
            else showResult();
        }

        function showResult() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            const finalScoreEl = document.getElementById('final-score');
            let s = 0;
            const interval = setInterval(() => {
                s++;
                finalScoreEl.innerText = s;
                if (s >= score) clearInterval(interval);
            }, 40);

            const msg = document.getElementById('result-message');
            playSound('win');
            createConfetti();

            if (score === 15) msg.innerText = "Wow! B·∫°n l√† Thi√™n t√†i H√†m S·ªë! Kh√¥ng ƒë·ªëi th·ªß! üëë";
            else if (score >= 12) msg.innerText = "Xu·∫•t s·∫Øc! B·∫°n ƒë√£ l√†m ch·ªß ho√†n to√†n ƒë∆∞·ªùng ƒëua n√†y! üèéÔ∏è";
            else if (score >= 8) msg.innerText = "Kh√° l·∫Øm! N·∫°p th√™m ki·∫øn th·ª©c ƒë·ªÉ v·ªÅ nh·∫•t nh√©! ‚õΩ";
            else msg.innerText = "ƒê·ª´ng lo! √în t·∫≠p r·ªìi quay l·∫°i ƒëua ti·∫øp nh√©! üõ†Ô∏è";
        }

        function restartGame() {
            currentIdx = 0;
            score = 0;
            document.getElementById('score').innerText = '0';
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }
    </script>
</body>
</html>
