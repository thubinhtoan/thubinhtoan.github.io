<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Si√™u T√≠nh Nh·∫©m: L√†m Tr√≤n & ∆Ø·ªõc L∆∞·ª£ng</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Baloo 2', cursive;
            background-color: #ecfccb;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2384cc16' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .card-shadow {
            box-shadow: 8px 8px 0px rgba(0,0,0,0.15);
        }

        .btn-shadow {
            box-shadow: 0 4px 0 #166534; /* Green-800 */
            transition: all 0.1s;
        }
        .btn-shadow:active {
            box-shadow: 0 0 0 #166534;
            transform: translateY(4px);
        }

        .option-card {
            transition: transform 0.2s, background-color 0.2s;
            cursor: pointer;
        }
        .option-card:hover:not(.disabled) {
            transform: scale(1.02);
            background-color: #f0fdf4; /* Green-50 */
        }
        .option-card.correct {
            background-color: #dcfce7 !important; /* Green-100 */
            border-color: #22c55e !important;
            color: #14532d;
        }
        .option-card.wrong {
            background-color: #fee2e2 !important; /* Red-100 */
            border-color: #ef4444 !important;
            color: #7f1d1d;
        }

        /* Float Animation */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- MAIN CONTAINER -->
    <div class="w-full max-w-4xl bg-white rounded-3xl border-4 border-green-600 card-shadow overflow-hidden relative flex flex-col min-h-[650px]">
        
        <!-- DECORATION -->
        <div class="absolute top-0 right-0 p-4 opacity-20 pointer-events-none">
            <i class="ph-fill ph-calculator text-9xl text-green-700"></i>
        </div>

        <!-- START SCREEN -->
        <div id="start-screen" class="absolute inset-0 z-20 flex flex-col items-center justify-center bg-gradient-to-br from-green-400 to-emerald-600 text-white p-6 text-center">
            <div class="text-8xl mb-4 animate-float">üéØ</div>
            <h1 class="text-5xl md:text-6xl font-extrabold mb-2 drop-shadow-md">Si√™u T√≠nh Nh·∫©m</h1>
            <p class="text-2xl font-semibold text-green-100 mb-8">Th·ª≠ Th√°ch L√†m Tr√≤n & ∆Ø·ªõc L∆∞·ª£ng</p>
            
            <div class="bg-white/20 backdrop-blur-sm p-6 rounded-2xl mb-8 max-w-md border-2 border-white/30">
                <ul class="text-left space-y-3 font-bold text-lg">
                    <li class="flex items-center"><i class="ph-fill ph-check-circle mr-3 text-yellow-300"></i> 15 C√¢u h·ªèi tr·∫Øc nghi·ªám</li>
                    <li class="flex items-center"><i class="ph-fill ph-brain mr-3 text-yellow-300"></i> R√®n luy·ªán t∆∞ duy nhanh</li>
                    <li class="flex items-center"><i class="ph-fill ph-trophy mr-3 text-yellow-300"></i> Tr·ªü th√†nh b·∫≠c th·∫ßy ∆∞·ªõc l∆∞·ª£ng</li>
                </ul>
            </div>

            <button onclick="Game.start()" class="bg-yellow-400 text-yellow-900 px-10 py-4 rounded-full font-black text-2xl btn-shadow border-b-4 border-yellow-600 hover:bg-yellow-300 flex items-center gap-2">
                <i class="ph-bold ph-play"></i> B·∫Øt ƒê·∫ßu
            </button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="hidden flex-col h-full bg-slate-50 relative">
            <!-- Header -->
            <div class="bg-green-600 p-4 text-white flex justify-between items-center shadow-md z-10">
                <div class="flex items-center gap-3">
                    <div class="bg-green-700 w-12 h-12 rounded-xl flex items-center justify-center font-bold text-2xl border-2 border-green-400">
                        <span id="ui-current">1</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-green-200 uppercase tracking-widest">C√¢u h·ªèi</span>
                        <span class="text-sm font-semibold">/ <span id="ui-total">15</span></span>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 bg-black/20 px-4 py-2 rounded-lg">
                    <i class="ph-fill ph-star text-yellow-400 text-xl"></i>
                    <span id="ui-score" class="font-bold text-2xl">0</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 h-3">
                <div id="ui-progress" class="h-full bg-yellow-400 transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>

            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto p-6 pb-40">
                <div class="max-w-3xl mx-auto">
                    <!-- Question Level Badge -->
                    <span id="ui-level" class="inline-block px-4 py-1 rounded-full bg-blue-100 text-blue-700 font-bold text-sm mb-4 border border-blue-200 shadow-sm">
                        M·ª©c ƒë·ªô: Nh·∫≠n bi·∫øt
                    </span>

                    <!-- Question Text -->
                    <h2 id="ui-question" class="text-2xl md:text-3xl font-bold text-gray-800 mb-8 leading-snug">
                        <!-- Content -->
                    </h2>

                    <!-- Options Grid -->
                    <div id="ui-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Buttons injected via JS -->
                    </div>
                </div>
            </div>

            <!-- Feedback Sheet (Fixed Bottom) -->
            <div id="feedback-sheet" class="absolute bottom-0 inset-x-0 bg-white border-t-4 border-green-500 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] p-6 transform translate-y-full transition-transform duration-300 z-20">
                <div class="max-w-3xl mx-auto flex items-start gap-4">
                    <div id="fb-icon" class="text-5xl flex-shrink-0 animate-bounce"></div>
                    <div class="flex-1">
                        <h3 id="fb-title" class="text-xl font-bold mb-1"></h3>
                        <p id="fb-rationale" class="text-gray-700 text-lg mb-2 leading-relaxed"></p>
                        <div class="text-sm text-blue-600 bg-blue-50 p-2 rounded border border-blue-100 italic">
                            <i class="ph-bold ph-lightbulb mr-1"></i> <span id="fb-hint"></span>
                        </div>
                    </div>
                    <button onclick="Game.next()" class="bg-gray-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-black transition-colors flex items-center gap-2 h-fit mt-1 shadow-lg">
                        Ti·∫øp t·ª•c <i class="ph-bold ph-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- END SCREEN -->
        <div id="end-screen" class="hidden absolute inset-0 z-20 flex-col items-center justify-center bg-white p-8 text-center">
            <div class="relative mb-6">
                <div class="absolute inset-0 bg-yellow-200 rounded-full animate-ping opacity-75"></div>
                <i class="ph-fill ph-crown text-8xl text-yellow-500 relative z-10"></i>
            </div>

            <h2 class="text-4xl font-extrabold text-gray-800 mb-2">Ho√†n Th√†nh!</h2>
            <p id="end-msg" class="text-xl text-gray-600 mb-8">B·∫°n ƒë√£ l√†m r·∫•t t·ªët nhi·ªám v·ª• c·ªßa m√¨nh.</p>

            <div class="flex gap-4 mb-8">
                <div class="bg-green-100 p-6 rounded-2xl border-2 border-green-200">
                    <div class="text-xs font-bold text-green-600 uppercase">ƒêi·ªÉm s·ªë</div>
                    <div class="text-4xl font-black text-green-800" id="end-score">0</div>
                </div>
                <div class="bg-blue-100 p-6 rounded-2xl border-2 border-blue-200">
                    <div class="text-xs font-bold text-blue-600 uppercase">ƒê√∫ng</div>
                    <div class="text-4xl font-black text-blue-800"><span id="end-correct">0</span>/15</div>
                </div>
            </div>

            <button onclick="location.reload()" class="bg-green-600 text-white px-8 py-3 rounded-full font-bold text-xl shadow-lg hover:bg-green-700 transition-all flex items-center gap-2">
                <i class="ph-bold ph-arrow-counter-clockwise"></i> Ch∆°i L·∫°i
            </button>
        </div>

    </div>

<script>
    // --- DATABASE ---
    const QUESTIONS = [
        // --- NH·∫¨N BI·∫æT (6 c√¢u) ---
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "Quy t·∫Øc l√†m tr√≤n s·ªë: N·∫øu ch·ªØ s·ªë ƒë·∫ßu ti√™n trong c√°c ch·ªØ s·ªë b·ªã b·ªè ƒëi <b>nh·ªè h∆°n 5</b> th√¨ ta l√†m g√¨?",
            options: [
                { text: "Gi·ªØ nguy√™n b·ªô ph·∫≠n c√≤n l·∫°i.", correct: true, rationale: "Ch√≠nh x√°c! N·∫øu ch·ªØ s·ªë ngay sau h√†ng l√†m tr√≤n < 5 th√¨ ta gi·ªØ nguy√™n ch·ªØ s·ªë h√†ng l√†m tr√≤n." },
                { text: "C·ªông th√™m 1 v√†o ch·ªØ s·ªë cu·ªëi c√πng c·ªßa b·ªô ph·∫≠n c√≤n l·∫°i.", correct: false, rationale: "Sai. Ta ch·ªâ c·ªông th√™m 1 khi ch·ªØ s·ªë ƒë√≥ l·ªõn h∆°n ho·∫∑c b·∫±ng 5." },
                { text: "Tr·ª´ ƒëi 1 ·ªü b·ªô ph·∫≠n c√≤n l·∫°i.", correct: false, rationale: "Sai. Kh√¥ng bao gi·ªù c√≥ quy t·∫Øc tr·ª´ ƒëi 1." },
                { text: "Thay ch·ªØ s·ªë ƒë√≥ b·∫±ng s·ªë 5.", correct: false, rationale: "Sai." }
            ],
            hint: "V√≠ d·ª•: L√†m tr√≤n 1,2 v·ªÅ h√†ng ƒë∆°n v·ªã th√¨ ƒë∆∞·ª£c 1 (gi·ªØ nguy√™n)."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "L√†m tr√≤n s·ªë th·∫≠p ph√¢n $12,345$ ƒë·∫øn h√†ng ph·∫ßn m∆∞·ªùi.",
            options: [
                { text: "$12,3$", correct: true, rationale: "ƒê√∫ng. Ch·ªØ s·ªë sau h√†ng ph·∫ßn m∆∞·ªùi l√† 4 (< 5) n√™n ta gi·ªØ nguy√™n s·ªë 3." },
                { text: "$12,4$", correct: false, rationale: "Sai. Ch·ªâ l√†m tr√≤n l√™n khi ch·ªØ s·ªë sau n√≥ >= 5." },
                { text: "$12,35$", correct: false, rationale: "Sai. ƒê√¢y l√† l√†m tr√≤n ƒë·∫øn h√†ng ph·∫ßn trƒÉm." },
                { text: "$12$", correct: false, rationale: "Sai. ƒê√¢y l√† l√†m tr√≤n ƒë·∫øn h√†ng ƒë∆°n v·ªã." }
            ],
            hint: "H√†ng ph·∫ßn m∆∞·ªùi l√† ch·ªØ s·ªë ngay sau d·∫•u ph·∫©y (s·ªë 3). Nh√¨n s·ªë k·∫ø ti·∫øp (s·ªë 4) ƒë·ªÉ quy·∫øt ƒë·ªãnh."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "K√≠ hi·ªáu n√†o sau ƒë√¢y d√πng ƒë·ªÉ ch·ªâ s·ª± x·∫•p x·ªâ (g·∫ßn b·∫±ng)?",
            options: [
                { text: "$\\approx$", correct: true, rationale: "Ch√≠nh x√°c. Hai d·∫•u ng√£ bi·ªÉu th·ªã s·ª± x·∫•p x·ªâ." },
                { text: "$=$", correct: false, rationale: "Sai. ƒê√¢y l√† d·∫•u b·∫±ng tuy·ªát ƒë·ªëi." },
                { text: "$\\in$", correct: false, rationale: "Sai. ƒê√¢y l√† d·∫•u thu·ªôc t·∫≠p h·ª£p." },
                { text: "$\\ge$", correct: false, rationale: "Sai. ƒê√¢y l√† d·∫•u l·ªõn h∆°n ho·∫∑c b·∫±ng." }
            ],
            hint: "N√≥ tr√¥ng gi·ªëng d·∫•u b·∫±ng nh∆∞ng u·ªën l∆∞·ª£n."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "L√†m tr√≤n s·ªë $79,99$ ƒë·∫øn h√†ng ƒë∆°n v·ªã.",
            options: [
                { text: "$80$", correct: true, rationale: "ƒê√∫ng. Ch·ªØ s·ªë sau h√†ng ƒë∆°n v·ªã l√† 9 (>= 5) n√™n c·ªông 1 v√†o 79 th√†nh 80." },
                { text: "$79$", correct: false, rationale: "Sai quy t·∫Øc." },
                { text: "$79,9$", correct: false, rationale: "Sai. Y√™u c·∫ßu l√†m tr√≤n ƒë·∫øn h√†ng ƒë∆°n v·ªã (s·ªë nguy√™n)." },
                { text: "$80,0$", correct: false, rationale: "Sai ƒë·ªãnh d·∫°ng s·ªë nguy√™n." }
            ],
            hint: "H√†ng ƒë∆°n v·ªã l√† s·ªë 9 (tr∆∞·ªõc d·∫•u ph·∫©y). S·ªë sau n√≥ l√† 9 (l·ªõn h∆°n 5)."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "L√†m tr√≤n s·ªë $1567$ v·ªõi ƒë·ªô ch√≠nh x√°c $50$ (t·ª©c l√† l√†m tr√≤n ƒë·∫øn h√†ng trƒÉm).",
            options: [
                { text: "$1600$", correct: true, rationale: "ƒê√∫ng. H√†ng trƒÉm l√† s·ªë 5. S·ªë sau n√≥ l√† 6 (>=5) n√™n tƒÉng 5 l√™n 6 v√† thay c√°c s·ªë sau b·∫±ng 0." },
                { text: "$1500$", correct: false, rationale: "Sai." },
                { text: "$1570$", correct: false, rationale: "Sai. ƒê√¢y l√† l√†m tr√≤n ƒë·∫øn h√†ng ch·ª•c." },
                { text: "$1550$", correct: false, rationale: "Sai." }
            ],
            hint: "Quan s√°t ch·ªØ s·ªë h√†ng trƒÉm (s·ªë 5) v√† ch·ªØ s·ªë ngay sau n√≥ (s·ªë 6)."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "S·ªë n√†o sau ƒë√¢y khi l√†m tr√≤n ƒë·∫øn h√†ng ph·∫ßn m∆∞·ªùi th√¨ ƒë∆∞·ª£c k·∫øt qu·∫£ l√† $3,5$?",
            options: [
                { text: "$3,52$", correct: true, rationale: "Ch√≠nh x√°c. S·ªë 2 < 5 n√™n gi·ªØ nguy√™n 3,5." },
                { text: "$3,44$", correct: false, rationale: "Sai. L√†m tr√≤n th√†nh 3,4." },
                { text: "$3,56$", correct: false, rationale: "Sai. L√†m tr√≤n th√†nh 3,6 (v√¨ 6 >= 5)." },
                { text: "$3,41$", correct: false, rationale: "Sai. L√†m tr√≤n th√†nh 3,4." }
            ],
            hint: "T√¨m s·ªë m√† ch·ªØ s·ªë h√†ng ph·∫ßn trƒÉm nh·ªè h∆°n 5 (n·∫øu h√†ng ph·∫ßn m∆∞·ªùi l√† 5)."
        },

        // --- TH√îNG HI·ªÇU (5 c√¢u) ---
        {
            level: "Th√¥ng hi·ªÉu",
            text: "L√†m tr√≤n s·ªë √¢m $-4,285$ ƒë·∫øn h√†ng ph·∫ßn m∆∞·ªùi.",
            options: [
                { text: "$-4,3$", correct: true, rationale: "ƒê√∫ng. X√©t s·ªë ƒë·ªëi 4,285 l√†m tr√≤n th√†nh 4,3. Th√™m d·∫•u tr·ª´ th√†nh -4,3." },
                { text: "$-4,2$", correct: false, rationale: "Sai. Ch·ªØ s·ªë sau s·ªë 2 l√† 8 (>=5) n√™n ph·∫£i tƒÉng l√™n." },
                { text: "$-4,29$", correct: false, rationale: "Sai. ƒê√¢y l√† h√†ng ph·∫ßn trƒÉm." },
                { text: "$-5,3$", correct: false, rationale: "Sai." }
            ],
            hint: "L√†m tr√≤n s·ªë d∆∞∆°ng t∆∞∆°ng ·ª©ng r·ªìi ƒë·∫∑t d·∫•u tr·ª´ ƒë·∫±ng tr∆∞·ªõc."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "∆Ø·ªõc l∆∞·ª£ng k·∫øt qu·∫£ c·ªßa ph√©p t√≠nh: $19,8 \\cdot 4,1$.",
            options: [
                { text: "$80$", correct: true, rationale: "Xu·∫•t s·∫Øc! $19,8 \\approx 20$, $4,1 \\approx 4$ n√™n $\\approx 80$." },
                { text: "$100$", correct: false, rationale: "Qu√° cao." },
                { text: "$60$", correct: false, rationale: "Qu√° th·∫•p." },
                { text: "$76$", correct: false, rationale: "Kh√≥ nh·∫©m h∆°n v√† kh√¥ng ph·∫£i ∆∞·ªõc l∆∞·ª£ng tr√≤n s·ªë." }
            ],
            hint: "L√†m tr√≤n v·ªÅ 20 v√† 4."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "M·ªôt m·∫£nh v∆∞·ªùn h√¨nh ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i $11,8m$ v√† chi·ªÅu r·ªông $9,2m$. ∆Ø·ªõc l∆∞·ª£ng di·ªán t√≠ch m·∫£nh v∆∞·ªùn.",
            options: [
                { text: "$108 \\, m^2$", correct: true, rationale: "ƒê√∫ng. $11,8 \\approx 12$, $9,2 \\approx 9$ n√™n $\\approx 108$." },
                { text: "$120 \\, m^2$", correct: false, rationale: "Sai. L√†m tr√≤n l√™n 10 g√¢y sai s·ªë l·ªõn." },
                { text: "$99 \\, m^2$", correct: false, rationale: "Sai. L√†m tr√≤n xu·ªëng 11 g√¢y l·ªách." },
                { text: "$100 \\, m^2$", correct: false, rationale: "∆Ø·ªõc l∆∞·ª£ng ch∆∞a s√°t." }
            ],
            hint: "L√†m tr√≤n: 11,8‚Üí12 v√† 9,2‚Üí9."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "K·∫øt qu·∫£ l√†m tr√≤n s·ªë $\\sqrt{5}$ ƒë·∫øn h√†ng ph·∫ßn ngh√¨n l√†:",
            options: [
                { text: "$2,236$", correct: true, rationale: "Ch√≠nh x√°c. $\\sqrt{5} \\approx 2,23606...$ n√™n l√†m tr√≤n ƒë·∫øn ph·∫ßn ngh√¨n l√† 2,236." },
                { text: "$2,237$", correct: false, rationale: "Sai." },
                { text: "$2,24$", correct: false, rationale: "Sai. ƒê√¢y l√† h√†ng ph·∫ßn trƒÉm." },
                { text: "$2,23$", correct: false, rationale: "Sai." }
            ],
            hint: "Nh·ªõ g·∫ßn ƒë√∫ng: 2,2360..."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "Bi·∫øt 1 inch $\\approx 2,54$ cm. M·ªôt chi·∫øc TV 50 inch c√≥ ƒë∆∞·ªùng ch√©o kho·∫£ng bao nhi√™u m√©t?",
            options: [
                { text: "$1,27 \\, m$", correct: true, rationale: "ƒê√∫ng. $50\\cdot2,54=127$ cm = 1,27 m." },
                { text: "$127 \\, m$", correct: false, rationale: "Sai ƒë∆°n v·ªã." },
                { text: "$1,5 \\, m$", correct: false, rationale: "Sai." },
                { text: "$2,54 \\, m$", correct: false, rationale: "Sai." }
            ],
            hint: "Nh√¢n r·ªìi ƒë·ªïi cm ‚Üí m."
        },

        // --- V·∫¨N D·ª§NG (3 c√¢u) ---
        {
            level: "V·∫≠n d·ª•ng th·ª±c t·∫ø",
            text: "B·∫°n Lan mua: Rau (28.500ƒë), Th·ªãt (102.000ƒë), G·∫°o (58.000ƒë). Lan mang 200.000ƒë. ∆Ø·ªõc l∆∞·ª£ng Lan c√≥ ƒë·ªß ti·ªÅn kh√¥ng?",
            options: [
                { text: "ƒê·ªß ti·ªÅn", correct: true, rationale: "ƒê√∫ng! ∆Ø·ªõc l∆∞·ª£ng: 30 + 100 + 60 = 190 (ngh√¨n) < 200." },
                { text: "Kh√¥ng ƒë·ªß ti·ªÅn", correct: false, rationale: "Sai. T·ªïng kho·∫£ng 188.500ƒë." },
                { text: "Thi·∫øu 10.000ƒë", correct: false, rationale: "Sai." },
                { text: "V·ª´a ƒë·ªß y chang", correct: false, rationale: "Sai. C√≤n d∆∞." }
            ],
            hint: "L√†m tr√≤n ƒë·∫øn ch·ª•c ngh√¨n: 30 + 100 + 60."
        },
        {
            level: "V·∫≠n d·ª•ng",
            text: "T√≠nh di·ªán t√≠ch h√¨nh tr√≤n b√°n k√≠nh $r=4,8$ cm (l·∫•y $\\pi\\approx3,14$, l√†m tr√≤n k·∫øt qu·∫£ ƒë·∫øn h√†ng ƒë∆°n v·ªã).",
            options: [
                { text: "$72 \\, cm^2$", correct: true, rationale: "ƒê√∫ng. $S\\approx3,14\\cdot23,04\\approx72,3456$ ‚Üí 72." },
                { text: "$75 \\, cm^2$", correct: false, rationale: "Sai. ∆Ø·ªõc l∆∞·ª£ng th√¥ th√¨ ra 75 nh∆∞ng ƒë·ªÅ y√™u c·∫ßu t√≠nh v√† l√†m tr√≤n." },
                { text: "$15 \\, cm^2$", correct: false, rationale: "Sai c√¥ng th·ª©c." },
                { text: "$30 \\, cm^2$", correct: false, rationale: "Sai." }
            ],
            hint: "T√≠nh (4,8)^2 tr∆∞·ªõc."
        },
        {
            level: "V·∫≠n d·ª•ng",
            text: "D√¢n s·ªë Vi·ªát Nam nƒÉm 2020 ∆∞·ªõc t√≠nh $97.582.700$ ng∆∞·ªùi. L√†m tr√≤n ƒë·∫øn h√†ng tri·ªáu.",
            options: [
                { text: "$98.000.000$", correct: true, rationale: "ƒê√∫ng. H√†ng trƒÉm ngh√¨n l√† 5 n√™n l√†m tr√≤n l√™n." },
                { text: "$97.000.000$", correct: false, rationale: "Sai." },
                { text: "$97.600.000$", correct: false, rationale: "Sai h√†ng l√†m tr√≤n." },
                { text: "$97.500.000$", correct: false, rationale: "Sai." }
            ],
            hint: "Nh√¨n ch·ªØ s·ªë h√†ng trƒÉm ngh√¨n."
        },

        // --- V·∫¨N D·ª§NG CAO (1 c√¢u) ---
        {
            level: "V·∫≠n d·ª•ng cao",
            text: "T√¨m s·ªë t·ª± nhi√™n $n$ <b>l·ªõn nh·∫•t</b> sao cho khi l√†m tr√≤n $n$ ƒë·∫øn h√†ng trƒÉm ƒë∆∞·ª£c $500$.",
            options: [
                { text: "$549$", correct: true, rationale: "ƒê√∫ng! ƒê·ªÉ l√†m tr√≤n v·ªÅ 500 th√¨ $n$ ph·∫£i < 550. L·ªõn nh·∫•t l√† 549." },
                { text: "$550$", correct: false, rationale: "Sai. 550 l√†m tr√≤n th√†nh 600." },
                { text: "$499$", correct: false, rationale: "Sai. Ch∆∞a l·ªõn nh·∫•t." },
                { text: "$599$", correct: false, rationale: "Sai. L√†m tr√≤n th√†nh 600." }
            ],
            hint: "Mu·ªën ra 500 th√¨ ph·∫£i nh·ªè h∆°n 550."
        }
    ];

    // --- UTILS: shuffle + c√¢n ƒë√°p √°n ABCD trong d·ªØ li·ªáu ---
    function shuffleArray(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    // ƒê∆∞a ƒë√°p √°n ƒë√∫ng c·ªßa m·ªói c√¢u v·ªÅ v·ªã tr√≠ m·ª•c ti√™u (0..3) ƒë·ªÉ "chia ƒë·ªÅu ABCD" ·ªü d·ªØ li·ªáu g·ªëc
    function balanceCorrectPositions(questions) {
        return questions.map((q, idx) => {
            const options = [...q.options];
            const correctIdx = options.findIndex(o => o.correct);
            if (correctIdx === -1) return q; // ph√≤ng khi thi·∫øu correct
            const target = idx % 4; // A,B,C,D,A,B,C,D...
            const [correctOpt] = options.splice(correctIdx, 1);
            options.splice(target, 0, correctOpt);
            return { ...q, options };
        });
    }

    // --- GAME ENGINE ---
    const Game = {
        state: {
            score: 0,
            index: 0,
            answered: false,
            questions: []
        },

        start() {
            this.state.score = 0;
            this.state.index = 0;
            this.state.answered = false;

            // 1) C√¢n ABCD trong d·ªØ li·ªáu (ƒë√∫ng y√™u c·∫ßu c√¥)
            const balanced = balanceCorrectPositions(QUESTIONS);

            // 2) Random th·ª© t·ª± c√¢u h·ªèi
            this.state.questions = shuffleArray(balanced);

            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('flex');

            this.render();
        },

        render() {
            this.state.answered = false;
            document.getElementById('feedback-sheet').classList.add('translate-y-full');

            const q = this.state.questions[this.state.index];

            // UI Updates
            document.getElementById('ui-current').innerText = this.state.index + 1;
            document.getElementById('ui-total').innerText = this.state.questions.length;
            document.getElementById('ui-score').innerText = this.state.score;
            document.getElementById('ui-level').innerText = "M·ª©c ƒë·ªô: " + q.level;

            // Progress (c√¢u cu·ªëi ƒë·∫ßy 100%)
            const pct = ((this.state.index) / (this.state.questions.length - 1)) * 100;
            document.getElementById('ui-progress').style.width = `${isFinite(pct) ? pct : 0}%`;

            // Content
            document.getElementById('ui-question').innerHTML = q.text;

            // Options (random ƒë√°p √°n m·ªói c√¢u)
            const randomizedOptions = shuffleArray(q.options);

            const container = document.getElementById('ui-options');
            container.innerHTML = '';

            randomizedOptions.forEach((opt, i) => {
                const btn = document.createElement('div');
                btn.className = `option-card bg-white border-2 border-gray-200 p-5 rounded-2xl flex items-center shadow-sm`;
                btn.innerHTML = `
                    <div class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 font-bold flex items-center justify-center mr-4 border border-gray-300 flex-shrink-0">
                        ${String.fromCharCode(65 + i)}
                    </div>
                    <div class="font-semibold text-lg text-gray-700">${opt.text}</div>
                `;
                btn.onclick = () => this.check(btn, opt, randomizedOptions, q);
                container.appendChild(btn);
            });

            if (window.MathJax) MathJax.typesetPromise();
        },

        check(btn, opt, renderedOptions, q) {
            if (this.state.answered) return;
            this.state.answered = true;

            const allBtns = document.querySelectorAll('.option-card');
            allBtns.forEach(b => {
                b.classList.add('disabled', 'cursor-default');
                b.style.pointerEvents = 'none';
            });

            const fbIcon = document.getElementById('fb-icon');
            const fbTitle = document.getElementById('fb-title');

            if (opt.correct) {
                this.state.score += 10;
                document.getElementById('ui-score').innerText = this.state.score;
                btn.classList.add('correct');

                fbIcon.innerText = "üéâ";
                fbTitle.innerText = "Ch√≠nh X√°c!";
                fbTitle.className = "text-xl font-bold mb-1 text-green-600";

                this.playSound('success');
                confetti({ particleCount: 80, spread: 60, origin: { y: 0.7 } });
            } else {
                btn.classList.add('wrong');

                const correctIndex = renderedOptions.findIndex(o => o.correct);
                if (correctIndex >= 0) allBtns[correctIndex].classList.add('correct', 'opacity-75');

                fbIcon.innerText = "ü§î";
                fbTitle.innerText = "Ti·∫øc qu√°!";
                fbTitle.className = "text-xl font-bold mb-1 text-red-600";

                this.playSound('error');
            }

            document.getElementById('fb-rationale').innerText = opt.rationale;
            document.getElementById('fb-hint').innerText = "G·ª£i √Ω: " + q.hint;
            document.getElementById('feedback-sheet').classList.remove('translate-y-full');

            if (window.MathJax) MathJax.typesetPromise();
        },

        next() {
            this.state.index++;
            if (this.state.index < this.state.questions.length) {
                this.render();
            } else {
                this.end();
            }
        },

        end() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('flex');
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('end-screen').classList.add('flex');

            document.getElementById('end-score').innerText = this.state.score;
            document.getElementById('end-correct').innerText = Math.round(this.state.score / 10);

            this.playSound('complete');

            const msg = document.getElementById('end-msg');
            if (this.state.score >= 130) msg.innerText = "Tuy·ªát ƒë·ªânh! B·∫°n l√† m√°y t√≠nh s·ªëng! ü§ñ";
            else if (this.state.score >= 100) msg.innerText = "R·∫•t t·ªët! Kh·∫£ nƒÉng ∆∞·ªõc l∆∞·ª£ng c·ªßa b·∫°n r·∫•t c·ª´! üëç";
            else msg.innerText = "H√£y c·∫©n th·∫≠n h∆°n m·ªôt ch√∫t khi l√†m tr√≤n nh√©! üí™";
        },

        playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'success') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(440, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
                osc.start();
                osc.stop(ctx.currentTime + 0.5);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.001, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } else if (type === 'complete') {
                [523, 659, 783, 1046].forEach((f, i) => {
                    setTimeout(() => {
                        const o = ctx.createOscillator();
                        const g = ctx.createGain();
                        o.connect(g);
                        g.connect(ctx.destination);
                        o.type = 'triangle';
                        o.frequency.value = f;
                        g.gain.setValueAtTime(0.1, ctx.currentTime);
                        g.gain.linearRampToValueAtTime(0.001, ctx.currentTime + 0.2);
                        o.start();
                        o.stop(ctx.currentTime + 0.2);
                    }, i * 150);
                });
            }
        }
    };
</script>

</body>
</html>
