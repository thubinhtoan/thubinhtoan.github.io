<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khu V∆∞·ªùn B√≠ M·∫≠t - To√°n 9: ƒê∆∞·ªùng tr√≤n</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- T·∫£i Tone.js cho √¢m thanh -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* CSS cho font v√† giao di·ªán chung */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        /* Container ch√≠nh c·ªßa tr√≤ ch∆°i */
        #game-container {
            width: 100%;
            max-width: 900px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Ti√™u ƒë·ªÅ */
        header {
            background-color: #68b984;
            color: white;
            padding: 1.5rem 2rem;
            text-align: center;
            border-bottom: 5px solid #4a9c6d;
        }

        header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }

        /* N·ªôi dung ch√≠nh (V∆∞·ªùn + C√¢u h·ªèi) */
        main {
            display: flex;
            flex-direction: column;
            md:flex-direction: row;
            flex-grow: 1;
        }
        <!-- Hi·ªÉn th·ªã th√¥ng tin h·ªçc sinh (·ªü tr√™n c√πng) -->
<div id="student-info-bar"
     class="w-full text-right text-sm text-gray-200 opacity-90 py-1 pr-4">
    H·ªçc sinh: <span id="info-name"></span> ‚Äì 
    L·ªõp <span id="info-class"></span> ‚Äì 
    <span id="info-school"></span>
</div>
        /* Khu v∆∞·ªùn b√≠ m·∫≠t */
        #secret-garden {
            width: 100%;
            md:width: 40%;
            background: #f0fdf4; /* M√†u n·ªÅn c·ªè nh·∫°t */
            border-right: 2px solid #d1fae5;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            align-content: start;
            min-height: 200px;
            order: 2; /* ƒê·∫£o th·ª© t·ª± tr√™n mobile */
            md:order: 1;
        }

        /* B√¥ng hoa */
        .flower-pot {
            aspect-ratio: 1 / 1;
            background-color: #e0f2e9;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #a0aec0;
            border: 2px dashed #bbf7d0;
        }

        .flower {
            font-size: 2.5rem;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .flower.grown {
            opacity: 1;
            transform: scale(1);
        }

        /* Khu v·ª±c c√¢u h·ªèi */
        #quiz-area {
            width: 100%;
            md:width: 60%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            order: 1; /* ƒê·∫£o th·ª© t·ª± tr√™n mobile */
            md:order: 2;
        }

        #question-container {
            margin-bottom: 1.5rem;
        }

        /* Hi·ªÉn th·ªã m·ª©c ƒë·ªô c√¢u h·ªèi */
        #question-level {
            font-size: 0.875rem;
            font-weight: 600;
            color: #56ab2f;
            background-color: #dcfce7;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            display: inline-block;
            margin-bottom: 0.75rem;
        }

        /* N·ªôi dung c√¢u h·ªèi */
        #question-text {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* C√°c l·ª±a ch·ªçn tr·∫£ l·ªùi */
        #options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        /* N√∫t l·ª±a ch·ªçn */
        .option-btn {
            width: 100%;
            background-color: #fff;
            border: 2px solid #d1d5db;
            border-radius: 12px;
            padding: 1rem;
            text-align: left;
            font-size: 1rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        /* Hi·ªáu ·ª©ng khi di chu·ªôt v√†o n√∫t */
        .option-btn:not(:disabled):hover {
            border-color: #68b984;
            background-color: #f0fdf4;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.08);
        }

        /* N√∫t khi ƒë∆∞·ª£c ch·ªçn */
        .option-btn.selected {
            border-color: #4a9c6d;
            background-color: #dcfce7;
            color: #166534;
        }

        /* N√∫t khi tr·∫£ l·ªùi ƒë√∫ng */
        .option-btn.correct {
            background-color: #dcfce7;
            border-color: #4ade80;
            color: #166534;
            animation: pulse-correct 0.5s;
        }

        /* N√∫t khi tr·∫£ l·ªùi sai */
        .option-btn.wrong {
            background-color: #fee2e2;
            border-color: #f87171;
            color: #991b1b;
            animation: shake-wrong 0.5s;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* N√∫t ƒëi·ªÅu khi·ªÉn (Ki·ªÉm tra / C√¢u ti·∫øp) */
        #controls {
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        #control-btn {
            background-color: #56ab2f;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 10px rgba(86, 171, 47, 0.3);
        }

        #control-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
        }

        #control-btn:not(:disabled):hover {
            background-color: #4a9c6d;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(86, 171, 47, 0.4);
        }

        /* M√†n h√¨nh k·∫øt th√∫c */
        #end-screen {
            display: none; /* ·∫®n ban ƒë·∫ßu */
            text-align: center;
            padding: 3rem 2rem;
        }

        #end-screen h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4a9c6d;
            margin-bottom: 1rem;
        }

        #end-score {
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Hi·ªáu ·ª©ng cho c√¢u tr·∫£ l·ªùi */
        @keyframes pulse-correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake-wrong {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* Bi·ªÉu t∆∞·ª£ng tung hoa (hi·ªáu ·ª©ng khi ƒë√∫ng) */
        .feedback-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            opacity: 0;
            animation: fade-out-up 1s ease-out;
        }

        @keyframes fade-out-up {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            100% { opacity: 0; transform: translate(-50%, -150%) scale(1.5); }
        }
        
        /* CSS cho responsive */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            main {
                flex-direction: column;
            }
            #secret-garden {
                order: 2; /* V∆∞·ªùn xu·ªëng d∆∞·ªõi */
                width: 100%;
                border-right: none;
                border-top: 2px solid #d1fae5;
                grid-template-columns: repeat(5, 1fr); /* Gi·ªØ 5 c·ªôt cho 10 c√¢u */
            }
            #quiz-area {
                order: 1; /* C√¢u h·ªèi l√™n tr√™n */
                width: 100%;
                padding: 1.5rem;
            }
            header h1 {
                font-size: 1.5rem;
            }
            #question-text {
                font-size: 1.125rem;
            }
            .flower-pot {
                font-size: 1rem;
            }
            .flower {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- M√†n h√¨nh nh·∫≠p th√¥ng tin h·ªçc sinh (ch·ªâ xu·∫•t hi·ªán n·∫øu ch∆∞a c√≥ d·ªØ li·ªáu) -->
<div id="student-screen" 
     class="fixed inset-0 bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center text-white z-50 hidden">
    <div class="bg-slate-800 p-8 rounded-2xl w-96 shadow-2xl border border-slate-600">
        <h2 class="text-2xl font-bold mb-4 text-center text-emerald-300">Th√¥ng tin h·ªçc sinh</h2>

        <label class="block mb-3">
            H·ªç v√† t√™n:
            <input id="student-name" class="mt-1 w-full p-2 rounded bg-slate-700 border border-slate-500" required>
        </label>

        <label class="block mb-3">
            L·ªõp:
            <input id="student-class" class="mt-1 w-full p-2 rounded bg-slate-700 border border-slate-500" required>
        </label>

        <label class="block mb-5">
            Tr∆∞·ªùng:
            <input id="student-school" class="mt-1 w-full p-2 rounded bg-slate-700 border border-slate-500" required>
        </label>

        <button id="save-student-btn"
                class="w-full bg-emerald-500 hover:bg-emerald-600 py-2 rounded-lg font-semibold text-white transition">
            B·∫Øt ƒë·∫ßu ch∆°i
        </button>
    </div>
</div>
    <div id="game-container">
        <header>
            <h1>Khu V∆∞·ªùn B√≠ M·∫≠t</h1>
            <p>B√†i 1: ƒê∆∞·ªùng tr√≤n - To√°n l·ªõp 9 (Ch√¢n tr·ªùi s√°ng t·∫°o)</p>
        </header>

        <main>
            <!-- Khu V∆∞·ªùn -->
            <div id="secret-garden">
                <!-- 10 v·ªã tr√≠ tr·ªìng hoa -->
                <div class="flower-pot"><span id="flower-1" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-2" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-3" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-4" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-5" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-6" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-7" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-8" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-9" class="flower"></span></div>
                <div class="flower-pot"><span id="flower-10" class="flower"></span></div>
            </div>

            <!-- Khu V·ª±c C√¢u H·ªèi -->
            <div id="quiz-area">
                <div id="question-container">
                    <span id="question-level">M·ª©c ƒë·ªô 1/4</span>
                    <div id="question-text">ƒê√¢y l√† n·ªôi dung c√¢u h·ªèi...</div>
                    <div id="options-container">
                        <!-- C√°c l·ª±a ch·ªçn s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                    </div>
                </div>

                <div id="controls">
                    <button id="control-btn" disabled>Ki·ªÉm tra</button>
                </div>
                
                <!-- Hi·ªáu ·ª©ng ph·∫£n h·ªìi -->
                <div id="feedback-container" class="relative w-full h-0"></div>

                <!-- M√†n h√¨nh k·∫øt th√∫c -->
                <div id="end-screen">
                    <h2>Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh!</h2>
                    <p id="end-score">Khu v∆∞·ªùn c·ªßa b·∫°n ƒë√£ n·ªü 8/10 b√¥ng hoa!</p>
                    <button id="restart-btn" class="mt-4 bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-blue-600 transition">Ch∆°i l·∫°i</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ========================
<script>
  // ========================
  //  TH√îNG TIN H·ªåC SINH D√ôNG CHUNG CHO T·∫§T C·∫¢ GAME
  // ========================

  function loadStudentInfo() {
    const name = localStorage.getItem("studentName");
    const lop = localStorage.getItem("studentClass");
    const school = localStorage.getItem("studentSchool");

    const form = document.getElementById("student-screen");

    if (name && lop && school) {
      // ƒê√£ c√≥ d·ªØ li·ªáu ‚Üí Hi·ªÉn th·ªã tr√™n thanh info
      document.getElementById("info-name").textContent = name;
      document.getElementById("info-class").textContent = lop;
      document.getElementById("info-school").textContent = school;
      form.classList.add("hidden");
    } else {
      // Ch∆∞a c√≥ d·ªØ li·ªáu ‚Üí b·∫≠t form nh·∫≠p
      form.classList.remove("hidden");
    }
  }

  // Khi b·∫•m n√∫t l∆∞u
  const saveBtn = document.getElementById("save-student-btn");
  if (saveBtn) {
    saveBtn.addEventListener("click", () => {
      const name = document.getElementById("student-name").value.trim();
      const lop = document.getElementById("student-class").value.trim();
      const school = document.getElementById("student-school").value.trim();

      if (!name || !lop || !school) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
      }

      // L∆∞u localStorage
      localStorage.setItem("studentName", name);
      localStorage.setItem("studentClass", lop);
      localStorage.setItem("studentSchool", school);

      // ·∫®n form, hi·ªán info
      document.getElementById("student-screen").classList.add("hidden");
      loadStudentInfo();
    });
  }

  // --- D·ªØ li·ªáu c√¢u h·ªèi ---
  const questions = [
    // M·ª©c 1: Nh·∫≠n bi·∫øt
    {
      level: "Nh·∫≠n bi·∫øt",
      text: "ƒê∆∞·ªùng tr√≤n (O; R) l√† h√¨nh g·ªìm c√°c ƒëi·ªÉm M trong m·∫∑t ph·∫≥ng sao cho:",
      options: [
        { text: "OM < R", correct: false },
        { text: "OM > R", correct: false },
        { text: "OM = R", correct: true },
        { text: "OM ‚â§ R", correct: false }
      ]
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      text: "ƒê·ªëi t∆∞·ª£ng n√†o sau ƒë√¢y l√† t√¢m ƒë·ªëi x·ª©ng c·ªßa ƒë∆∞·ªùng tr√≤n (O)?",
      options: [
        { text: "M·ªôt ƒëi·ªÉm M b·∫•t k√¨ tr√™n ƒë∆∞·ªùng tr√≤n", correct: false },
        { text: "T√¢m O", correct: true },
        { text: "M·ªôt b√°n k√≠nh b·∫•t k√¨", correct: false },
        { text: "M·ªôt ƒë∆∞·ªùng k√≠nh b·∫•t k√¨", correct: false }
      ]
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      text: "Trong m·ªôt ƒë∆∞·ªùng tr√≤n, d√¢y cung l·ªõn nh·∫•t ƒë∆∞·ª£c g·ªçi l√† g√¨?",
      options: [
        { text: "B√°n k√≠nh", correct: false },
        { text: "ƒê∆∞·ªùng k√≠nh", correct: true },
        { text: "C√°t tuy·∫øn", correct: false },
        { text: "Ti·∫øp tuy·∫øn", correct: false }
      ]
    },
    // M·ª©c 2: Th√¥ng hi·ªÉu
    {
      level: "Th√¥ng hi·ªÉu",
      text: "Cho ƒë∆∞·ªùng tr√≤n (O; 5 cm). ƒêi·ªÉm A c√≥ OA = 6 cm. V·ªã tr√≠ c·ªßa ƒëi·ªÉm A so v·ªõi ƒë∆∞·ªùng tr√≤n (O) l√†:",
      options: [
        { text: "N·∫±m trong ƒë∆∞·ªùng tr√≤n", correct: false },
        { text: "N·∫±m tr√™n ƒë∆∞·ªùng tr√≤n", correct: false },
        { text: "N·∫±m ngo√†i ƒë∆∞·ªùng tr√≤n", correct: true },
        { text: "Tr√πng v·ªõi t√¢m O", correct: false }
      ]
    },
    {
      level: "Th√¥ng hi·ªÉu",
      text: "Hai ƒë∆∞·ªùng tr√≤n (O; R) v√† (O'; R') (v·ªõi R > R') ti·∫øp x√∫c trong v·ªõi nhau. H·ªá th·ª©c n√†o sau ƒë√¢y l√† ƒë√∫ng?",
      options: [
        { text: "OO' = R + R'", correct: false },
        { text: "OO' = R - R'", correct: true },
        { text: "OO' > R + R'", correct: false },
        { text: "OO' < R - R'", correct: false }
      ]
    },
    {
      level: "Th√¥ng hi·ªÉu",
      text: "Cho ƒë∆∞·ªùng tr√≤n (I; 8 cm). M·ªôt d√¢y cung MN c√≥ ƒë·ªô d√†i 17 cm. H·ªèi d√¢y MN c√≥ ph·∫£i l√† ƒë∆∞·ªùng k√≠nh kh√¥ng?",
      options: [
        { text: "C√≥, v√¨ 17 > 8", correct: false },
        {
          text: "Kh√¥ng, v√¨ ƒë·ªô d√†i ƒë∆∞·ªùng k√≠nh l√† 16 cm, 17 > 16 l√† v√¥ l√Ω",
          correct: true
        },
        { text: "Kh√¥ng, v√¨ n√≥ kh√¥ng ƒëi qua t√¢m", correct: false },
        { text: "C√≥, v√¨ n√≥ l√† d√¢y cung l·ªõn nh·∫•t", correct: false }
      ]
    },
    // M·ª©c 3: V·∫≠n d·ª•ng
    {
      level: "V·∫≠n d·ª•ng",
      text: "Cho hai ƒë∆∞·ªùng tr√≤n (O; 5 cm) v√† (O'; 3 cm). Bi·∫øt OO' = 8 cm. V·ªã tr√≠ t∆∞∆°ng ƒë·ªëi c·ªßa hai ƒë∆∞·ªùng tr√≤n l√†:",
      options: [
        { text: "C·∫Øt nhau", correct: false },
        { text: "Ti·∫øp x√∫c ngo√†i", correct: true },
        { text: "·ªû ngo√†i nhau", correct: false },
        { text: "ƒê·ª±ng nhau", correct: false }
      ]
    },
    {
      level: "V·∫≠n d·ª•ng",
      text: "M·ªôt c√°i b√°nh xe ƒë·∫°p c√≥ b√°n k√≠nh l√† 33 cm. H·ªèi, n·∫øu m·ªôt con ki·∫øn ƒë·∫≠u tr√™n v√†nh b√°nh xe, n√≥ c√°ch tr·ª•c b√°nh xe (t√¢m ƒë∆∞·ªùng tr√≤n) bao nhi√™u cm?",
      options: [
        { text: "33 cm", correct: true },
        { text: "66 cm", correct: false },
        { text: "16,5 cm", correct: false },
        { text: "Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c", correct: false }
      ]
    },
    {
      level: "V·∫≠n d·ª•ng",
      text: "Cho hai ƒë∆∞·ªùng tr√≤n (A; 10 cm) v√† (B; 4 cm). ƒê·ªÉ hai ƒë∆∞·ªùng tr√≤n n√†y c·∫Øt nhau, ƒë·ªô d√†i ƒëo·∫°n n·ªëi t√¢m AB ph·∫£i th·ªèa m√£n:",
      options: [
        { text: "AB = 14 cm", correct: false },
        { text: "AB = 6 cm", correct: false },
        { text: "AB > 14 cm", correct: false },
        { text: "6 < AB < 14 cm", correct: true }
      ]
    },
    // M·ª©c 4: V·∫≠n d·ª•ng cao
    {
      level: "V·∫≠n d·ª•ng cao",
      text: "Cho h√¨nh ch·ªØ nh·∫≠t ABCD c√≥ AB = 16 cm, AD = 12 cm. B·ªën ƒëi·ªÉm A, B, C, D c√πng thu·ªôc m·ªôt ƒë∆∞·ªùng tr√≤n. B√°n k√≠nh c·ªßa ƒë∆∞·ªùng tr√≤n ƒë√≥ l√†:",
      options: [
        { text: "8 cm", correct: false },
        { text: "6 cm", correct: false },
        { text: "10 cm", correct: true },
        { text: "14 cm", correct: false }
      ]
    }
  ];

  // --- Bi·∫øn tr·∫°ng th√°i tr√≤ ch∆°i ---
  let currentQuestionIndex = 0;
  let score = 0;
  let selectedButton = null;
  let soundReady = false;

  // --- ƒê·ªëi t∆∞·ª£ng √¢m thanh ---
  let correctSound, wrongSound;

  // --- C√°c ph·∫ßn t·ª≠ DOM ---
  const questionContainer = document.getElementById("question-container");
  const questionLevelEl = document.getElementById("question-level");
  const questionTextEl = document.getElementById("question-text");
  const optionsContainer = document.getElementById("options-container");
  const controlBtn = document.getElementById("control-btn");
  const feedbackContainer = document.getElementById("feedback-container");
  const endScreen = document.getElementById("end-screen");
  const endScoreEl = document.getElementById("end-score");
  const restartBtn = document.getElementById("restart-btn");
  const controls = document.getElementById("controls");
  const flowerEmojis = ["üå∏", "üåπ", "üåª", "üå∑", "üåº", "üå∫", "üíê", "üíÆ", "üèµÔ∏è", "G"];

  // --- H√†m shuffle ƒë·ªÉ random th·ª© t·ª± ƒë√°p √°n ---
  function shuffleArray(arr) {
    const array = [...arr];
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // --- Kh·ªüi ƒë·ªông sau khi DOM s·∫µn s√†ng ---
  document.addEventListener("DOMContentLoaded", () => {
    loadStudentInfo();
    startGame();
  });

  function startGame() {
    // Kh·ªüi t·∫°o √¢m thanh khi ng∆∞·ªùi d√πng t∆∞∆°ng t√°c
    document.body.addEventListener("click", initAudio, { once: true });

    currentQuestionIndex = 0;
    score = 0;
    endScreen.style.display = "none";
    questionContainer.style.display = "block";
    controls.style.display = "flex";

    // ƒê·∫∑t l·∫°i c√°c b√¥ng hoa
    for (let i = 1; i <= 10; i++) {
      const flower = document.getElementById(`flower-${i}`);
      flower.classList.remove("grown");
      flower.textContent = "";
      flower.parentElement.style.display = "flex";
    }

    // X√°o tr·ªôn c√°c emoji hoa
    flowerEmojis.sort(() => Math.random() - 0.5);

    loadQuestion();
  }

  function initAudio() {
    if (soundReady) return;
    Tone.start();
    correctSound = new Tone.Synth({
      oscillator: { type: "sine" },
      envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 0.2 }
    }).toDestination();

    wrongSound = new Tone.Synth({
      oscillator: { type: "square" },
      envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.2 }
    }).toDestination();
    soundReady = true;
  }

  // --- T·∫£i c√¢u h·ªèi ---
  function loadQuestion() {
    selectedButton = null;
    optionsContainer.innerHTML = "";

    if (currentQuestionIndex >= questions.length) {
      endGame();
      return;
    }

    const q = questions[currentQuestionIndex];

    // C·∫≠p nh·∫≠t n·ªôi dung c√¢u h·ªèi
    questionLevelEl.textContent = `M·ª©c ƒë·ªô: ${q.level}`;
    questionTextEl.innerHTML = q.text;

    // Random th·ª© t·ª± ƒë√°p √°n
    const shuffledOptions = shuffleArray(q.options);

    // T·∫°o c√°c n√∫t l·ª±a ch·ªçn
    shuffledOptions.forEach((option) => {
      const button = document.createElement("button");
      button.innerHTML = option.text;
      button.classList.add("option-btn");
      button.dataset.correct = option.correct ? "true" : "false";
      button.addEventListener("click", () => selectOption(button));
      optionsContainer.appendChild(button);
    });

    controlBtn.textContent = "Ki·ªÉm tra";
    controlBtn.disabled = true;
  }

  function selectOption(button) {
    const allOptions = document.querySelectorAll(".option-btn");
    allOptions.forEach((btn) => btn.classList.remove("selected"));

    button.classList.add("selected");
    selectedButton = button;
    controlBtn.disabled = false;
  }

  controlBtn.addEventListener("click", () => {
    if (controlBtn.textContent === "Ki·ªÉm tra") {
      checkAnswer();
    } else {
      nextQuestion();
    }
  });

  function checkAnswer() {
    const allOptions = document.querySelectorAll(".option-btn");

    allOptions.forEach((btn) => (btn.disabled = true));
    controlBtn.textContent = "C√¢u ti·∫øp theo";
    controlBtn.disabled = false;

    const isCorrect =
      selectedButton && selectedButton.dataset.correct === "true";

    if (isCorrect) {
      score++;
      selectedButton.classList.add("correct");
      growFlower();
      playEffect("correct");
    } else {
      if (selectedButton) {
        selectedButton.classList.add("wrong");
      }
      // T√¥ xanh ƒë√°p √°n ƒë√∫ng
      allOptions.forEach((btn) => {
        if (btn.dataset.correct === "true") {
          btn.classList.add("correct");
        }
      });
      playEffect("wrong");
    }
  }

  function nextQuestion() {
    currentQuestionIndex++;
    loadQuestion();
  }

  function endGame() {
    questionContainer.style.display = "none";
    controls.style.display = "none";
    endScreen.style.display = "block";
    endScoreEl.innerHTML = `Khu v∆∞·ªùn c·ªßa b·∫°n ƒë√£ n·ªü ${score}/10 b√¥ng hoa!`;
  }

  restartBtn.addEventListener("click", startGame);

  // --- Hi·ªáu ·ª©ng ---
  function growFlower() {
    const flower = document.getElementById(
      `flower-${currentQuestionIndex + 1}`
    );
    if (flower) {
      flower.textContent =
        flowerEmojis[currentQuestionIndex % flowerEmojis.length];
      flower.classList.add("grown");
    }
  }

  function playEffect(type) {
    if (soundReady) {
      if (type === "correct") {
        correctSound.triggerAttackRelease("C5", "0.2", Tone.now());
        correctSound.triggerAttackRelease("G5", "0.2", Tone.now() + 0.1);
      } else {
        wrongSound.triggerAttackRelease("C3", "0.3", Tone.now());
      }
    }

    const effect = document.createElement("div");
    effect.classList.add("feedback-effect");
    effect.textContent = type === "correct" ? "üéâ" : "üò¢";
    feedbackContainer.appendChild(effect);
    effect.addEventListener("animationend", () => effect.remove());
  }
</script>
</body>
</html>
