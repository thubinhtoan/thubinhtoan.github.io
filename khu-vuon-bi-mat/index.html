<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cu·ªôc X√¢m LƒÉng - To√°n 9: Ti·∫øp tuy·∫øn</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- T·∫£i Tone.js cho √¢m thanh -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* CSS cho font v√† giao di·ªán chung */
        body {
            font-family: 'Inter', sans-serif;
            background: #0f0c29; /* N·ªÅn tr·ªùi ƒë√™m */
            background: -webkit-linear-gradient(to top, #24243e, #302b63, #0f0c29);
            background: linear-gradient(to top, #24243e, #302b63, #0f0c29);
            color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        /* Container ch√≠nh c·ªßa tr√≤ ch∆°i */
        #game-container {
            width: 100%;
            max-width: 700px; /* Thu h·∫πp l·∫°i cho game 1 ng∆∞·ªùi */
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Ti√™u ƒë·ªÅ */
        header {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 1.5rem 2rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
            color: #ff5e5e; /* M√†u ƒë·ªè b√°o ƒë·ªông */
            text-shadow: 0 0 10px #ff5e5e;
        }

        header p {
            font-size: 1rem;
            opacity: 0.8;
            margin-top: 0.25rem;
        }

        /* Khu v·ª±c hi·ªÉn th·ªã game (t√†u, l√° ch·∫Øn) */
        #game-area {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><g fill="%23fff" fill-opacity="0.1"><circle cx="25" cy="25" r="1.5"/><circle cx="50" cy="50" r="1.5"/><circle cx="75" cy="75" r="1.5"/><circle cx="10" cy="90" r="1.5"/><circle cx="90" cy="10" r="1.5"/></g></svg>') 0 0 / 50px 50px;
        }

        /* H·∫°m ƒë·ªôi UFO */
        #ufo-fleet {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
        }

        .ufo {
            font-size: 2.5rem;
            text-align: center;
            opacity: 1;
            transform: scale(1);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            filter: drop-shadow(0 0 5px #00f2ff);
        }

        .ufo.destroyed {
            opacity: 0;
            transform: scale(0) rotate(180deg);
        }

        /* L√° ch·∫Øn Tr√°i ƒê·∫•t */
        #shield-status {
            margin-top: 1.5rem;
        }
        
        #shield-label {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #00f2ff;
        }

        #shield-bar-container {
            width: 100%;
            height: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid #00f2ff;
            overflow: hidden;
        }

        #shield-bar {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #00f2ff 0%, #00c6ff 100%);
            border-radius: 8px;
            transition: width 0.5s ease-out;
            box-shadow: 0 0 10px #00f2ff;
        }
        
        /* Hi·ªáu ·ª©ng rung l·∫Øc khi b·ªã t·∫•n c√¥ng */
        @keyframes shake-wrong {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }
        .shake {
            animation: shake-wrong 0.4s;
        }


        /* Khu v·ª±c c√¢u h·ªèi */
        #quiz-area {
            padding: 2rem;
            background-color: rgba(0, 0, 0, 0.1);
        }

        #question-container {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        /* Hi·ªáu ·ª©ng ph·∫£n h·ªìi (n·ªï, v·ªó tay) */
        #feedback-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .feedback-effect {
            font-size: 6rem;
            opacity: 0;
            animation: fade-out-zoom 1s ease-out;
        }
        
        @keyframes fade-out-zoom {
            0% { opacity: 1; transform: scale(0.5); }
            100% { opacity: 0; transform: scale(2); }
        }

        /* Hi·ªÉn th·ªã m·ª©c ƒë·ªô c√¢u h·ªèi */
        #question-level {
            font-size: 0.875rem;
            font-weight: 600;
            color: #ffae42; /* M√†u cam */
            background-color: rgba(255, 174, 66, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            display: inline-block;
            margin-bottom: 0.75rem;
            border: 1px solid #ffae42;
        }

        /* N·ªôi dung c√¢u h·ªèi */
        #question-text {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* C√°c l·ª±a ch·ªçn tr·∫£ l·ªùi */
        #options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        /* N√∫t l·ª±a ch·ªçn */
        .option-btn {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 1rem;
            text-align: left;
            font-size: 1rem;
            font-weight: 500;
            color: #f0f2f5;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .option-btn:not(:disabled):hover {
            border-color: #00f2ff;
            background-color: rgba(0, 242, 255, 0.1);
        }
        .option-btn.selected {
            border-color: #ffae42;
            background-color: rgba(255, 174, 66, 0.2);
        }

        /* Tr·∫£ l·ªùi ƒë√∫ng/sai */
        .option-btn.correct {
            background-color: rgba(74, 222, 128, 0.2);
            border-color: #4ade80;
            color: #f0fdf4;
        }
        .option-btn.wrong {
            background-color: rgba(248, 113, 113, 0.2);
            border-color: #f87171;
            color: #fef2f2;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* N√∫t ƒëi·ªÅu khi·ªÉn (Ki·ªÉm tra / C√¢u ti·∫øp) */
        #controls {
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        #control-btn {
            background-color: #ff5e5e;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-shadow: 0 0 5px #ff5e5e;
            box-shadow: 0 4px 10px rgba(255, 94, 94, 0.3);
        }

        #control-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
            text-shadow: none;
        }

        #control-btn:not(:disabled):hover {
            background-color: #ff4747;
            transform: translateY(-2px);
        }

        /* M√†n h√¨nh k·∫øt th√∫c */
        #end-screen {
            display: none; /* ·∫®n ban ƒë·∫ßu */
            text-align: center;
            padding: 3rem 2rem;
        }

        #end-screen h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        #end-screen.victory h2 {
            color: #4ade80;
            text-shadow: 0 0 10px #4ade80;
        }
        #end-screen.defeat h2 {
            color: #f87171;
            text-shadow: 0 0 10px #f87171;
        }
        #end-score {
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }

        /* CSS cho responsive */
        @media (max-width: 640px) {
            body {
                padding: 0.5rem;
            }
            header h1 {
                font-size: 1.5rem;
            }
            #quiz-area {
                padding: 1.5rem;
            }
            #question-text {
                font-size: 1.125rem;
            }
            #game-area {
                padding: 1rem;
            }
            .ufo {
                font-size: 1.8rem;
            }
            #ufo-fleet {
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <header>
            <h1>Cu·ªôc X√¢m LƒÉng</h1>
            <p>B√†i 2: Ti·∫øp tuy·∫øn c·ªßa ƒë∆∞·ªùng tr√≤n - To√°n 9</p>
        </header>

        <!-- Khu v·ª±c hi·ªÉn th·ªã Game -->
        <div id="game-area">
            <!-- H·∫°m ƒë·ªôi UFO -->
            <div id="ufo-fleet">
                <div id="ufo-1" class="ufo">üõ∏</div>
                <div id="ufo-2" class="ufo">üõ∏</div>
                <div id="ufo-3" class="ufo">üõ∏</div>
                <div id="ufo-4" class="ufo">üõ∏</div>
                <div id="ufo-5" class="ufo">üõ∏</div>
                <div id="ufo-6" class="ufo">üõ∏</div>
                <div id="ufo-7" class="ufo">üõ∏</div>
                <div id="ufo-8" class="ufo">üõ∏</div>
                <div id="ufo-9" class="ufo">üõ∏</div>
                <div id="ufo-10" class="ufo">üõ∏</div>
            </div>
            <!-- L√° ch·∫Øn Tr√°i ƒê·∫•t -->
            <div id="shield-status">
                <div id="shield-label">NƒÇNG L∆Ø·ª¢NG L√Å CH·∫ÆN</div>
                <div id="shield-bar-container">
                    <div id="shield-bar"></div>
                </div>
            </div>
        </div>

        <!-- Khu V·ª±c C√¢u H·ªèi -->
        <div id="quiz-area">
            <div id="question-container">
                <div id="feedback-container"></div> <!-- ƒê·∫∑t ·ªü ƒë√¢y ƒë·ªÉ n·∫±m tr√™n c√¢u h·ªèi -->
                <span id="question-level">M·ª©c ƒë·ªô</span>
                <div id="question-text">ƒê√¢y l√† n·ªôi dung c√¢u h·ªèi...</div>
                <div id="options-container">
                    <!-- C√°c l·ª±a ch·ªçn s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                </div>
            </div>

            <div id="controls">
                <button id="control-btn" disabled>B·∫ÆN H·∫†</button>
            </div>
            
            <!-- M√†n h√¨nh k·∫øt th√∫c -->
            <div id="end-screen">
                <h2 id="end-title">CHI·∫æN TH·∫ÆNG!</h2>
                <p id="end-score">Tr√°i ƒê·∫•t ƒë√£ an to√†n!</p>
                <button id="restart-btn" class="mt-4 bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-blue-600 transition">Ch∆°i l·∫°i</button>
            </div>
        </div>
    </div>

    <script>
        // --- D·ªØ li·ªáu c√¢u h·ªèi (B√†i 2: Ti·∫øp tuy·∫øn) ---
        const questions = [
            // M·ª©c 1: Nh·∫≠n bi·∫øt
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "ƒê∆∞·ªùng th·∫≥ng $a$ v√† ƒë∆∞·ªùng tr√≤n $(O; R)$ c√≥ $d = R$ ($d$ l√† kho·∫£ng c√°ch t·ª´ $O$ ƒë·∫øn $a$). V·ªã tr√≠ c·ªßa $a$ v√† $(O)$ l√†:",
                options: [
                    { text: "C·∫Øt nhau", correct: false },
                    { text: "Ti·∫øp x√∫c", correct: true },
                    { text: "Kh√¥ng giao nhau", correct: false },
                    { text: "Tr√πng nhau", correct: false }
                ]
            },
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "ƒê∆∞·ªùng th·∫≥ng $a$ l√† ti·∫øp tuy·∫øn c·ªßa $(O; R)$ t·∫°i ti·∫øp ƒëi·ªÉm $A$ n·∫øu:",
                options: [
                    { text: "$a$ ƒëi qua $A$", correct: false },
                    { text: "$a$ vu√¥ng g√≥c v·ªõi $OA$", correct: false },
                    { text: "$a$ ƒëi qua $A$ v√† $a$ song song v·ªõi $OA$", correct: false },
                    { text: "$a$ ƒëi qua $A$ v√† $a$ vu√¥ng g√≥c v·ªõi $OA$ t·∫°i $A$", correct: true }
                ]
            },
            {
                level: "Nh·∫≠n bi·∫øt",
                text: "Cho $MA$ v√† $MB$ l√† hai ti·∫øp tuy·∫øn c·ªßa $(O)$ c·∫Øt nhau t·∫°i $M$ ($A, B$ l√† ti·∫øp ƒëi·ªÉm). Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y l√† **SAI**?",
                options: [
                    { text: "$MA = MB$", correct: false },
                    { text: "$MO$ l√† ph√¢n gi√°c $\\angle AMB$", correct: false },
                    { text: "$OM = AB$", correct: true },
                    { text: "$MO$ l√† ph√¢n gi√°c $\\angle AOB$", correct: false }
                ]
            },
            // M·ª©c 2: Th√¥ng hi·ªÉu
            {
                level: "Th√¥ng hi·ªÉu",
                text: "Cho ƒë∆∞·ªùng tr√≤n $(O; 6 \\text{ cm})$ v√† ƒë∆∞·ªùng th·∫≥ng $a$. Kho·∫£ng c√°ch $d$ t·ª´ $O$ ƒë·∫øn $a$ l√† $5 \\text{ cm}$. S·ªë ƒëi·ªÉm chung c·ªßa $a$ v√† $(O)$ l√†:",
                options: [
                    { text: "0", correct: false },
                    { text: "1", correct: false },
                    { text: "2", correct: true },
                    { text: "V√¥ s·ªë", correct: false }
                ]
            },
            {
                level: "Th√¥ng hi·ªÉu",
                text: "$MA, MB$ l√† hai ti·∫øp tuy·∫øn c·ªßa $(O)$ t·∫°i $A, B$. Bi·∫øt $\\angle AMB = 50^\\circ$. T√≠nh s·ªë ƒëo $\\angle AOM$.",
                options: [
                    { text: "$25^\\circ$", correct: false },
                    { text: "$50^\\circ$", correct: false },
                    { text: "$65^\\circ$", correct: true },
                    { text: "$40^\\circ$", correct: false }
                ]
            },
            {
                level: "Th√¥ng hi·ªÉu",
                text: "M·ªôt di·ªÖn vi√™n xi·∫øc ƒëi xe ƒë·∫°p m·ªôt b√°nh tr√™n d√¢y c√°p. N·∫øu ƒë∆∞·ªùng k√≠nh b√°nh xe l√† $60 \\text{ cm}$, kho·∫£ng c√°ch t·ª´ tr·ª•c b√°nh xe (t√¢m) ƒë·∫øn d√¢y c√°p l√† bao nhi√™u?",
                options: [
                    { text: "$60 \\text{ cm}$", correct: false },
                    { text: "$120 \\text{ cm}$", correct: false },
                    { text: "$30 \\text{ cm}$", correct: true },
                    { text: "$15 \\text{ cm}$", correct: false }
                ]
            },
            // M·ª©c 3: V·∫≠n d·ª•ng
            {
                level: "V·∫≠n d·ª•ng",
                text: "Cho ƒë∆∞·ªùng tr√≤n $(O; 5 \\text{ cm})$. T·ª´ ƒëi·ªÉm $M$ ·ªü ngo√†i $(O)$ v·∫Ω ti·∫øp tuy·∫øn $MA$ ($A$ l√† ti·∫øp ƒëi·ªÉm). Bi·∫øt $OM = 13 \\text{ cm}$. T√≠nh ƒë·ªô d√†i $MA$.",
                options: [
                    { text: "$12 \\text{ cm}$", correct: true },
                    { text: "$18 \\text{ cm}$", correct: false },
                    { text: "$8 \\text{ cm}$", correct: false },
                    { text: "$\\sqrt{194} \\text{ cm}$", correct: false }
                ]
            },
            {
                level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
                text: "M·ªôt v·ªá tinh ·ªü ƒë·ªô cao $h = 300 \\text{ km}$ so v·ªõi m·∫∑t ƒë·∫•t. B√°n k√≠nh Tr√°i ƒê·∫•t $R \\approx 6400 \\text{ km}$. T·∫ßm nh√¨n xa t·ªëi ƒëa m√† v·ªá tinh c√≥ th·ªÉ quan s√°t ƒë∆∞·ª£c tr√™n m·∫∑t ƒë·∫•t (ƒëo·∫°n $AC$ trong H√¨nh 7, SGK) l√† bao nhi√™u?",
                options: [
                    { text: "$\\approx 1982 \\text{ km}$", correct: true },
                    { text: "$\\approx 1960 \\text{ km}$", correct: false },
                    { text: "$\\approx 2100 \\text{ km}$", correct: false },
                    { text: "$\\approx 300 \\text{ km}$", correct: false }
                ]
            },
            {
                level: "V·∫≠n d·ª•ng",
                text: "Cho $MA, MB$ l√† hai ti·∫øp tuy·∫øn c·ªßa $(O)$ t·∫°i $A, B$. Bi·∫øt $\\angle AOB = 120^\\circ$. S·ªë ƒëo $\\angle AMB$ l√†:",
                options: [
                    { text: "$120^\\circ$", correct: false },
                    { text: "$90^\\circ$", correct: false },
                    { text: "$60^\\circ$", correct: true },
                    { text: "$30^\\circ$", correct: false }
                ]
            },
            // M·ª©c 4: V·∫≠n d·ª•ng cao
            {
                level: "V·∫≠n d·ª•ng cao",
                text: "Cho ƒë∆∞·ªùng tr√≤n $(O; R)$ v√† ƒëi·ªÉm $M$ sao cho $OM = 2R$. T·ª´ $M$ v·∫Ω hai ti·∫øp tuy·∫øn $MA, MB$. Tam gi√°c $MAB$ l√† tam gi√°c g√¨?",
                options: [
                    { text: "Tam gi√°c vu√¥ng", correct: false },
                    { text: "Tam gi√°c t√π", correct: false },
                    { text: "Tam gi√°c c√¢n (kh√¥ng ƒë·ªÅu)", correct: false },
                    { text: "Tam gi√°c ƒë·ªÅu", correct: true }
                ]
            }
        ];

        // --- Bi·∫øn tr·∫°ng th√°i tr√≤ ch∆°i ---
        let currentQuestionIndex = 0;
        let score = 0;
        let health = 5; // 5 m·∫°ng
        const MAX_HEALTH = 5;
        let selectedOption = null;
        let soundReady = false;

        // --- ƒê·ªëi t∆∞·ª£ng √¢m thanh ---
        let correctSound, wrongSound, explosionSound;

        // --- C√°c ph·∫ßn t·ª≠ DOM ---
        const gameContainer = document.getElementById('game-container');
        const questionContainer = document.getElementById('question-container');
        const questionLevelEl = document.getElementById('question-level');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const controlBtn = document.getElementById('control-btn');
        const feedbackContainer = document.getElementById('feedback-container');
        const endScreen = document.getElementById('end-screen');
        const endTitleEl = document.getElementById('end-title');
        const endScoreEl = document.getElementById('end-score');
        const restartBtn = document.getElementById('restart-btn');
        const shieldBar = document.getElementById('shield-bar');
        const controls = document.getElementById('controls');
        // --- H√†m kh·ªüi t·∫°o ---
        document.addEventListener('DOMContentLoaded', startGame);

        function startGame() {
            // Kh·ªüi t·∫°o √¢m thanh
            document.body.addEventListener('click', initAudio, { once: true });

            currentQuestionIndex = 0;
            score = 0;
            health = MAX_HEALTH;
            
            // ƒê·∫∑t l·∫°i UI
            endScreen.style.display = 'none';
            questionContainer.style.display = 'block';
            controls.style.display = 'flex';
            updateShieldBar();
            
            // ƒê·∫∑t l·∫°i UFO
            for (let i = 1; i <= 10; i++) {
                const ufo = document.getElementById(`ufo-${i}`);
                if (ufo) ufo.classList.remove('destroyed');
            }

            loadQuestion();
        }

        function initAudio() {
            if (soundReady) return;
            Tone.start();
            // √Çm thanh b·∫Øn laser (ƒë√∫ng)
            correctSound = new Tone.Synth({
                oscillator: { type: "sawtooth" },
                envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }
            }).toDestination();
            // √Çm thanh b·ªã b·∫Øn tr√∫ng (sai)
            wrongSound = new Tone.NoiseSynth({
                noise: { type: "brown" },
                envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.1 }
            }).toDestination();
            // √Çm thanh n·ªï (ph√° h·ªßy UFO)
            explosionSound = new Tone.NoiseSynth({
                noise: { type: "white" },
                envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }
            }).toDestination();
            soundReady = true;
        }

        // --- T·∫£i c√¢u h·ªèi ---
        function loadQuestion() {
            selectedOption = null;
            optionsContainer.innerHTML = '';

            if (currentQuestionIndex >= questions.length || health <= 0) {
                endGame();
                return;
            }

            const q = questions[currentQuestionIndex];

            questionLevelEl.textContent = `ƒê·ª£t t·∫•n c√¥ng: ${currentQuestionIndex + 1}/10 - ${q.level}`;
            questionTextEl.innerHTML = q.text;
            
            q.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.innerHTML = option.text;
                button.classList.add('option-btn');
                button.dataset.index = index;
                button.addEventListener('click', () => selectOption(button, index));
                optionsContainer.appendChild(button);
            });

            controlBtn.textContent = 'B·∫ÆN H·∫†';
            controlBtn.disabled = true;

            if (window.MathJax) {
                MathJax.typesetPromise([questionTextEl, optionsContainer]);
            }
        }

        // --- X·ª≠ l√Ω logic tr√≤ ch∆°i ---
        function selectOption(button, index) {
            const allOptions = document.querySelectorAll('.option-btn');
            allOptions.forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedOption = index;
            controlBtn.disabled = false;
        }

        controlBtn.addEventListener('click', () => {
            if (controlBtn.textContent === 'B·∫ÆN H·∫†') {
                checkAnswer();
            } else {
                nextQuestion();
            }
        });

        function checkAnswer() {
            const q = questions[currentQuestionIndex];
            const correctIndex = q.options.findIndex(opt => opt.correct);
            const allOptions = document.querySelectorAll('.option-btn');

            allOptions.forEach(btn => btn.disabled = true);
            controlBtn.textContent = 'Ti·∫øp t·ª•c';
            controlBtn.disabled = false;

            if (selectedOption == correctIndex) {
                // TR·∫¢ L·ªúI ƒê√öNG
                score++;
                allOptions[selectedOption].classList.add('correct');
                destroyUFO(currentQuestionIndex + 1);
                playEffect('correct');
            } else {
                // TR·∫¢ L·ªúI SAI
                health--;
                allOptions[selectedOption].classList.add('wrong');
                allOptions[correctIndex].classList.add('correct');
                updateShieldBar();
                playEffect('wrong');
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function endGame() {
            questionContainer.style.display = 'none';
            controls.style.display = 'none';
            endScreen.style.display = 'block';

            if (health > 0) {
                endScreen.classList.add('victory');
                endScreen.classList.remove('defeat');
                endTitleEl.textContent = 'CHI·∫æN TH·∫ÆNG!';
                endScoreEl.innerHTML = `B·∫°n ƒë√£ b·∫Øn h·∫° ${score} t√†u ƒë·ªãch. Tr√°i ƒê·∫•t ƒë√£ an to√†n!`;
            } else {
                endScreen.classList.add('defeat');
                endScreen.classList.remove('victory');
                endTitleEl.textContent = 'TH·∫§T B·∫†I!';
                endScoreEl.innerHTML = `L√° ch·∫Øn ƒë√£ b·ªã ph√° h·ªßy! B·∫°n b·∫Øn h·∫° ƒë∆∞·ª£c ${score} t√†u ƒë·ªãch.`;
            }
        }

        restartBtn.addEventListener('click', startGame);

        // --- Hi·ªáu ·ª©ng & C·∫≠p nh·∫≠t UI ---
        function destroyUFO(index) {
            const ufo = document.getElementById(`ufo-${index}`);
            if (ufo) ufo.classList.add('destroyed');
        }

        function updateShieldBar() {
            const shieldPercentage = (health / MAX_HEALTH) * 100;
            shieldBar.style.width = `${shieldPercentage}%`;
            if(shieldPercentage < 30) {
                shieldBar.style.background = "#ff5e5e"; // Chuy·ªÉn m√†u ƒë·ªè khi y·∫øu
            } else {
                shieldBar.style.background = "linear-gradient(90deg, #00f2ff 0%, #00c6ff 100%)";
            }
        }

        function playEffect(type) {
            // 1. √Çm thanh
            if (soundReady) {
                if (type === 'correct') {
                    correctSound.triggerAttackRelease("G5", "0.1", Tone.now());
                    explosionSound.triggerAttackRelease("0.1", Tone.now() + 0.1);
                } else {
                    wrongSound.triggerAttackRelease("0.2", Tone.now());
                }
            }

            // 2. Bi·ªÉu t∆∞·ª£ng
            const effect = document.createElement('div');
            effect.classList.add('feedback-effect');
            if (type === 'correct') {
                effect.textContent = 'üéâ'; // Bi·ªÉu t∆∞·ª£ng chi·∫øn th·∫Øng
            } else {
                effect.textContent = 'üí•'; // Bi·ªÉu t∆∞·ª£ng b·ªã b·∫Øn tr√∫ng
                gameContainer.classList.add('shake');
                setTimeout(() => gameContainer.classList.remove('shake'), 400);
            }
            feedbackContainer.appendChild(effect);

            effect.addEventListener('animationend', () => effect.remove());
        }

    </script>
    
    <!-- T·∫£i MathJax ƒë·ªÉ hi·ªÉn th·ªã LaTeX ƒë·∫πp -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</body>
</html>
