<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ª≠ T√†i Th·ªëng K√™ - To√°n 9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .option-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .option-card:hover:not(.disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .option-card.selected-correct {
            background-color: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .option-card.selected-wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .option-card.disabled {
            cursor: default;
            opacity: 0.7;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Audio Elements -->
    <audio id="correctSound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="wrongSound" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
    <audio id="bgMusic" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/123/123-preview.mp3" type="audio/mpeg">
    </audio>

    <div class="container max-w-4xl w-full">
        
        <!-- Start Screen -->
        <div id="start-screen" class="glass-panel p-8 md:p-12 text-center fade-in">
            <div class="mb-6">
                <i class="fa-solid fa-chart-pie text-6xl text-indigo-600 mb-4 animate-bounce"></i>
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 mb-2">Th·ª≠ T√†i Th·ªëng K√™</h1>
                <p class="text-xl text-gray-600 font-semibold">Ch∆∞∆°ng 7 - To√°n 9: B·∫£ng t·∫ßn s·ªë & Bi·ªÉu ƒë·ªì</p>
            </div>
            
            <div class="bg-indigo-50 rounded-xl p-6 mb-8 text-left mx-auto max-w-2xl">
                <h3 class="text-lg font-bold text-indigo-800 mb-2"><i class="fa-solid fa-circle-info mr-2"></i>Lu·∫≠t ch∆°i:</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>G·ªìm <strong>15 c√¢u h·ªèi</strong> tr·∫Øc nghi·ªám.</li>
                    <li>C√≥ 4 m·ª©c ƒë·ªô: Nh·∫≠n bi·∫øt, Th√¥ng hi·ªÉu, V·∫≠n d·ª•ng, V·∫≠n d·ª•ng cao.</li>
                    <li>Tr·∫£ l·ªùi ƒë√∫ng ƒë·ªÉ nh·∫≠n ƒëi·ªÉm v√† hi·ªáu ·ª©ng ch√∫c m·ª´ng!</li>
                    <li>M·ªói c√¢u h·ªèi s·∫Ω c√≥ gi·∫£i th√≠ch chi ti·∫øt sau khi tr·∫£ l·ªùi.</li>
                </ul>
            </div>

            <button onclick="startGame()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold py-4 px-10 rounded-full text-xl hover:shadow-lg transform hover:scale-105 transition duration-300">
                B·∫Øt ƒë·∫ßu ngay <i class="fa-solid fa-rocket ml-2"></i>
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="glass-panel p-6 md:p-8 hidden">
            <!-- Header -->
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <div>
                    <span class="text-sm font-bold text-indigo-500 uppercase tracking-wider">C√¢u h·ªèi</span>
                    <div class="text-2xl font-black text-gray-800"><span id="current-question-num">1</span>/15</div>
                </div>
                <div class="bg-indigo-100 px-4 py-2 rounded-lg">
                    <span class="text-sm font-bold text-indigo-600">ƒêi·ªÉm s·ªë: <span id="score" class="text-xl">0</span></span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-8">
                <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>

            <!-- Question Content -->
            <div class="mb-8">
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 leading-relaxed">
                    <!-- Question goes here -->
                </h2>
                <p id="hint-text" class="text-sm text-gray-500 mt-2 italic hidden"><i class="fa-regular fa-lightbulb mr-1 text-yellow-500"></i><span id="hint-content"></span></p>
            </div>

            <!-- Options Grid -->
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                <!-- Options will be injected here -->
            </div>

            <!-- Feedback Area (Rationale) -->
            <div id="feedback-area" class="hidden rounded-xl p-6 mb-6 transition-all duration-300 border-l-4">
                <div class="flex items-start">
                    <div id="feedback-icon" class="text-3xl mr-4 flex-shrink-0"></div>
                    <div>
                        <h4 id="feedback-title" class="font-bold text-lg mb-1"></h4>
                        <p id="feedback-content" class="text-gray-700"></p>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex justify-end">
                <button id="next-btn" onclick="nextQuestion()" class="hidden bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all">
                    C√¢u ti·∫øp theo <i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="glass-panel p-8 md:p-12 text-center hidden fade-in">
            <div class="mb-6 relative">
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                    <i class="fa-solid fa-trophy text-6xl text-yellow-400 drop-shadow-lg"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mt-12 mb-2">Ho√†n th√†nh!</h2>
                <p class="text-gray-600">B·∫°n ƒë√£ ho√†n th√†nh b√†i ki·ªÉm tra.</p>
            </div>

            <div class="bg-white rounded-2xl p-8 shadow-inner mb-8 max-w-sm mx-auto">
                <div class="text-sm text-gray-500 uppercase font-bold tracking-wide mb-2">T·ªïng ƒëi·ªÉm c·ªßa b·∫°n</div>
                <div class="text-6xl font-black text-indigo-600 mb-2"><span id="final-score">0</span><span class="text-2xl text-gray-400">/150</span></div>
                <div id="result-message" class="text-lg font-semibold text-indigo-500"></div>
            </div>

            <div class="flex flex-col md:flex-row justify-center gap-4">
                <button onclick="location.reload()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full transition-all">
                    <i class="fa-solid fa-rotate-right mr-2"></i> Ch∆°i l·∫°i
                </button>
                <button onclick="alert('C·∫£m ∆°n b·∫°n ƒë√£ tham gia!')" class="bg-white hover:bg-gray-50 text-indigo-600 border-2 border-indigo-600 font-bold py-3 px-8 rounded-full transition-all">
                    <i class="fa-solid fa-share-nodes mr-2"></i> Chia s·∫ª k·∫øt qu·∫£
                </button>
            </div>
        </div>

    </div>

   <script>
  // --- QUIZ DATA ---
  const quizData = [
    {
      question: "Trong th·ªëng k√™, 't·∫ßn s·ªë' c·ªßa m·ªôt gi√° tr·ªã x trong m·∫´u d·ªØ li·ªáu ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a l√† g√¨?",
      options: [
        "Gi√° tr·ªã c·ªßa x chia cho t·ªïng s·ªë d·ªØ li·ªáu.",
        "T·ªïng c√°c gi√° tr·ªã c√≥ trong m·∫´u d·ªØ li·ªáu.",
        "S·ªë l·∫ßn xu·∫•t hi·ªán c·ªßa gi√° tr·ªã x trong m·∫´u d·ªØ li·ªáu ƒë√≥.",
        "S·ªë l∆∞·ª£ng c√°c gi√° tr·ªã kh√°c nhau trong m·∫´u."
      ],
      correct: 2,
      rationale: "Ch√≠nh x√°c! üéâ T·∫ßn s·ªë ch√≠nh l√† s·ªë l·∫ßn m·ªôt gi√° tr·ªã c·ª• th·ªÉ ƒë∆∞·ª£c l·∫∑p l·∫°i trong t·∫≠p d·ªØ li·ªáu (s·ªë l·∫ßn xu·∫•t hi·ªán).",
      hint: "H√£y nh·ªõ l·∫°i ho·∫°t ƒë·ªông 'ki·ªÉm ƒë·∫øm' s·ªë l·∫ßn m·ªôt gi√° tr·ªã xu·∫•t hi·ªán."
    },
    {
      question: "Cho m·∫´u s·ªë li·ªáu: 6; 7; 8; 6; 9; 6; 7. Gi√° tr·ªã 6 c√≥ t·∫ßn s·ªë l√† bao nhi√™u?",
      options: ["2", "3", "4", "6"],
      correct: 1,
      rationale: "Tuy·ªát v·ªùi! üåü N·∫øu b·∫°n ƒë·∫øm, s·ªë 6 xu·∫•t hi·ªán ·ªü v·ªã tr√≠ th·ª© 1, th·ª© 4 v√† th·ª© 6. T·ªïng c·ªông l√† 3 l·∫ßn.",
      hint: "ƒê·∫øm xem s·ªë 6 xu·∫•t hi·ªán bao nhi√™u l·∫ßn trong danh s√°ch."
    },
    {
      question: "Trong b·∫£ng t·∫ßn s·ªë, t·ªïng c√°c t·∫ßn s·ªë c·ªßa t·∫•t c·∫£ c√°c gi√° tr·ªã lu√¥n b·∫±ng:",
      options: [
        "S·ªë c√°c ƒë∆°n v·ªã ƒëi·ªÅu tra (C·ª° m·∫´u N)",
        "100",
        "S·ªë gi√° tr·ªã kh√°c nhau c·ªßa m·∫´u",
        "Gi√° tr·ªã l·ªõn nh·∫•t trong m·∫´u"
      ],
      correct: 0,
      rationale: "Chu·∫©n x√°c! üëè T·ªïng c√°c t·∫ßn s·ªë ch√≠nh l√† t·ªïng s·ªë d·ªØ li·ªáu ƒë√£ thu th·∫≠p ƒë∆∞·ª£c, g·ªçi l√† c·ª° m·∫´u N.",
      hint: "N·∫øu b·∫°n c·ªông s·ªë l·∫ßn xu·∫•t hi·ªán c·ªßa t·∫•t c·∫£ c√°c gi√° tr·ªã l·∫°i, b·∫°n s·∫Ω ƒë∆∞·ª£c t·ªïng s·ªë g√¨?"
    },
    {
      question: "Bi·ªÉu ƒë·ªì t·∫ßn s·ªë d·∫°ng c·ªôt c√≥ ƒë·∫∑c ƒëi·ªÉm n√†o sau ƒë√¢y?",
      options: [
        "Tr·ª•c ho√†nh bi·ªÉu di·ªÖn t·∫ßn s·ªë, tr·ª•c tung bi·ªÉu di·ªÖn gi√° tr·ªã.",
        "C√°c c·ªôt n·ªëi v·ªõi nhau b·∫±ng c√°c ƒëo·∫°n th·∫≥ng g·∫•p kh√∫c.",
        "Lu√¥n c√≥ d·∫°ng h√¨nh tr√≤n.",
        "C√°c c·ªôt c√≥ chi·ªÅu r·ªông b·∫±ng nhau v√† chi·ªÅu cao t∆∞∆°ng ·ª©ng v·ªõi t·∫ßn s·ªë."
      ],
      correct: 3,
      rationale: "ƒê√∫ng r·ªìi! üéä Trong bi·ªÉu ƒë·ªì c·ªôt, chi·ªÅu cao c·ªßa c·ªôt th·ªÉ hi·ªán s·ªë l·∫ßn xu·∫•t hi·ªán (t·∫ßn s·ªë) c·ªßa gi√° tr·ªã ƒë√≥, v√† c√°c c·ªôt th∆∞·ªùng c√≥ ƒë·ªô r·ªông b·∫±ng nhau.",
      hint: "H√£y h√¨nh dung v·ªÅ c√°c h√¨nh ch·ªØ nh·∫≠t ƒë·ª©ng trong bi·ªÉu ƒë·ªì."
    },
    {
      question: "Trong bi·ªÉu ƒë·ªì t·∫ßn s·ªë d·∫°ng ƒëo·∫°n th·∫≥ng, c√°c ƒëi·ªÉm ƒë∆∞·ª£c x√°c ƒë·ªãnh b·ªüi c·∫∑p t·ªça ƒë·ªô n√†o?",
      options: [
        "(T·∫ßn s·ªë; Gi√° tr·ªã)",
        "(Gi√° tr·ªã; T·∫ßn s·ªë)",
        "(Gi√° tr·ªã; Gi√° tr·ªã)",
        "(T·∫ßn s·ªë; T·∫ßn s·ªë)"
      ],
      correct: 1,
      rationale: "Ch√≠nh x√°c! üåπ Tr·ª•c ho√†nh (ngang) th∆∞·ªùng l√† gi√° tr·ªã, tr·ª•c tung (ƒë·ª©ng) l√† t·∫ßn s·ªë, n√™n c·∫∑p t·ªça ƒë·ªô l√† (Gi√° tr·ªã; T·∫ßn s·ªë).",
      hint: "Tr·ª•c n·∫±m ngang (x) th∆∞·ªùng l√† Gi√° tr·ªã, tr·ª•c th·∫≥ng ƒë·ª©ng (y) th∆∞·ªùng l√† T·∫ßn s·ªë."
    },
    {
      question: "ƒê·ªÉ bi·∫øt gi√° tr·ªã n√†o xu·∫•t hi·ªán nhi·ªÅu nh·∫•t trong m·∫´u s·ªë li·ªáu d·ª±a v√†o bi·ªÉu ƒë·ªì c·ªôt, ta nh√¨n v√†o ƒë√¢u?",
      options: [
        "C·ªôt cao nh·∫•t.",
        "C·ªôt th·∫•p nh·∫•t.",
        "C·ªôt n·∫±m ngo√†i c√πng b√™n tr√°i.",
        "C·ªôt n·∫±m ngo√†i c√πng b√™n ph·∫£i."
      ],
      correct: 0,
      rationale: "Hoan h√¥! üåª C·ªôt cao nh·∫•t c√≥ chi·ªÅu cao l·ªõn nh·∫•t, t∆∞∆°ng ·ª©ng v·ªõi t·∫ßn s·ªë l·ªõn nh·∫•t (xu·∫•t hi·ªán nhi·ªÅu nh·∫•t).",
      hint: "T·∫ßn s·ªë c√†ng l·ªõn th√¨ c·ªôt c√†ng..."
    },
    {
      question: "Cho b·∫£ng t·∫ßn s·ªë ƒëi·ªÉm ki·ªÉm tra: ƒêi·ªÉm 8 (t·∫ßn s·ªë 5), ƒêi·ªÉm 9 (t·∫ßn s·ªë 3), ƒêi·ªÉm 10 (t·∫ßn s·ªë 2). C·ª° m·∫´u N l√† bao nhi√™u?",
      options: ["3", "10", "27", "30"],
      correct: 1,
      rationale: "ƒê√∫ng r·ªìi! üåü C·ª° m·∫´u N = T·ªïng t·∫ßn s·ªë = 5 + 3 + 2 = 10.",
      hint: "C·ªông t·∫•t c·∫£ c√°c t·∫ßn s·ªë l·∫°i v·ªõi nhau."
    },
    {
      question: "M·ªôt c·ª≠a h√†ng b√°n kem ghi l·∫°i s·ªë l∆∞·ª£ng kem b√°n ƒë∆∞·ª£c trong 5 ng√†y: 20, 15, 20, 25, 20. B·∫£ng t·∫ßn s·ªë n√†o sau ƒë√¢y ƒë√∫ng?",
      options: [
        "Gi√° tr·ªã: 15, 20, 25 | T·∫ßn s·ªë: 1, 2, 2",
        "Gi√° tr·ªã: 20, 15, 25 | T·∫ßn s·ªë: 20, 15, 25",
        "Gi√° tr·ªã: 15, 20, 25 | T·∫ßn s·ªë: 1, 3, 1",
        "Gi√° tr·ªã: 1, 2, 3 | T·∫ßn s·ªë: 15, 20, 25"
      ],
      correct: 2,
      rationale: "Tuy·ªát v·ªùi! üç¶ S·∫Øp x·∫øp l·∫°i: 15 (1 l·∫ßn), 20 (3 l·∫ßn), 25 (1 l·∫ßn).",
      hint: "ƒê·∫øm xem s·ªë 20 xu·∫•t hi·ªán m·∫•y l·∫ßn, s·ªë 15 m·∫•y l·∫ßn..."
    },
    {
      question: "Khi chuy·ªÉn t·ª´ b·∫£ng t·∫ßn s·ªë sang bi·ªÉu ƒë·ªì t·∫ßn s·ªë d·∫°ng ƒëo·∫°n th·∫≥ng, n·∫øu hai gi√° tr·ªã c√≥ t·∫ßn s·ªë b·∫±ng nhau th√¨ tr√™n bi·ªÉu ƒë·ªì ch√∫ng s·∫Ω nh∆∞ th·∫ø n√†o?",
      options: [
        "Hai ƒëi·ªÉm bi·ªÉu di·ªÖn s·∫Ω tr√πng nhau.",
        "Hai ƒëi·ªÉm bi·ªÉu di·ªÖn s·∫Ω n·∫±m tr√™n c√πng m·ªôt ƒë∆∞·ªùng n·∫±m ngang.",
        "Hai ƒëi·ªÉm bi·ªÉu di·ªÖn s·∫Ω n·∫±m tr√™n c√πng m·ªôt ƒë∆∞·ªùng th·∫≥ng ƒë·ª©ng.",
        "Kh√¥ng c√≥ m·ªëi li√™n h·ªá n√†o."
      ],
      correct: 1,
      rationale: "Ch√≠nh x√°c! üìè V√¨ c√≥ c√πng tung ƒë·ªô (t·∫ßn s·ªë) n√™n ch√∫ng c√≥ c√πng ƒë·ªô cao so v·ªõi tr·ª•c ho√†nh, t·ª©c l√† n·∫±m tr√™n c√πng m·ªôt ƒë∆∞·ªùng ngang.",
      hint: "T·∫ßn s·ªë ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng ƒë·ªô cao (tung ƒë·ªô) c·ªßa ƒëi·ªÉm."
    },
    {
      question: "Cho b·∫£ng t·∫ßn s·ªë l·ªói ch√≠nh t·∫£: 0 l·ªói (4 b·∫°n), 1 l·ªói (5 b·∫°n), 2 l·ªói (8 b·∫°n), 3 l·ªói (3 b·∫°n). S·ªë h·ªçc sinh m·∫Øc √≠t nh·∫•t 2 l·ªói l√† bao nhi√™u?",
      options: ["8", "3", "11", "20"],
      correct: 2,
      rationale: "ƒê√∫ng r·ªìi! üéâ '√çt nh·∫•t 2 l·ªói' nghƒ©a l√† m·∫Øc 2 l·ªói ho·∫∑c nhi·ªÅu h∆°n (3 l·ªói). S·ªë b·∫°n = 8 (m·∫Øc 2 l·ªói) + 3 (m·∫Øc 3 l·ªói) = 11.",
      hint: "√çt nh·∫•t 2 l·ªói nghƒ©a l√† s·ªë l·ªói >= 2. H√£y c·ªông t·∫ßn s·ªë c·ªßa c√°c gi√° tr·ªã 2 v√† 3."
    },
    {
      question: "Quan s√°t bi·ªÉu ƒë·ªì c·ªôt v·ªÅ s·ªë c√¢y tr·ªìng ƒë∆∞·ª£c: T·ªï 1 (10 c√¢y), T·ªï 2 (15 c√¢y), T·ªï 3 (12 c√¢y), T·ªï 4 (15 c√¢y). Nh·∫≠n x√©t n√†o ƒê√öNG?",
      options: [
        "T·ªï 1 tr·ªìng ƒë∆∞·ª£c nhi·ªÅu c√¢y nh·∫•t.",
        "T·ªï 3 tr·ªìng ƒë∆∞·ª£c √≠t c√¢y nh·∫•t.",
        "T·ªïng s·ªë c√¢y tr·ªìng ƒë∆∞·ª£c l√† 40.",
        "T·ªï 2 v√† T·ªï 4 tr·ªìng ƒë∆∞·ª£c s·ªë c√¢y b·∫±ng nhau v√† nhi·ªÅu nh·∫•t."
      ],
      correct: 3,
      rationale: "Ch√≠nh x√°c! üå≥ C·∫£ T·ªï 2 v√† T·ªï 4 ƒë·ªÅu tr·ªìng ƒë∆∞·ª£c 15 c√¢y v√† ƒë√¢y l√† m·ª©c cao nh·∫•t trong 4 t·ªï.",
      hint: "So s√°nh chi·ªÅu cao c·ªßa c√°c c·ªôt t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng t·ªï."
    },
    {
      question: "C·ª≠a h√†ng th·ªùi trang th·ªëng k√™ c·ª° √°o b√°n ra: S (10 c√°i), M (35 c√°i), L (15 c√°i), XL (5 c√°i). Ch·ªß c·ª≠a h√†ng n√™n ∆∞u ti√™n nh·∫≠p th√™m c·ª° √°o n√†o nh·∫•t?",
      options: ["C·ª° S", "C·ª° XL", "C·ª° M", "Nh·∫≠p ƒë·ªÅu c√°c c·ª°"],
      correct: 2,
      rationale: "Quy·∫øt ƒë·ªãnh s√°ng su·ªët! üëî C·ª° M c√≥ t·∫ßn s·ªë cao nh·∫•t (35), ch·ª©ng t·ªè nhu c·∫ßu kh√°ch h√†ng cao nh·∫•t, n√™n c·∫ßn nh·∫≠p nhi·ªÅu nh·∫•t.",
      hint: "Trong kinh doanh, ng∆∞·ªùi ta th∆∞·ªùng nh·∫≠p nhi·ªÅu h√†ng h√≥a lo·∫°i 'b√°n ch·∫°y nh·∫•t' (c√≥ t·∫ßn s·ªë cao nh·∫•t)."
    },
    {
      question: "Th·ªëng k√™ th·ªùi gian gi·∫£i to√°n (ph√∫t): 5, 7, 5, 8, 7, 5, 10, 6. C√≥ bao nhi√™u h·ªçc sinh gi·∫£i b√†i to√°n trong th·ªùi gian d∆∞·ªõi 7 ph√∫t?",
      options: ["3", "4", "5", "6"],
      correct: 1,
      rationale: "Ch√≠nh x√°c! ‚è±Ô∏è C√°c gi√° tr·ªã d∆∞·ªõi 7 l√†: 5, 5, 5, 6. T·ªïng c·ªông c√≥ 4 h·ªçc sinh.",
      hint: "Li·ªát k√™ c√°c gi√° tr·ªã nh·ªè h∆°n 7 trong d√£y s·ªë li·ªáu v√† ƒë·∫øm s·ªë l∆∞·ª£ng c·ªßa ch√∫ng."
    },
    {
      question: "M·ªôt b·∫£ng t·∫ßn s·ªë ghi l·∫°i s·ªë con trong 20 h·ªô gia ƒë√¨nh. T·∫ßn s·ªë c·ªßa c√°c h·ªô c√≥ 1 con l√† 8, 2 con l√† 10. T·∫ßn s·ªë c·ªßa h·ªô c√≥ 3 con b·ªã m·ªù. H√£y t√¨m t·∫ßn s·ªë ƒë√≥?",
      options: ["1", "2", "18", "0"],
      correct: 1,
      rationale: "Th√¥ng minh l·∫Øm! üß© T·ªïng s·ªë h·ªô (N) l√† 20. S·ªë h·ªô ƒë√£ bi·∫øt l√† 8 + 10 = 18. V·∫≠y s·ªë h·ªô c√≤n l·∫°i l√† 20 - 18 = 2.",
      hint: "T·ªïng c√°c t·∫ßn s·ªë ph·∫£i b·∫±ng k√≠ch th∆∞·ªõc m·∫´u N (·ªü ƒë√¢y N=20)."
    },
    {
      question: "Cho bi·ªÉu ƒë·ªì c·ªôt s·ªë huy ch∆∞∆°ng v√†ng: C·ªôt A cao g·∫•p ƒë√¥i B. C·ªôt C cao b·∫±ng B. C·ªôt D th·∫•p nh·∫•t (kh√°c 0). T·ªïng l√† 25, B c√≥ 5 huy ch∆∞∆°ng. H·ªèi ƒëo√†n D c√≥ bao nhi√™u huy ch∆∞∆°ng?",
      options: [
        "5",
        "C√≥ l·ªói trong d·ªØ ki·ªán ƒë·ªÅ b√†i (D kh√¥ng th·ªÉ v·ª´a b·∫±ng 5 m√† v·∫´n 'th·∫•p nh·∫•t').",
        "2",
        "10"
      ],
      correct: 1,
      rationale: "ƒê√¢y l√† c√¢u b·∫´y logic üïµÔ∏è‚Äç‚ôÇÔ∏è: B=5 ‚áí A=10, C=5 ‚áí A+B+C=20 ‚áí D=25-20=5. Nh∆∞ng n·∫øu D=5 th√¨ D b·∫±ng B v√† C, kh√¥ng th·ªèa ƒëi·ªÅu ki·ªán 'D th·∫•p nh·∫•t'. V·∫≠y d·ªØ ki·ªán m√¢u thu·∫´n.",
      hint: "T√≠nh D tr∆∞·ªõc, r·ªìi ki·ªÉm tra l·∫°i ƒëi·ªÅu ki·ªán 'D th·∫•p nh·∫•t'."
    }
  ];

  // --- GAME VARIABLES ---
  let currentQuestionIndex = 0;
  let score = 0;
  let answered = false;

  // L∆∞u ph∆∞∆°ng √°n sau khi random ƒë·ªÉ ch·∫•m ƒë√∫ng
  let currentOptionsShuffled = [];
  let currentCorrectIndex = 0;

  // --- DOM ELEMENTS ---
  const startScreen = document.getElementById('start-screen');
  const quizScreen = document.getElementById('quiz-screen');
  const resultScreen = document.getElementById('result-screen');
  const questionText = document.getElementById('question-text');
  const optionsContainer = document.getElementById('options-container');
  const scoreEl = document.getElementById('score');
  const progressBar = document.getElementById('progress-bar');
  const currentQNum = document.getElementById('current-question-num');
  const feedbackArea = document.getElementById('feedback-area');
  const feedbackTitle = document.getElementById('feedback-title');
  const feedbackContent = document.getElementById('feedback-content');
  const feedbackIcon = document.getElementById('feedback-icon');
  const nextBtn = document.getElementById('next-btn');
  const hintText = document.getElementById('hint-text');
  const hintContent = document.getElementById('hint-content');

  // Sounds
  const correctSound = document.getElementById('correctSound');
  const wrongSound = document.getElementById('wrongSound');

  // --- HELPERS ---
  function shuffleInPlace(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // --- FUNCTIONS ---
  function startGame() {
    startScreen.classList.add('hidden');
    quizScreen.classList.remove('hidden');
    quizScreen.classList.add('fade-in');

    // Reset state
    currentQuestionIndex = 0;
    score = 0;
    scoreEl.innerText = score;

    loadQuestion();
  }

  function loadQuestion() {
    const data = quizData[currentQuestionIndex];

    // Update UI
    currentQNum.innerText = currentQuestionIndex + 1;
    questionText.innerText = data.question;
    progressBar.style.width = `${(currentQuestionIndex / quizData.length) * 100}%`;

    // Reset feedback & buttons
    feedbackArea.classList.add('hidden');
    nextBtn.classList.add('hidden');
    answered = false;

    // Hint
    if (data.hint && data.hint.trim() !== "") {
      hintText.classList.remove('hidden');
      hintContent.innerText = data.hint;
    } else {
      hintText.classList.add('hidden');
      hintContent.innerText = "";
    }

    // --- RANDOM th·ª© t·ª± ƒë√°p √°n (v√† c·∫≠p nh·∫≠t correct) ---
    const objects = data.options.map((text, idx) => ({
      text,
      isCorrect: idx === data.correct
    }));
    shuffleInPlace(objects);

    currentOptionsShuffled = objects.map(o => o.text);
    currentCorrectIndex = objects.findIndex(o => o.isCorrect);

    // Render Options
    optionsContainer.innerHTML = '';
    currentOptionsShuffled.forEach((opt, index) => {
      const btn = document.createElement('div');
      btn.className =
        'option-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md font-semibold text-gray-700 flex items-center';
      btn.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center mr-3 font-bold text-gray-500 border border-gray-300">
          ${String.fromCharCode(65 + index)}
        </div>
        <span>${opt}</span>
      `;
      btn.onclick = () => checkAnswer(index, btn);
      optionsContainer.appendChild(btn);
    });
  }

  function checkAnswer(selectedIndex, btnElement) {
    if (answered) return;
    answered = true;

    const data = quizData[currentQuestionIndex];
    const isCorrect = selectedIndex === currentCorrectIndex;
    const options = optionsContainer.children;

    // Highlight answers
    if (isCorrect) {
      btnElement.classList.add('selected-correct');
      btnElement.querySelector('div').className =
        "w-8 h-8 rounded-full bg-green-500 flex items-center justify-center mr-3 font-bold text-white border border-green-500";
      btnElement.querySelector('div').innerHTML = '<i class="fa-solid fa-check"></i>';

      score += 10;
      scoreEl.innerText = score;
      playCorrectEffect();
    } else {
      btnElement.classList.add('selected-wrong');
      btnElement.querySelector('div').className =
        "w-8 h-8 rounded-full bg-red-500 flex items-center justify-center mr-3 font-bold text-white border border-red-500";
      btnElement.querySelector('div').innerHTML = '<i class="fa-solid fa-xmark"></i>';

      // Highlight correct answer
      const correctBtn = options[currentCorrectIndex];
      correctBtn.classList.add('selected-correct');
      correctBtn.querySelector('div').className =
        "w-8 h-8 rounded-full bg-green-500 flex items-center justify-center mr-3 font-bold text-white border border-green-500";
      correctBtn.querySelector('div').innerHTML = '<i class="fa-solid fa-check"></i>';

      playWrongEffect();
    }

    // Disable all options
    for (let btn of options) {
      btn.classList.add('disabled');
    }

    // Show Feedback (Rationale)
    showFeedback(isCorrect, data.rationale);
    nextBtn.classList.remove('hidden');

    // Update progress bar
    progressBar.style.width = `${((currentQuestionIndex + 1) / quizData.length) * 100}%`;
  }

  function showFeedback(isCorrect, rationaleText) {
    feedbackArea.classList.remove('hidden');
    if (isCorrect) {
      feedbackArea.className =
        "rounded-xl p-6 mb-6 transition-all duration-300 border-l-4 bg-green-50 border-green-500 fade-in";
      feedbackIcon.innerHTML = '<i class="fa-solid fa-face-laugh-beam text-green-500"></i>';
      feedbackTitle.innerText = "Ch√≠nh x√°c!";
      feedbackTitle.className = "font-bold text-lg mb-1 text-green-700";
    } else {
      feedbackArea.className =
        "rounded-xl p-6 mb-6 transition-all duration-300 border-l-4 bg-red-50 border-red-500 fade-in";
      feedbackIcon.innerHTML = '<i class="fa-solid fa-face-frown-open text-red-500"></i>';
      feedbackTitle.innerText = "Ch∆∞a ƒë√∫ng r·ªìi!";
      feedbackTitle.className = "font-bold text-lg mb-1 text-red-700";
    }
    feedbackContent.innerText = rationaleText;
  }

  function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < quizData.length) {
      loadQuestion();
    } else {
      showResults();
    }
  }

  function showResults() {
    quizScreen.classList.add('hidden');
    resultScreen.classList.remove('hidden');

    const finalScoreEl = document.getElementById('final-score');
    const resultMessage = document.getElementById('result-message');

    // FIX l·ªói score=0 b·ªã nh·∫£y l√™n 1
    let currentScoreDisplay = 0;
    finalScoreEl.innerText = 0;

    const interval = setInterval(() => {
      if (currentScoreDisplay >= score) {
        clearInterval(interval);
        triggerBigConfetti();
        return;
      }
      currentScoreDisplay += 1;
      finalScoreEl.innerText = currentScoreDisplay;
    }, 20);

    // Message based on score
    if (score === 150) {
      resultMessage.innerText = "Tuy·ªát ƒë·ªëi! B·∫°n l√† chuy√™n gia th·ªëng k√™! üèÜ";
    } else if (score >= 120) {
      resultMessage.innerText = "R·∫•t t·ªët! Ki·∫øn th·ª©c v·ªØng v√†ng! üåü";
    } else if (score >= 80) {
      resultMessage.innerText = "Kh√° l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üëç";
    } else {
      resultMessage.innerText = "H√£y √¥n l·∫°i b√†i v√† th·ª≠ l·∫°i nh√©! üí™";
    }
  }

  // --- EFFECTS ---
  function playCorrectEffect() {
    correctSound.currentTime = 0;
    correctSound.play().catch(e => console.log("Audio play prevented"));

    confetti({
      particleCount: 50,
      spread: 60,
      origin: { y: 0.7 },
      colors: ['#10b981', '#34d399', '#6ee7b7']
    });
  }

  function playWrongEffect() {
    wrongSound.currentTime = 0;
    wrongSound.play().catch(e => console.log("Audio play prevented"));

    const container = document.getElementById('options-container');
    container.classList.add('animate-pulse');
    setTimeout(() => container.classList.remove('animate-pulse'), 500);
  }

  function triggerBigConfetti() {
    var duration = 3000;
    var end = Date.now() + duration;

    (function frame() {
      confetti({
        particleCount: 5,
        angle: 60,
        spread: 55,
        origin: { x: 0 },
        colors: ['#6366f1', '#ec4899', '#10b981', '#f59e0b']
      });
      confetti({
        particleCount: 5,
        angle: 120,
        spread: 55,
        origin: { x: 1 },
        colors: ['#6366f1', '#ec4899', '#10b981', '#f59e0b']
      });

      if (Date.now() < end) requestAnimationFrame(frame);
    })();
  }
</script>
</body>
</html>
