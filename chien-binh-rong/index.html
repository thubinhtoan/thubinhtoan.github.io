<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi·∫øn Binh R·ªìng - To√°n 9 (B√†i 4)</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- T·∫£i Tone.js ƒë·ªÉ t·∫°o √¢m thanh -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        
        #game-container {
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hp-bar-inner {
            transition: width 0.5s ease-in-out;
        }

        .option-btn {
            transition: all 0.3s ease;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .flash-correct {
            animation: flash 0.5s ease;
        }

        @keyframes flash {
            0% { box-shadow: 0 0 20px 10px rgba(76, 175, 80, 0.7); }
            100% { box-shadow: none; }
        }
        
        #feedback-icon {
            position: absolute;
            font-size: 3rem;
            animation: burst 0.8s ease-out forwards;
            opacity: 0;
            z-index: 100;
        }

        @keyframes burst {
            0% { transform: scale(0.1); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0; top: -100px; }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
            animation: fall 3s ease-out forwards;
        }

        @keyframes fall {
            0% { opacity: 1; transform: translateY(0) rotateZ(0); }
            100% { opacity: 0; transform: translateY(400px) rotateZ(360deg); }
        }
        
        #end-screen {
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .attack-player {
            animation: attackPlayer 0.5s ease;
        }
        @keyframes attackPlayer {
            0% { transform: translateX(0); }
            50% { transform: translateX(-30px); }
            100% { transform: translateX(0); }
        }
        .attack-monster {
            animation: attackMonster 0.5s ease;
        }
        @keyframes attackMonster {
            0% { transform: translateX(0); }
            50% { transform: translateX(30px); }
            100% { transform: translateX(0); }
        }

    </style>
</head>
<body class="bg-gray-900 text-white">

    <div id="game-container" class="min-h-screen w-full flex flex-col items-center justify-center p-4 relative">
        
        <!-- M√†n h√¨nh b·∫Øt ƒë·∫ßu -->
        <div id="start-screen" class="text-center">
            <h1 class="text-5xl font-bold mb-4 text-yellow-300">Chi·∫øn Binh R·ªìng</h1>
            <p class="text-xl mb-8 text-gray-200">Gi√∫p chi·∫øn binh ti√™u di·ªát qu√°i v·∫≠t b·∫±ng ki·∫øn th·ª©c To√°n 9!</p>
            <button id="start-btn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg text-2xl shadow-lg transition duration-300">
                B·∫Øt ƒë·∫ßu!
            </button>
        </div>

        <!-- M√†n h√¨nh tr√≤ ch∆°i -->
        <div id="game-screen" class="hidden w-full max-w-4xl">
            
            <!-- Thanh HP -->
            <div class="flex justify-between items-center mb-6 px-4">
                <!-- Chi·∫øn binh -->
                <div class="w-2/5 text-center">
                    <span id="player-sprite" class="text-6xl">‚öîÔ∏è</span>
                    <h2 class="text-xl font-bold text-blue-300">Chi·∫øn Binh</h2>
                    <div class="bg-gray-700 rounded-full h-4 overflow-hidden shadow-inner">
                        <div id="player-hp-bar" class="hp-bar-inner bg-green-500 h-4" style="width: 100%;"></div>
                    </div>
                    <span id="player-hp-text" class="text-sm">100/100</span>
                </div>
                
                <div class="text-2xl font-bold text-red-500">VS</div>
                
                <!-- Qu√°i v·∫≠t -->
                <div class="w-2/5 text-center">
                    <span id="monster-sprite" class="text-6xl">üê≤</span>
                    <h2 class="text-xl font-bold text-red-300">Qu√°i V·∫≠t</h2>
                    <div class="bg-gray-700 rounded-full h-4 overflow-hidden shadow-inner">
                        <div id="monster-hp-bar" class="hp-bar-inner bg-red-500 h-4" style="width: 100%;"></div>
                    </div>
                    <span id="monster-hp-text" class="text-sm">100/100</span>
                </div>
            </div>

            <!-- C√¢u h·ªèi -->
            <div class="bg-gray-800 bg-opacity-70 p-6 rounded-lg shadow-2xl text-center mb-6">
                <p class="text-gray-400 text-sm mb-2">
                    C√¢u <span id="question-number">1</span> / 15
                </p>
                <p id="question-text" class="text-xl md:text-2xl font-semibold min-h-[100px]">
                    N·ªôi dung c√¢u h·ªèi s·∫Ω ·ªü ƒë√¢y...
                </p>
            </div>

            <!-- ƒê√°p √°n -->
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- JS ch√®n v√†o ƒë√¢y -->
            </div>
            
            <!-- Icon ph·∫£n h·ªìi -->
            <div id="feedback-icon-container" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none">
                <div id="feedback-icon"></div>
            </div>
            
            <!-- Ph√°o hoa -->
            <div id="confetti-container" class="absolute top-0 left-0 w-full h-full pointer-events-none"></div>

        </div>

        <!-- M√†n h√¨nh k·∫øt th√∫c -->
        <div id="end-screen" class="hidden absolute inset-0 flex flex-col items-center justify-center text-center p-8 z-50">
            <h2 id="end-title" class="text-5xl font-bold mb-4">Ch√∫c m·ª´ng!</h2>
            <p id="end-message" class="text-2xl mb-8">B·∫°n ƒë√£ ti√™u di·ªát qu√°i v·∫≠t!</p>
            <p id="end-score" class="text-3xl mb-10">ƒêi·ªÉm c·ªßa b·∫°n: <span id="score-text">0</span></p>
            <button id="restart-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-2xl shadow-lg transition duration-300">
                Ch∆°i l·∫°i
            </button>
        </div>

    </div>

    <script>
        // 1. DANH S√ÅCH C√ÇU H·ªéI ‚Äì 15 C√ÇU
        const questions = [
            // M·ª©c 1: Nh·∫≠n bi·∫øt (6 c√¢u)
            {
                level: 1,
                question: "H√¨nh qu·∫°t tr√≤n l√† m·ªôt ph·∫ßn h√¨nh tr√≤n ƒë∆∞·ª£c gi·ªõi h·∫°n b·ªüi hai b√°n k√≠nh v√†...",
                options: ["...cung tr√≤n t∆∞∆°ng ·ª©ng.", "...m·ªôt d√¢y cung.", "...ƒë∆∞·ªùng k√≠nh.", "...m·ªôt ti·∫øp tuy·∫øn."],
                answer: 0
            },
            {
                level: 1,
                question: "C√¥ng th·ª©c t√≠nh ƒë·ªô d√†i cung tr√≤n n ƒë·ªô, b√°n k√≠nh R l√†:",
                options: ["l = (pi * R * n) / 180", "l = (pi * R^2 * n) / 180", "l = (pi * R * n) / 360", "l = 2 * pi * R * n"],
                answer: 0
            },
            {
                level: 1,
                question: "C√¥ng th·ª©c t√≠nh di·ªán t√≠ch h√¨nh qu·∫°t tr√≤n b√°n k√≠nh R, cung n ƒë·ªô l√†:",
                options: ["S = (pi * R * n) / 360", "S = (pi * R^2 * n) / 180", "S = (pi * R^2 * n) / 360", "S = (pi * R^2 * n) / 120"],
                answer: 2
            },
            {
                level: 1,
                question: "N·∫øu bi·∫øt ƒë·ªô d√†i cung l√† l v√† b√°n k√≠nh l√† R, di·ªán t√≠ch h√¨nh qu·∫°t tr√≤n (S) c√≤n ƒë∆∞·ª£c t√≠nh b·∫±ng c√¥ng th·ª©c:",
                options: ["S = l * R", "S = (l * R) / 2", "S = (l * R^2) / 2", "S = 2 * l * R"],
                answer: 1
            },
            {
                level: 1,
                question: "H√¨nh v√†nh khuy√™n l√† ph·∫ßn m·∫∑t ph·∫≥ng n·∫±m gi·ªØa hai h√¨nh tr√≤n...",
                options: ["...c√≥ c√πng t√¢m (ƒë·ªìng t√¢m).", "...c·∫Øt nhau t·∫°i hai ƒëi·ªÉm.", "...ti·∫øp x√∫c ngo√†i.", "...kh√¥ng giao nhau."],
                answer: 0
            },
            {
                level: 1,
                question: "C√¥ng th·ª©c t√≠nh di·ªán t√≠ch h√¨nh v√†nh khuy√™n v·ªõi b√°n k√≠nh v√≤ng ngo√†i R, b√°n k√≠nh v√≤ng trong r l√†:",
                options: ["S = pi * (R^2 + r^2)", "S = pi * (R - r)^2", "S = pi * (R^2 - r^2)", "S = pi * R^2 - pi * r"],
                answer: 2
            },
            // M·ª©c 2: Th√¥ng hi·ªÉu (5 c√¢u)
            {
                level: 2,
                question: "T√≠nh ƒë·ªô d√†i cung 60 ƒë·ªô c·ªßa m·ªôt ƒë∆∞·ªùng tr√≤n c√≥ b√°n k√≠nh 6 cm.",
                options: ["2*pi cm", "pi cm", "3*pi cm", "6*pi cm"],
                answer: 0
            },
            {
                level: 2,
                question: "T√≠nh di·ªán t√≠ch h√¨nh qu·∫°t tr√≤n c√≥ b√°n k√≠nh 10 cm, s·ªë ƒëo cung l√† 90 ƒë·ªô.",
                options: ["100*pi cm^2", "50*pi cm^2", "25*pi cm^2", "10*pi cm^2"],
                answer: 2
            },
            {
                level: 2,
                question: "M·ªôt h√¨nh qu·∫°t tr√≤n c√≥ b√°n k√≠nh 8 cm v√† ƒë·ªô d√†i cung t∆∞∆°ng ·ª©ng l√† 4*pi cm. Di·ªán t√≠ch c·ªßa n√≥ l√†:",
                options: ["16*pi cm^2", "32*pi cm^2", "8*pi cm^2", "64*pi cm^2"],
                answer: 0
            },
            {
                level: 2,
                question: "T√≠nh di·ªán t√≠ch h√¨nh v√†nh khuy√™n gi·ªõi h·∫°n b·ªüi hai ƒë∆∞·ªùng tr√≤n ƒë·ªìng t√¢m c√≥ b√°n k√≠nh l·∫ßn l∆∞·ª£t l√† 5 cm v√† 3 cm.",
                options: ["4*pi cm^2", "16*pi cm^2", "34*pi cm^2", "8*pi cm^2"],
                answer: 1
            },
            {
                level: 2,
                question: "M·ªôt h√¨nh qu·∫°t tr√≤n c√≥ di·ªán t√≠ch l√† 36*pi cm^2 v√† b√°n k√≠nh l√† 12 cm. S·ªë ƒëo n c·ªßa cung tr√≤n ƒë√≥ l√†:",
                options: ["n = 60 ƒë·ªô", "n = 120 ƒë·ªô", "n = 90 ƒë·ªô", "n = 30 ƒë·ªô"],
                answer: 2
            },
            // M·ª©c 3: V·∫≠n d·ª•ng (3 c√¢u)
            {
                level: 3,
                question: "M·ªôt b√°nh xe lƒÉn 100 v√≤ng th√¨ ƒëi ƒë∆∞·ª£c qu√£ng ƒë∆∞·ªùng 188,4 m. T√≠nh b√°n k√≠nh c·ªßa b√°nh xe (l·∫•y pi = 3,14).",
                options: ["R = 0,3 m", "R = 0,6 m", "R = 3 m", "R = 6 m"],
                answer: 0
            },
            {
                level: 3,
                question: "Di·ªán t√≠ch h√¨nh v√†nh khuy√™n l√† 64*pi cm^2. T·ªâ s·ªë gi·ªØa b√°n k√≠nh ngo√†i (R) v√† b√°n k√≠nh trong (r) l√† R/r = 5/3. T√≠nh b√°n k√≠nh ngo√†i R.",
                options: ["R = 8 cm", "R = 10 cm", "R = 12 cm", "R = 15 cm"],
                answer: 1
            },
            {
                level: 3,
                question: "M·ªôt c√°i b√†n tr√≤n c√≥ b√°n k√≠nh 1 m. Ng∆∞·ªùi ta mu·ªën ph·ªß m·ªôt khƒÉn tr·∫£i b√†n h√¨nh v√†nh khuy√™n sao cho khƒÉn r·ªß xu·ªëng kh·ªèi m√©p b√†n 0,2 m. Di·ªán t√≠ch khƒÉn tr·∫£i b√†n l√†:",
                options: ["0,44*pi m^2", "0,40*pi m^2", "1*pi m^2", "1,44*pi m^2"],
                answer: 0
            },
            // M·ª©c 4: V·∫≠n d·ª•ng cao (1 c√¢u)
            {
                level: 4,
                question: "Cho ƒë∆∞·ªùng tr√≤n (O; 6 cm) v√† m·ªôt h√¨nh qu·∫°t tr√≤n AOB t·ª´ ƒë∆∞·ªùng tr√≤n ƒë√≥ v·ªõi s·ªë ƒëo cung l√† 60 ƒë·ªô. Di·ªán t√≠ch c·ªßa ph·∫ßn h√¨nh v√†nh khuy√™n t·∫°o b·ªüi cung AB v√† cung CD (C, D thu·ªôc OA, OB v√† OC = OD = 2 cm) l√†:",
                options: ["32*pi/3 cm^2", "16*pi/3 cm^2", "16*pi cm^2", "8*pi cm^2"],
                answer: 1
            }
        ];

        const TOTAL_QUESTIONS = questions.length; // = 15

        // 2. BI·∫æN TR·∫†NG TH√ÅI
        let currentQuestionIndex = 0;
        let score = 0;
        let playerHP = 100;
        let monsterHP = 100;
        let questionsPerMonster = 5;
        let monsterIndex = 1;
        let audioContextStarted = false;

        // 3. DOM
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        const questionNumber = document.getElementById('question-number');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        
        const playerHPBar = document.getElementById('player-hp-bar');
        const playerHPText = document.getElementById('player-hp-text');
        const monsterHPBar = document.getElementById('monster-hp-bar');
        const monsterHPText = document.getElementById('monster-hp-text');
        const playerSprite = document.getElementById('player-sprite');
        const monsterSprite = document.getElementById('monster-sprite');
        
        const feedbackIconContainer = document.getElementById('feedback-icon-container');
        const confettiContainer = document.getElementById('confetti-container');

        const endTitle = document.getElementById('end-title');
        const endMessage = document.getElementById('end-message');
        const scoreText = document.getElementById('score-text');

        // 4. √ÇM THANH
        let correctSynth, wrongSynth;

        async function setupAudio() {
            if (audioContextStarted) return;
            await Tone.start();
            
            correctSynth = new Tone.PolySynth(Tone.Synth, {
                volume: -10,
                oscillator: { type: "sine" },
                envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 0.4 }
            }).toDestination();

            wrongSynth = new Tone.PolySynth(Tone.Synth, {
                volume: -10,
                oscillator: { type: "square" },
                envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.2 }
            }).toDestination();
            
            audioContextStarted = true;
        }

        function playCorrectSound() {
            if (!audioContextStarted) return;
            const now = Tone.now();
            correctSynth.triggerAttackRelease("C4", "8n", now);
            correctSynth.triggerAttackRelease("E4", "8n", now + 0.1);
            correctSynth.triggerAttackRelease("G4", "8n", now + 0.2);
        }

        function playWrongSound() {
            if (!audioContextStarted) return;
            const now = Tone.now();
            wrongSynth.triggerAttackRelease("C3", "8n", now);
            wrongSynth.triggerAttackRelease("B2", "8n", now + 0.1);
        }
        
        // 5. HI·ªÜU ·ª®NG H√åNH ·∫¢NH
        function showFeedback(isCorrect) {
            const icon = document.getElementById('feedback-icon');
            icon.innerText = isCorrect ? 'üòÑ' : 'üòµ';
            icon.style.animation = 'none';
            icon.offsetHeight;
            icon.style.animation = 'burst 0.8s ease-out forwards';

            if (isCorrect) {
                createConfetti();
            }
        }
        
        function createConfetti() {
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = `${Math.random() * 50 + 25}%`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.animationDelay = `${Math.random() * 0.2}s`;
                confettiContainer.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        // 6. LOGIC TR√í CH∆†I
        function startGame() {
            if (!audioContextStarted) {
                setupAudio();
            }
            
            currentQuestionIndex = 0;
            score = 0;
            playerHP = 100;
            monsterHP = 100;
            monsterIndex = 1;
            
            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            updateHPBars();
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                endGame(true);
                return;
            }

            const q = questions[currentQuestionIndex];
            
            monsterIndex = Math.floor(currentQuestionIndex / questionsPerMonster) + 1;
            monsterSprite.innerText = ['üê≤', 'üëπ', 'üî•'][monsterIndex - 1] || 'üê≤';

            questionNumber.innerText = `${currentQuestionIndex + 1}`;
            questionText.innerText = q.question;
            
            optionsContainer.innerHTML = '';
            
            q.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.innerText = option;
                button.classList.add(
                    'option-btn',
                    'w-full',
                    'bg-blue-600',
                    'hover:bg-blue-800',
                    'text-white',
                    'font-semibold',
                    'py-3',
                    'px-4',
                    'rounded-lg',
                    'shadow-md'
                );
                button.onclick = () => handleAnswer(index);
                optionsContainer.appendChild(button);
            });
        }

        function handleAnswer(selectedIndex) {
            const q = questions[currentQuestionIndex];
            const isCorrect = selectedIndex === q.answer;
            
            optionsContainer.style.pointerEvents = 'none';
            const selectedButton = optionsContainer.children[selectedIndex];

            if (isCorrect) {
                score++;
                playCorrectSound();
                showFeedback(true);
                selectedButton.classList.remove('bg-blue-600', 'hover:bg-blue-800');
                selectedButton.classList.add('bg-green-500', 'flash-correct');
                
                const damage = 20;
                monsterHP -= damage;
                monsterSprite.classList.add('attack-monster');
                
            } else {
                playWrongSound();
                showFeedback(false);
                selectedButton.classList.remove('bg-blue-600', 'hover:bg-blue-800');
                selectedButton.classList.add('bg-red-500', 'shake');
                
                const correctButton = optionsContainer.children[q.answer];
                correctButton.classList.remove('bg-blue-600', 'hover:bg-blue-800');
                correctButton.classList.add('bg-green-500');
                
                const damage = 10;
                playerHP -= damage;
                playerSprite.classList.add('attack-player');
            }

            updateHPBars();

            setTimeout(() => {
                playerSprite.classList.remove('attack-player');
                monsterSprite.classList.remove('attack-monster');
            }, 500);

            setTimeout(() => {
                if (playerHP <= 0) {
                    endGame(false);
                    return;
                }
                
                if (monsterHP <= 0) {
                    if (currentQuestionIndex < questions.length - 1) {
                        monsterHP = 100;
                        updateHPBars();
                    } else if (currentQuestionIndex === questions.length - 1) {
                        updateHPBars();
                        setTimeout(() => endGame(true), 500);
                        return;
                    }
                }

                currentQuestionIndex++;
                optionsContainer.style.pointerEvents = 'auto';
                loadQuestion();
                
            }, 1500);
        }

        function updateHPBars() {
            playerHP = Math.max(0, playerHP);
            monsterHP = Math.max(0, monsterHP);

            playerHPBar.style.width = `${playerHP}%`;
            playerHPText.innerText = `${playerHP}/100`;

            monsterHPBar.style.width = `${monsterHP}%`;
            monsterHPText.innerText = `${monsterHP}/100`;
        }

        function endGame(isWin) {
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            
            if (isWin) {
                endTitle.innerText = "Chi·∫øn th·∫Øng!";
                endTitle.classList.remove('text-red-500');
                endTitle.classList.add('text-yellow-300');
                endMessage.innerText = "B·∫°n ƒë√£ ti√™u di·ªát t·∫•t c·∫£ qu√°i v·∫≠t v√† b·∫£o v·ªá v∆∞∆°ng qu·ªëc!";
            } else {
                endTitle.innerText = "Th·∫•t b·∫°i!";
                endTitle.classList.remove('text-yellow-300');
                endTitle.classList.add('text-red-500');
                endMessage.innerText = "B·∫°n ƒë√£ b·ªã qu√°i v·∫≠t ƒë√°nh b·∫°i. H√£y th·ª≠ l·∫°i!";
            }
            
            scoreText.innerText = `${score} / 15`;
        }

        // 7. G·∫ÆN S·ª∞ KI·ªÜN
        startBtn.onclick = startGame;
        restartBtn.onclick = startGame;
    </script>
</body>
</html>
