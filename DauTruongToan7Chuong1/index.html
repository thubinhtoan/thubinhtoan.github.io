<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ƒê·∫•u Tr∆∞·ªùng To√°n 7: Chinh Ph·ª•c S·ªë H·ªØu T·ªâ</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f9ff;
            background-image: radial-gradient(#bae6fd 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .math-content { font-size: 1.1em; }

        /* Animations */
        @keyframes bounce-in {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .animate-bounce-in { animation: bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards; }
        .animate-shake { animation: shake 0.4s ease-in-out; }
        .animate-float { animation: float 3s ease-in-out infinite; }

        .option-card { transition: all 0.2s ease; }
        .option-card:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .option-card.correct {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #14532d;
        }

        .option-card.wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #7f1d1d;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

<div id="app" class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden relative min-h-[600px] flex flex-col">

    <!-- START SCREEN -->
    <div id="start-screen" class="absolute inset-0 flex flex-col items-center justify-center p-8 bg-gradient-to-br from-blue-500 to-cyan-400 text-white z-20">
        <div class="mb-6 animate-float">
            <i class="ph-fill ph-calculator text-8xl text-yellow-300 drop-shadow-lg"></i>
        </div>
        <h1 class="text-4xl md:text-5xl font-extrabold text-center mb-4 text-shadow">ƒê·∫•u Tr∆∞·ªùng To√°n 7</h1>
        <p class="text-xl mb-8 text-blue-100 text-center">Chinh Ph·ª•c Th·∫ø Gi·ªõi S·ªë H·ªØu T·ªâ</p>

        <div class="bg-white/20 backdrop-blur-sm rounded-xl p-6 mb-8 max-w-md w-full">
            <h3 class="font-bold text-lg mb-2 flex items-center"><i class="ph-bold ph-info mr-2"></i> Lu·∫≠t ch∆°i:</h3>
            <ul class="space-y-2 text-sm md:text-base">
                <li class="flex items-center"><i class="ph-bold ph-check-circle mr-2 text-green-300"></i> 15 C√¢u h·ªèi tr·∫Øc nghi·ªám</li>
                <li class="flex items-center"><i class="ph-bold ph-brain mr-2 text-yellow-300"></i> Ki·∫øn th·ª©c t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao</li>
                <li class="flex items-center"><i class="ph-bold ph-star mr-2 text-orange-300"></i> Xem gi·∫£i th√≠ch ngay sau khi ch·ªçn</li>
            </ul>
        </div>

        <button onclick="startGame()" class="group relative px-8 py-4 bg-yellow-400 text-blue-900 font-bold text-xl rounded-full shadow-[0_4px_0_rgb(202,138,4)] active:shadow-none active:translate-y-[4px] transition-all hover:bg-yellow-300">
            <span class="flex items-center">
                B·∫Øt ƒê·∫ßu Ngay
                <i class="ph-bold ph-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </span>
        </button>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="flex-1 flex flex-col hidden">
        <!-- Header -->
        <div class="bg-blue-600 text-white p-4 shadow-md flex justify-between items-center z-10">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center font-bold border-2 border-blue-400">
                    <span id="q-current">1</span>
                </div>
                <span class="text-blue-200 text-sm">/ <span id="q-total">15</span></span>
            </div>
            <div class="font-bold text-xl flex items-center">
                <i class="ph-fill ph-trophy text-yellow-400 mr-2"></i>
                <span id="score">0</span>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 h-2">
            <div id="progress-bar" class="bg-yellow-400 h-2 transition-all duration-500 ease-out" style="width: 0%"></div>
        </div>

        <!-- Question Area -->
        <div class="flex-1 p-6 md:p-8 overflow-y-auto">
            <div class="mb-2">
                <span id="difficulty-badge" class="inline-block px-3 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-600 uppercase tracking-wide">
                    M·ª©c ƒë·ªô: Nh·∫≠n bi·∫øt
                </span>
            </div>

            <h2 id="question-text" class="text-2xl font-bold text-gray-800 mb-6 math-content leading-relaxed"></h2>

            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Footer / Feedback -->
        <div id="feedback-area" class="hidden border-t-2 border-gray-100 p-6 bg-gray-50 animate-bounce-in z-10">
            <div class="flex items-start gap-4">
                <div id="feedback-icon" class="text-4xl flex-shrink-0"></div>
                <div class="flex-1">
                    <h3 id="feedback-title" class="font-bold text-lg mb-1"></h3>
                    <p id="feedback-rationale" class="text-gray-600 text-sm md:text-base mb-2"></p>
                    <p id="feedback-hint" class="text-blue-600 text-xs italic border-l-2 border-blue-300 pl-2"></p>
                </div>
                <button onclick="nextQuestion()" class="flex-shrink-0 px-6 py-2 bg-blue-600 text-white rounded-lg font-bold shadow-lg hover:bg-blue-700 active:scale-95 transition-transform flex items-center">
                    Ti·∫øp t·ª•c <i class="ph-bold ph-caret-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- END SCREEN -->
    <div id="end-screen" class="absolute inset-0 flex flex-col items-center justify-center p-8 bg-white hidden z-20">
        <div class="text-center">
            <div class="mb-6 relative inline-block">
                <div class="absolute inset-0 bg-yellow-200 rounded-full animate-ping opacity-75"></div>
                <i class="ph-fill ph-medal text-9xl text-yellow-400 relative z-10 drop-shadow-xl"></i>
            </div>

            <h2 class="text-3xl font-bold text-gray-800 mb-2">Ho√†n Th√†nh!</h2>
            <p class="text-gray-500 mb-8">B·∫°n ƒë√£ chinh ph·ª•c b√†i √¥n t·∫≠p ch∆∞∆°ng 1</p>

            <div class="grid grid-cols-2 gap-4 mb-8 w-full max-w-sm mx-auto">
                <div class="bg-blue-50 p-4 rounded-xl text-center border border-blue-100">
                    <div class="text-gray-500 text-xs uppercase font-bold tracking-wider mb-1">ƒêi·ªÉm s·ªë</div>
                    <div class="text-3xl font-black text-blue-600" id="final-score">0</div>
                </div>
                <div class="bg-green-50 p-4 rounded-xl text-center border border-green-100">
                    <div class="text-gray-500 text-xs uppercase font-bold tracking-wider mb-1">ƒê√∫ng</div>
                    <div class="text-3xl font-black text-green-600"><span id="correct-count">0</span>/15</div>
                </div>
            </div>

            <div id="final-message" class="text-lg font-medium text-gray-700 mb-8 italic"></div>

            <button onclick="location.reload()" class="px-8 py-3 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 transition-colors flex items-center mx-auto">
                <i class="ph-bold ph-arrow-counter-clockwise mr-2"></i> Ch∆°i L·∫°i
            </button>
        </div>
    </div>

</div>

<script>
    // =========================
    // SETTINGS (C√î B·∫¨T/T·∫ÆT ·ªû ƒê√ÇY)
    // =========================
    const RANDOM_QUESTIONS = true; // ‚úÖ random th·ª© t·ª± c√¢u h·ªèi
    const RANDOM_OPTIONS   = true; // ‚úÖ random th·ª© t·ª± ƒë√°p √°n

    // =========================
    // DATA
    // =========================
    const quizData = [
        {
            "questionNumber": 1,
            "level": "Nh·∫≠n bi·∫øt",
            "question": "S·ªë h·ªØu t·ªâ l√† s·ªë ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng $\\frac{a}{b}$ v·ªõi ƒëi·ªÅu ki·ªán n√†o sau ƒë√¢y?",
            "answerOptions": [
                { "text": "$a, b \\in \\mathbb{Z}; b \\ne 0$", "rationale": "Ch√≠nh x√°c! S·ªë h·ªØu t·ªâ l√† s·ªë vi·∫øt ƒë∆∞·ª£c d∆∞·ªõi d·∫°ng ph√¢n s·ªë a/b v·ªõi t·ª≠ v√† m·∫´u l√† s·ªë nguy√™n, m·∫´u kh√°c 0.", "isCorrect": true },
                { "text": "$a, b \\in \\mathbb{N}; b \\ne 0$", "rationale": "Ch∆∞a ƒë·ªß. T·ª≠ s·ªë v√† m·∫´u s·ªë c√≥ th·ªÉ l√† s·ªë nguy√™n √¢m, kh√¥ng nh·∫•t thi·∫øt ph·∫£i l√† s·ªë t·ª± nhi√™n.", "isCorrect": false },
                { "text": "$a, b \\in \\mathbb{Z}$", "rationale": "Thi·∫øu ƒëi·ªÅu ki·ªán quan tr·ªçng. M·∫´u s·ªë b ph·∫£i lu√¥n kh√°c 0 th√¨ ph√¢n s·ªë m·ªõi c√≥ nghƒ©a.", "isCorrect": false },
                { "text": "$a \\in \\mathbb{N}, b \\in \\mathbb{Z}$", "rationale": "Ch∆∞a ch√≠nh x√°c. T·ª≠ s·ªë a c≈©ng c√≥ th·ªÉ l√† s·ªë nguy√™n √¢m.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: H√£y nh·ªõ l·∫°i ƒë·ªãnh nghƒ©a c∆° b·∫£n v·ªÅ s·ªë h·ªØu t·ªâ trong b√†i 1. Ch√∫ √Ω ƒë·∫øn t·∫≠p h·ª£p ch·ª©a a, b v√† ƒëi·ªÅu ki·ªán c·ªßa m·∫´u s·ªë."
        },
        {
            "questionNumber": 2,
            "level": "Nh·∫≠n bi·∫øt",
            "question": "S·ªë ƒë·ªëi c·ªßa s·ªë h·ªØu t·ªâ $\\frac{-3}{5}$ l√† s·ªë n√†o?",
            "answerOptions": [
                { "text": "$\\frac{3}{5}$", "rationale": "Tuy·ªát v·ªùi! S·ªë ƒë·ªëi c·ªßa m·ªôt s·ªë √¢m l√† s·ªë d∆∞∆°ng t∆∞∆°ng ·ª©ng. T·ªïng c·ªßa ch√∫ng b·∫±ng 0.", "isCorrect": true },
                { "text": "$\\frac{-5}{3}$", "rationale": "ƒê√¢y l√† s·ªë ngh·ªãch ƒë·∫£o, kh√¥ng ph·∫£i s·ªë ƒë·ªëi nh√©.", "isCorrect": false },
                { "text": "$\\frac{3}{-5}$", "rationale": "S·ªë n√†y v·∫´n b·∫±ng -3/5, nghƒ©a l√† ch√≠nh n√≥ ch·ª© kh√¥ng ph·∫£i s·ªë ƒë·ªëi.", "isCorrect": false },
                { "text": "$0$", "rationale": "Sai r·ªìi. S·ªë 0 l√† s·ªë ƒë·ªëi c·ªßa ch√≠nh n√≥.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: S·ªë ƒë·ªëi c·ªßa s·ªë x l√† s·ªë y sao cho x + y = 0. N√≥i ƒë∆°n gi·∫£n l√† ch·ªâ c·∫ßn ƒë·ªïi d·∫•u."
        },
        {
            "questionNumber": 3,
            "level": "Nh·∫≠n bi·∫øt",
            "question": "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $(-0,5)^2$ l√† bao nhi√™u?",
            "answerOptions": [
                { "text": "$0,25$", "rationale": "Ch√≠nh x√°c! B√¨nh ph∆∞∆°ng c·ªßa m·ªôt s·ªë (d√π √¢m hay d∆∞∆°ng) lu√¥n l√† s·ªë kh√¥ng √¢m. (-0,5).(-0,5) = 0,25.", "isCorrect": true },
                { "text": "$-0,25$", "rationale": "R·∫•t ti·∫øc. L≈©y th·ª´a b·∫≠c ch·∫µn c·ªßa s·ªë √¢m ph·∫£i ra k·∫øt qu·∫£ d∆∞∆°ng.", "isCorrect": false },
                { "text": "$0,1$", "rationale": "Sai r·ªìi. B·∫°n ƒëang t√≠nh nh·∫ßm sang 0,5 x 2 ph·∫£i kh√¥ng? ƒê√¢y l√† m≈© 2 nh√©.", "isCorrect": false },
                { "text": "$-1$", "rationale": "Sai. ƒê√¢y l√† ph√©p l≈©y th·ª´a, kh√¥ng ph·∫£i ph√©p nh√¢n v·ªõi 2.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: L≈©y th·ª´a b·∫≠c ch·∫µn c·ªßa s·ªë √¢m lu√¥n mang d·∫•u d∆∞∆°ng. H√£y t√≠nh 0,5 nh√¢n 0,5."
        },
        {
            "questionNumber": 4,
            "level": "Nh·∫≠n bi·∫øt",
            "question": "Gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa m·ªôt s·ªë h·ªØu t·ªâ $x$, k√≠ hi·ªáu l√† $|x|$, lu√¥n th·ªèa m√£n ƒëi·ªÅu ki·ªán n√†o?",
            "answerOptions": [
                { "text": "$|x| \\ge 0$", "rationale": "ƒê√∫ng r·ªìi! Gi√° tr·ªã tuy·ªát ƒë·ªëi l√† kho·∫£ng c√°ch t·ª´ ƒëi·ªÉm x ƒë·∫øn ƒëi·ªÉm 0 tr√™n tr·ª•c s·ªë, n√™n kh√¥ng bao gi·ªù √¢m.", "isCorrect": true },
                { "text": "$|x| = x$", "rationale": "Ch·ªâ ƒë√∫ng khi x l√† s·ªë d∆∞∆°ng ho·∫∑c b·∫±ng 0. N·∫øu x √¢m th√¨ sai.", "isCorrect": false },
                { "text": "$|x| < 0$", "rationale": "Sai ho√†n to√†n. Kho·∫£ng c√°ch kh√¥ng th·ªÉ l√† s·ªë √¢m.", "isCorrect": false },
                { "text": "$|x| = -x$", "rationale": "Ch·ªâ ƒë√∫ng khi x l√† s·ªë √¢m ho·∫∑c b·∫±ng 0. N·∫øu x d∆∞∆°ng th√¨ sai.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: Gi√° tr·ªã tuy·ªát ƒë·ªëi bi·ªÉu di·ªÖn kho·∫£ng c√°ch. Kho·∫£ng c√°ch c√≥ bao gi·ªù l√† s·ªë √¢m kh√¥ng?"
        },
        {
            "questionNumber": 5,
            "level": "Nh·∫≠n bi·∫øt",
            "question": "C√¥ng th·ª©c n√†o sau ƒë√¢y ƒë√∫ng khi nh√¢n hai l≈©y th·ª´a c√πng c∆° s·ªë?",
            "answerOptions": [
                { "text": "$x^m . x^n = x^{m+n}$", "rationale": "Ch√≠nh x√°c! Khi nh√¢n hai l≈©y th·ª´a c√πng c∆° s·ªë, ta gi·ªØ nguy√™n c∆° s·ªë v√† c·ªông c√°c s·ªë m≈©.", "isCorrect": true },
                { "text": "$x^m . x^n = x^{m.n}$", "rationale": "Sai r·ªìi. ƒê√¢y l√† l·ªói sai th∆∞·ªùng g·∫∑p. Nh√¢n hai l≈©y th·ª´a th√¨ C·ªòNG s·ªë m≈©, kh√¥ng ph·∫£i nh√¢n s·ªë m≈©.", "isCorrect": false },
                { "text": "$x^m . x^n = x^{m-n}$", "rationale": "Sai. Tr·ª´ s·ªë m≈© l√† quy t·∫Øc c·ªßa ph√©p chia, kh√¥ng ph·∫£i ph√©p nh√¢n.", "isCorrect": false },
                { "text": "$x^m . x^n = (x.x)^{m+n}$", "rationale": "Sai. C∆° s·ªë ph·∫£i ƒë∆∞·ª£c gi·ªØ nguy√™n l√† x.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: Nh·ªõ c√¢u th·∫ßn ch√∫: 'Nh√¢n th√¨ c·ªông (m≈©), Chia th√¨ tr·ª´ (m≈©)'."
        },
        {
            "questionNumber": 6,
            "level": "Nh·∫≠n bi·∫øt",
            "question": "Ph√¢n s·ªë n√†o d∆∞·ªõi ƒë√¢y bi·ªÉu di·ªÖn s·ªë h·ªØu t·ªâ $0,75$?",
            "answerOptions": [
                { "text": "$\\frac{3}{4}$", "rationale": "Hoan h√¥! 0,75 ch√≠nh l√† 75/100, r√∫t g·ªçn cho 25 ta ƒë∆∞·ª£c 3/4.", "isCorrect": true },
                { "text": "$\\frac{1}{4}$", "rationale": "Sai r·ªìi. 1/4 l√† 0,25.", "isCorrect": false },
                { "text": "$\\frac{7}{5}$", "rationale": "Sai. 7/5 l√† 1,4.", "isCorrect": false },
                { "text": "$\\frac{3}{5}$", "rationale": "Sai. 3/5 l√† 0,6.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: H√£y vi·∫øt 0,75 d∆∞·ªõi d·∫°ng ph√¢n s·ªë th·∫≠p ph√¢n 75/100 r·ªìi r√∫t g·ªçn."
        },
        {
            "questionNumber": 7,
            "level": "Th√¥ng hi·ªÉu",
            "question": "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $\\frac{-1}{3} + \\frac{1}{2}$ l√†:",
            "answerOptions": [
                { "text": "$\\frac{1}{6}$", "rationale": "Gi·ªèi l·∫Øm! Quy ƒë·ªìng m·∫´u s·ªë chung l√† 6: (-2/6) + (3/6) = 1/6.", "isCorrect": true },
                { "text": "$\\frac{-1}{6}$", "rationale": "Ti·∫øc qu√°, b·∫°n ƒë√£ t√≠nh nh·∫ßm d·∫•u. -2 c·ªông 3 ph·∫£i ra d∆∞∆°ng 1.", "isCorrect": false },
                { "text": "$\\frac{2}{5}$", "rationale": "Sai. Kh√¥ng ƒë∆∞·ª£c c·ªông t·ª≠ v·ªõi t·ª≠, m·∫´u v·ªõi m·∫´u nh√©!", "isCorrect": false },
                { "text": "$\\frac{-5}{6}$", "rationale": "Sai. Ki·ªÉm tra l·∫°i b∆∞·ªõc quy ƒë·ªìng nh√©.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: H√£y quy ƒë·ªìng m·∫´u s·ªë hai ph√¢n s·ªë v·ªÅ m·∫´u chung l√† 6 r·ªìi th·ª±c hi·ªán ph√©p c·ªông t·ª≠ s·ªë."
        },
        {
            "questionNumber": 8,
            "level": "Th√¥ng hi·ªÉu",
            "question": "So s√°nh hai s·ªë h·ªØu t·ªâ $x = \\frac{-2}{3}$ v√† $y = \\frac{-3}{4}$:",
            "answerOptions": [
                { "text": "$x > y$", "rationale": "ƒê√∫ng r·ªìi! Quy ƒë·ªìng l√™n ta c√≥ x = -8/12 v√† y = -9/12. V√¨ -8 > -9 n√™n x > y.", "isCorrect": true },
                { "text": "$x < y$", "rationale": "Sai r·ªìi. Trong s·ªë √¢m, s·ªë n√†o c√≥ ph·∫ßn s·ªë t·ª± nhi√™n l·ªõn h∆°n th√¨ nh·ªè h∆°n.", "isCorrect": false },
                { "text": "$x = y$", "rationale": "Hai ph√¢n s·ªë n√†y kh√¥ng b·∫±ng nhau.", "isCorrect": false },
                { "text": "Kh√¥ng so s√°nh ƒë∆∞·ª£c", "rationale": "M·ªçi s·ªë h·ªØu t·ªâ ƒë·ªÅu c√≥ th·ªÉ so s√°nh ƒë∆∞·ª£c v·ªõi nhau.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: Quy ƒë·ªìng m·∫´u s·ªë chung l√† 12, sau ƒë√≥ so s√°nh t·ª≠ s·ªë. Nh·ªõ quy t·∫Øc so s√°nh hai s·ªë √¢m nh√©!"
        },
        {
            "questionNumber": 9,
            "level": "Th√¥ng hi·ªÉu",
            "question": "T√¨m $x$, bi·∫øt: $x - \\frac{1}{4} = \\frac{5}{8}$",
            "answerOptions": [
                { "text": "$x = \\frac{7}{8}$", "rationale": "Ch√≠nh x√°c! x = 5/8 + 1/4 = 5/8 + 2/8 = 7/8.", "isCorrect": true },
                { "text": "$x = \\frac{3}{8}$", "rationale": "Sai. Mu·ªën t√¨m s·ªë b·ªã tr·ª´, ta ph·∫£i l·∫•y hi·ªáu C·ªòNG v·ªõi s·ªë tr·ª´. B·∫°n ƒë√£ l√†m ph√©p tr·ª´ r·ªìi.", "isCorrect": false },
                { "text": "$x = \\frac{1}{2}$", "rationale": "Sai. H√£y quy ƒë·ªìng m·∫´u s·ªë c·∫©n th·∫≠n h∆°n.", "isCorrect": false },
                { "text": "$x = \\frac{-3}{8}$", "rationale": "Sai d·∫•u r·ªìi.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: Mu·ªën t√¨m s·ªë b·ªã tr·ª´ (x), ta l·∫•y hi·ªáu c·ªông v·ªõi s·ªë tr·ª´. Chuy·ªÉn -1/4 sang v·∫ø ph·∫£i th√†nh +1/4."
        },
        {
            "questionNumber": 10,
            "level": "Th√¥ng hi·ªÉu",
            "question": "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $\\frac{3}{7} \\cdot \\frac{-2}{5}$ l√†:",
            "answerOptions": [
                { "text": "$\\frac{-6}{35}$", "rationale": "Chu·∫©n x√°c! Nh√¢n t·ª≠ v·ªõi t·ª≠ (3.-2 = -6) v√† m·∫´u v·ªõi m·∫´u (7.5 = 35).", "isCorrect": true },
                { "text": "$\\frac{6}{35}$", "rationale": "Sai d·∫•u. D∆∞∆°ng nh√¢n √Çm ph·∫£i ra √Çm.", "isCorrect": false },
                { "text": "$\\frac{1}{12}$", "rationale": "Sai. ƒê√¢y l√† ph√©p nh√¢n, kh√¥ng ph·∫£i ph√©p c·ªông.", "isCorrect": false },
                { "text": "$\\frac{-5}{12}$", "rationale": "Sai ho√†n to√†n quy t·∫Øc nh√¢n ph√¢n s·ªë.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: Quy t·∫Øc nh√¢n ph√¢n s·ªë: T·ª≠ nh√¢n t·ª≠, M·∫´u nh√¢n m·∫´u."
        },
        {
            "questionNumber": 11,
            "level": "Th√¥ng hi·ªÉu",
            "question": "Th·ª© t·ª± th·ª±c hi·ªán ph√©p t√≠nh ƒë√∫ng ƒë·ªëi v·ªõi bi·ªÉu th·ª©c kh√¥ng c√≥ d·∫•u ngo·∫∑c l√†:",
            "answerOptions": [
                { "text": "L≈©y th·ª´a $\\rightarrow$ Nh√¢n v√† Chia $\\rightarrow$ C·ªông v√† Tr·ª´", "rationale": "R·∫•t t·ªët! ƒê√¢y l√† quy t·∫Øc b·∫•t di b·∫•t d·ªãch trong th·ª© t·ª± th·ª±c hi·ªán ph√©p t√≠nh.", "isCorrect": true },
                { "text": "Nh√¢n v√† Chia $\\rightarrow$ L≈©y th·ª´a $\\rightarrow$ C·ªông v√† Tr·ª´", "rationale": "Sai. L≈©y th·ª´a lu√¥n ƒë∆∞·ª£c ∆∞u ti√™n t√≠nh tr∆∞·ªõc ti√™n.", "isCorrect": false },
                { "text": "C·ªông v√† Tr·ª´ $\\rightarrow$ Nh√¢n v√† Chia $\\rightarrow$ L≈©y th·ª´a", "rationale": "Sai ng∆∞·ª£c ho√†n to√†n.", "isCorrect": false },
                { "text": "T·ª´ tr√°i sang ph·∫£i, kh√¥ng c·∫ßn th·ª© t·ª± ∆∞u ti√™n", "rationale": "Sai. Ch·ªâ l√†m t·ª´ tr√°i sang ph·∫£i khi c√°c ph√©p t√≠nh c√πng m·ª©c ∆∞u ti√™n (v√≠ d·ª• ch·ªâ c√≥ nh√¢n chia).", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: Ph√©p n√¢ng l√™n l≈©y th·ª´a l√† m·∫°nh nh·∫•t, sau ƒë√≥ ƒë·∫øn ph√©p t√≠nh n√†o?"
        },
        {
            "questionNumber": 12,
            "level": "V·∫≠n d·ª•ng",
            "question": "T√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c: $A = \\left( -\\frac{1}{3} \\right)^2 + \\frac{5}{9} - 1$",
            "answerOptions": [
                { "text": "$\\frac{-1}{3}$", "rationale": "Tuy·ªát v·ªùi! (-1/3)^2 = 1/9. V·∫≠y A = 1/9 + 5/9 - 9/9 = 6/9 - 9/9 = -3/9 = -1/3.", "isCorrect": true },
                { "text": "$\\frac{5}{9}$", "rationale": "Sai. B·∫°n ƒë√£ t√≠nh sai l≈©y th·ª´a ho·∫∑c sai b∆∞·ªõc tr·ª´ cu·ªëi c√πng.", "isCorrect": false },
                { "text": "$0$", "rationale": "Sai. T·ªïng 1/9 + 5/9 ch·ªâ b·∫±ng 6/9, ch∆∞a ƒë·ªß ƒë·ªÉ tr·ª´ ƒëi 1 b·∫±ng 0.", "isCorrect": false },
                { "text": "$\\frac{1}{3}$", "rationale": "Sai d·∫•u. K·∫øt qu·∫£ ph·∫£i l√† s·ªë √¢m.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: H√£y t√≠nh l≈©y th·ª´a tr∆∞·ªõc: (-1/3)^2 b·∫±ng bao nhi√™u? Sau ƒë√≥ th·ª±c hi·ªán c·ªông tr·ª´ t·ª´ tr√°i sang ph·∫£i."
        },
        {
            "questionNumber": 13,
            "level": "V·∫≠n d·ª•ng",
            "question": "T√¨m $x$ bi·∫øt: $|x - 1,5| = 2$",
            "answerOptions": [
                { "text": "$x = 3,5$ ho·∫∑c $x = -0,5$", "rationale": "Xu·∫•t s·∫Øc! C√≥ 2 tr∆∞·ªùng h·ª£p: x - 1,5 = 2 ho·∫∑c x - 1,5 = -2. Gi·∫£i ra ta ƒë∆∞·ª£c 3,5 v√† -0,5.", "isCorrect": true },
                { "text": "Ch·ªâ c√≥ $x = 3,5$", "rationale": "Thi·∫øu nghi·ªám. Gi√° tr·ªã tuy·ªát ƒë·ªëi b·∫±ng m·ªôt s·ªë d∆∞∆°ng lu√¥n sinh ra 2 tr∆∞·ªùng h·ª£p.", "isCorrect": false },
                { "text": "$x = 3,5$ ho·∫∑c $x = 0,5$", "rationale": "Sai nghi·ªám th·ª© hai. x - 1,5 = -2 th√¨ x ph·∫£i l√† -0,5.", "isCorrect": false },
                { "text": "Ch·ªâ c√≥ $x = -0,5$", "rationale": "Thi·∫øu nghi·ªám d∆∞∆°ng.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: Ph√° d·∫•u gi√° tr·ªã tuy·ªát ƒë·ªëi ra hai tr∆∞·ªùng h·ª£p: bi·ªÉu th·ª©c b√™n trong b·∫±ng 2 ho·∫∑c b·∫±ng -2."
        },
        {
            "questionNumber": 14,
            "level": "V·∫≠n d·ª•ng th·ª±c t·∫ø",
            "question": "B·∫°n Lan c√≥ 200.000 ƒë·ªìng ƒë·ªÉ mua v·ªü. Bi·∫øt gi√° m·ªôt quy·ªÉn v·ªü l√† 12.000 ƒë·ªìng. Lan ƒë∆∞·ª£c c·ª≠a h√†ng gi·∫£m gi√° 10% tr√™n t·ªïng h√≥a ƒë∆°n. H·ªèi Lan mua ƒë∆∞·ª£c t·ªëi ƒëa bao nhi√™u quy·ªÉn v·ªü?",
            "answerOptions": [
                { "text": "18 quy·ªÉn", "rationale": "Ch√≠nh x√°c! Gi√° 1 quy·ªÉn sau gi·∫£m l√† 12.000 * 90% = 10.800ƒë. 200.000 : 10.800 ‚âà 18,5. Lan ch·ªâ mua ƒë∆∞·ª£c t·ªëi ƒëa 18 quy·ªÉn.", "isCorrect": true },
                { "text": "16 quy·ªÉn", "rationale": "Qu√° √≠t. B·∫°n t√≠nh gi√° g·ªëc l√† 12.000 th√¨ 200.000/12.000 = 16,6. Nh∆∞ng Lan ƒë∆∞·ª£c gi·∫£m gi√° m√†!", "isCorrect": false },
                { "text": "19 quy·ªÉn", "rationale": "H∆°i l·ªë r·ªìi. 19 quy·ªÉn gi√° sau gi·∫£m s·∫Ω t·ªën 205.200ƒë, Lan kh√¥ng ƒë·ªß ti·ªÅn.", "isCorrect": false },
                { "text": "17 quy·ªÉn", "rationale": "V·∫´n c√≤n d∆∞ ti·ªÅn mua th√™m 1 quy·ªÉn n·ªØa ƒë√≥.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: ƒê·∫ßu ti√™n t√≠nh gi√° ti·ªÅn th·ª±c t·∫ø c·ªßa m·ªôt quy·ªÉn v·ªü sau khi ƒë∆∞·ª£c gi·∫£m 10%. Sau ƒë√≥ l·∫•y t·ªïng ti·ªÅn chia cho gi√° m·ªõi."
        },
        {
            "questionNumber": 15,
            "level": "V·∫≠n d·ª•ng cao",
            "question": "T√¨m gi√° tr·ªã nh·ªè nh·∫•t c·ªßa bi·ªÉu th·ª©c $A = |x - 2023| + |x - 2024|$",
            "answerOptions": [
                { "text": "1", "rationale": "Tuy·ªát ƒë·ªânh! √Åp d·ª•ng b·∫•t ƒë·∫≥ng th·ª©c |a| + |b| >= |a+b|. Ta c√≥ A = |x - 2023| + |2024 - x| >= |x - 2023 + 2024 - x| = 1. D·∫•u b·∫±ng x·∫£y ra khi 2023 <= x <= 2024.", "isCorrect": true },
                { "text": "0", "rationale": "Sai. T·ªïng hai gi√° tr·ªã tuy·ªát ƒë·ªëi ch·ªâ b·∫±ng 0 khi c·∫£ hai s·ªë h·∫°ng b·∫±ng 0 c√πng l√∫c, ƒëi·ªÅu n√†y kh√¥ng th·ªÉ x·∫£y ra ·ªü ƒë√¢y (x kh√¥ng th·ªÉ v·ª´a b·∫±ng 2023 v·ª´a b·∫±ng 2024).", "isCorrect": false },
                { "text": "2023", "rationale": "Kh√¥ng ƒë√∫ng. Gi√° tr·ªã nh·ªè nh·∫•t nh·ªè h∆°n nhi·ªÅu.", "isCorrect": false },
                { "text": "2024", "rationale": "Kh√¥ng ƒë√∫ng.", "isCorrect": false }
            ],
            "hint": "G·ª£i √Ω: S·ª≠ d·ª•ng t√≠nh ch·∫•t |A| + |B| >= |A+B|. L∆∞u √Ω vi·∫øt l·∫°i |x - 2024| th√†nh |2024 - x| ƒë·ªÉ tri·ªát ti√™u x."
        }
    ];

    // =========================
    // GAME STATE
    // =========================
    let currentQuestionIndex = 0;
    let score = 0;
    let isAnswered = false;

    // M·∫£ng c√¢u h·ªèi d√πng trong l∆∞·ª£t ch∆°i (ƒë√£ random n·∫øu b·∫≠t)
    let gameQuestions = [];

    // =========================
    // DOM ELEMENTS
    // =========================
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const endScreen = document.getElementById('end-screen');

    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const difficultyBadge = document.getElementById('difficulty-badge');
    const progressBar = document.getElementById('progress-bar');

    const feedbackArea = document.getElementById('feedback-area');
    const feedbackTitle = document.getElementById('feedback-title');
    const feedbackRationale = document.getElementById('feedback-rationale');
    const feedbackHint = document.getElementById('feedback-hint');
    const feedbackIcon = document.getElementById('feedback-icon');

    const scoreDisplay = document.getElementById('score');
    const qCurrent = document.getElementById('q-current');
    const qTotal = document.getElementById('q-total');

    // =========================
    // AUDIO (Web Audio API)
    // =========================
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playTone(freq, type, duration) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    function playSuccessSound() {
        playTone(523.25, 'sine', 0.1); // C5
        setTimeout(() => playTone(659.25, 'sine', 0.1), 100); // E5
        setTimeout(() => playTone(783.99, 'sine', 0.3), 200); // G5
    }

    function playErrorSound() {
        playTone(150, 'sawtooth', 0.3);
        setTimeout(() => playTone(130, 'sawtooth', 0.4), 150);
    }

    function playCompleteSound() {
        [523, 659, 783, 1046].forEach((freq, i) => {
            setTimeout(() => playTone(freq, 'square', 0.2), i * 150);
        });
    }

    // =========================
    // SHUFFLE
    // =========================
    function shuffleArray(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    // =========================
    // GAME LOGIC
    // =========================
    function startGame() {
        startScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        gameScreen.classList.add('flex');

        // reset
        currentQuestionIndex = 0;
        score = 0;
        scoreDisplay.innerText = score;
        isAnswered = false;

        // build a fresh question list each run
        gameQuestions = [...quizData];
        if (RANDOM_QUESTIONS) shuffleArray(gameQuestions);

        loadQuestion();
    }

    function loadQuestion() {
        isAnswered = false;
        feedbackArea.classList.add('hidden');

        const qData = gameQuestions[currentQuestionIndex];

        // Update UI Info
        qCurrent.innerText = currentQuestionIndex + 1;
        qTotal.innerText = gameQuestions.length;
        difficultyBadge.innerText = `M·ª©c ƒë·ªô: ${qData.level}`;

        // progress bar
        const denom = Math.max(1, gameQuestions.length - 1);
        const progress = (currentQuestionIndex / denom) * 100;
        progressBar.style.width = `${Math.max(0, Math.min(100, progress))}%`;

        // Render Question
        questionText.innerHTML = qData.question;

        // Render Options (RANDOM)
        optionsContainer.innerHTML = '';
        let currentOptions = qData.answerOptions.map(o => ({ ...o })); // copy

        if (RANDOM_OPTIONS) shuffleArray(currentOptions);

        // l∆∞u ƒë·ªÉ checkAnswer highlight ƒë√∫ng sau random
        qData._currentOptions = currentOptions;

        currentOptions.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className =
                `option-card w-full text-left p-4 rounded-xl border-2 border-gray-200 bg-white hover:border-blue-300 text-gray-700 font-medium text-lg relative overflow-hidden math-content`;
            btn.innerHTML =
                `<span class="inline-block w-8 h-8 rounded-full bg-blue-50 text-blue-600 text-center leading-8 mr-3 font-bold text-sm border border-blue-100">${String.fromCharCode(65 + index)}</span> ${opt.text}`;
            btn.onclick = () => checkAnswer(btn, opt, qData);
            optionsContainer.appendChild(btn);
        });

        // Trigger MathJax re-render
        if (window.MathJax) {
            MathJax.typesetPromise();
        }
    }

    function checkAnswer(btn, option, qData) {
        if (isAnswered) return;
        isAnswered = true;

        const allBtns = optionsContainer.querySelectorAll('button');
        allBtns.forEach(b => b.classList.add('disabled', 'cursor-default'));

        if (option.isCorrect) {
            // CORRECT
            score += 10;
            scoreDisplay.innerText = score;
            btn.classList.add('correct', 'animate-bounce-in');

            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

            playSuccessSound();

            feedbackIcon.innerHTML = '<i class="ph-fill ph-smiley text-green-500"></i>';
            feedbackTitle.innerText = "Ch√≠nh x√°c! üéâ";
            feedbackTitle.className = "font-bold text-lg mb-1 text-green-700";
        } else {
            // WRONG
            btn.classList.add('wrong', 'animate-shake');

            // Highlight correct answer theo m·∫£ng hi·ªán t·∫°i (ƒë√£ random)
            const correctIndex = (qData._currentOptions || qData.answerOptions).findIndex(o => o.isCorrect);
            if (correctIndex >= 0) {
                allBtns[correctIndex].classList.add('correct', 'opacity-75');
            }

            playErrorSound();

            feedbackIcon.innerHTML = '<i class="ph-fill ph-smiley-sad text-red-500"></i>';
            feedbackTitle.innerText = "Ti·∫øc qu√°! üòÖ";
            feedbackTitle.className = "font-bold text-lg mb-1 text-red-700";
        }

        feedbackRationale.innerText = option.rationale;
        feedbackHint.innerText = qData.hint || "";

        feedbackArea.classList.remove('hidden');

        setTimeout(() => {
            feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }, 100);
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < gameQuestions.length) {
            loadQuestion();
        } else {
            endGame();
        }
    }

    function endGame() {
        gameScreen.classList.add('hidden');
        endScreen.classList.remove('hidden');
        endScreen.classList.add('flex');

        document.getElementById('final-score').innerText = score;
        document.getElementById('correct-count').innerText = Math.round(score / 10);

        playCompleteSound();

        const finalMsg = document.getElementById('final-message');
        const correctCount = Math.round(score / 10);

        if (correctCount === gameQuestions.length) {
            finalMsg.innerText = "Tuy·ªát ƒë·ªânh! B·∫°n l√† th·∫ßn ƒë·ªìng To√°n h·ªçc! üèÜ";
        } else if (correctCount >= Math.ceil(gameQuestions.length * 0.8)) {
            finalMsg.innerText = "R·∫•t t·ªët! Ki·∫øn th·ª©c c·ªßa b·∫°n r·∫•t v·ªØng! üåü";
        } else if (correctCount >= Math.ceil(gameQuestions.length * 0.55)) {
            finalMsg.innerText = "Kh√° l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
        } else {
            finalMsg.innerText = "ƒê·ª´ng n·∫£n l√≤ng! H√£y √¥n l·∫°i b√†i v√† th·ª≠ l·∫°i nh√©! üìö";
        }

        // Victory confetti
        const duration = 3000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

        const randomInRange = (min, max) => Math.random() * (max - min) + min;

        const interval = setInterval(function() {
            const timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) return clearInterval(interval);

            const particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    }
</script>

</body>
</html>
