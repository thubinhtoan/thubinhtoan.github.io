<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·ªπ S∆∞ Kh√¥ng Gian: Di·ªán T√≠ch & Th·ªÉ T√≠ch</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax for rendering Math formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0fdf4; /* Green-50 */
            background-image: 
                linear-gradient(30deg, #dcfce7 12%, transparent 12.5%, transparent 87%, #dcfce7 87.5%, #dcfce7),
                linear-gradient(150deg, #dcfce7 12%, transparent 12.5%, transparent 87%, #dcfce7 87.5%, #dcfce7),
                linear-gradient(30deg, #dcfce7 12%, transparent 12.5%, transparent 87%, #dcfce7 87.5%, #dcfce7),
                linear-gradient(150deg, #dcfce7 12%, transparent 12.5%, transparent 87%, #dcfce7 87.5%, #dcfce7),
                linear-gradient(60deg, #dcfce777 25%, transparent 25.5%, transparent 75%, #dcfce777 75%, #dcfce777),
                linear-gradient(60deg, #dcfce777 25%, transparent 25.5%, transparent 75%, #dcfce777 75%, #dcfce777);
            background-size: 80px 140px;
            background-position: 0 0, 0 0, 40px 70px, 40px 70px, 0 0, 40px 70px;
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid #ffffff;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .btn-option {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.2);
        }
        .btn-option:active:not(:disabled) {
            transform: translateY(0);
        }
        .btn-option.correct {
            background-color: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }
        .btn-option.wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating-icon { animation: float 3s ease-in-out infinite; }

        .progress-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- GAME WRAPPER -->
    <div class="w-full max-w-4xl glass-container rounded-3xl overflow-hidden relative flex flex-col min-h-[680px]">
        
        <!-- DECORATION -->
        <div class="absolute -top-10 -right-10 w-40 h-40 bg-green-300 rounded-full blur-3xl opacity-30"></div>
        <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-blue-300 rounded-full blur-3xl opacity-30"></div>

        <!-- START SCREEN -->
        <div id="start-screen" class="absolute inset-0 z-30 flex flex-col items-center justify-center p-8 text-center bg-white/95">
            <div class="mb-6 floating-icon">
                <i class="ph-fill ph-package text-8xl text-green-600 drop-shadow-lg"></i>
            </div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 mb-2">K·ªπ S∆∞ Kh√¥ng Gian</h1>
            <p class="text-xl text-green-600 font-bold mb-8">Chuy√™n gia Di·ªán t√≠ch & Th·ªÉ t√≠ch</p>
            
            <div class="bg-green-50 p-6 rounded-2xl mb-8 max-w-md w-full border border-green-100">
                <div class="flex items-center mb-3">
                    <i class="ph-bold ph-ruler text-green-600 text-xl mr-3"></i>
                    <span class="text-gray-700 font-semibold">15 Th·ª≠ th√°ch t√≠nh to√°n</span>
                </div>
                <div class="flex items-center mb-3">
                    <i class="ph-bold ph-cube text-blue-600 text-xl mr-3"></i>
                    <span class="text-gray-700 font-semibold">H√¨nh h·ªôp & H√¨nh l·∫≠p ph∆∞∆°ng</span>
                </div>
                <div class="flex items-center">
                    <i class="ph-bold ph-medal text-yellow-500 text-xl mr-3"></i>
                    <span class="text-gray-700 font-semibold">Nh·∫≠n huy hi·ªáu K·ªπ s∆∞ tr∆∞·ªüng</span>
                </div>
            </div>

            <button onclick="Game.start()" class="group relative px-10 py-4 bg-green-600 text-white font-bold rounded-full text-xl shadow-[0_4px_0_#15803d] active:shadow-none active:translate-y-[4px] transition-all hover:bg-green-500">
                <span class="flex items-center gap-2">
                    B·∫Øt ƒê·∫ßu Ngay <i class="ph-bold ph-arrow-right group-hover:translate-x-1 transition-transform"></i>
                </span>
            </button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="hidden flex-col h-full bg-white/80 relative z-10">
            <!-- HEADER -->
            <div class="bg-white p-4 shadow-sm flex justify-between items-center z-20 border-b border-gray-100">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-2xl bg-green-100 text-green-700 flex items-center justify-center font-bold text-xl border border-green-200">
                        <span id="q-idx">1</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-gray-400 uppercase">C√ÇU H·ªéI</span>
                        <span class="font-bold text-gray-700">/ <span id="q-total">15</span></span>
                    </div>
                </div>
                
                <div class="flex items-center bg-gray-50 px-4 py-2 rounded-xl border border-gray-200">
                    <i class="ph-fill ph-star text-yellow-400 text-2xl mr-2"></i>
                    <span id="score" class="font-bold text-2xl text-gray-800">0</span>
                </div>
            </div>

            <!-- PROGRESS -->
            <div class="w-full bg-gray-200 h-2">
                <div id="progress" class="h-full bg-green-500 progress-bar" style="width: 0%"></div>
            </div>

            <!-- CONTENT -->
            <div class="flex-1 overflow-y-auto p-6 md:p-8 pb-40">
                <div class="max-w-3xl mx-auto">
                    <span id="level-badge" class="inline-block px-3 py-1 rounded-lg bg-blue-100 text-blue-700 text-xs font-bold uppercase mb-4 tracking-wider">
                        Nh·∫≠n bi·∫øt
                    </span>
                    
                    <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-gray-800 mb-8 leading-normal">
                        <!-- Question goes here -->
                    </h2>

                    <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Buttons go here -->
                    </div>
                </div>
            </div>

            <!-- FEEDBACK AREA -->
            <div id="feedback-area" class="absolute bottom-0 inset-x-0 bg-white border-t-4 border-green-500 shadow-[0_-10px_50px_rgba(0,0,0,0.1)] p-6 transform translate-y-full transition-transform duration-300 z-30">
                <div class="max-w-4xl mx-auto flex flex-col md:flex-row gap-6 items-start">
                    <div id="fb-icon" class="text-5xl shrink-0"></div>
                    <div class="flex-1">
                        <h3 id="fb-title" class="text-xl font-bold mb-2"></h3>
                        <p id="fb-text" class="text-gray-700 text-lg leading-relaxed mb-2"></p>
                        <div id="hint-box" class="hidden bg-yellow-50 text-yellow-800 p-3 rounded-lg text-sm border border-yellow-200 flex items-start mt-2">
                            <i class="ph-bold ph-lightbulb text-xl mr-2 mt-0.5"></i>
                            <span id="fb-hint"></span>
                        </div>
                    </div>
                    <button onclick="Game.next()" class="px-8 py-3 bg-gray-900 text-white font-bold rounded-xl shadow-lg hover:scale-105 transition-transform flex items-center justify-center gap-2">
                        Ti·∫øp T·ª•c <i class="ph-bold ph-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- END SCREEN -->
        <div id="end-screen" class="hidden absolute inset-0 z-30 flex flex-col items-center justify-center p-8 bg-white text-center">
            <div class="relative mb-8">
                <div class="absolute inset-0 bg-green-200 rounded-full animate-ping opacity-50"></div>
                <i class="ph-fill ph-trophy text-9xl text-yellow-400 relative z-10 drop-shadow-xl"></i>
            </div>
            
            <h2 class="text-3xl font-black text-gray-800 mb-2">Ho√†n Th√†nh Nhi·ªám V·ª•!</h2>
            <p id="end-message" class="text-lg text-gray-600 mb-8">B·∫°n ƒë√£ xu·∫•t s·∫Øc ho√†n th√†nh b·∫£n v·∫Ω k·ªπ thu·∫≠t.</p>

            <div class="flex gap-4 mb-8 justify-center w-full max-w-sm">
                <div class="flex-1 bg-green-50 p-4 rounded-2xl border border-green-100">
                    <div class="text-xs font-bold text-green-600 uppercase">ƒêi·ªÉm s·ªë</div>
                    <div class="text-3xl font-black text-green-700" id="final-score">0</div>
                </div>
                <div class="flex-1 bg-blue-50 p-4 rounded-2xl border border-blue-100">
                    <div class="text-xs font-bold text-blue-600 uppercase">ƒê√∫ng</div>
                    <div class="text-3xl font-black text-blue-700"><span id="final-correct">0</span>/15</div>
                </div>
            </div>

            <button onclick="location.reload()" class="px-8 py-3 bg-green-600 text-white font-bold rounded-full shadow-lg hover:bg-green-700 transition-all flex items-center gap-2">
                <i class="ph-bold ph-arrow-counter-clockwise"></i> Th·ª≠ Th√°ch L·∫°i
            </button>
        </div>

    </div>

<script>
/* =========================
   UTIL: SHUFFLE (random)
========================= */
function shuffleArray(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* =========================
   DATABASE (15 c√¢u)
   ‚úÖ ƒê√É C√ÇN ƒê√ÅP √ÅN ƒê√öNG ABCD (tr∆∞·ªõc khi random)
   ‚úÖ LaTeX d√πng $...$
========================= */
const QUESTIONS = [
  // --- NH·∫¨N BI·∫æT (6 c√¢u) ---
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "C√¥ng th·ª©c t√≠nh th·ªÉ t√≠ch c·ªßa h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ ba k√≠ch th∆∞·ªõc $a, b, h$ l√†:",
    options: [
      { text: "$V = a \\cdot b \\cdot h$", correct: true,  rationale: "Ch√≠nh x√°c! Th·ªÉ t√≠ch b·∫±ng t√≠ch c·ªßa chi·ªÅu d√†i, chi·ªÅu r·ªông v√† chi·ªÅu cao." },
      { text: "$V = (a + b) \\cdot h$", correct: false, rationale: "Sai. ƒê√¢y g·∫ßn gi·ªëng c√¥ng th·ª©c di·ªán t√≠ch xung quanh nh∆∞ng thi·∫øu s·ªë 2." },
      { text: "$V = 2(a + b) \\cdot h$", correct: false, rationale: "Sai. ƒê√¢y l√† c√¥ng th·ª©c t√≠nh di·ªán t√≠ch xung quanh." },
      { text: "$V = a^2 \\cdot h$", correct: false, rationale: "Sai." }
    ],
    hint: "Mu·ªën t√≠nh s·ª©c ch·ª©a (th·ªÉ t√≠ch), ta nh√¢n c·∫£ 3 k√≠ch th∆∞·ªõc l·∫°i v·ªõi nhau."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "Di·ªán t√≠ch xung quanh c·ªßa h√¨nh l·∫≠p ph∆∞∆°ng c√≥ c·∫°nh $a$ ƒë∆∞·ª£c t√≠nh theo c√¥ng th·ª©c:",
    options: [
      { text: "$S_{xq} = 6a^2$", correct: false, rationale: "Sai. ƒê√¢y l√† c√¥ng th·ª©c t√≠nh di·ªán t√≠ch to√†n ph·∫ßn." },
      { text: "$S_{xq} = 4a^2$", correct: true,  rationale: "ƒê√∫ng. H√¨nh l·∫≠p ph∆∞∆°ng c√≥ 4 m·∫∑t b√™n l√† c√°c h√¨nh vu√¥ng b·∫±ng nhau, di·ªán t√≠ch m·ªói m·∫∑t l√† $a^2$." },
      { text: "$S_{xq} = a^3$",  correct: false, rationale: "Sai. ƒê√¢y l√† c√¥ng th·ª©c t√≠nh th·ªÉ t√≠ch." },
      { text: "$S_{xq} = a^2$",  correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch 1 m·∫∑t." }
    ],
    hint: "Di·ªán t√≠ch xung quanh g·ªìm 4 m·∫∑t b√™n."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "N·∫øu c·∫°nh c·ªßa m·ªôt h√¨nh l·∫≠p ph∆∞∆°ng l√† $3$ cm, th√¨ th·ªÉ t√≠ch c·ªßa n√≥ ƒë∆∞·ª£c t√≠nh b·∫±ng:",
    options: [
      { text: "$3^2$ ($cm^3$)", correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch 1 m·∫∑t." },
      { text: "$3 \\times 4$ ($cm^3$)", correct: false, rationale: "Sai." },
      { text: "$3^3$ ($cm^3$)", correct: true,  rationale: "Ch√≠nh x√°c. $V = a^3$." },
      { text: "$3 \\times 6$ ($cm^3$)", correct: false, rationale: "Sai." }
    ],
    hint: "Th·ªÉ t√≠ch h√¨nh l·∫≠p ph∆∞∆°ng b·∫±ng c·∫°nh l≈©y th·ª´a 3."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "ƒê∆°n v·ªã n√†o sau ƒë√¢y <b>kh√¥ng</b> d√πng ƒë·ªÉ ƒëo th·ªÉ t√≠ch?",
    options: [
      { text: "$m^3$", correct: false, rationale: "Sai. M√©t kh·ªëi l√† ƒë∆°n v·ªã ƒëo th·ªÉ t√≠ch." },
      { text: "$cm^3$", correct: false, rationale: "Sai. XƒÉng-ti-m√©t kh·ªëi l√† ƒë∆°n v·ªã ƒëo th·ªÉ t√≠ch." },
      { text: "L√≠t ($L$)", correct: false, rationale: "Sai. L√≠t l√† ƒë∆°n v·ªã ƒëo dung t√≠ch (th·ªÉ t√≠ch)." },
      { text: "$m^2$", correct: true,  rationale: "ƒê√∫ng. $m^2$ (m√©t vu√¥ng) l√† ƒë∆°n v·ªã ƒëo di·ªán t√≠ch." }
    ],
    hint: "ƒê∆°n v·ªã ƒëo th·ªÉ t√≠ch th∆∞·ªùng c√≥ s·ªë m≈© l√† 3."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "C√¥ng th·ª©c t√≠nh di·ªán t√≠ch xung quanh c·ªßa h√¨nh h·ªôp ch·ªØ nh·∫≠t l√†:",
    options: [
      { text: "$S_{xq} = 2(a + b)h$", correct: true,  rationale: "Ch√≠nh x√°c! B·∫±ng chu vi ƒë√°y nh√¢n v·ªõi chi·ªÅu cao." },
      { text: "$S_{xq} = ab h$",        correct: false, rationale: "Sai. ƒê√¢y l√† th·ªÉ t√≠ch." },
      { text: "$S_{xq} = (a + b)h$",    correct: false, rationale: "Sai. Thi·∫øu h·ªá s·ªë 2." },
      { text: "$S_{xq} = 2ab h$",       correct: false, rationale: "Sai." }
    ],
    hint: "L·∫•y chu vi m·∫∑t ƒë√°y nh√¢n v·ªõi chi·ªÅu cao."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "Di·ªán t√≠ch to√†n ph·∫ßn c·ªßa h√¨nh l·∫≠p ph∆∞∆°ng b·∫±ng:",
    options: [
      { text: "Di·ªán t√≠ch xung quanh nh√¢n 2",                    correct: false, rationale: "Sai." },
      { text: "Di·ªán t√≠ch xung quanh c·ªông v·ªõi di·ªán t√≠ch 2 ƒë√°y",  correct: true,  rationale: "ƒê√∫ng. To√†n ph·∫ßn = Xung quanh + 2 ƒê√°y." },
      { text: "Di·ªán t√≠ch m·ªôt m·∫∑t nh√¢n v·ªõi 4",                  correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch xung quanh." },
      { text: "Th·ªÉ t√≠ch chia cho chi·ªÅu cao",                   correct: false, rationale: "Sai." }
    ],
    hint: "To√†n ph·∫ßn nghƒ©a l√† bao g·ªìm c·∫£ m·∫∑t b√™n v√† m·∫∑t ƒë√°y."
  },

  // --- TH√îNG HI·ªÇU (5 c√¢u) ---
  {
    level: "Th√¥ng hi·ªÉu",
    text: "M·ªôt h√¨nh l·∫≠p ph∆∞∆°ng c√≥ c·∫°nh $5$ cm. Di·ªán t√≠ch xung quanh c·ªßa n√≥ l√†:",
    options: [
      { text: "$150 \\, cm^2$", correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch to√†n ph·∫ßn ($6 \\cdot 25$)." },
      { text: "$125 \\, cm^2$", correct: false, rationale: "Sai. ƒê√¢y l√† th·ªÉ t√≠ch ($5^3$)." },
      { text: "$100 \\, cm^2$", correct: true,  rationale: "Gi·ªèi l·∫Øm! $S_{xq} = 4 \\cdot 5^2 = 4 \\cdot 25 = 100$." },
      { text: "$25 \\, cm^2$",  correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch 1 m·∫∑t." }
    ],
    hint: "T√≠nh di·ªán t√≠ch m·ªôt m·∫∑t ($5 \\times 5$) r·ªìi nh√¢n v·ªõi 4."
  },
  {
    level: "Th√¥ng hi·ªÉu",
    text: "M·ªôt h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i $4$m, chi·ªÅu r·ªông $3$m, chi·ªÅu cao $2$m. Th·ªÉ t√≠ch c·ªßa h√¨nh h·ªôp n√†y l√†:",
    options: [
      { text: "$28 \\, m^3$", correct: false, rationale: "Sai. B·∫°n c√≥ th·ªÉ ƒë√£ t√≠nh di·ªán t√≠ch xung quanh ($2(4+3)\\cdot 2 = 28$)." },
      { text: "$24 \\, m^3$", correct: true,  rationale: "ƒê√∫ng. $V = 4 \\cdot 3 \\cdot 2 = 24$." },
      { text: "$9 \\, m^3$",  correct: false, rationale: "Sai." },
      { text: "$14 \\, m^3$", correct: false, rationale: "Sai." }
    ],
    hint: "Nh√¢n ba k√≠ch th∆∞·ªõc l·∫°i v·ªõi nhau."
  },
  {
    level: "Th√¥ng hi·ªÉu",
    text: "Bi·∫øt di·ªán t√≠ch xung quanh c·ªßa m·ªôt h√¨nh l·∫≠p ph∆∞∆°ng l√† $64 \\, cm^2$. ƒê·ªô d√†i c·∫°nh c·ªßa h√¨nh l·∫≠p ph∆∞∆°ng ƒë√≥ l√†:",
    options: [
      { text: "$8 \\, cm$",  correct: false, rationale: "Sai. $8^2 = 64$, nh∆∞ng ph·∫£i chia cho 4 tr∆∞·ªõc." },
      { text: "$16 \\, cm$", correct: false, rationale: "Sai." },
      { text: "$2 \\, cm$",  correct: false, rationale: "Sai." },
      { text: "$4 \\, cm$",  correct: true,  rationale: "Xu·∫•t s·∫Øc! $S_{xq} = 4a^2 = 64 \\Rightarrow a^2 = 16 \\Rightarrow a = 4$." }
    ],
    hint: "L·∫•y 64 chia cho 4 ƒë·ªÉ t√¨m di·ªán t√≠ch m·ªôt m·∫∑t, sau ƒë√≥ t√¨m s·ªë n√†o b√¨nh ph∆∞∆°ng l√™n b·∫±ng k·∫øt qu·∫£ ƒë√≥."
  },
  {
    level: "Th√¥ng hi·ªÉu",
    text: "M·ªôt b·ªÉ n∆∞·ªõc h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ th·ªÉ t√≠ch $12 \\, m^3$, di·ªán t√≠ch ƒë√°y l√† $4 \\, m^2$. Chi·ªÅu cao c·ªßa b·ªÉ l√†:",
    options: [
      { text: "$48 \\, m$",   correct: false, rationale: "Sai. Kh√¥ng ph·∫£i ph√©p nh√¢n." },
      { text: "$3 \\, m$",    correct: true,  rationale: "ƒê√∫ng. $h = V : S_{ƒë√°y} = 12 : 4 = 3$." },
      { text: "$8 \\, m$",    correct: false, rationale: "Sai." },
      { text: "$0,33 \\, m$", correct: false, rationale: "Sai. L·∫•y 12 chia 4 ch·ª© kh√¥ng ph·∫£i 4 chia 12." }
    ],
    hint: "Th·ªÉ t√≠ch b·∫±ng di·ªán t√≠ch ƒë√°y nh√¢n chi·ªÅu cao. Mu·ªën t√¨m chi·ªÅu cao, ta l√†m ph√©p chia."
  },
  {
    level: "Th√¥ng hi·ªÉu",
    text: "Di·ªán t√≠ch to√†n ph·∫ßn c·ªßa h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ k√≠ch th∆∞·ªõc $2cm, 3cm, 4cm$ l√†:",
    options: [
      { text: "$40 \\, cm^2$", correct: false, rationale: "Sai. ƒê√¢y m·ªõi l√† di·ªán t√≠ch xung quanh." },
      { text: "$24 \\, cm^2$", correct: false, rationale: "Sai. ƒê√¢y l√† th·ªÉ t√≠ch." },
      { text: "$52 \\, cm^2$", correct: true,  rationale: "Ch√≠nh x√°c! $S_{xq} = 2(2+3)\\cdot 4 = 40$. $S_{2ƒë} = 2 \\cdot 2 \\cdot 3 = 12$. T·ªïng = $52$." },
      { text: "$26 \\, cm^2$", correct: false, rationale: "Sai." }
    ],
    hint: "T√≠nh $S_{xq}$ tr∆∞·ªõc, sau ƒë√≥ c·ªông th√™m di·ªán t√≠ch c·ªßa 2 m·∫∑t ƒë√°y."
  },

  // --- V·∫¨N D·ª§NG (3 c√¢u) ---
  {
    level: "V·∫≠n d·ª•ng",
    text: "M·ªôt h√¨nh l·∫≠p ph∆∞∆°ng c√≥ c·∫°nh b·∫±ng $a$. N·∫øu g·∫•p c·∫°nh c·ªßa h√¨nh l·∫≠p ph∆∞∆°ng l√™n $3$ l·∫ßn th√¨ di·ªán t√≠ch xung quanh c·ªßa n√≥ tƒÉng l√™n bao nhi√™u l·∫ßn?",
    options: [
      { text: "$9$ l·∫ßn",  correct: true,  rationale: "Tuy·ªát v·ªùi! Di·ªán t√≠ch t·ªâ l·ªá thu·∫≠n v·ªõi b√¨nh ph∆∞∆°ng c·∫°nh. $3^2 = 9$." },
      { text: "$3$ l·∫ßn",  correct: false, rationale: "Sai. Di·ªán t√≠ch kh√¥ng t·ªâ l·ªá thu·∫≠n b·∫≠c 1 v·ªõi c·∫°nh." },
      { text: "$6$ l·∫ßn",  correct: false, rationale: "Sai." },
      { text: "$27$ l·∫ßn", correct: false, rationale: "Sai. ƒê√¢y l√† s·ªë l·∫ßn tƒÉng c·ªßa th·ªÉ t√≠ch." }
    ],
    hint: "Di·ªán t√≠ch ph·ª• thu·ªôc v√†o $a^2$. N·∫øu thay $a$ b·∫±ng $3a$ th√¨ di·ªán t√≠ch s·∫Ω ch·ª©a $(3a)^2$."
  },
  {
    level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
    text: "B√°c Nam l√†m m·ªôt b·ªÉ c√° k√≠nh d·∫°ng h√¨nh h·ªôp ch·ªØ nh·∫≠t kh√¥ng c√≥ n·∫Øp, chi·ªÅu d√†i $80cm$, r·ªông $50cm$, cao $40cm$. Di·ªán t√≠ch k√≠nh c·∫ßn d√πng l√†:",
    options: [
      { text: "$18400 \\, cm^2$",  correct: false, rationale: "Sai. B·∫°n ƒë√£ t√≠nh c·∫£ n·∫Øp (di·ªán t√≠ch to√†n ph·∫ßn)." },
      { text: "$14400 \\, cm^2$",  correct: true,  rationale: "Ch√≠nh x√°c! $S_{xq} = 2(80+50)\\cdot 40 = 10400$. $S_{ƒë√°y} = 80\\cdot 50 = 4000$. T·ªïng = $14400$." },
      { text: "$10400 \\, cm^2$",  correct: false, rationale: "Sai. ƒê√¢y m·ªõi l√† di·ªán t√≠ch xung quanh." },
      { text: "$160000 \\, cm^2$", correct: false, rationale: "Sai. ƒê√¢y l√† th·ªÉ t√≠ch." }
    ],
    hint: "Di·ªán t√≠ch k√≠nh = Di·ªán t√≠ch xung quanh + Di·ªán t√≠ch 1 m·∫∑t ƒë√°y (v√¨ kh√¥ng c√≥ n·∫Øp)."
  },
  {
    level: "V·∫≠n d·ª•ng",
    text: "M·ªôt h·ªì b∆°i c√≥ chi·ªÅu d√†i $20m$, chi·ªÅu r·ªông $8m$, ƒë·ªô s√¢u trung b√¨nh $1,5m$. C·∫ßn bao nhi√™u m√©t kh·ªëi n∆∞·ªõc ƒë·ªÉ b∆°m ƒë·∫ßy $80\\%$ h·ªì?",
    options: [
      { text: "$240 \\, m^3$", correct: false, rationale: "Sai. ƒê√¢y l√† th·ªÉ t√≠ch ƒë·∫ßy h·ªì." },
      { text: "$300 \\, m^3$", correct: false, rationale: "Sai." },
      { text: "$192 \\, m^3$", correct: true,  rationale: "ƒê√∫ng. $V_{h·ªì} = 20 \\cdot 8 \\cdot 1,5 = 240$. N∆∞·ªõc = $240 \\cdot 80\\% = 192$." },
      { text: "$160 \\, m^3$", correct: false, rationale: "Sai." }
    ],
    hint: "ƒê·∫ßu ti√™n t√≠nh th·ªÉ t√≠ch to√†n b·ªô h·ªì, sau ƒë√≥ nh√¢n v·ªõi $80\\%$."
  },

  // --- V·∫¨N D·ª§NG CAO (1 c√¢u) ---
  {
    level: "V·∫≠n d·ª•ng cao",
    text: "M·ªôt h√¨nh l·∫≠p ph∆∞∆°ng c√≥ di·ªán t√≠ch to√†n ph·∫ßn b·∫±ng th·ªÉ t√≠ch c·ªßa n√≥ (v·ªÅ m·∫∑t tr·ªã s·ªë). ƒê·ªô d√†i c·∫°nh c·ªßa h√¨nh l·∫≠p ph∆∞∆°ng ƒë√≥ l√†:",
    options: [
      { text: "$4$", correct: false, rationale: "Sai. $6\\cdot 16 = 96 \\ne 64$." },
      { text: "$1$", correct: false, rationale: "Sai. $6 \\ne 1$." },
      { text: "$6$", correct: true,  rationale: "ƒê·ªânh cao! Ta c√≥ ph∆∞∆°ng tr√¨nh $6a^2 = a^3$. Chia c·∫£ hai v·∫ø cho $a^2$ (v√¨ $a>0$) ƒë∆∞·ª£c $a=6$." },
      { text: "$8$", correct: false, rationale: "Sai." }
    ],
    hint: "Vi·∫øt c√¥ng th·ª©c di·ªán t√≠ch to√†n ph·∫ßn v√† th·ªÉ t√≠ch, cho ch√∫ng b·∫±ng nhau r·ªìi gi·∫£i t√¨m c·∫°nh $a$."
  }
];

/* =========================
   GAME ENGINE
   ‚úÖ Random c√¢u h·ªèi + ƒë√°p √°n m·ªói l·∫ßn Start
========================= */
const Game = {
  state: { idx: 0, score: 0, answered: false },
  questions: [],

  start() {
    // Random c√¢u h·ªèi + random ƒë√°p √°n (m·ªói l·∫ßn start kh√°c nhau)
    this.questions = shuffleArray(QUESTIONS).map(q => ({
      ...q,
      options: shuffleArray(q.options)
    }));

    this.state = { idx: 0, score: 0, answered: false };
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('end-screen').classList.add('hidden');
    document.getElementById('game-screen').classList.remove('hidden');
    document.getElementById('game-screen').classList.add('flex');
    this.render();
  },

  render() {
    this.state.answered = false;
    document.getElementById('feedback-area').classList.add('translate-y-full');

    const q = this.questions[this.state.idx];

    // Stats
    document.getElementById('q-idx').innerText = this.state.idx + 1;
    document.getElementById('q-total').innerText = this.questions.length;
    document.getElementById('score').innerText = this.state.score;
    document.getElementById('level-badge').innerText = q.level;

    // Progress
    const pct = (this.state.idx / this.questions.length) * 100;
    document.getElementById('progress').style.width = `${pct}%`;

    // Question
    document.getElementById('question-text').innerHTML = q.text;

    // Options
    const container = document.getElementById('options-container');
    container.innerHTML = '';

    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = `btn-option w-full p-6 text-left rounded-2xl bg-white border-2 border-green-50 shadow-sm flex items-center gap-4`;
      btn.innerHTML = `
        <div class="w-10 h-10 rounded-full bg-green-50 text-green-600 font-bold flex items-center justify-center border border-green-200 shrink-0">
          ${String.fromCharCode(65 + i)}
        </div>
        <span class="text-lg text-gray-700 font-medium">${opt.text}</span>
      `;
      btn.onclick = () => this.check(btn, opt, q);
      container.appendChild(btn);
    });

    if (window.MathJax) MathJax.typesetPromise();
  },

  check(btn, opt, q) {
    if (this.state.answered) return;
    this.state.answered = true;

    const allBtns = document.querySelectorAll('.btn-option');
    allBtns.forEach(b => (b.disabled = true));

    const fbIcon = document.getElementById('fb-icon');
    const fbTitle = document.getElementById('fb-title');
    const hintBox = document.getElementById('hint-box');

    if (opt.correct) {
      this.state.score += 10;
      document.getElementById('score').innerText = this.state.score;

      btn.classList.add('correct');

      fbIcon.innerHTML = 'üéâ';
      fbTitle.innerText = "Tuy·ªát V·ªùi!";
      fbTitle.className = "text-xl font-bold mb-2 text-green-600";
      hintBox.classList.add('hidden');

      this.playSound('success');
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.8 }
      });
    } else {
      btn.classList.add('wrong');

      // Highlight correct
      const correctIdx = q.options.findIndex(o => o.correct);
      allBtns[correctIdx].classList.add('correct', 'opacity-75');

      fbIcon.innerHTML = 'üîß';
      fbTitle.innerText = "C·∫ßn ƒêi·ªÅu Ch·ªânh!";
      fbTitle.className = "text-xl font-bold mb-2 text-red-500";

      hintBox.classList.remove('hidden');
      document.getElementById('fb-hint').innerHTML = q.hint;
      this.playSound('error');
    }

    // ‚úÖ d√πng innerHTML ƒë·ªÉ MathJax render LaTeX trong gi·∫£i th√≠ch
    document.getElementById('fb-text').innerHTML = opt.rationale;

    document.getElementById('feedback-area').classList.remove('translate-y-full');

    if (window.MathJax) MathJax.typesetPromise();
  },

  next() {
    this.state.idx++;
    if (this.state.idx < this.questions.length) {
      this.render();
    } else {
      this.end();
    }
  },

  end() {
    document.getElementById('game-screen').classList.remove('flex');
    document.getElementById('game-screen').classList.add('hidden');
    document.getElementById('end-screen').classList.remove('hidden');
    document.getElementById('end-screen').classList.add('flex');

    document.getElementById('final-score').innerText = this.state.score;
    document.getElementById('final-correct').innerText = Math.round(this.state.score / 10);

    const msg = document.getElementById('end-message');
    if (this.state.score >= 130) msg.innerText = "K·ªπ nƒÉng c·ªßa b·∫°n th·∫≠t tuy·ªát v·ªùi! C√¥ng tr√¨nh ho√†n h·∫£o! üèóÔ∏è";
    else if (this.state.score >= 100) msg.innerText = "B·∫°n n·∫Øm r·∫•t v·ªØng ki·∫øn th·ª©c! Ti·∫øp t·ª•c ph√°t huy nh√©! üìê";
    else msg.innerText = "H√£y √¥n l·∫°i c√°c c√¥ng th·ª©c m·ªôt ch√∫t r·ªìi th·ª≠ l·∫°i nh√©! üìö";

    this.playSound('finish');
  },

  playSound(type) {
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    if (!AudioContext) return;
    const ctx = new AudioContext();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);

    if (type === 'success') {
      osc.type = 'sine';
      osc.frequency.setValueAtTime(523, ctx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
      gain.gain.setValueAtTime(0.1, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
      osc.start();
      osc.stop(ctx.currentTime + 0.5);
    } else if (type === 'error') {
      osc.type = 'sawtooth';
      osc.frequency.setValueAtTime(200, ctx.currentTime);
      osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.2);
      gain.gain.setValueAtTime(0.1, ctx.currentTime);
      gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.2);
      osc.start();
      osc.stop(ctx.currentTime + 0.2);
    } else if (type === 'finish') {
      [440, 554, 659, 880].forEach((f, i) => {
        setTimeout(() => {
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.connect(g);
          g.connect(ctx.destination);
          o.type = 'triangle';
          o.frequency.value = f;
          g.gain.setValueAtTime(0.1, ctx.currentTime);
          g.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
          o.start();
          o.stop(ctx.currentTime + 0.3);
        }, i * 150);
      });
    }
  }
};
</script>

</body>
</html>
