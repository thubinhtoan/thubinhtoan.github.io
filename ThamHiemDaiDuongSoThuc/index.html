<!DOCTYPE html>
<html lang="vi">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√°m Hi·ªÉm ƒê·∫°i D∆∞∆°ng S·ªë Th·ª±c</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
            overflow-x: hidden;
            background-attachment: fixed;
        }
        #fb-content {
    font-size: 1.25rem;   /* ~20px */
    line-height: 1.8;
    font-weight: 600;
}

#fb-hint {
    font-size: 1.05rem;
}

        /* Bubble Animation Background */
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            bottom: -50px;
            animation: rise 10s infinite ease-in;
            pointer-events: none;
            z-index: 0;
        }
        @keyframes rise {
            0% { bottom: -50px; transform: translateX(0); }
            50% { transform: translateX(100px); }
            100% { bottom: 100vh; transform: translateX(-100px); }
        }

        .game-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 4px solid #fff;
            box-shadow: 0 20px 50px rgba(0, 78, 146, 0.3);
            border-radius: 30px;
        }

        .option-btn {
            transition: all 0.2s ease-out;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 10px 0 #e2e8f0;
        }
        
        .option-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: none;
        }

        .option-btn.correct {
            background-color: #86efac;
            border-color: #22c55e;
            color: #14532d;
            box-shadow: 0 4px 0 #15803d;
        }

        .option-btn.wrong {
            background-color: #fca5a5;
            border-color: #ef4444;
            color: #7f1d1d;
            box-shadow: 0 4px 0 #b91c1c;
        }

        /* Animations */
        @keyframes submarine-float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }
        .submarine { animation: submarine-float 4s ease-in-out infinite; }

        @keyframes fish-swim {
            0% { transform: translateX(100vw); }
            100% { transform: translateX(-100vw); }
        }
        .fish { position: absolute; animation: fish-swim 20s linear infinite; opacity: 0.6; z-index: 0; }
        

    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 relative">

    <!-- Background Elements -->
    <div id="bubbles-container"></div>
    <div class="fish text-6xl" style="top: 20%; animation-duration: 25s;">üê†</div>
    <div class="fish text-5xl" style="top: 60%; animation-duration: 18s; animation-delay: 5s;">üê°</div>
    <div class="fish text-7xl" style="top: 80%; animation-duration: 30s; animation-delay: 2s;">üêã</div>

    <!-- MAIN APP CONTAINER -->
    <div id="app" class="w-full max-w-4xl z-10 min-h-[600px] relative">
        
        <!-- START SCREEN -->
        <div id="start-screen" class="game-card absolute inset-0 flex flex-col items-center justify-center p-8 text-center z-20">
            <div class="submarine text-9xl mb-6">ü§ø</div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-blue-600 mb-2 drop-shadow-sm">
                Th√°m Hi·ªÉm ƒê·∫°i D∆∞∆°ng
            </h1>
            <h2 class="text-2xl font-bold text-cyan-600 mb-6">S·ªë Th·ª±c & Gi√° Tr·ªã Tuy·ªát ƒê·ªëi</h2>
            
            <div class="bg-blue-50 p-6 rounded-2xl mb-8 border-2 border-blue-100 max-w-lg">
                <p class="text-gray-600 text-lg mb-4">Ch√†o m·ª´ng c√°c nh√† th√°m hi·ªÉm nh√≠! H√£y d√πng ki·∫øn th·ª©c To√°n h·ªçc ƒë·ªÉ l·∫∑n s√¢u xu·ªëng ƒë√°y ƒë·∫°i d∆∞∆°ng v√† t√¨m kho b√°u nh√©!</p>
                <div class="flex justify-center space-x-4 text-sm font-bold text-blue-400">
                    <span class="flex items-center"><i class="ph-fill ph-check-circle mr-1"></i> 15 C√¢u h·ªèi</span>
                    <span class="flex items-center"><i class="ph-fill ph-clock mr-1"></i> T·ª± do</span>
                </div>
            </div>

            <button onclick="Game.start()" class="group relative px-10 py-4 bg-yellow-400 text-yellow-900 font-bold text-2xl rounded-full shadow-[0_6px_0_#b45309] active:shadow-none active:translate-y-[6px] transition-all hover:bg-yellow-300">
                L·∫∑n Ngay! üåä
            </button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="game-card hidden flex-col h-full absolute inset-0 bg-white/90">
            <!-- Header -->
            <div class="bg-blue-600 text-white p-4 rounded-t-[26px] flex justify-between items-center shadow-lg">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-xl font-bold border-2 border-white/40">
                        <span id="q-current">1</span>
                    </div>
                    <div class="leading-tight">
                        <div class="text-xs font-bold text-blue-200 uppercase">Ti·∫øn ƒë·ªô</div>
                        <div class="font-bold"><span id="q-progress">1/15</span></div>
                    </div>
                </div>
                
                <div class="bg-white/10 px-4 py-2 rounded-xl border border-white/20 backdrop-blur-sm">
                    <span class="text-blue-200 text-xs font-bold uppercase mr-2">ƒêi·ªÉm</span>
                    <span id="score" class="text-2xl font-bold text-yellow-300">0</span>
                </div>
            </div>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-6 md:p-8 pb-32 custom-scrollbar">
                
                <!-- Question Block -->
                <div class="max-w-3xl mx-auto">
                    <div class="mb-4 flex items-center">
                        <span id="level-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-purple-100 text-purple-600 uppercase tracking-wider border border-purple-200">
                            Nh·∫≠n bi·∫øt
                        </span>
                    </div>

                    <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-gray-800 mb-8 leading-snug">
                        <!-- Question content -->
                    </h2>

                    <!-- Options Grid -->
                    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Buttons injected here -->
                    </div>
                </div>
            </div>

            <!-- Feedback Panel (Slide up) -->
            <div id="feedback-panel" class="absolute bottom-0 inset-x-0 bg-white border-t-4 border-blue-100 p-6 rounded-b-[26px] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] transform translate-y-full transition-transform duration-300 z-30">
                <div class="max-w-3xl mx-auto flex gap-4 md:gap-6 items-start">
                    <div id="fb-icon" class="text-5xl shrink-0 bounce"></div>
                    <div class="flex-1">
                        <h3 id="fb-title" class="text-xl font-extrabold mb-1"></h3>
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">GI·∫¢I TH√çCH</div>
                        <p id="fb-content" class="text-gray-700 text-lg leading-relaxed mb-2"></p>
                        <div id="fb-hint-box" class="hidden bg-yellow-50 text-yellow-800 p-3 rounded-lg text-sm border border-yellow-200 flex items-start">
                            <i class="ph-bold ph-lightbulb text-lg mr-2 mt-0.5"></i>
                            <span id="fb-hint"></span>
                        </div>
                    </div>
                    <button onclick="Game.next()" class="shrink-0 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-xl shadow-lg transition-transform hover:scale-105 active:scale-95">
                        <i class="ph-bold ph-arrow-right text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- END SCREEN -->
        <div id="end-screen" class="game-card hidden absolute inset-0 flex-col items-center justify-center p-8 z-20 text-center">
            <div class="relative mb-8">
                <div class="absolute inset-0 bg-yellow-300 blur-3xl opacity-40 rounded-full animate-pulse"></div>
                <div class="text-9xl relative z-10 drop-shadow-2xl">üëë</div>
            </div>
            
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Chuy·∫øn Th√°m Hi·ªÉm K·∫øt Th√∫c!</h2>
            <p id="end-msg" class="text-gray-600 text-lg mb-8">B·∫°n ƒë√£ thu th·∫≠p ƒë∆∞·ª£c bao nhi√™u ki·∫øn th·ª©c?</p>

            <div class="grid grid-cols-2 gap-6 w-full max-w-md mb-8">
                <div class="bg-blue-50 p-4 rounded-2xl border-2 border-blue-100">
                    <div class="text-blue-500 text-xs font-bold uppercase">T·ªïng ƒëi·ªÉm</div>
                    <div id="final-score" class="text-4xl font-black text-blue-700">0</div>
                </div>
                <div class="bg-green-50 p-4 rounded-2xl border-2 border-green-100">
                    <div class="text-green-500 text-xs font-bold uppercase">Tr·∫£ l·ªùi ƒë√∫ng</div>
                    <div class="text-4xl font-black text-green-700"><span id="final-correct">0</span>/15</div>
                </div>
            </div>

            <button onclick="location.reload()" class="px-8 py-3 bg-gray-800 text-white font-bold rounded-full shadow-lg hover:bg-gray-900 transition-all flex items-center space-x-2">
                <i class="ph-bold ph-arrow-counter-clockwise"></i>
                <span>Ch∆°i L·∫°i T·ª´ ƒê·∫ßu</span>
            </button>
        </div>

    </div>

<script>
/* =========================
   UTIL: SHUFFLE (random)
========================= */
function shuffleArray(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* =========================
   DATABASE (15 c√¢u)
   L∆∞u √Ω: rationale/hint d√πng LaTeX $...$
========================= */
const QUESTIONS = [
  // --- NH·∫¨N BI·∫æT (6) ---
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "T·∫≠p h·ª£p c√°c s·ªë th·ª±c ƒë∆∞·ª£c k√≠ hi·ªáu l√†:",
    options: [
      { text: "$\\mathbb{R}$", correct: true,  rationale: "Ch√≠nh x√°c! $\\mathbb{R}$ l√† k√≠ hi·ªáu c·ªßa t·∫≠p s·ªë th·ª±c." },
      { text: "$\\mathbb{Q}$", correct: false, rationale: "Sai. $\\mathbb{Q}$ l√† t·∫≠p s·ªë h·ªØu t·ªâ." },
      { text: "$\\mathbb{Z}$", correct: false, rationale: "Sai. $\\mathbb{Z}$ l√† t·∫≠p s·ªë nguy√™n." },
      { text: "$\\mathbb{N}$", correct: false, rationale: "Sai. $\\mathbb{N}$ l√† t·∫≠p s·ªë t·ª± nhi√™n." }
    ],
    hint: "Real numbers ‚Üí ch·ªØ c√°i ƒë·∫ßu l√† $\\mathbb{R}$."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "Ph√°t bi·ªÉu n√†o sau ƒë√¢y l√† <b>ƒë√∫ng</b> v·ªÅ m·ªëi quan h·ªá gi·ªØa c√°c t·∫≠p h·ª£p s·ªë?",
    options: [
      { text: "$\\mathbb{Q} \\subset \\mathbb{R}$", correct: true,  rationale: "ƒê√∫ng! S·ªë h·ªØu t·ªâ l√† m·ªôt ph·∫ßn c·ªßa s·ªë th·ª±c." },
      { text: "$\\mathbb{R} \\subset \\mathbb{Q}$", correct: false, rationale: "Sai. S·ªë th·ª±c c√≤n c√≥ c·∫£ s·ªë v√¥ t·ªâ." },
      { text: "$\\mathbb{I} \\subset \\mathbb{Q}$", correct: false, rationale: "Sai. V√¥ t·ªâ v√† h·ªØu t·ªâ l√† hai t·∫≠p r·ªùi nhau." },
      { text: "$\\mathbb{R} \\subset \\mathbb{Z}$", correct: false, rationale: "Sai. S·ªë nguy√™n ch·ªâ l√† m·ªôt ph·∫ßn c·ªßa s·ªë th·ª±c." }
    ],
    hint: "T·∫≠p l·ªõn nh·∫•t l√† $\\mathbb{R}$."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "Gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa s·ªë th·ª±c $a$, k√≠ hi·ªáu $|a|$, l√†:",
    options: [
      { text: "Kho·∫£ng c√°ch t·ª´ ƒëi·ªÉm $a$ ƒë·∫øn ƒëi·ªÉm $0$ tr√™n tr·ª•c s·ªë.", correct: true,  rationale: "Chu·∫©n! $|a|$ l√† kho·∫£ng c√°ch t·ª´ $a$ ƒë·∫øn $0$." },
      { text: "Ch√≠nh s·ªë $a$.", correct: false, rationale: "Sai. N·∫øu $a<0$ th√¨ $|a|\\ne a$." },
      { text: "S·ªë ƒë·ªëi c·ªßa $a$.", correct: false, rationale: "Sai. N·∫øu $a>0$ th√¨ s·ªë ƒë·ªëi l√† √¢m." },
      { text: "Lu√¥n l√† m·ªôt s·ªë d∆∞∆°ng.", correct: false, rationale: "Sai. C√≥ th·ªÉ b·∫±ng $0$ khi $a=0$." }
    ],
    hint: "Gi√° tr·ªã tuy·ªát ƒë·ªëi l√† ‚Äúƒë·ªô d√†i/ kho·∫£ng c√°ch‚Äù."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "N·∫øu $x$ l√† m·ªôt s·ªë th·ª±c √¢m, th√¨ $|x|$ b·∫±ng:",
    options: [
      { text: "$-x$", correct: true,  rationale: "ƒê√∫ng. N·∫øu $x<0$ th√¨ $|x|=-x$ ƒë·ªÉ ra s·ªë kh√¥ng √¢m." },
      { text: "$x$",  correct: false, rationale: "Sai. V√¨ $x$ ƒëang √¢m." },
      { text: "$0$",  correct: false, rationale: "Sai." },
      { text: "$1$",  correct: false, rationale: "Sai." }
    ],
    hint: "V√≠ d·ª•: $|-5|=5=-(-5)$."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "S·ªë ƒë·ªëi c·ªßa s·ªë th·ª±c $\\sqrt{2}$ l√†:",
    options: [
      { text: "$-\\sqrt{2}$", correct: true,  rationale: "ƒê√∫ng. S·ªë ƒë·ªëi c·ªßa $a$ l√† $-a$." },
      { text: "$\\sqrt{2}$",  correct: false, rationale: "Sai. ƒê√¢y l√† ch√≠nh n√≥." },
      { text: "$\\dfrac{1}{\\sqrt{2}}$", correct: false, rationale: "Sai. ƒê√¢y l√† s·ªë ngh·ªãch ƒë·∫£o." },
      { text: "$2$", correct: false, rationale: "Sai." }
    ],
    hint: "Th√™m d·∫•u ‚Äú‚àí‚Äù ph√≠a tr∆∞·ªõc."
  },
  {
    level: "Nh·∫≠n bi·∫øt",
    text: "Ch·ªçn kh·∫≥ng ƒë·ªãnh <b>sai</b> trong c√°c kh·∫≥ng ƒë·ªãnh sau:",
    options: [
      { text: "$|-2{,}5|=-2{,}5$", correct: true,  rationale: "ƒê√∫ng! ƒê√¢y l√† c√¢u SAI v√¨ $|-2{,}5|=2{,}5$." },
      { text: "$|1{,}5|=1{,}5$",   correct: false, rationale: "C√¢u n√†y ƒê√öNG." },
      { text: "$|-\\sqrt{3}|=\\sqrt{3}$", correct: false, rationale: "C√¢u n√†y ƒê√öNG." },
      { text: "$|0|=0$",          correct: false, rationale: "C√¢u n√†y ƒê√öNG." }
    ],
    hint: "Gi√° tr·ªã tuy·ªát ƒë·ªëi kh√¥ng bao gi·ªù √¢m."
  },

  // --- TH√îNG HI·ªÇU (5) ---
  {
    level: "Th√¥ng hi·ªÉu",
    text: "So s√°nh hai s·ªë th·ª±c: $-1{,}25$ v√† $-1{,}3$.",
    options: [
      { text: "$-1{,}25>-1{,}3$", correct: true,  rationale: "ƒê√∫ng! Tr√™n tr·ª•c s·ªë, $-1{,}25$ n·∫±m b√™n ph·∫£i $-1{,}3$." },
      { text: "$-1{,}25<-1{,}3$", correct: false, rationale: "Sai." },
      { text: "$-1{,}25=-1{,}3$", correct: false, rationale: "Sai." },
      { text: "Kh√¥ng so s√°nh ƒë∆∞·ª£c", correct: false, rationale: "Sai." }
    ],
    hint: "S·ªë √¢m ‚Äú√≠t √¢m h∆°n‚Äù th√¨ l·ªõn h∆°n."
  },
  {
    level: "Th√¥ng hi·ªÉu",
    text: "T√¨m $x$ bi·∫øt $|x|=\\sqrt{5}$.",
    options: [
      { text: "$x=\\sqrt{5}$ ho·∫∑c $x=-\\sqrt{5}$", correct: true,  rationale: "ƒê√∫ng! C√≥ 2 s·ªë c√°ch 0 m·ªôt kho·∫£ng $\\sqrt{5}$." },
      { text: "Ch·ªâ c√≥ $x=\\sqrt{5}$", correct: false, rationale: "Thi·∫øu nghi·ªám √¢m." },
      { text: "Ch·ªâ c√≥ $x=-\\sqrt{5}$", correct: false, rationale: "Thi·∫øu nghi·ªám d∆∞∆°ng." },
      { text: "$x=5$ ho·∫∑c $x=-5$", correct: false, rationale: "Sai v√¨ $|5|=5\\ne\\sqrt{5}$." }
    ],
    hint: "Gi√° tr·ªã tuy·ªát ƒë·ªëi t·∫°o ra 2 tr∆∞·ªùng h·ª£p."
  },
  {
    level: "Th√¥ng hi·ªÉu",
    text: "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh $|-3{,}5|+|1{,}5|-\\sqrt{4}$ l√†:",
    options: [
      { text: "$3$", correct: true,  rationale: "ƒê√∫ng! $3{,}5+1{,}5-2=3$." },
      { text: "$7$", correct: false, rationale: "Sai." },
      { text: "$-3$", correct: false, rationale: "Sai." },
      { text: "$0$", correct: false, rationale: "Sai." }
    ],
    hint: "T√≠nh t·ª´ng ph·∫ßn: $|-3{,}5|=3{,}5$, $\\sqrt{4}=2$."
  },
  {
    level: "Th√¥ng hi·ªÉu",
    text: "S·∫Øp x·∫øp t·ª´ nh·ªè ƒë·∫øn l·ªõn: $-2;\\,0;\\,-\\sqrt{5};\\,1{,}5$.",
    options: [
      { text: "$-\\sqrt{5};\\,-2;\\,0;\\,1{,}5$", correct: true,  rationale: "ƒê√∫ng! V√¨ $\\sqrt{5}\\approx2{,}236$ n√™n $-\\sqrt{5}<-2$." },
      { text: "$-2;\\,-\\sqrt{5};\\,0;\\,1{,}5$", correct: false, rationale: "Sai." },
      { text: "$0;\\,-2;\\,-\\sqrt{5};\\,1{,}5$", correct: false, rationale: "Sai." },
      { text: "$-\\sqrt{5};\\,1{,}5;\\,-2;\\,0$", correct: false, rationale: "Sai." }
    ],
    hint: "∆Ø·ªõc l∆∞·ª£ng $\\sqrt{5}$ ƒë·ªÉ so s√°nh."
  },
  {
    level: "Th√¥ng hi·ªÉu",
    text: "T√≠nh $M=a-|a|$ v·ªõi $a=-5$.",
    options: [
      { text: "$-10$", correct: true,  rationale: "ƒê√∫ng! $(-5)-|-5|=-5-5=-10$." },
      { text: "$0$",   correct: false, rationale: "Sai." },
      { text: "$10$",  correct: false, rationale: "Sai." },
      { text: "$-5$",  correct: false, rationale: "Sai." }
    ],
    hint: "C·∫©n th·∫≠n d·∫•u tr·ª´."
  },

  // --- V·∫¨N D·ª§NG (3) ---
  {
    level: "V·∫≠n d·ª•ng",
    text: "T√¨m $x$ bi·∫øt $|x-0{,}5|-1{,}5=2$.",
    options: [
      { text: "$x=4$ ho·∫∑c $x=-3$", correct: true,  rationale: "ƒê√∫ng! $|x-0{,}5|=3{,}5\\Rightarrow x-0{,}5=\\pm 3{,}5\\Rightarrow x=4$ ho·∫∑c $x=-3$." },
      { text: "Ch·ªâ $x=4$",  correct: false, rationale: "Thi·∫øu nghi·ªám." },
      { text: "$x=4$ ho·∫∑c $x=3$", correct: false, rationale: "Sai nghi·ªám th·ª© hai." },
      { text: "$x=2$ ho·∫∑c $x=-2$", correct: false, rationale: "Sai." }
    ],
    hint: "Chuy·ªÉn v·∫ø ƒë·ªÉ ƒë∆∞·ª£c $|x-0{,}5|$ r·ªìi x√©t 2 tr∆∞·ªùng h·ª£p."
  },
  {
    level: "V·∫≠n d·ª•ng",
    text: "T√≠nh $A=\\sqrt{(-4)^2}-\\sqrt{16}+|-3|\\cdot\\sqrt{9}$.",
    options: [
      { text: "$9$",  correct: true,  rationale: "ƒê√∫ng! $\\sqrt{(-4)^2}=4$, $\\sqrt{16}=4$, $|-3|=3$, $\\sqrt{9}=3$ n√™n $A=4-4+3\\cdot3=9$." },
      { text: "$17$", correct: false, rationale: "Sai." },
      { text: "$1$",  correct: false, rationale: "Sai." },
      { text: "$-9$", correct: false, rationale: "Sai." }
    ],
    hint: "Nh·ªõ $\\sqrt{a^2}=|a|$."
  },
  {
    level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
    text: "M·ªôt chi ti·∫øt m√°y c√≥ chi·ªÅu d√†i chu·∫©n $20$ cm, sai s·ªë kh√¥ng qu√° $0{,}05$ cm. ƒêi·ªÅu ki·ªán ƒë·∫°t chu·∫©n l√†:",
    options: [
      { text: "$|x-20|\\le 0{,}05$", correct: true,  rationale: "ƒê√∫ng! Sai s·ªë l√† kho·∫£ng c√°ch gi·ªØa $x$ v√† $20$." },
      { text: "$x-20\\le 0{,}05$",   correct: false, rationale: "Sai v√¨ thi·∫øu tr∆∞·ªùng h·ª£p $x<20$ qu√° nhi·ªÅu." },
      { text: "$|x|-20\\le 0{,}05$", correct: false, rationale: "Sai c√¥ng th·ª©c." },
      { text: "$x\\le 20{,}05$",     correct: false, rationale: "Sai v√¨ thi·∫øu c·∫≠n d∆∞·ªõi." }
    ],
    hint: "Sai s·ªë = kho·∫£ng c√°ch ‚Üí d√πng gi√° tr·ªã tuy·ªát ƒë·ªëi."
  },

  // --- V·∫¨N D·ª§NG CAO (1) ---
  {
    level: "V·∫≠n d·ª•ng cao",
    text: "Gi√° tr·ªã nh·ªè nh·∫•t c·ªßa $A=|x-2|+|x-10|$ l√†:",
    options: [
      { text: "$8$",  correct: true,  rationale: "ƒê√∫ng! $|x-2|+|10-x|\\ge |(x-2)+(10-x)|=8$, ƒë·∫°t ƒë∆∞·ª£c khi $2\\le x\\le 10$." },
      { text: "$0$",  correct: false, rationale: "Sai." },
      { text: "$12$", correct: false, rationale: "Sai." },
      { text: "$2$",  correct: false, rationale: "Sai." }
    ],
    hint: "D√πng $|a|+|b|\\ge |a+b|$."
  }
];

/* =========================
   GAME ENGINE
   - Random c√¢u h·ªèi + ƒë√°p √°n
   - Next ·∫©n gi·∫£i th√≠ch
   - Rationale font l·ªõn + LaTeX (innerHTML)
========================= */
const Game = {
  score: 0,
  currentIdx: 0,
  answered: false,
  playList: [], // danh s√°ch c√¢u ƒë√£ random

  start() {
    this.score = 0;
    this.currentIdx = 0;
    this.answered = false;

    // ‚úÖ random th·ª© t·ª± c√¢u h·ªèi + random ƒë√°p √°n
    this.playList = shuffleArray(QUESTIONS).map(q => ({
      ...q,
      options: shuffleArray(q.options)
    }));

    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('end-screen').classList.add('hidden');
    document.getElementById('game-screen').classList.remove('hidden');
    document.getElementById('game-screen').classList.add('flex');

    this.loadQuestion();
  },

  loadQuestion() {
    this.answered = false;
    const q = this.playList[this.currentIdx];

    // Update UI
    document.getElementById('q-current').innerText = this.currentIdx + 1;
    document.getElementById('q-progress').innerText = `${this.currentIdx + 1}/${this.playList.length}`;
    document.getElementById('score').innerText = this.score;
    document.getElementById('level-badge').innerText = q.level;

    // Question
    document.getElementById('question-text').innerHTML = q.text;

    // Options
    const grid = document.getElementById('options-grid');
    grid.innerHTML = '';

    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className =
        'option-btn bg-white border-2 border-blue-100 p-4 rounded-2xl text-left text-lg font-semibold text-gray-700 hover:border-blue-400 shadow-sm w-full h-full flex items-center';
      btn.innerHTML = `
        <span class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center mr-3 text-sm font-bold border border-blue-200 shrink-0">
          ${String.fromCharCode(65 + i)}
        </span>
        <span>${opt.text}</span>
      `;
      btn.onclick = () => this.check(btn, opt, q);
      grid.appendChild(btn);
    });

    // ‚úÖ ·∫®n gi·∫£i th√≠ch khi sang c√¢u m·ªõi
    document.getElementById('feedback-panel').classList.add('translate-y-full');

    // MathJax
    if (window.MathJax) MathJax.typesetPromise();
  },

  check(btn, opt, q) {
    if (this.answered) return;
    this.answered = true;

    const btns = document.querySelectorAll('.option-btn');
    btns.forEach(b => (b.disabled = true));

    const feedbackPanel = document.getElementById('feedback-panel');
    const fbIcon = document.getElementById('fb-icon');
    const fbTitle = document.getElementById('fb-title');
    const fbContent = document.getElementById('fb-content');
    const fbHintBox = document.getElementById('fb-hint-box');
    const fbHint = document.getElementById('fb-hint');

    // ‚úÖ TƒÉng c·ª° ch·ªØ ph·∫ßn gi·∫£i th√≠ch (d·ªÖ nh√¨n)
    fbContent.className = "text-gray-700 text-xl md:text-2xl leading-relaxed mb-2";

    if (opt.correct) {
      this.score += 10;
      document.getElementById('score').innerText = this.score;
      btn.classList.add('correct');

      fbIcon.innerText = 'üê°';
      fbTitle.innerText = "Ch√≠nh X√°c!";
      fbTitle.className = "text-xl font-extrabold mb-1 text-green-600";

      this.playTone(600, 'sine');
      setTimeout(() => this.playTone(800, 'sine'), 100);

      confetti({ particleCount: 100, spread: 70, origin: { y: 0.8 } });

      fbHintBox.classList.add('hidden'); // ƒë√∫ng th√¨ ·∫©n g·ª£i √Ω
    } else {
      btn.classList.add('wrong');

      // highlight correct
      const correctIdx = q.options.findIndex(o => o.correct);
      btns[correctIdx].classList.add('correct', 'opacity-70');

      fbIcon.innerText = 'üêô';
      fbTitle.innerText = "Ch∆∞a ƒë√∫ng r·ªìi!";
      fbTitle.className = "text-xl font-extrabold mb-1 text-red-500";

      this.playTone(200, 'sawtooth');

      fbHintBox.classList.remove('hidden');
      fbHint.innerHTML = q.hint;
    }

    // ‚úÖ Rationale d√πng innerHTML ƒë·ªÉ ch·ª©a LaTeX $...$
    fbContent.innerHTML = opt.rationale;

    // Show panel
    feedbackPanel.classList.remove('translate-y-full');

    if (window.MathJax) MathJax.typesetPromise();
  },

  next() {
    // ‚úÖ b·∫•m Next l√† ‚Äúm·∫•t gi·∫£i th√≠ch‚Äù ngay
    document.getElementById('feedback-panel').classList.add('translate-y-full');

    this.currentIdx++;
    if (this.currentIdx < this.playList.length) {
      this.loadQuestion();
    } else {
      this.finish();
    }
  },

  finish() {
    document.getElementById('game-screen').classList.remove('flex');
    document.getElementById('game-screen').classList.add('hidden');
    document.getElementById('end-screen').classList.remove('hidden');
    document.getElementById('end-screen').classList.add('flex');

    document.getElementById('final-score').innerText = this.score;
    document.getElementById('final-correct').innerText = Math.round(this.score / 10);

    const msg = document.getElementById('end-msg');
    if (this.score === this.playList.length * 10) msg.innerText = "Tuy·ªát ƒë·ªânh! B·∫°n l√† Vua Bi·ªÉn C·∫£! üßú‚Äç‚ôÇÔ∏è";
    else if (this.score >= (this.playList.length * 10) * 0.8) msg.innerText = "R·∫•t gi·ªèi! Thuy·ªÅn tr∆∞·ªüng t√†i ba! üõ≥Ô∏è";
    else if (this.score >= (this.playList.length * 10) * 0.5) msg.innerText = "Kh√° l·∫Øm! C·ªë g·∫Øng l·∫∑n s√¢u h∆°n nh√©! üèä";
    else msg.innerText = "ƒê·ª´ng n·∫£n! Trang b·ªã th√™m ki·∫øn th·ª©c v√† th·ª≠ l·∫°i nh√©! üõü";

    this.playTone(400, 'square');
    setTimeout(() => this.playTone(600, 'square'), 200);
  },

  playTone(freq, type) {
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    if (!AudioContext) return;
    const ctx = new AudioContext();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.frequency.value = freq;
    osc.type = type;
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    gain.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.5);
    osc.stop(ctx.currentTime + 0.5);
  }
};

/* Bubble Generator (gi·ªØ nguy√™n) */
function createBubbles() {
  const container = document.getElementById('bubbles-container');
  if (!container) return;
  const bubbleCount = 15;
  container.innerHTML = "";
  for (let i = 0; i < bubbleCount; i++) {
    const bubble = document.createElement('div');
    bubble.classList.add('bubble');
    const size = Math.random() * 60 + 20 + 'px';
    bubble.style.width = size;
    bubble.style.height = size;
    bubble.style.left = Math.random() * 100 + 'vw';
    bubble.style.animationDuration = Math.random() * 5 + 5 + 's';
    bubble.style.animationDelay = Math.random() * 5 + 's';
    container.appendChild(bubble);
  }
}
createBubbles();
</script>
</body>
</html>
