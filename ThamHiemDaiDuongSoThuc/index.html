<!DOCTYPE html>
<html lang="vi">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√°m Hi·ªÉm ƒê·∫°i D∆∞∆°ng S·ªë Th·ª±c</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
            overflow-x: hidden;
            background-attachment: fixed;
        }

        /* Bubble Animation Background */
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            bottom: -50px;
            animation: rise 10s infinite ease-in;
            pointer-events: none;
            z-index: 0;
        }
        @keyframes rise {
            0% { bottom: -50px; transform: translateX(0); }
            50% { transform: translateX(100px); }
            100% { bottom: 100vh; transform: translateX(-100px); }
        }

        .game-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 4px solid #fff;
            box-shadow: 0 20px 50px rgba(0, 78, 146, 0.3);
            border-radius: 30px;
        }

        .option-btn {
            transition: all 0.2s ease-out;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 10px 0 #e2e8f0;
        }
        
        .option-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: none;
        }

        .option-btn.correct {
            background-color: #86efac;
            border-color: #22c55e;
            color: #14532d;
            box-shadow: 0 4px 0 #15803d;
        }

        .option-btn.wrong {
            background-color: #fca5a5;
            border-color: #ef4444;
            color: #7f1d1d;
            box-shadow: 0 4px 0 #b91c1c;
        }

        /* Animations */
        @keyframes submarine-float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }
        .submarine { animation: submarine-float 4s ease-in-out infinite; }

        @keyframes fish-swim {
            0% { transform: translateX(100vw); }
            100% { transform: translateX(-100vw); }
        }
        .fish { position: absolute; animation: fish-swim 20s linear infinite; opacity: 0.6; z-index: 0; }
        

    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 relative">

    <!-- Background Elements -->
    <div id="bubbles-container"></div>
    <div class="fish text-6xl" style="top: 20%; animation-duration: 25s;">üê†</div>
    <div class="fish text-5xl" style="top: 60%; animation-duration: 18s; animation-delay: 5s;">üê°</div>
    <div class="fish text-7xl" style="top: 80%; animation-duration: 30s; animation-delay: 2s;">üêã</div>

    <!-- MAIN APP CONTAINER -->
    <div id="app" class="w-full max-w-4xl z-10 min-h-[600px] relative">
        
        <!-- START SCREEN -->
        <div id="start-screen" class="game-card absolute inset-0 flex flex-col items-center justify-center p-8 text-center z-20">
            <div class="submarine text-9xl mb-6">ü§ø</div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-blue-600 mb-2 drop-shadow-sm">
                Th√°m Hi·ªÉm ƒê·∫°i D∆∞∆°ng
            </h1>
            <h2 class="text-2xl font-bold text-cyan-600 mb-6">S·ªë Th·ª±c & Gi√° Tr·ªã Tuy·ªát ƒê·ªëi</h2>
            
            <div class="bg-blue-50 p-6 rounded-2xl mb-8 border-2 border-blue-100 max-w-lg">
                <p class="text-gray-600 text-lg mb-4">Ch√†o m·ª´ng c√°c nh√† th√°m hi·ªÉm nh√≠! H√£y d√πng ki·∫øn th·ª©c To√°n h·ªçc ƒë·ªÉ l·∫∑n s√¢u xu·ªëng ƒë√°y ƒë·∫°i d∆∞∆°ng v√† t√¨m kho b√°u nh√©!</p>
                <div class="flex justify-center space-x-4 text-sm font-bold text-blue-400">
                    <span class="flex items-center"><i class="ph-fill ph-check-circle mr-1"></i> 15 C√¢u h·ªèi</span>
                    <span class="flex items-center"><i class="ph-fill ph-clock mr-1"></i> T·ª± do</span>
                </div>
            </div>

            <button onclick="Game.start()" class="group relative px-10 py-4 bg-yellow-400 text-yellow-900 font-bold text-2xl rounded-full shadow-[0_6px_0_#b45309] active:shadow-none active:translate-y-[6px] transition-all hover:bg-yellow-300">
                L·∫∑n Ngay! üåä
            </button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="game-card hidden flex-col h-full absolute inset-0 bg-white/90">
            <!-- Header -->
            <div class="bg-blue-600 text-white p-4 rounded-t-[26px] flex justify-between items-center shadow-lg">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-xl font-bold border-2 border-white/40">
                        <span id="q-current">1</span>
                    </div>
                    <div class="leading-tight">
                        <div class="text-xs font-bold text-blue-200 uppercase">Ti·∫øn ƒë·ªô</div>
                        <div class="font-bold"><span id="q-progress">1/15</span></div>
                    </div>
                </div>
                
                <div class="bg-white/10 px-4 py-2 rounded-xl border border-white/20 backdrop-blur-sm">
                    <span class="text-blue-200 text-xs font-bold uppercase mr-2">ƒêi·ªÉm</span>
                    <span id="score" class="text-2xl font-bold text-yellow-300">0</span>
                </div>
            </div>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-6 md:p-8 pb-32 custom-scrollbar">
                
                <!-- Question Block -->
                <div class="max-w-3xl mx-auto">
                    <div class="mb-4 flex items-center">
                        <span id="level-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-purple-100 text-purple-600 uppercase tracking-wider border border-purple-200">
                            Nh·∫≠n bi·∫øt
                        </span>
                    </div>

                    <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-gray-800 mb-8 leading-snug">
                        <!-- Question content -->
                    </h2>

                    <!-- Options Grid -->
                    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Buttons injected here -->
                    </div>
                </div>
            </div>

            <!-- Feedback Panel (Slide up) -->
            <div id="feedback-panel" class="absolute bottom-0 inset-x-0 bg-white border-t-4 border-blue-100 p-6 rounded-b-[26px] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] transform translate-y-full transition-transform duration-300 z-30">
                <div class="max-w-3xl mx-auto flex gap-4 md:gap-6 items-start">
                    <div id="fb-icon" class="text-5xl shrink-0 bounce"></div>
                    <div class="flex-1">
                        <h3 id="fb-title" class="text-xl font-extrabold mb-1"></h3>
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">GI·∫¢I TH√çCH</div>
                        <p id="fb-content" class="text-gray-700 text-lg leading-relaxed mb-2"></p>
                        <div id="fb-hint-box" class="hidden bg-yellow-50 text-yellow-800 p-3 rounded-lg text-sm border border-yellow-200 flex items-start">
                            <i class="ph-bold ph-lightbulb text-lg mr-2 mt-0.5"></i>
                            <span id="fb-hint"></span>
                        </div>
                    </div>
                    <button onclick="Game.next()" class="shrink-0 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-xl shadow-lg transition-transform hover:scale-105 active:scale-95">
                        <i class="ph-bold ph-arrow-right text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- END SCREEN -->
        <div id="end-screen" class="game-card hidden absolute inset-0 flex-col items-center justify-center p-8 z-20 text-center">
            <div class="relative mb-8">
                <div class="absolute inset-0 bg-yellow-300 blur-3xl opacity-40 rounded-full animate-pulse"></div>
                <div class="text-9xl relative z-10 drop-shadow-2xl">üëë</div>
            </div>
            
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Chuy·∫øn Th√°m Hi·ªÉm K·∫øt Th√∫c!</h2>
            <p id="end-msg" class="text-gray-600 text-lg mb-8">B·∫°n ƒë√£ thu th·∫≠p ƒë∆∞·ª£c bao nhi√™u ki·∫øn th·ª©c?</p>

            <div class="grid grid-cols-2 gap-6 w-full max-w-md mb-8">
                <div class="bg-blue-50 p-4 rounded-2xl border-2 border-blue-100">
                    <div class="text-blue-500 text-xs font-bold uppercase">T·ªïng ƒëi·ªÉm</div>
                    <div id="final-score" class="text-4xl font-black text-blue-700">0</div>
                </div>
                <div class="bg-green-50 p-4 rounded-2xl border-2 border-green-100">
                    <div class="text-green-500 text-xs font-bold uppercase">Tr·∫£ l·ªùi ƒë√∫ng</div>
                    <div class="text-4xl font-black text-green-700"><span id="final-correct">0</span>/15</div>
                </div>
            </div>

            <button onclick="location.reload()" class="px-8 py-3 bg-gray-800 text-white font-bold rounded-full shadow-lg hover:bg-gray-900 transition-all flex items-center space-x-2">
                <i class="ph-bold ph-arrow-counter-clockwise"></i>
                <span>Ch∆°i L·∫°i T·ª´ ƒê·∫ßu</span>
            </button>
        </div>

    </div>

<script>
/* ================== RANDOM HELPERS ================== */
function shuffleArray(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function buildShuffledQuestions(baseQuestions) {
  // clone s√¢u ƒë·ªÉ kh√¥ng l√†m h·ªèng QUESTIONS g·ªëc
  const cloned = baseQuestions.map(q => ({
    ...q,
    options: q.options.map(o => ({ ...o }))
  }));

  // random ƒë√°p √°n trong t·ª´ng c√¢u
  const withShuffledOptions = cloned.map(q => ({
    ...q,
    options: shuffleArray(q.options)
  }));

  // random th·ª© t·ª± c√¢u h·ªèi
  return shuffleArray(withShuffledOptions);
}
/* ================== DATABASE ================== */
    const QUESTIONS = [
        // --- NH·∫¨N BI·∫æT (6 c√¢u) ---
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "T·∫≠p h·ª£p c√°c s·ªë th·ª±c ƒë∆∞·ª£c k√≠ hi·ªáu l√†:",
            options: [
                { text: "$\\mathbb{R}$", correct: true, rationale: "Ch√≠nh x√°c! $\\mathbb{R}$ l√† k√≠ hi·ªáu chu·∫©n c·ªßa t·∫≠p h·ª£p s·ªë th·ª±c (Real numbers)." },
                { text: "$\\mathbb{Q}$", correct: false, rationale: "Sai. $\\mathbb{Q}$ l√† k√≠ hi·ªáu c·ªßa t·∫≠p s·ªë h·ªØu t·ªâ." },
                { text: "$\\mathbb{Z}$", correct: false, rationale: "Sai. $\\mathbb{Z}$ l√† k√≠ hi·ªáu c·ªßa t·∫≠p s·ªë nguy√™n." },
                { text: "$\\mathbb{N}$", correct: false, rationale: "Sai. $\\mathbb{N}$ l√† k√≠ hi·ªáu c·ªßa t·∫≠p s·ªë t·ª± nhi√™n." }
            ],
            hint: "T√™n ti·∫øng Anh l√† Real numbers, b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ c√°i g√¨?"
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y l√† <b>ƒë√∫ng</b>?",
            options: [
                { text: "M·ªói s·ªë th·ª±c l√† m·ªôt s·ªë h·ªØu t·ªâ ho·∫∑c m·ªôt s·ªë v√¥ t·ªâ.", correct: true, rationale: "ƒê√∫ng. T·∫≠p s·ªë th·ª±c $\\mathbb{R}$ l√† h·ª£p c·ªßa t·∫≠p s·ªë h·ªØu t·ªâ $\\mathbb{Q}$ v√† t·∫≠p s·ªë v√¥ t·ªâ $\\mathbb{I}$." },
                { text: "S·ªë th·ª±c d∆∞∆°ng lu√¥n l·ªõn h∆°n s·ªë th·ª±c √¢m.", correct: true, rationale: "C√¢u n√†y c≈©ng ƒë√∫ng, nh∆∞ng c√¢u A bao qu√°t ƒë·ªãnh nghƒ©a h∆°n. (Trong ng·ªØ c·∫£nh n√†y ∆∞u ti√™n ƒë·ªãnh nghƒ©a c·∫•u t·∫°o t·∫≠p h·ª£p)." }, // Wait, multiple correct? Let's fix.
                // FIXING OPTION B to make it clearly wrong/less preferred or rephrase question.
                // Rephrasing B to be wrong.
            ],
            // Let's rewrite the options for Question 2 to be stricter.
            override: true 
        },
        // RE-DO Question 2
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "Ph√°t bi·ªÉu n√†o sau ƒë√¢y l√† <b>ƒë√∫ng</b> v·ªÅ m·ªëi quan h·ªá gi·ªØa c√°c t·∫≠p h·ª£p s·ªë?",
            options: [
                { text: "$\\mathbb{Q} \\subset \\mathbb{R}$", correct: true, rationale: "Ch√≠nh x√°c! T·∫≠p s·ªë h·ªØu t·ªâ l√† con c·ªßa t·∫≠p s·ªë th·ª±c." },
                { text: "$\\mathbb{R} \\subset \\mathbb{Q}$", correct: false, rationale: "Sai. T·∫≠p s·ªë th·ª±c ch·ª©a c·∫£ s·ªë v√¥ t·ªâ n√™n kh√¥ng th·ªÉ l√† con c·ªßa s·ªë h·ªØu t·ªâ." },
                { text: "$\\mathbb{I} \\subset \\mathbb{Q}$", correct: false, rationale: "Sai. S·ªë v√¥ t·ªâ v√† s·ªë h·ªØu t·ªâ l√† hai t·∫≠p h·ª£p r·ªùi nhau." },
                { text: "$\\mathbb{R} \\subset \\mathbb{Z}$", correct: false, rationale: "Sai ho√†n to√†n." }
            ],
            hint: "T·∫≠p n√†o r·ªông nh·∫•t ch·ª©a t·∫•t c·∫£ c√°c t·∫≠p c√≤n l·∫°i?"
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "Gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa s·ªë th·ª±c $a$, k√≠ hi·ªáu $|a|$, l√†:",
            options: [
                { text: "Kho·∫£ng c√°ch t·ª´ ƒëi·ªÉm $a$ ƒë·∫øn ƒëi·ªÉm $0$ tr√™n tr·ª•c s·ªë.", correct: true, rationale: "R·∫•t chu·∫©n! Gi√° tr·ªã tuy·ªát ƒë·ªëi ch√≠nh l√† kho·∫£ng c√°ch h√¨nh h·ªçc ƒë·∫øn g·ªëc t·ªça ƒë·ªô." },
                { text: "Ch√≠nh s·ªë $a$.", correct: false, rationale: "Ch∆∞a ƒë·ªß. N·∫øu $a$ √¢m th√¨ $|a|$ kh√¥ng b·∫±ng $a$." },
                { text: "S·ªë ƒë·ªëi c·ªßa $a$.", correct: false, rationale: "Ch∆∞a ƒë·ªß. N·∫øu $a$ d∆∞∆°ng th√¨ sai." },
                { text: "Lu√¥n l√† m·ªôt s·ªë d∆∞∆°ng.", correct: false, rationale: "Thi·∫øu tr∆∞·ªùng h·ª£p b·∫±ng $0$." }
            ],
            hint: "Nghƒ© v·ªÅ h√¨nh ·∫£nh tr·ª•c s·ªë, ƒë·ªô d√†i ƒëo·∫°n th·∫≥ng n·ªëi t·ª´ 0 ƒë·∫øn a g·ªçi l√† g√¨?"
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "N·∫øu $x$ l√† m·ªôt s·ªë th·ª±c √¢m, th√¨ $|x|$ b·∫±ng:",
            options: [
                { text: "$-x$", correct: true, rationale: "ƒê√∫ng. N·∫øu $x < 0$ th√¨ b·ªè d·∫•u gi√° tr·ªã tuy·ªát ƒë·ªëi ph·∫£i th√™m d·∫•u tr·ª´ ƒë·∫±ng tr∆∞·ªõc ƒë·ªÉ k·∫øt qu·∫£ th√†nh d∆∞∆°ng." },
                { text: "$x$", correct: false, rationale: "Sai. V√¨ $x$ ƒëang √¢m, m√† gi√° tr·ªã tuy·ªát ƒë·ªëi kh√¥ng th·ªÉ √¢m." },
                { text: "$0$", correct: false, rationale: "Sai." },
                { text: "$1$", correct: false, rationale: "Sai." }
            ],
            hint: "V√≠ d·ª• $|-5| = 5 = -(-5)$."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "S·ªë ƒë·ªëi c·ªßa s·ªë th·ª±c $\\sqrt{2}$ l√†:",
            options: [
                { text: "$-\\sqrt{2}$", correct: true, rationale: "Ch√≠nh x√°c. S·ªë ƒë·ªëi c·ªßa $a$ l√† $-a$." },
                { text: "$\\sqrt{2}$", correct: false, rationale: "Sai. ƒê√¢y l√† ch√≠nh n√≥." },
                { text: "$\\frac{1}{\\sqrt{2}}$", correct: false, rationale: "Sai. ƒê√¢y l√† s·ªë ngh·ªãch ƒë·∫£o." },
                { text: "$2$", correct: false, rationale: "Sai." }
            ],
            hint: "Ch·ªâ c·∫ßn th√™m d·∫•u tr·ª´ v√†o tr∆∞·ªõc s·ªë ƒë√≥."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "Ch·ªçn kh·∫≥ng ƒë·ªãnh <b>sai</b> trong c√°c kh·∫≥ng ƒë·ªãnh sau:",
            options: [
                { text: "$| -2,5 | = -2,5$", correct: true, rationale: "ƒê√∫ng l√† c√¢u n√†y Sai! Gi√° tr·ªã tuy·ªát ƒë·ªëi kh√¥ng bao gi·ªù √¢m. $|-2,5|$ ph·∫£i b·∫±ng $2,5$." },
                { text: "$| 1,5 | = 1,5$", correct: false, rationale: "C√¢u n√†y ƒê√∫ng." },
                { text: "$| -\\sqrt{3} | = \\sqrt{3}$", correct: false, rationale: "C√¢u n√†y ƒê√∫ng." },
                { text: "$| 0 | = 0$", correct: false, rationale: "C√¢u n√†y ƒê√∫ng." }
            ],
            hint: "H√£y t√¨m c√¢u n√†o c√≥ k·∫øt qu·∫£ c·ªßa gi√° tr·ªã tuy·ªát ƒë·ªëi l√† m·ªôt s·ªë √¢m."
        },

        // --- TH√îNG HI·ªÇU (5 c√¢u) ---
        {
            level: "Th√¥ng hi·ªÉu",
            text: "So s√°nh hai s·ªë th·ª±c: $-1,25$ v√† $-1,3$.",
            options: [
                { text: "$-1,25 > -1,3$", correct: true, rationale: "Tuy·ªát v·ªùi! V·ªõi hai s·ªë √¢m, s·ªë n√†o c√≥ gi√° tr·ªã tuy·ªát ƒë·ªëi nh·ªè h∆°n th√¨ l·ªõn h∆°n ($1,25 < 1,3 \\Rightarrow -1,25 > -1,3$)." },
                { text: "$-1,25 < -1,3$", correct: false, rationale: "Sai r·ªìi. Tr√™n tr·ª•c s·ªë, -1,25 n·∫±m b√™n ph·∫£i -1,3." },
                { text: "$-1,25 = -1,3$", correct: false, rationale: "Sai." },
                { text: "Kh√¥ng so s√°nh ƒë∆∞·ª£c", correct: false, rationale: "Sai." }
            ],
            hint: "S·ªë √¢m 'n·ª£ √≠t h∆°n' th√¨ 'gi√†u h∆°n' (l·ªõn h∆°n)."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "T√¨m $x$ bi·∫øt $|x| = \\sqrt{5}$.",
            options: [
                { text: "$x = \\sqrt{5}$ ho·∫∑c $x = -\\sqrt{5}$", correct: true, rationale: "Ch√≠nh x√°c! C√≥ hai s·ªë th·ª±c c√≥ gi√° tr·ªã tuy·ªát ƒë·ªëi b·∫±ng $\\sqrt{5}$ l√† ch√≠nh n√≥ v√† s·ªë ƒë·ªëi c·ªßa n√≥." },
                { text: "Ch·ªâ c√≥ $x = \\sqrt{5}$", correct: false, rationale: "Thi·∫øu nghi·ªám √¢m." },
                { text: "Ch·ªâ c√≥ $x = -\\sqrt{5}$", correct: false, rationale: "Thi·∫øu nghi·ªám d∆∞∆°ng." },
                { text: "$x = 5$ ho·∫∑c $x = -5$", correct: false, rationale: "Sai. $|5| = 5$ ch·ª© kh√¥ng ph·∫£i $\\sqrt{5}$." }
            ],
            hint: "C√≥ bao nhi√™u s·ªë c√≥ kho·∫£ng c√°ch ƒë·∫øn 0 b·∫±ng $\\sqrt{5}$?"
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh: $|-3,5| + |1,5| - \\sqrt{4}$ l√†:",
            options: [
                { text: "$3$", correct: true, rationale: "ƒê√∫ng! $3,5 + 1,5 - 2 = 5 - 2 = 3$." },
                { text: "$7$", correct: false, rationale: "Sai. B·∫°n c√≥ th·ªÉ ƒë√£ c·ªông nh·∫ßm ho·∫∑c kh√¥ng khai cƒÉn." },
                { text: "$-3$", correct: false, rationale: "Sai d·∫•u." },
                { text: "$0$", correct: false, rationale: "Sai." }
            ],
            hint: "T√≠nh t·ª´ng gi√° tr·ªã tuy·ªát ƒë·ªëi v√† cƒÉn tr∆∞·ªõc: $3,5 + 1,5 - 2 = ?$"
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "S·∫Øp x·∫øp c√°c s·ªë sau theo th·ª© t·ª± t·ª´ nh·ªè ƒë·∫øn l·ªõn: $-2; \\, 0; \\, -\\sqrt{5}; \\, 1,5$.",
            options: [
                { text: "$-\\sqrt{5}; \\, -2; \\, 0; \\, 1,5$", correct: true, rationale: "Ch√≠nh x√°c! V√¨ $\\sqrt{5} \\approx 2,236$ n√™n $-\\sqrt{5} \\approx -2,236 < -2$." },
                { text: "$-2; \\, -\\sqrt{5}; \\, 0; \\, 1,5$", correct: false, rationale: "Sai. $-2$ l·ªõn h∆°n $-\\sqrt{5}$." },
                { text: "$0; \\, -2; \\, -\\sqrt{5}; \\, 1,5$", correct: false, rationale: "Sai. S·ªë √¢m ph·∫£i nh·ªè h∆°n 0." },
                { text: "$-\\sqrt{5}; \\, 1,5; \\, -2; \\, 0$", correct: false, rationale: "Sai th·ª© t·ª±." }
            ],
            hint: "H√£y ∆∞·ªõc l∆∞·ª£ng $\\sqrt{5}$ kho·∫£ng $2,2...$ r·ªìi so s√°nh hai s·ªë √¢m."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "T√≠nh gi√° tr·ªã bi·ªÉu th·ª©c $M = a - |a|$ v·ªõi $a = -5$.",
            options: [
                { text: "$-10$", correct: true, rationale: "ƒê√∫ng! Thay v√†o ta c√≥: $(-5) - |-5| = (-5) - 5 = -10$." },
                { text: "$0$", correct: false, rationale: "Sai. B·∫°n nh·∫ßm d·∫•u r·ªìi: $(-5) - 5$ kh√¥ng b·∫±ng 0." },
                { text: "$10$", correct: false, rationale: "Sai." },
                { text: "$-5$", correct: false, rationale: "Sai." }
            ],
            hint: "Thay s·ªë c·∫©n th·∫≠n: $a$ l√† √¢m 5, tr·ª´ ƒëi gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa √¢m 5."
        },

        // --- V·∫¨N D·ª§NG (3 c√¢u) ---
        {
            level: "V·∫≠n d·ª•ng",
            text: "T√¨m $x$ bi·∫øt: $|x - 0,5| - 1,5 = 2$.",
            options: [
                { text: "$x = 4$ ho·∫∑c $x = -3$", correct: true, rationale: "Xu·∫•t s·∫Øc! $|x - 0,5| = 3,5$. Suy ra $x-0,5=3,5$ ho·∫∑c $x-0,5=-3,5$. V·∫≠y $x=4$ ho·∫∑c $x=-3$." },
                { text: "$x = 4$", correct: false, rationale: "Thi·∫øu m·ªôt tr∆∞·ªùng h·ª£p." },
                { text: "$x = 4$ ho·∫∑c $x = 3$", correct: false, rationale: "Sai nghi·ªám th·ª© hai." },
                { text: "$x = 2$ ho·∫∑c $x = -2$", correct: false, rationale: "Sai b∆∞·ªõc chuy·ªÉn v·∫ø ƒë·∫ßu ti√™n." }
            ],
            hint: "B∆∞·ªõc 1: Chuy·ªÉn $-1,5$ sang v·∫ø ph·∫£i ƒë·ªÉ t√¨m $|x - 0,5|$. B∆∞·ªõc 2: Chia 2 tr∆∞·ªùng h·ª£p."
        },
        {
            level: "V·∫≠n d·ª•ng",
            text: "T√≠nh gi√° tr·ªã bi·ªÉu th·ª©c: $A = \\sqrt{(-4)^2} - \\sqrt{16} + |-3| \\cdot \\sqrt{9}$.",
            options: [
                { text: "$9$", correct: true, rationale: "Gi·ªèi l·∫Øm! $A = 4 - 4 + 3 \\cdot 3 = 0 + 9 = 9$." },
                { text: "$17$", correct: false, rationale: "Sai. L∆∞u √Ω $\\sqrt{(-4)^2} = 4$ v√† $\\sqrt{16} = 4$, ch√∫ng tri·ªát ti√™u nhau." },
                { text: "$1$", correct: false, rationale: "Sai t√≠nh to√°n." },
                { text: "$-9$", correct: false, rationale: "Sai d·∫•u gi√° tr·ªã tuy·ªát ƒë·ªëi." }
            ],
            hint: "L∆∞u √Ω $\\sqrt{A^2} = |A|$. H√£y t√≠nh t·ª´ng s·ªë h·∫°ng m·ªôt."
        },
        {
            level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
            text: "M·ªôt chi ti·∫øt m√°y c√≥ chi·ªÅu d√†i chu·∫©n l√† $20$ cm. Kƒ© s∆∞ cho ph√©p sai s·ªë kh√¥ng qu√° $0,05$ cm. G·ªçi $x$ l√† chi·ªÅu d√†i th·ª±c t·∫ø c·ªßa chi ti·∫øt m√°y. ƒêi·ªÅu ki·ªán ƒë·ªÉ chi ti·∫øt m√°y ƒê·∫†T CHU·∫®N l√†:",
            options: [
                { text: "$|x - 20| \\le 0,05$", correct: true, rationale: "Ch√≠nh x√°c! Sai s·ªë ch√≠nh l√† kho·∫£ng c√°ch (tr·ªã tuy·ªát ƒë·ªëi) gi·ªØa chi·ªÅu d√†i th·ª±c t·∫ø ($x$) v√† chi·ªÅu d√†i chu·∫©n ($20$)." },
                { text: "$x - 20 \\le 0,05$", correct: false, rationale: "Ch∆∞a ƒë·ªß. N·∫øu $x$ nh·ªè h∆°n $20$ qu√° nhi·ªÅu (v√≠ d·ª• 10cm) th√¨ bi·ªÉu th·ª©c n√†y v·∫´n ƒë√∫ng nh∆∞ng m√°y h·ªèng." },
                { text: "$|x| - 20 \\le 0,05$", correct: false, rationale: "Sai c√¥ng th·ª©c." },
                { text: "$x \\le 20,05$", correct: false, rationale: "Thi·∫øu c·∫≠n d∆∞·ªõi ($x$ kh√¥ng ƒë∆∞·ª£c qu√° nh·ªè)." }
            ],
            hint: "Sai s·ªë l√† kho·∫£ng c√°ch ch√™nh l·ªách gi·ªØa th·ª±c t·∫ø v√† chu·∫©n. D√πng gi√° tr·ªã tuy·ªát ƒë·ªëi ƒë·ªÉ bi·ªÉu di·ªÖn kho·∫£ng c√°ch."
        },

        // --- V·∫¨N D·ª§NG CAO (1 c√¢u) ---
        {
            level: "V·∫≠n d·ª•ng cao",
            text: "T√¨m gi√° tr·ªã nh·ªè nh·∫•t c·ªßa bi·ªÉu th·ª©c $A = |x - 2| + |x - 10|$.",
            options: [
                { text: "8", correct: true, rationale: "ƒê·ªânh cao! $A = |x-2| + |10-x| \\ge |x-2 + 10-x| = |8| = 8$. D·∫•u b·∫±ng x·∫£y ra khi $2 \\le x \\le 10$." },
                { text: "0", correct: false, rationale: "Kh√¥ng th·ªÉ b·∫±ng 0 v√¨ $x$ kh√¥ng th·ªÉ v·ª´a b·∫±ng 2 v·ª´a b·∫±ng 10." },
                { text: "12", correct: false, rationale: "Sai." },
                { text: "2", correct: false, rationale: "Sai." }
            ],
            hint: "S·ª≠ d·ª•ng b·∫•t ƒë·∫≥ng th·ª©c $|a| + |b| \\ge |a+b|$. H√£y ƒë·ªïi $|x-10|$ th√†nh $|10-x|$."
        }
    ];

    /* ================== GAME ENGINE ================== */
const Game = {
  score: 0,
  currentIdx: 0,
  answered: false,
  questions: [],

  start() {
    this.score = 0;
    this.currentIdx = 0;
    this.answered = false;

    // ‚úÖ RANDOM c√¢u h·ªèi + ƒë√°p √°n
    this.questions = buildShuffledQuestions(QUESTIONS);

    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('end-screen').classList.add('hidden');
    document.getElementById('game-screen').classList.remove('hidden');
    document.getElementById('game-screen').classList.add('flex');

    this.loadQuestion();
  },

  loadQuestion() {
    this.answered = false;
    const q = this.questions[this.currentIdx];

    document.getElementById('q-current').innerText = this.currentIdx + 1;
    document.getElementById('q-progress').innerText =
      `${this.currentIdx + 1}/${this.questions.length}`;
    document.getElementById('score').innerText = this.score;
    document.getElementById('level-badge').innerText = q.level;
    document.getElementById('question-text').innerHTML = q.text;

    const grid = document.getElementById('options-grid');
    grid.innerHTML = '';

    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className =
        'option-btn bg-white border-2 border-blue-100 p-4 rounded-2xl text-left text-lg font-semibold text-gray-700 hover:border-blue-400 shadow-sm w-full h-full flex items-center';

      btn.innerHTML = `
        <span class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center mr-3 text-sm font-bold border border-blue-200 shrink-0">
          ${String.fromCharCode(65 + i)}
        </span>
        <span>${opt.text}</span>
      `;

      btn.onclick = () => this.check(btn, opt, q);
      grid.appendChild(btn);
    });

    document.getElementById('feedback-panel').classList.add('translate-y-full');
    if (window.MathJax) MathJax.typesetPromise();
  },

  check(btn, opt, q) {
    if (this.answered) return;
    this.answered = true;

    const btns = document.querySelectorAll('.option-btn');
    btns.forEach(b => b.disabled = true);

    const fbPanel = document.getElementById('feedback-panel');
    const fbIcon = document.getElementById('fb-icon');
    const fbTitle = document.getElementById('fb-title');
    const fbContent = document.getElementById('fb-content');
    const fbHintBox = document.getElementById('fb-hint-box');

    if (opt.correct) {
      this.score += 10;
      document.getElementById('score').innerText = this.score;
      btn.classList.add('correct');

      fbIcon.innerText = 'üê†';
      fbTitle.innerText = 'Ch√≠nh x√°c!';
      fbTitle.className = 'text-xl font-extrabold mb-1 text-green-600';

      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.8 }
      });
    } else {
      btn.classList.add('wrong');
      const correctIdx = q.options.findIndex(o => o.correct);
      btns[correctIdx].classList.add('correct', 'opacity-70');

      fbIcon.innerText = 'üêô';
      fbTitle.innerText = 'Ch∆∞a ƒë√∫ng!';
      fbTitle.className = 'text-xl font-extrabold mb-1 text-red-500';
    }

    fbContent.innerText = opt.rationale;

    if (!opt.correct) {
      fbHintBox.classList.remove('hidden');
      document.getElementById('fb-hint').innerText = q.hint;
    } else {
      fbHintBox.classList.add('hidden');
    }

    fbPanel.classList.remove('translate-y-full');
    if (window.MathJax) MathJax.typesetPromise();
  },

  next() {
    // ·∫®n ho√†n to√†n b·∫£ng gi·∫£i th√≠ch tr∆∞·ªõc
    const feedbackPanel = document.getElementById('feedback-panel');
    feedbackPanel.classList.add('translate-y-full');

    // Reset n·ªôi dung gi·∫£i th√≠ch (tr√°nh s√≥t)
    document.getElementById('fb-content').innerText = '';
    document.getElementById('fb-hint').innerText = '';
    document.getElementById('fb-hint-box').classList.add('hidden');

    this.currentIdx++;

    if (this.currentIdx < QUESTIONS.length) {
        this.loadQuestion();
    } else {
        this.finish();
    }
  },

  finish() {
    document.getElementById('game-screen').classList.remove('flex');
    document.getElementById('game-screen').classList.add('hidden');
    document.getElementById('end-screen').classList.remove('hidden');
    document.getElementById('end-screen').classList.add('flex');

    document.getElementById('final-score').innerText = this.score;
    document.getElementById('final-correct').innerText =
      Math.round(this.score / 10);

    const msg = document.getElementById('end-msg');
    if (this.score === this.questions.length * 10)
      msg.innerText = 'Tuy·ªát ƒë·ªânh! B·∫°n l√† Vua Bi·ªÉn C·∫£! üßú‚Äç‚ôÇÔ∏è';
    else if (this.score >= this.questions.length * 8)
      msg.innerText = 'R·∫•t gi·ªèi! Thuy·ªÅn tr∆∞·ªüng t√†i ba! üõ≥Ô∏è';
    else if (this.score >= this.questions.length * 5)
      msg.innerText = 'Kh√° l·∫Øm! C·ªë g·∫Øng th√™m nh√©! üê¨';
    else
      msg.innerText = 'ƒê·ª´ng n·∫£n! H√£y th·ª≠ l·∫°i n√†o! üõü';
  }
};

/* ================== BUBBLES ================== */
function createBubbles() {
  const container = document.getElementById('bubbles-container');
  for (let i = 0; i < 15; i++) {
    const bubble = document.createElement('div');
    bubble.classList.add('bubble');
    const size = Math.random() * 60 + 20 + 'px';
    bubble.style.width = size;
    bubble.style.height = size;
    bubble.style.left = Math.random() * 100 + 'vw';
    bubble.style.animationDuration = Math.random() * 5 + 5 + 's';
    bubble.style.animationDelay = Math.random() * 5 + 's';
    container.appendChild(bubble);
  }
}
createBubbles();
</script>
</body>
</html>
