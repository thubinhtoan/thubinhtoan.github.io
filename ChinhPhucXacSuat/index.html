<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinh Ph·ª•c X√°c Su·∫•t - To√°n 8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script>
        MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        .btn-option {
            transition: all 0.2s;
            border: 2px solid #e2e8f0;
        }
        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: #667eea;
            background-color: #f7fafc;
        }
        .btn-option.correct {
            background-color: #c6f6d5 !important;
            border-color: #48bb78 !important;
            color: #044332;
        }
        .btn-option.wrong {
            background-color: #fed7d7 !important;
            border-color: #f56565 !important;
            color: #63171b;
        }
        .badge {
            font-size: 0.8em;
            padding: 4px 12px;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .level-nb { background-color: #bee3f8; color: #2c5282; }
        .level-th { background-color: #c6f6d5; color: #22543d; }
        .level-vd { background-color: #fefcbf; color: #744210; }
        .level-vdc { background-color: #fed7d7; color: #822727; }
        
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="w-full max-w-3xl">
        <!-- Start Screen -->
        <div id="start-screen" class="card p-10 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-700 mb-4">üé≤ Chinh Ph·ª•c X√°c Su·∫•t</h1>
            <p class="text-gray-600 text-lg mb-8">B√†i 1: M√¥ t·∫£ x√°c su·∫•t b·∫±ng t·ªâ s·ªë (To√°n 8)</p>
            <div class="grid grid-cols-2 gap-4 mb-8 text-left">
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <span class="text-2xl">üß†</span>
                    <span class="font-bold text-gray-700 ml-2">15 C√¢u h·ªèi</span>
                </div>
                <div class="bg-purple-50 p-4 rounded-xl border border-purple-100">
                    <span class="text-2xl">‚ö°</span>
                    <span class="font-bold text-gray-700 ml-2">4 M·ª©c ƒë·ªô</span>
                </div>
            </div>
            <button onclick="startGame()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-10 rounded-full shadow-lg transform transition hover:scale-105 text-xl">
                B·∫Øt ƒê·∫ßu Ngay üöÄ
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="flex justify-between items-center mb-6 text-white">
                <div class="text-lg font-bold">C√¢u <span id="current-q">1</span>/15</div>
                <div class="bg-white/20 px-4 py-2 rounded-full backdrop-blur-sm">
                    ƒêi·ªÉm: <span id="score" class="font-bold text-yellow-300">0</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-white/30 rounded-full h-2.5 mb-6">
                <div id="progress" class="bg-yellow-400 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>

            <div class="card p-6 md:p-8 relative min-h-[400px] flex flex-col">
                <div class="flex justify-between items-start mb-4">
                    <span id="q-level" class="badge level-nb">Nh·∫≠n bi·∫øt</span>
                </div>
                
                <h2 id="q-text" class="text-xl md:text-2xl font-bold text-gray-800 mb-6 leading-relaxed flex-grow">
                    <!-- Question text here -->
                </h2>

                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Options here -->
                </div>

                <!-- Feedback Area -->
                <div id="feedback" class="hidden mt-4 p-4 rounded-xl bg-gray-50 border-l-4 border-indigo-500 fade-in">
                    <div class="flex items-center gap-3 mb-2">
                        <span id="feedback-icon" class="text-2xl"></span>
                        <h3 id="feedback-title" class="font-bold text-lg"></h3>
                    </div>
                    <p id="feedback-text" class="text-gray-600"></p>
                    <button onclick="nextQuestion()" class="mt-4 bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 font-bold ml-auto block">
                        C√¢u ti·∫øp theo ‚ûú
                    </button>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden card p-10 text-center">
            <div class="mb-6 text-6xl">üèÜ</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Ho√†n Th√†nh!</h2>
            <p class="text-gray-500 mb-6">B·∫°n ƒë√£ chinh ph·ª•c th·ª≠ th√°ch x√°c su·∫•t.</p>
            
            <div class="bg-indigo-50 rounded-2xl p-6 mb-8">
                <div class="text-sm text-gray-500 uppercase tracking-wide font-bold">T·ªïng ƒëi·ªÉm</div>
                <div class="text-5xl font-black text-indigo-600 my-2" id="final-score">0</div>
                <p id="result-msg" class="text-indigo-800 font-medium"></p>
            </div>

            <button onclick="location.reload()" class="bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-8 rounded-full shadow-lg transition">
                Ch∆°i L·∫°i üîÑ
            </button>
        </div>
    </div>

    <!-- Audio -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3"></audio>
    <audio id="sound-win" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

    <script>
  // =========================
  // 1) DATA (ƒë√£ s·ª≠a c√¢u s·ªë nguy√™n t·ªë ƒë·ªÉ ch·ªâ 1 ƒë√°p √°n ƒë√∫ng)
  // =========================
  const questions = [
    // 6 C√¢u Nh·∫≠n bi·∫øt
    {
      level: "Nh·∫≠n bi·∫øt",
      question:
        "Trong m·ªôt tr√≤ ch∆°i, n·∫øu t·∫•t c·∫£ c√°c k·∫øt qu·∫£ ƒë·ªÅu c√≥ kh·∫£ nƒÉng x·∫£y ra nh∆∞ nhau, th√¨ x√°c su·∫•t c·ªßa bi·∫øn c·ªë A ƒë∆∞·ª£c t√≠nh theo c√¥ng th·ª©c n√†o?",
      options: [
        "P(A) = S·ªë k·∫øt qu·∫£ thu·∫≠n l·ª£i √ó T·ªïng s·ªë k·∫øt qu·∫£",
        "P(A) = S·ªë k·∫øt qu·∫£ thu·∫≠n l·ª£i / T·ªïng s·ªë k·∫øt qu·∫£",
        "P(A) = T·ªïng s·ªë k·∫øt qu·∫£ / S·ªë k·∫øt qu·∫£ thu·∫≠n l·ª£i",
        "P(A) = S·ªë k·∫øt qu·∫£ thu·∫≠n l·ª£i + T·ªïng s·ªë k·∫øt qu·∫£",
      ],
      correct: 1,
      rationale:
        "C√¥ng th·ª©c t√≠nh x√°c su·∫•t l√≠ thuy·∫øt khi c√°c k·∫øt qu·∫£ ƒë·ªìng kh·∫£ nƒÉng l√† t·ªâ s·ªë gi·ªØa s·ªë k·∫øt qu·∫£ thu·∫≠n l·ª£i cho bi·∫øn c·ªë A v√† t·ªïng s·ªë k·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra.",
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Gieo m·ªôt con x√∫c x·∫Øc c√¢n ƒë·ªëi v√† ƒë·ªìng ch·∫•t. C√≥ bao nhi√™u k·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra?",
      options: ["1", "4", "6", "8"],
      correct: 2,
      rationale: "Con x√∫c x·∫Øc c√≥ 6 m·∫∑t, ƒë∆∞·ª£c ƒë√°nh s·ªë t·ª´ 1 ƒë·∫øn 6 ch·∫•m, n√™n c√≥ 6 k·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra.",
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "X√°c su·∫•t c·ªßa m·ªôt bi·∫øn c·ªë ch·∫Øc ch·∫Øn l√† bao nhi√™u?",
      options: ["0", "0.5", "1", "100"],
      correct: 2,
      rationale: "Bi·∫øn c·ªë ch·∫Øc ch·∫Øn lu√¥n lu√¥n x·∫£y ra, n√™n t·ªâ s·ªë gi·ªØa s·ªë k·∫øt qu·∫£ thu·∫≠n l·ª£i v√† t·ªïng s·ªë k·∫øt qu·∫£ l√† 1.",
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Tung m·ªôt ƒë·ªìng xu c√¢n ƒë·ªëi. X√°c su·∫•t ƒë·ªÉ xu·∫•t hi·ªán m·∫∑t ng·ª≠a l√†:",
      options: ["1/2", "1/3", "1/4", "1"],
      correct: 0,
      rationale:
        "C√≥ 2 k·∫øt qu·∫£ c√≥ th·ªÉ (S·∫•p, Ng·ª≠a). Bi·∫øn c·ªë 'm·∫∑t ng·ª≠a' c√≥ 1 k·∫øt qu·∫£ thu·∫≠n l·ª£i. V·∫≠y x√°c su·∫•t l√† 1/2.",
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question:
        "M·ªôt h·ªôp c√≥ 3 qu·∫£ b√≥ng xanh, 2 qu·∫£ b√≥ng ƒë·ªè. T·ªïng s·ªë k·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra khi l·∫•y ng·∫´u nhi√™n 1 qu·∫£ b√≥ng l√†?",
      options: ["2", "3", "5", "6"],
      correct: 2,
      rationale: "T·ªïng s·ªë qu·∫£ b√≥ng trong h·ªôp l√† 3 + 2 = 5 qu·∫£. M·ªói qu·∫£ b√≥ng ƒë∆∞·ª£c l·∫•y ra l√† m·ªôt k·∫øt qu·∫£.",
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "N·∫øu x√°c su·∫•t c·ªßa bi·∫øn c·ªë A l√† 0, ƒëi·ªÅu n√†y c√≥ nghƒ©a l√† g√¨?",
      options: [
        "Bi·∫øn c·ªë A ch·∫Øc ch·∫Øn x·∫£y ra",
        "Bi·∫øn c·ªë A c√≥ th·ªÉ x·∫£y ra",
        "Bi·∫øn c·ªë A kh√¥ng th·ªÉ x·∫£y ra",
        "Bi·∫øn c·ªë A x·∫£y ra 50%",
      ],
      correct: 2,
      rationale: "X√°c su·∫•t b·∫±ng 0 ·ª©ng v·ªõi bi·∫øn c·ªë kh√¥ng th·ªÉ (kh√¥ng bao gi·ªù x·∫£y ra).",
    },

    // 5 C√¢u Th√¥ng hi·ªÉu
    {
      level: "Th√¥ng hi·ªÉu",
      question: "Gieo m·ªôt con x√∫c x·∫Øc c√¢n ƒë·ªëi. X√°c su·∫•t ƒë·ªÉ gieo ƒë∆∞·ª£c m·∫∑t c√≥ s·ªë ch·∫•m l√† s·ªë ch·∫µn l√†:",
      options: ["1/2", "1/3", "1/6", "2/3"],
      correct: 0,
      rationale: "C√°c m·∫∑t ch·∫µn l√† {2; 4; 6}, c√≥ 3 k·∫øt qu·∫£ thu·∫≠n l·ª£i. T·ªïng s·ªë k·∫øt qu·∫£ l√† 6. X√°c su·∫•t P = 3/6 = 1/2.",
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question:
        "M·ªôt h·ªôp ch·ª©a c√°c th·∫ª s·ªë t·ª´ 1 ƒë·∫øn 10. R√∫t ng·∫´u nhi√™n 1 th·∫ª. X√°c su·∫•t ƒë·ªÉ r√∫t ƒë∆∞·ª£c th·∫ª ghi s·ªë nguy√™n t·ªë l√†:",
      options: [
        "2/5",
        "3/10",
        "1/2",
        "4/5"
      ],
      correct: 0,
      rationale:
        "C√°c s·ªë nguy√™n t·ªë t·ª´ 1 ƒë·∫øn 10 l√† {2; 3; 5; 7}, c√≥ 4 s·ªë. T·ªïng s·ªë th·∫ª l√† 10. X√°c su·∫•t P = 4/10 = 2/5.",
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "L·ªõp 8A c√≥ 20 nam v√† 20 n·ªØ. Gi√°o vi√™n g·ªçi ng·∫´u nhi√™n m·ªôt b·∫°n l√™n b·∫£ng. X√°c su·∫•t ƒë·ªÉ b·∫°n ƒë∆∞·ª£c g·ªçi l√† n·ªØ l√†:",
      options: ["20%", "40%", "50%", "100%"],
      correct: 2,
      rationale: "T·ªïng s·ªë h·ªçc sinh l√† 20 + 20 = 40. S·ªë n·ªØ l√† 20. X√°c su·∫•t = 20/40 = 1/2 = 50%.",
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "Gieo m·ªôt con x√∫c x·∫Øc. X√°c su·∫•t ƒë·ªÉ xu·∫•t hi·ªán m·∫∑t c√≥ s·ªë ch·∫•m l·ªõn h∆°n 4 l√†:",
      options: ["1/6", "1/3", "1/2", "2/3"],
      correct: 1,
      rationale: "C√°c m·∫∑t l·ªõn h∆°n 4 l√† {5; 6}, c√≥ 2 k·∫øt qu·∫£ thu·∫≠n l·ª£i. X√°c su·∫•t P = 2/6 = 1/3.",
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "M·ªôt v√≤ng quay may m·∫Øn c√≥ 8 √¥ ƒë·ªÅu nhau, ghi c√°c s·ªë t·ª´ 1 ƒë·∫øn 8. X√°c su·∫•t quay v√†o √¥ ghi s·ªë chia h·∫øt cho 4 l√†:",
      options: ["1/8", "1/4", "3/8", "1/2"],
      correct: 1,
      rationale: "C√°c s·ªë chia h·∫øt cho 4 t·ª´ 1 ƒë·∫øn 8 l√† {4; 8}, c√≥ 2 k·∫øt qu·∫£. X√°c su·∫•t P = 2/8 = 1/4.",
    },

    // 3 C√¢u V·∫≠n d·ª•ng
    {
      level: "V·∫≠n d·ª•ng",
      question:
        "M·ªôt h·ªôp c√≥ 4 vi√™n bi xanh v√† m·ªôt s·ªë vi√™n bi ƒë·ªè. Bi·∫øt x√°c su·∫•t l·∫•y ƒë∆∞·ª£c bi xanh l√† 1/3. H·ªèi trong h·ªôp c√≥ bao nhi√™u vi√™n bi ƒë·ªè?",
      options: ["4", "8", "12", "6"],
      correct: 1,
      rationale:
        "G·ªçi x l√† s·ªë bi ƒë·ªè. T·ªïng s·ªë bi l√† 4 + x. X√°c su·∫•t l·∫•y bi xanh l√† 4/(4+x) = 1/3. Suy ra 12 = 4 + x => x = 8.",
    },
    {
      level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
      question:
        "M·ªôt l√¥ h√†ng g·ªìm 100 s·∫£n ph·∫©m, trong ƒë√≥ c√≥ 5 s·∫£n ph·∫©m b·ªã l·ªói. L·∫•y ng·∫´u nhi√™n 1 s·∫£n ph·∫©m ƒë·ªÉ ki·ªÉm tra. X√°c su·∫•t l·∫•y ƒë∆∞·ª£c s·∫£n ph·∫©m t·ªët l√†:",
      options: ["5/100", "1/20", "95/100", "19/25"],
      correct: 2,
      rationale: "S·ªë s·∫£n ph·∫©m t·ªët l√† 100 - 5 = 95. X√°c su·∫•t l·∫•y ƒë∆∞·ª£c s·∫£n ph·∫©m t·ªët l√† 95/100 (hay 19/20).",
    },
    {
      level: "V·∫≠n d·ª•ng",
      question: "T·ª´ b·ªô b√†i t√∫ l∆° kh∆° 52 l√°, r√∫t ng·∫´u nhi√™n 1 l√°. X√°c su·∫•t ƒë·ªÉ r√∫t ƒë∆∞·ª£c l√° b√†i l√† qu√¢n √Åt (A) l√†:",
      options: ["1/52", "1/26", "1/13", "4/13"],
      correct: 2,
      rationale: "Trong b·ªô b√†i c√≥ 4 qu√¢n √Åt (C∆°, R√¥, Chu·ªìn, B√≠ch). X√°c su·∫•t P = 4/52 = 1/13.",
    },

    // 1 C√¢u V·∫≠n d·ª•ng cao
    {
      level: "V·∫≠n d·ª•ng cao",
      question: "Gieo ƒë·ªìng th·ªùi 2 con x√∫c x·∫Øc c√¢n ƒë·ªëi. X√°c su·∫•t ƒë·ªÉ t·ªïng s·ªë ch·∫•m tr√™n hai m·∫∑t b·∫±ng 7 l√†:",
      options: ["1/6", "1/12", "5/36", "7/36"],
      correct: 0,
      rationale:
        "T·ªïng s·ªë k·∫øt qu·∫£ l√† 6*6=36. C√°c c·∫∑p c√≥ t·ªïng b·∫±ng 7 l√†: (1,6), (2,5), (3,4), (4,3), (5,2), (6,1). C√≥ 6 k·∫øt qu·∫£ thu·∫≠n l·ª£i. P = 6/36 = 1/6.",
    },
  ];

  // =========================
  // 2) STATE
  // =========================
  let currentQuestionIndex = 0;
  let score = 0;
  let isAnswering = false;

  // C√¢u hi·ªán t·∫°i sau khi random (m·ªói c√¢u s·∫Ω c√≥ options + correct m·ªõi)
  let preparedQuestions = [];

  // =========================
  // 3) HELPERS: shuffle + c√¢n b·∫±ng A/B/C/D
  // =========================
  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // T·∫°o 1 c√¢u ƒë√£ shuffle options + update correct
  function shuffleQuestion(q) {
    const indexed = q.options.map((text, idx) => ({ text, idx }));
    shuffleArray(indexed);

    const newOptions = indexed.map(x => x.text);
    const newCorrect = indexed.findIndex(x => x.idx === q.correct);

    return {
      ...q,
      options: newOptions,
      correct: newCorrect,
    };
  }

  // C√¢n b·∫±ng v·ªã tr√≠ ƒë√°p √°n ƒë√∫ng: g·∫ßn ƒë·ªÅu 4-4-4-3
  function prepareQuestionsBalanced() {
    const n = questions.length;
    const target = [0, 0, 0, 0];
    for (let i = 0; i < n; i++) target[i % 4]++;

    // th·ª≠ shuffle nhi·ªÅu l·∫ßn ƒë·ªÉ ƒë·∫°t target
    for (let attempt = 0; attempt < 3000; attempt++) {
      const temp = questions.map(q => shuffleQuestion(q));
      const count = [0, 0, 0, 0];
      temp.forEach(q => count[q.correct]++);

      const ok = count.every((c, i) => c === target[i]);
      if (ok) return temp;
    }

    // n·∫øu hi·∫øm qu√° th√¨ tr·∫£ v·ªÅ shuffle b√¨nh th∆∞·ªùng (v·∫´n random ƒë∆∞·ª£c)
    return questions.map(q => shuffleQuestion(q));
  }

  // =========================
  // 4) GAME FLOW
  // =========================
  function startGame() {
    preparedQuestions = prepareQuestionsBalanced();

    currentQuestionIndex = 0;
    score = 0;
    isAnswering = false;

    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('quiz-screen').classList.remove('hidden');
    loadQuestion();
  }

  function loadQuestion() {
    isAnswering = true;
    const q = preparedQuestions[currentQuestionIndex];

    document.getElementById('current-q').innerText = currentQuestionIndex + 1;
    document.getElementById('score').innerText = score;
    document.getElementById('progress').style.width =
      `${(currentQuestionIndex / preparedQuestions.length) * 100}%`;

    document.getElementById('q-text').innerText = q.question;

    // badge level
    const badge = document.getElementById('q-level');
    badge.className = `badge level-${getBadgeClass(q.level)}`;
    badge.innerText = q.level;

    // render options
    const optionsContainer = document.getElementById('options-container');
    optionsContainer.innerHTML = '';

    q.options.forEach((opt, index) => {
      const btn = document.createElement('button');
      btn.className =
        `btn-option w-full p-4 rounded-xl text-left text-gray-700 font-semibold bg-white text-lg flex items-center`;
      btn.onclick = () => checkAnswer(index, btn);
      btn.innerHTML =
        `<span class="bg-gray-100 text-gray-500 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm font-bold">${String.fromCharCode(65 + index)}</span> ${opt}`;
      optionsContainer.appendChild(btn);
    });

    document.getElementById('feedback').classList.add('hidden');

    if (window.MathJax) MathJax.typesetPromise();
  }

  function getBadgeClass(level) {
    if (level.includes("Nh·∫≠n bi·∫øt")) return "nb";
    if (level.includes("Th√¥ng hi·ªÉu")) return "th";
    if (level.includes("V·∫≠n d·ª•ng cao")) return "vdc";
    return "vd";
  }

  function checkAnswer(selectedIndex, btnElement) {
    if (!isAnswering) return;
    isAnswering = false;

    const q = preparedQuestions[currentQuestionIndex];
    const isCorrect = selectedIndex === q.correct;

    const allBtns = document.querySelectorAll('.btn-option');
    allBtns.forEach(btn => btn.disabled = true);

    const feedback = document.getElementById('feedback');
    const fbTitle = document.getElementById('feedback-title');
    const fbText = document.getElementById('feedback-text');
    const fbIcon = document.getElementById('feedback-icon');

    if (isCorrect) {
      btnElement.classList.add('correct');
      score += 10;
      document.getElementById('score').innerText = score;

      document.getElementById('sound-correct').currentTime = 0;
      document.getElementById('sound-correct').play().catch(() => {});

      fbTitle.innerText = "Ch√≠nh x√°c! üéâ";
      fbTitle.className = "font-bold text-lg text-green-600";
      fbIcon.innerText = "ü§©";

      confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
    } else {
      btnElement.classList.add('wrong');

      // highlight correct
      allBtns[q.correct].classList.add('correct');

      document.getElementById('sound-wrong').currentTime = 0;
      document.getElementById('sound-wrong').play().catch(() => {});

      fbTitle.innerText = "Ti·∫øc qu√°! üòÖ";
      fbTitle.className = "font-bold text-lg text-red-600";
      fbIcon.innerText = "ü§î";
    }

    fbText.innerText = q.rationale;
    feedback.classList.remove('hidden');

    if (window.MathJax) MathJax.typesetPromise();
  }

  function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < preparedQuestions.length) {
      loadQuestion();
    } else {
      showResult();
    }
  }

  function showResult() {
    document.getElementById('quiz-screen').classList.add('hidden');
    document.getElementById('result-screen').classList.remove('hidden');
    document.getElementById('final-score').innerText = score;

    document.getElementById('sound-win').currentTime = 0;
    document.getElementById('sound-win').play().catch(() => {});

    const msg = document.getElementById('result-msg');
    if (score >= 130) msg.innerText = "Xu·∫•t s·∫Øc! B·∫°n l√† b·∫≠c th·∫ßy x√°c su·∫•t! üåü";
    else if (score >= 100) msg.innerText = "L√†m t·ªët l·∫Øm! Ki·∫øn th·ª©c r·∫•t v·ªØng! üëç";
    else if (score >= 70) msg.innerText = "Kh√° t·ªët! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
    else msg.innerText = "H√£y √¥n l·∫°i b√†i v√† th·ª≠ l·∫°i nh√©! üìö";

    confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
  }
</script>
</body>
</html>
