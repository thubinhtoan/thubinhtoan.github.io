<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ª≠ Th√°ch To√°n H·ªçc: H√¨nh Ch√≥p ƒê·ªÅu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        .option-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .option-card:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .option-card.selected-correct {
            background-color: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .option-card.selected-wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .option-card.show-correct {
            background-color: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .progress-bar {
            transition: width 0.5s ease-in-out;
        }

        /* Math formula style adjustment */
        .math-text {
            font-family: 'Times New Roman', Times, serif;
            font-style: italic;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Audio Elements -->
    <audio id="correctSound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="wrongSound" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
    <audio id="finishSound" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>

    <div class="w-full max-w-3xl">
        <!-- Start Screen -->
        <div id="start-screen" class="glass-panel rounded-3xl p-8 md:p-12 text-center fade-in">
            <div class="mb-6">
                <span class="inline-block p-4 rounded-full bg-blue-100 text-blue-600 mb-4">
                    <i class="fas fa-shapes text-4xl"></i>
                </span>
            </div>
            <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 mb-4">
                Chinh Ph·ª•c H√¨nh Kh·ªëi
            </h1>
            <p class="text-lg text-slate-600 mb-8 leading-relaxed">
                Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi th·ª≠ th√°ch ki·∫øn th·ª©c v·ªÅ 
                <span class="font-bold text-blue-600">Di·ªán t√≠ch & Th·ªÉ t√≠ch H√¨nh ch√≥p</span>. 
                <br>G·ªìm 15 c√¢u h·ªèi t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao. B·∫°n ƒë√£ s·∫µn s√†ng ch∆∞a?
            </p>
            <button onclick="startGame()" class="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-white transition-all duration-200 bg-blue-600 rounded-full hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-600 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                <span>B·∫Øt ƒë·∫ßu ngay</span>
                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden glass-panel rounded-3xl overflow-hidden fade-in">
            <!-- Header / Progress -->
            <div class="bg-slate-50 border-b border-slate-100 p-6">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-3">
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-bold shadow-sm">
                            <i class="fas fa-flag mr-1"></i> C√¢u <span id="current-question-num">1</span>/15
                        </span>
                        <span id="level-badge" class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-bold shadow-sm">
                            Nh·∫≠n bi·∫øt
                        </span>
                    </div>
                    <div class="text-slate-600 font-bold">
                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                        ƒêi·ªÉm: <span id="score" class="text-slate-800">0</span>
                    </div>
                </div>
                <!-- Progress Bar -->
                <div class="h-2 w-full bg-slate-200 rounded-full overflow-hidden">
                    <div id="progress-bar" class="progress-bar h-full bg-blue-500 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <!-- Question Area -->
            <div class="p-6 md:p-8">
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-slate-800 mb-8 leading-relaxed">
                    <!-- Question goes here -->
                </h2>

                <!-- Options Grid -->
                <div id="options-container" class="grid gap-4 md:grid-cols-2">
                    <!-- Options generated by JS -->
                </div>

                <!-- Rationale / Feedback Area -->
                <div id="feedback-area" class="hidden mt-6 p-5 rounded-2xl border-l-4">
                    <div class="flex items-start">
                        <div id="feedback-icon" class="flex-shrink-0 mr-3 mt-1"></div>
                        <div>
                            <h3 id="feedback-title" class="font-bold text-lg mb-1"></h3>
                            <p id="feedback-text" class="text-slate-700 leading-relaxed"></p>
                        </div>
                    </div>
                    <div class="mt-4 text-right">
                        <button id="next-btn" onclick="nextQuestion()" class="px-6 py-2 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-700 transition-colors shadow-lg">
                            C√¢u ti·∫øp theo <i class="fas fa-chevron-right ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden glass-panel rounded-3xl p-8 md:p-12 text-center fade-in">
            <div class="mb-6 relative inline-block">
                <i class="fas fa-trophy text-6xl text-yellow-400 drop-shadow-lg"></i>
                <i class="fas fa-star text-2xl text-yellow-300 absolute -top-2 -right-4 animate-bounce"></i>
            </div>
            <h2 class="text-3xl font-extrabold text-slate-800 mb-2">Ho√†n th√†nh xu·∫•t s·∫Øc!</h2>
            <p class="text-slate-500 mb-8">B·∫°n ƒë√£ chinh ph·ª•c th·ª≠ th√°ch h√¨nh h·ªçc.</p>
            
            <div class="grid grid-cols-2 gap-4 mb-8 max-w-sm mx-auto">
                <div class="bg-blue-50 p-4 rounded-2xl">
                    <div class="text-3xl font-black text-blue-600 mb-1" id="final-score">0</div>
                    <div class="text-sm text-slate-500 font-semibold uppercase tracking-wider">ƒêi·ªÉm s·ªë</div>
                </div>
                <div class="bg-green-50 p-4 rounded-2xl">
                    <div class="text-3xl font-black text-green-600 mb-1" id="final-percent">0%</div>
                    <div class="text-sm text-slate-500 font-semibold uppercase tracking-wider">Ch√≠nh x√°c</div>
                </div>
            </div>

            <p id="result-message" class="text-lg text-slate-700 mb-8 font-medium px-4 py-3 bg-slate-50 rounded-xl inline-block border border-slate-100">
                <!-- Dynamic message -->
            </p>

            <button onclick="location.reload()" class="px-8 py-3 bg-blue-600 text-white rounded-full font-bold hover:bg-blue-700 transition-all shadow-lg hover:shadow-xl">
                <i class="fas fa-redo mr-2"></i> Ch∆°i l·∫°i
            </button>
        </div>
    </div>

    <script>
        // Quiz Data
       // Quiz Data
const questions = [
    // --- M·ª®C ƒê·ªò: NH·∫¨N BI·∫æT (6 c√¢u) ---
    {
        level: "Nh·∫≠n bi·∫øt",
        question: "Di·ªán t√≠ch xung quanh c·ªßa h√¨nh ch√≥p tam gi√°c ƒë·ªÅu b·∫±ng t·ªïng di·ªán t√≠ch c·ªßa c√°c h√¨nh n√†o?",
        options: [
            "C√°c m·∫∑t b√™n",
            "M·∫∑t ƒë√°y v√† m·ªôt m·∫∑t b√™n",
            "T·∫•t c·∫£ c√°c m·∫∑t (ƒë√°y v√† b√™n)",
            "Chu vi ƒë√°y v√† chi·ªÅu cao"
        ],
        correct: 0, // A
        rationale: "Theo ƒë·ªãnh nghƒ©a, di·ªán t√≠ch xung quanh c·ªßa h√¨nh ch√≥p ƒë·ªÅu b·∫±ng t·ªïng di·ªán t√≠ch c·ªßa c√°c m·∫∑t b√™n (c√°c tam gi√°c c√¢n b·∫±ng nhau)."
    },
    {
        level: "Nh·∫≠n bi·∫øt",
        question: "C√¥ng th·ª©c t√≠nh th·ªÉ t√≠ch <span class='math-text'>V</span> c·ªßa h√¨nh ch√≥p c√≥ di·ªán t√≠ch ƒë√°y <span class='math-text'>S</span> v√† chi·ªÅu cao <span class='math-text'>h</span> l√†:",
        options: [
            "<span class='math-text'>V = S . h</span>",
            "<span class='math-text'>V = 1/3 . S . h</span>",
            "<span class='math-text'>V = 1/2 . S . h</span>",
            "<span class='math-text'>V = 3 . S . h</span>"
        ],
        correct: 1, // B
        rationale: "C√¥ng th·ª©c chu·∫©n t√≠nh th·ªÉ t√≠ch h√¨nh ch√≥p l√† m·ªôt ph·∫ßn ba di·ªán t√≠ch ƒë√°y nh√¢n v·ªõi chi·ªÅu cao t∆∞∆°ng ·ª©ng."
    },
    {
        level: "Nh·∫≠n bi·∫øt",
        question: "ƒê·ªÉ t√≠nh di·ªán t√≠ch xung quanh c·ªßa h√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu, ta c·∫ßn bi·∫øt nh·ªØng y·∫øu t·ªë n√†o?",
        options: [
            "Chu vi ƒë√°y v√† chi·ªÅu cao h√¨nh ch√≥p",
            "Di·ªán t√≠ch ƒë√°y v√† chi·ªÅu cao h√¨nh ch√≥p",
            "Chu vi ƒë√°y v√† trung ƒëo·∫°n (chi·ªÅu cao m·∫∑t b√™n)",
            "ƒê·ªô d√†i c·∫°nh ƒë√°y v√† di·ªán t√≠ch ƒë√°y"
        ],
        correct: 2, // C
        rationale: "Di·ªán t√≠ch xung quanh h√¨nh ch√≥p ƒë·ªÅu = n·ª≠a chu vi ƒë√°y √ó trung ƒëo·∫°n (ho·∫∑c t·ªïng di·ªán t√≠ch c√°c m·∫∑t b√™n tam gi√°c)."
    },
    {
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu c√≥ m·∫∑t ƒë√°y l√† h√¨nh g√¨?",
        options: [
            "H√¨nh b√¨nh h√†nh",
            "H√¨nh ch·ªØ nh·∫≠t",
            "H√¨nh thoi",
            "H√¨nh vu√¥ng"
        ],
        correct: 3, // D
        rationale: "ƒê·ªãnh nghƒ©a: H√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu l√† h√¨nh ch√≥p c√≥ ƒë√°y l√† h√¨nh vu√¥ng v√† c√°c c·∫°nh b√™n b·∫±ng nhau."
    },
    {
        level: "Nh·∫≠n bi·∫øt",
        question: "ƒê∆°n v·ªã n√†o sau ƒë√¢y d√πng ƒë·ªÉ ƒëo th·ªÉ t√≠ch?",
        options: [
            "<span class='math-text'>cm<sup>3</sup></span>",
            "<span class='math-text'>cm</span>",
            "<span class='math-text'>m<sup>2</sup></span>",
            "<span class='math-text'>cm<sup>2</sup></span>"
        ],
        correct: 0, // A
        rationale: "Th·ªÉ t√≠ch l√† ƒë·∫°i l∆∞·ª£ng ƒëo kh√¥ng gian 3 chi·ªÅu n√™n c√≥ ƒë∆°n v·ªã l·∫≠p ph∆∞∆°ng (cm¬≥, m¬≥, ...)."
    },
    {
        level: "Nh·∫≠n bi·∫øt",
        question: "Trung ƒëo·∫°n c·ªßa h√¨nh ch√≥p ƒë·ªÅu l√† ƒë∆∞·ªùng th·∫≥ng n√†o?",
        options: [
            "ƒê∆∞·ªùng cao c·ªßa h√¨nh ch√≥p k·∫ª t·ª´ ƒë·ªânh xu·ªëng ƒë√°y",
            "ƒê∆∞·ªùng cao c·ªßa m·∫∑t b√™n k·∫ª t·ª´ ƒë·ªânh ch√≥p",
            "ƒê∆∞·ªùng ch√©o c·ªßa m·∫∑t ƒë√°y",
            "C·∫°nh b√™n c·ªßa h√¨nh ch√≥p"
        ],
        correct: 1, // B
        rationale: "Trung ƒëo·∫°n l√† ƒë∆∞·ªùng cao c·ªßa tam gi√°c c√¢n t·∫°i m·∫∑t b√™n, k·∫ª t·ª´ ƒë·ªânh S xu·ªëng trung ƒëi·ªÉm c·∫°nh ƒë√°y."
    },

    // --- M·ª®C ƒê·ªò: TH√îNG HI·ªÇU (5 c√¢u) ---
    {
        level: "Th√¥ng hi·ªÉu",
        question: "M·ªôt h√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu c√≥ c·∫°nh ƒë√°y b·∫±ng 4cm v√† trung ƒëo·∫°n (chi·ªÅu cao m·∫∑t b√™n) b·∫±ng 5cm. Di·ªán t√≠ch xung quanh l√† bao nhi√™u?",
        options: [
            "20 cm¬≤",
            "40 cm¬≤",
            "80 cm¬≤",
            "10 cm¬≤"
        ],
        correct: 1, // B
        rationale: "H√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu c√≥ 4 m·∫∑t b√™n l√† tam gi√°c c√¢n b·∫±ng nhau. Di·ªán t√≠ch 1 m·∫∑t = 1/2 √ó 4 √ó 5 = 10 cm¬≤. T·ªïng S_xq = 4 √ó 10 = 40 cm¬≤."
    },
    {
        level: "Th√¥ng hi·ªÉu",
        question: "M·ªôt h√¨nh ch√≥p tam gi√°c ƒë·ªÅu c√≥ di·ªán t√≠ch ƒë√°y l√† 12 cm¬≤ v√† chi·ªÅu cao l√† 4 cm. Th·ªÉ t√≠ch c·ªßa n√≥ l√†:",
        options: [
            "48 cm¬≥",
            "16 cm¬≥",
            "12 cm¬≥",
            "24 cm¬≥"
        ],
        correct: 1, // B
        rationale: "√Åp d·ª•ng c√¥ng th·ª©c: V = 1/3 . S . h = 1/3 . 12 . 4 = 4 . 4 = 16 cm¬≥."
    },
    {
        level: "Th√¥ng hi·ªÉu",
        question: "N·∫øu c·∫°nh ƒë√°y c·ªßa h√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu tƒÉng g·∫•p ƒë√¥i v√† chi·ªÅu cao gi·ªØ nguy√™n th√¨ th·ªÉ t√≠ch c·ªßa h√¨nh ch√≥p s·∫Ω:",
        options: [
            "TƒÉng g·∫•p 4 l·∫ßn",
            "TƒÉng g·∫•p 8 l·∫ßn",
            "Kh√¥ng ƒë·ªïi",
            "TƒÉng g·∫•p ƒë√¥i"
        ],
        correct: 0, // A
        rationale: "Di·ªán t√≠ch ƒë√°y l√† h√¨nh vu√¥ng (S = a¬≤). N·∫øu c·∫°nh a tƒÉng 2 l·∫ßn th√¨ S tƒÉng 2¬≤ = 4 l·∫ßn. V√¨ V t·ªâ l·ªá thu·∫≠n v·ªõi S ƒë√°y n√™n V tƒÉng 4 l·∫ßn."
    },
    {
        level: "Th√¥ng hi·ªÉu",
        question: "So s√°nh chi·ªÅu cao c·ªßa h√¨nh ch√≥p ƒë·ªÅu (h) v√† trung ƒëo·∫°n (d) c·ªßa n√≥?",
        options: [
            "Kh√¥ng so s√°nh ƒë∆∞·ª£c",
            "h < d",
            "h > d",
            "h = d"
        ],
        correct: 1, // B
        rationale: "Trong tam gi√°c vu√¥ng t·∫°o b·ªüi chi·ªÅu cao h√¨nh ch√≥p, trung ƒëo·∫°n v√† ƒëo·∫°n n·ªëi t√¢m ƒë√°y ƒë·∫øn trung ƒëi·ªÉm c·∫°nh, trung ƒëo·∫°n l√† c·∫°nh huy·ªÅn n√™n lu√¥n l·ªõn h∆°n chi·ªÅu cao h√¨nh ch√≥p."
    },
    {
        level: "Th√¥ng hi·ªÉu",
        question: "T√≠nh di·ªán t√≠ch to√†n ph·∫ßn c·ªßa h√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu c√≥ di·ªán t√≠ch xung quanh l√† 60 cm¬≤ v√† di·ªán t√≠ch ƒë√°y l√† 25 cm¬≤.",
        options: [
            "35 cm¬≤",
            "1500 cm¬≤",
            "85 cm¬≤",
            "42.5 cm¬≤"
        ],
        correct: 2, // C
        rationale: "Di·ªán t√≠ch to√†n ph·∫ßn = Di·ªán t√≠ch xung quanh + Di·ªán t√≠ch ƒë√°y = 60 + 25 = 85 cm¬≤."
    },

    // --- M·ª®C ƒê·ªò: V·∫¨N D·ª§NG (3 c√¢u) ---
    {
        level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
        question: "B·∫°n Nam d·ª±ng m·ªôt l·ªÅu tr·∫°i h√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu. C·∫°nh ƒë√°y l·ªÅu d√†i 3m, chi·ªÅu cao c·ªßa l·ªÅu l√† 2m. T√≠nh th·ªÉ t√≠ch kh√¥ng gian b√™n trong l·ªÅu.",
        options: [
            "6 m¬≥",
            "9 m¬≥",
            "18 m¬≥",
            "4.5 m¬≥"
        ],
        correct: 0, // A
        rationale: "Di·ªán t√≠ch ƒë√°y (h√¨nh vu√¥ng) S = 3¬≤ = 9 m¬≤. Th·ªÉ t√≠ch V = 1/3 . S . h = 1/3 . 9 . 2 = 6 m¬≥."
    },
    {
        level: "V·∫≠n d·ª•ng",
        question: "M·ªôt h·ªôp qu√† h√¨nh ch√≥p tam gi√°c ƒë·ªÅu c√≥ c·∫°nh ƒë√°y b·∫±ng 10cm v√† trung ƒëo·∫°n b·∫±ng 12cm. T√≠nh di·ªán t√≠ch gi·∫•y c·∫ßn d√πng ƒë·ªÉ b·ªçc quanh h·ªôp (ch·ªâ t√≠nh di·ªán t√≠ch xung quanh, kh√¥ng t√≠nh ƒë√°y v√† m√©p d√°n).",
        options: [
            "120 cm¬≤",
            "180 cm¬≤",
            "360 cm¬≤",
            "60 cm¬≤"
        ],
        correct: 1, // B
        rationale: "S_xq = 3 . (1/2 . c·∫°nh ƒë√°y . trung ƒëo·∫°n) = 3 . (1/2 . 10 . 12) = 3 . 60 = 180 cm¬≤."
    },
    {
        level: "V·∫≠n d·ª•ng",
        question: "M·ªôt kh·ªëi ch√≥p c√≥ th·ªÉ t√≠ch V = 100 cm¬≥ v√† di·ªán t√≠ch ƒë√°y S = 25 cm¬≤. T√≠nh chi·ªÅu cao h c·ªßa kh·ªëi ch√≥p ƒë√≥.",
        options: [
            "4 cm",
            "12 cm",
            "8 cm",
            "25 cm"
        ],
        correct: 1, // B
        rationale: "T·ª´ c√¥ng th·ª©c V = 1/3 . S . h => h = (3 . V) / S = (3 . 100) / 25 = 300 / 25 = 12 cm."
    },

    // --- M·ª®C ƒê·ªò: V·∫¨N D·ª§NG CAO (1 c√¢u) ---
    {
        level: "V·∫≠n d·ª•ng cao",
        question: "Cho h√¨nh ch√≥p t·ª© gi√°c ƒë·ªÅu c√≥ c·∫°nh ƒë√°y b·∫±ng 6 cm v√† c·∫°nh b√™n b·∫±ng 5 cm. T√≠nh th·ªÉ t√≠ch c·ªßa h√¨nh ch√≥p ƒë√≥.",
        options: [
            "48 cm¬≥",
            "12 cm¬≥",
            "12‚àö7 cm¬≥",
            "36‚àö7 cm¬≥"
        ],
        correct: 2, // C
        rationale: "ƒê∆∞·ªùng ch√©o ƒë√°y = 6‚àö2 => N·ª≠a ƒë∆∞·ªùng ch√©o = 3‚àö2. Chi·ªÅu cao h = ‚àö(c·∫°nh b√™n¬≤ - (n·ª≠a ƒëg ch√©o)¬≤) = ‚àö(5¬≤ - (3‚àö2)¬≤) = ‚àö(25-18) = ‚àö7. V = 1/3 . 6¬≤ . ‚àö7 = 12‚àö7."
    }
];
        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswered = false;

        // Sound Effects
        const playSound = (type) => {
            const sound = document.getElementById(type + 'Sound');
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log("Audio play failed:", e));
            }
        };

        const startGame = () => {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            loadQuestion();
        };

        const loadQuestion = () => {
            isAnswered = false;
            const currentQ = questions[currentQuestionIndex];
            
            // Update UI
            document.getElementById('current-question-num').textContent = currentQuestionIndex + 1;
            document.getElementById('question-text').innerHTML = currentQ.question;
            document.getElementById('progress-bar').style.width = `${((currentQuestionIndex) / questions.length) * 100}%`;
            
            // Update badge color based on level
            const badge = document.getElementById('level-badge');
            badge.textContent = currentQ.level;
            if (currentQ.level.includes("Nh·∫≠n bi·∫øt")) badge.className = "px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-bold shadow-sm";
            else if (currentQ.level.includes("Th√¥ng hi·ªÉu")) badge.className = "px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-bold shadow-sm";
            else if (currentQ.level.includes("V·∫≠n d·ª•ng")) badge.className = "px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-bold shadow-sm";
            else badge.className = "px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-bold shadow-sm";

            // Reset feedback
            document.getElementById('feedback-area').className = "hidden mt-6 p-5 rounded-2xl border-l-4";
            
            // Render Options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            currentQ.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = `option-card w-full p-4 text-left border-2 border-slate-200 rounded-2xl bg-white text-slate-700 font-semibold hover:border-blue-400 focus:outline-none`;
                btn.innerHTML = `<div class="flex items-center"><span class="w-8 h-8 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center mr-3 text-sm font-bold">${String.fromCharCode(65 + index)}</span>${opt}</div>`;
                btn.onclick = () => checkAnswer(index, btn);
                optionsContainer.appendChild(btn);
            });
        };

        const checkAnswer = (selectedIndex, btnElement) => {
            if (isAnswered) return;
            isAnswered = true;

            const currentQ = questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option-card');
            const feedbackArea = document.getElementById('feedback-area');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackTitle = document.getElementById('feedback-title');
            const feedbackText = document.getElementById('feedback-text');

            // Disable all buttons
            options.forEach(opt => opt.classList.add('disabled', 'cursor-default'));

            if (selectedIndex === currentQ.correct) {
                // Correct Answer
                score += 10;
                document.getElementById('score').textContent = score;
                btnElement.classList.add('selected-correct');
                
                playSound('correct');
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#10b981', '#3b82f6', '#f59e0b']
                });

                feedbackArea.classList.remove('hidden');
                feedbackArea.classList.add('bg-green-50', 'border-green-500', 'fade-in');
                feedbackIcon.innerHTML = '<i class="fas fa-check-circle text-2xl text-green-500"></i>';
                feedbackTitle.className = "font-bold text-lg mb-1 text-green-800";
                feedbackTitle.textContent = "Ch√≠nh x√°c! üéâ";
            } else {
                // Wrong Answer
                btnElement.classList.add('selected-wrong');
                options[currentQ.correct].classList.add('show-correct'); // Show correct answer
                
                playSound('wrong');

                feedbackArea.classList.remove('hidden');
                feedbackArea.classList.add('bg-red-50', 'border-red-500', 'fade-in');
                feedbackIcon.innerHTML = '<i class="fas fa-times-circle text-2xl text-red-500"></i>';
                feedbackTitle.className = "font-bold text-lg mb-1 text-red-800";
                feedbackTitle.textContent = "Ch∆∞a ƒë√∫ng r·ªìi üòÖ";
            }

            feedbackText.innerHTML = currentQ.rationale;
        };

        const nextQuestion = () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                showResult();
            }
        };

        const showResult = () => {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            const maxScore = questions.length * 10;
            const percent = Math.round((score / maxScore) * 100);
            
            // Animation for score
            animateValue("final-score", 0, score, 1000);
            document.getElementById('final-percent').textContent = `${percent}%`;

            playSound('finish');
            if (percent >= 80) {
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
                document.getElementById('result-message').textContent = "Tuy·ªát v·ªùi! B·∫°n l√† b·∫≠c th·∫ßy h√¨nh h·ªçc kh√¥ng gian! üèÜ";
            } else if (percent >= 50) {
                document.getElementById('result-message').textContent = "L√†m t·ªët l·∫Øm! H√£y √¥n l·∫°i m·ªôt ch√∫t ƒë·ªÉ ƒë·∫°t ƒëi·ªÉm t·ªëi ƒëa nh√©. üí™";
            } else {
                document.getElementById('result-message').textContent = "ƒê·ª´ng n·∫£n l√≤ng! H√£y xem l·∫°i l√Ω thuy·∫øt v√† th·ª≠ l·∫°i nh√©. üå±";
            }
        };

        function animateValue(id, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                document.getElementById(id).innerHTML = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }
    </script>
</body>
</html>
