<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Äáº¥u TrÆ°á»ng HÃ¬nh Há»c: BÃ­ Máº­t Kim Tá»± ThÃ¡p</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4338ca 100%);
            color: #fff;
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .option-btn {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            border-color: #818cf8;
        }

        .option-btn.correct {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            color: #34d399;
        }

        .option-btn.wrong {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            color: #fca5a5;
        }

        .progress-fill {
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(90deg, #ec4899, #8b5cf6);
        }

        .math-expr {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-weight: bold;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating-icon {
            animation: float 3s ease-in-out infinite;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Sounds -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
    <audio id="sound-win" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>

    <div class="w-full max-w-4xl">
        
        <!-- Welcome Screen -->
        <div id="start-screen" class="glass-container rounded-3xl p-10 text-center fade-in relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500"></div>
            
            <div class="mb-8 floating-icon">
                <i class="fas fa-shapes text-6xl text-yellow-400 drop-shadow-lg"></i>
            </div>
            
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-pink-300">
                Äáº¥u TrÆ°á»ng HÃ¬nh Há»c
            </h1>
            <h2 class="text-2xl font-bold text-indigo-200 mb-6">BÃ­ Máº­t Kim Tá»± ThÃ¡p</h2>
            
            <p class="text-lg text-gray-200 mb-10 max-w-2xl mx-auto leading-relaxed">
                ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i bÃ i Ã´n táº­p cuá»‘i chÆ°Æ¡ng 2. 
                HÃ£y vÆ°á»£t qua 15 cÃ¢u há»i tá»« nháº­n biáº¿t Ä‘áº¿n váº­n dá»¥ng cao Ä‘á»ƒ chinh phá»¥c kiáº¿n thá»©c vá» HÃ¬nh chÃ³p Ä‘á»u nhÃ©!
            </p>

            <button onclick="quizApp.start()" class="group relative px-8 py-4 bg-indigo-600 rounded-full font-bold text-xl shadow-lg hover:bg-indigo-500 hover:shadow-indigo-500/50 transition-all duration-300 transform hover:scale-105">
                <span class="mr-2">Báº¯t Äáº§u Thá»­ ThÃ¡ch</span>
                <i class="fas fa-rocket group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden glass-container rounded-3xl overflow-hidden fade-in flex flex-col md:flex-row">
            
            <!-- Sidebar / Stats -->
            <div class="md:w-1/4 bg-black/20 p-6 flex flex-col justify-between border-r border-white/10">
                <div>
                    <div class="flex items-center justify-between mb-6">
                        <div class="text-yellow-400 font-bold text-xl">
                            <i class="fas fa-coins mr-2"></i> <span id="score">0</span>
                        </div>
                        <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Äiá»ƒm sá»‘</div>
                    </div>
                    
                    <div class="mb-2 flex justify-between text-sm text-gray-300">
                        <span>Tiáº¿n Ä‘á»™</span>
                        <span><span id="q-current">1</span>/15</span>
                    </div>
                    <div class="h-3 w-full bg-gray-700 rounded-full overflow-hidden mb-6">
                        <div id="progress-bar" class="progress-fill h-full w-0"></div>
                    </div>

                    <div id="level-indicator" class="inline-block px-3 py-1 rounded-lg text-xs font-bold bg-green-500/20 text-green-300 border border-green-500/50">
                        NHáº¬N BIáº¾T
                    </div>
                </div>
                
                <div class="hidden md:block text-center opacity-50">
                    <i class="fas fa-cube text-6xl"></i>
                </div>
            </div>

            <!-- Main Content -->
            <div class="md:w-3/4 p-6 md:p-8 flex flex-col">
                <div class="flex-grow">
                    <h3 id="question-text" class="text-2xl font-bold mb-8 leading-relaxed">
                        <!-- Question content -->
                    </h3>

                    <div id="options-grid" class="grid gap-4 md:grid-cols-2">
                        <!-- Options injected here -->
                    </div>
                </div>

                <!-- Rationale Section -->
                <div id="rationale-box" class="hidden mt-6 p-4 rounded-xl border border-l-4 border-l-yellow-400 bg-yellow-400/10 fade-in">
                    <div class="flex gap-4">
                        <div class="flex-shrink-0 mt-1">
                            <i id="rationale-icon" class="fas fa-lightbulb text-yellow-300 text-xl"></i>
                        </div>
                        <div class="flex-grow">
                            <h4 class="font-bold text-yellow-200 mb-1" id="rationale-title">Giáº£i thÃ­ch:</h4>
                            <p class="text-gray-200 text-sm leading-relaxed" id="rationale-text"></p>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button onclick="quizApp.next()" class="px-6 py-2 bg-white text-indigo-900 rounded-lg font-bold hover:bg-gray-100 transition-colors">
                            Tiáº¿p tá»¥c <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden glass-container rounded-3xl p-10 text-center fade-in">
            <div class="mb-8">
                <i class="fas fa-crown text-6xl text-yellow-400 mb-4 floating-icon"></i>
                <h2 class="text-4xl font-bold mb-2">HoÃ n ThÃ nh!</h2>
                <p class="text-gray-300">Báº¡n Ä‘Ã£ chinh phá»¥c háº¿t cÃ¡c cÃ¢u há»i.</p>
            </div>

            <div class="grid grid-cols-2 gap-4 max-w-sm mx-auto mb-10">
                <div class="p-4 rounded-2xl bg-white/5 border border-white/10">
                    <div class="text-3xl font-bold text-yellow-400" id="final-score">0</div>
                    <div class="text-xs text-gray-400 uppercase mt-1">Tá»•ng Ä‘iá»ƒm</div>
                </div>
                <div class="p-4 rounded-2xl bg-white/5 border border-white/10">
                    <div class="text-3xl font-bold text-green-400" id="final-percent">0%</div>
                    <div class="text-xs text-gray-400 uppercase mt-1">Äá»™ chÃ­nh xÃ¡c</div>
                </div>
            </div>

            <p id="feedback-msg" class="text-xl font-medium text-indigo-200 mb-8 italic"></p>

            <button onclick="location.reload()" class="px-8 py-3 bg-white/10 hover:bg-white/20 border border-white/30 rounded-full font-semibold transition-all">
                <i class="fas fa-redo-alt mr-2"></i> ChÆ¡i láº¡i
            </button>
        </div>

    </div>

    <script>
       const quizData = [
    // --- Má»¨C Äá»˜: NHáº¬N BIáº¾T (6 cÃ¢u) ---
    {
        level: "Nháº­n biáº¿t",
        question: "HÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u cÃ³ Ä‘Ã¡y lÃ  hÃ¬nh gÃ¬?",
        options: ["HÃ¬nh vuÃ´ng", "HÃ¬nh chá»¯ nháº­t", "HÃ¬nh bÃ¬nh hÃ nh", "HÃ¬nh thoi"],
        correct: 0, // A
        rationale: "Theo Ä‘á»‹nh nghÄ©a, hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u báº¯t buá»™c pháº£i cÃ³ Ä‘Ã¡y lÃ  <b>hÃ¬nh vuÃ´ng</b> vÃ  cÃ¡c cáº¡nh bÃªn báº±ng nhau."
    },
    {
        level: "Nháº­n biáº¿t",
        question: "CÃ´ng thá»©c tÃ­nh thá»ƒ tÃ­ch cá»§a hÃ¬nh chÃ³p lÃ  gÃ¬? (vá»›i S lÃ  diá»‡n tÃ­ch Ä‘Ã¡y, h lÃ  chiá»u cao)",
        options: [
            "<span class='math-expr'>V = S . h</span>",
            "<span class='math-expr'>V = 1/3 . S . h</span>",
            "<span class='math-expr'>V = 1/2 . S . h</span>",
            "<span class='math-expr'>V = 3 . S . h</span>"
        ],
        correct: 1, // B
        rationale: "Thá»ƒ tÃ­ch khá»‘i chÃ³p báº±ng má»™t pháº§n ba tÃ­ch cá»§a diá»‡n tÃ­ch Ä‘Ã¡y vÃ  chiá»u cao: <span class='math-expr'>V = 1/3 . S . h</span>."
    },
    {
        level: "Nháº­n biáº¿t",
        question: "Sá»‘ máº·t bÃªn cá»§a hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u lÃ  bao nhiÃªu?",
        options: ["4 máº·t", "5 máº·t", "3 máº·t", "6 máº·t"],
        correct: 2, // C
        rationale: "HÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u cÃ³ Ä‘Ã¡y lÃ  tam giÃ¡c (3 cáº¡nh), nÃªn sáº½ cÃ³ tÆ°Æ¡ng á»©ng <b>3 máº·t bÃªn</b>."
    },
    {
        level: "Nháº­n biáº¿t",
        question: "Trong hÃ¬nh chÃ³p Ä‘á»u, Ä‘oáº¡n tháº³ng ná»‘i tá»« Ä‘á»‰nh xuá»‘ng trung Ä‘iá»ƒm cá»§a má»™t cáº¡nh Ä‘Ã¡y gá»i lÃ  gÃ¬?",
        options: ["ÄÆ°á»ng cao cá»§a hÃ¬nh chÃ³p", "Cáº¡nh bÃªn", "ÄÆ°á»ng chÃ©o", "Trung Ä‘oáº¡n"],
        correct: 3, // D
        rationale: "ÄÆ°á»ng cao cá»§a máº·t bÃªn xuáº¥t phÃ¡t tá»« Ä‘á»‰nh chÃ³p Ä‘Æ°á»£c gá»i lÃ  <b>trung Ä‘oáº¡n</b>."
    },
    {
        level: "Nháº­n biáº¿t",
        question: "HÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u cÃ³ táº¥t cáº£ bao nhiÃªu cáº¡nh?",
        options: ["8 cáº¡nh", "4 cáº¡nh", "6 cáº¡nh", "12 cáº¡nh"],
        correct: 0, // A
        rationale: "Gá»“m 4 cáº¡nh Ä‘Ã¡y (hÃ¬nh vuÃ´ng) vÃ  4 cáº¡nh bÃªn. Tá»•ng cá»™ng lÃ  <b>8 cáº¡nh</b>."
    },
    {
        level: "Nháº­n biáº¿t",
        question: "Diá»‡n tÃ­ch xung quanh cá»§a hÃ¬nh chÃ³p Ä‘á»u Ä‘Æ°á»£c tÃ­nh báº±ng cÃ´ng thá»©c nÃ o?",
        options: [
            "<span class='math-expr'>S = p . h</span> (p: chu vi Ä‘Ã¡y)",
            "<span class='math-expr'>S = p . d</span> (p: ná»­a chu vi, d: trung Ä‘oáº¡n)",
            "<span class='math-expr'>S = C . h</span> (C: chu vi Ä‘Ã¡y)",
            "<span class='math-expr'>S = 1/2 . S_Ä‘Ã¡y . h</span>"
        ],
        correct: 1, // B
        rationale: "Diá»‡n tÃ­ch xung quanh báº±ng tÃ­ch cá»§a <b>ná»­a chu vi Ä‘Ã¡y</b> vÃ  <b>trung Ä‘oáº¡n</b>."
    },

    // --- Má»¨C Äá»˜: THÃ”NG HIá»‚U (5 cÃ¢u) ---
    {
        level: "ThÃ´ng hiá»ƒu",
        question: "Má»™t hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u cÃ³ cáº¡nh Ä‘Ã¡y báº±ng 10m vÃ  trung Ä‘oáº¡n báº±ng 12m. Diá»‡n tÃ­ch xung quanh cá»§a nÃ³ lÃ  bao nhiÃªu?",
        options: ["120 mÂ²", "480 mÂ²", "240 mÂ²", "60 mÂ²"],
        correct: 2, // C
        rationale: "Chu vi Ä‘Ã¡y = 10 x 4 = 40m => Ná»­a chu vi p = 20m. <br>Sxq = p . d = 20 . 12 = <b>240 mÂ²</b>."
    },
    {
        level: "ThÃ´ng hiá»ƒu",
        question: "TÃ­nh thá»ƒ tÃ­ch cá»§a má»™t hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u biáº¿t diá»‡n tÃ­ch Ä‘Ã¡y lÃ  <span class='math-expr'>30 cmÂ²</span> vÃ  chiá»u cao lÃ  <span class='math-expr'>7 cm</span>.",
        options: ["210 cmÂ³", "105 cmÂ³", "70 cmÂ³", "35 cmÂ³"],
        correct: 2, // C
        rationale: "Ãp dá»¥ng cÃ´ng thá»©c: <span class='math-expr'>V = 1/3 . S . h = 1/3 . 30 . 7 = 10 . 7 = 70 cmÂ³</span>."
    },
    {
        level: "ThÃ´ng hiá»ƒu",
        question: "Náº¿u cáº¡nh Ä‘Ã¡y cá»§a má»™t hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u tÄƒng lÃªn gáº¥p 3 láº§n vÃ  chiá»u cao giá»¯ nguyÃªn, thá»ƒ tÃ­ch cá»§a nÃ³ sáº½ thay Ä‘á»•i nhÆ° tháº¿ nÃ o?",
        options: ["TÄƒng gáº¥p 9 láº§n", "TÄƒng gáº¥p 3 láº§n", "TÄƒng gáº¥p 6 láº§n", "KhÃ´ng Ä‘á»•i"],
        correct: 0, // A
        rationale: "Diá»‡n tÃ­ch Ä‘Ã¡y lÃ  hÃ¬nh vuÃ´ng (<span class='math-expr'>S = aÂ²</span>). Náº¿u cáº¡nh tÄƒng 3 láº§n thÃ¬ diá»‡n tÃ­ch tÄƒng <span class='math-expr'>3Â² = 9</span> láº§n. Do Ä‘Ã³ thá»ƒ tÃ­ch tÄƒng gáº¥p <b>9 láº§n</b>."
    },
    {
        level: "ThÃ´ng hiá»ƒu",
        question: "Biáº¿t thá»ƒ tÃ­ch cá»§a má»™t hÃ¬nh chÃ³p lÃ  <span class='math-expr'>100 cmÂ³</span> vÃ  chiá»u cao lÃ  <span class='math-expr'>10 cm</span>. Diá»‡n tÃ­ch Ä‘Ã¡y cá»§a hÃ¬nh chÃ³p Ä‘Ã³ lÃ  bao nhiÃªu?",
        options: ["10 cmÂ²", "30 cmÂ²", "33.3 cmÂ²", "300 cmÂ²"],
        correct: 1, // B
        rationale: "Ta cÃ³ <span class='math-expr'>V = 1/3 . S . h</span> => <span class='math-expr'>S = (3 . V) / h = (3 . 100) / 10 = 300 / 10 = 30 cmÂ²</span>."
    },
    {
        level: "ThÃ´ng hiá»ƒu",
        question: "TÃ­nh tá»•ng diá»‡n tÃ­ch cÃ¡c máº·t bÃªn (diá»‡n tÃ­ch xung quanh) cá»§a hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u cÃ³ cáº¡nh Ä‘Ã¡y 4cm vÃ  trung Ä‘oáº¡n 5cm.",
        options: ["20 cmÂ²", "10 cmÂ²", "30 cmÂ²", "40 cmÂ²"],
        correct: 2, // C
        rationale: "HÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u cÃ³ 3 máº·t bÃªn. Diá»‡n tÃ­ch 1 máº·t = 1/2 . 4 . 5 = 10 cmÂ². Tá»•ng = 3 . 10 = <b>30 cmÂ²</b>."
    },

    // --- Má»¨C Äá»˜: Váº¬N Dá»¤NG (3 cÃ¢u) ---
    {
        level: "Váº­n dá»¥ng (Thá»±c táº¿)",
        question: "Kim tá»± thÃ¡p Louvre (PhÃ¡p) cÃ³ dáº¡ng hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u vá»›i cáº¡nh Ä‘Ã¡y 34m vÃ  chiá»u cao khoáº£ng 21m. TÃ­nh thá»ƒ tÃ­ch khÃ´ng gian bÃªn trong kim tá»± thÃ¡p nÃ y.",
        options: ["8092 mÂ³", "24276 mÂ³", "8192 mÂ³", "12138 mÂ³"],
        correct: 0, // A
        rationale: "Diá»‡n tÃ­ch Ä‘Ã¡y: <span class='math-expr'>34Â² = 1156 mÂ²</span>. <br>Thá»ƒ tÃ­ch: <span class='math-expr'>V = 1/3 . 1156 . 21 = 1156 . 7 = 8092 mÂ³</span>."
    },
    {
        level: "Váº­n dá»¥ng",
        question: "Má»™t hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u cÃ³ cáº¡nh Ä‘Ã¡y 6cm vÃ  trung Ä‘oáº¡n 5cm. TÃ­nh diá»‡n tÃ­ch toÃ n pháº§n cá»§a hÃ¬nh chÃ³p.",
        options: ["96 cmÂ²", "60 cmÂ²", "36 cmÂ²", "120 cmÂ²"],
        correct: 0, // A
        rationale: "Sxq = 1/2 . (6.4) . 5 = 60 cmÂ². <br>SÄ‘Ã¡y = 6Â² = 36 cmÂ². <br>Stp = 60 + 36 = <b>96 cmÂ²</b>."
    },
    {
        level: "Váº­n dá»¥ng",
        question: "Cho hÃ¬nh chÃ³p tam giÃ¡c Ä‘á»u cÃ³ chu vi Ä‘Ã¡y lÃ  12cm vÃ  trung Ä‘oáº¡n lÃ  4cm. TÃ­nh diá»‡n tÃ­ch xung quanh.",
        options: ["48 cmÂ²", "24 cmÂ²", "12 cmÂ²", "16 cmÂ²"],
        correct: 1, // B
        rationale: "Ná»­a chu vi Ä‘Ã¡y p = 12 / 2 = 6cm. <br>Sxq = p . d = 6 . 4 = <b>24 cmÂ²</b>."
    },

    // --- Má»¨C Äá»˜: Váº¬N Dá»¤NG CAO (1 cÃ¢u) ---
    {
        level: "Váº­n dá»¥ng cao",
        question: "Má»™t hÃ¬nh chÃ³p tá»© giÃ¡c Ä‘á»u cÃ³ cáº¡nh Ä‘Ã¡y báº±ng <span class='math-expr'>2 m</span> vÃ  cáº¡nh bÃªn báº±ng <span class='math-expr'>âˆš3 m</span>. TÃ­nh thá»ƒ tÃ­ch cá»§a hÃ¬nh chÃ³p nÃ y.",
        options: [
            "<span class='math-expr'>4 mÂ³</span>",
            "<span class='math-expr'>2 mÂ³</span>",
            "<span class='math-expr'>4/3 mÂ³</span>",
            "<span class='math-expr'>âˆš2 mÂ³</span>"
        ],
        correct: 2, // C
        rationale: "ÄÆ°á»ng chÃ©o Ä‘Ã¡y <span class='math-expr'>d = 2âˆš2</span> => BÃ¡n kÃ­nh Ä‘Ã¡y <span class='math-expr'>R = âˆš2</span>. <br>Chiá»u cao <span class='math-expr'>h = âˆš(cáº¡nh_bÃªnÂ² - RÂ²) = âˆš(3 - 2) = 1 m</span>. <br>V = 1/3 . S . h = 1/3 . 2Â² . 1 = <b>4/3 mÂ³</b>."
    }
];

        const quizApp = {
            currentIdx: 0,
            score: 0,
            canAnswer: true,

            start() {
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('quiz-screen').classList.remove('hidden');
                document.getElementById('quiz-screen').classList.add('flex'); // restore flex
                this.loadQuestion();
            },

            loadQuestion() {
                this.canAnswer = true;
                const q = quizData[this.currentIdx];
                
                // Update stats
                document.getElementById('q-current').textContent = this.currentIdx + 1;
                document.getElementById('progress-bar').style.width = `${((this.currentIdx) / quizData.length) * 100}%`;
                
                // Update Level Badge
                const levelBadge = document.getElementById('level-indicator');
                levelBadge.textContent = q.level.toUpperCase();
                levelBadge.className = `inline-block px-3 py-1 rounded-lg text-xs font-bold border ${this.getLevelColor(q.level)}`;

                // Question Text
                document.getElementById('question-text').innerHTML = q.question;

                // Options
                const grid = document.getElementById('options-grid');
                grid.innerHTML = '';
                q.options.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = `option-btn w-full p-4 rounded-xl text-left font-semibold text-lg relative overflow-hidden`;
                    btn.innerHTML = `<span class="inline-block w-8 h-8 rounded-full bg-white/10 text-center leading-8 mr-3 text-sm">${String.fromCharCode(65 + idx)}</span> ${opt}`;
                    btn.onclick = () => this.checkAnswer(idx, btn);
                    grid.appendChild(btn);
                });

                // Hide rationale
                document.getElementById('rationale-box').classList.add('hidden');
            },

            getLevelColor(level) {
                if(level.includes("Nháº­n biáº¿t")) return "bg-green-500/20 text-green-300 border-green-500/50";
                if(level.includes("ThÃ´ng hiá»ƒu")) return "bg-blue-500/20 text-blue-300 border-blue-500/50";
                if(level.includes("Váº­n dá»¥ng cao")) return "bg-purple-500/20 text-purple-300 border-purple-500/50";
                return "bg-yellow-500/20 text-yellow-300 border-yellow-500/50"; // Váº­n dá»¥ng
            },

            checkAnswer(selectedIdx, btn) {
                if (!this.canAnswer) return;
                this.canAnswer = false;

                const q = quizData[this.currentIdx];
                const isCorrect = selectedIdx === q.correct;
                const buttons = document.querySelectorAll('.option-btn');

                if (isCorrect) {
                    this.score += 10;
                    document.getElementById('score').textContent = this.score;
                    btn.classList.add('correct');
                    this.playSound('correct');
                    this.fireConfetti();
                    
                    document.getElementById('rationale-title').textContent = "ChÃ­nh xÃ¡c! ğŸ‰";
                    document.getElementById('rationale-title').className = "font-bold text-green-300 mb-1";
                    document.getElementById('rationale-box').className = "mt-6 p-4 rounded-xl border border-l-4 border-l-green-500 bg-green-500/10 fade-in";
                    document.getElementById('rationale-icon').className = "fas fa-check-circle text-green-400 text-xl";
                } else {
                    btn.classList.add('wrong');
                    buttons[q.correct].classList.add('correct'); // Show correct answer
                    this.playSound('wrong');

                    document.getElementById('rationale-title').textContent = "Tiáº¿c quÃ¡! ğŸ˜…";
                    document.getElementById('rationale-title').className = "font-bold text-red-300 mb-1";
                    document.getElementById('rationale-box').className = "mt-6 p-4 rounded-xl border border-l-4 border-l-red-500 bg-red-500/10 fade-in";
                    document.getElementById('rationale-icon').className = "fas fa-times-circle text-red-400 text-xl";
                }

                // Show rationale
                document.getElementById('rationale-text').innerHTML = q.rationale;
                document.getElementById('rationale-box').classList.remove('hidden');
            },

            next() {
                this.currentIdx++;
                if (this.currentIdx < quizData.length) {
                    this.loadQuestion();
                } else {
                    this.showResult();
                }
            },

            showResult() {
                document.getElementById('quiz-screen').classList.add('hidden');
                document.getElementById('result-screen').classList.remove('hidden');
                
                const totalScore = quizData.length * 10;
                const percent = Math.round((this.score / totalScore) * 100);
                
                // Animation values
                this.animateValue("final-score", 0, this.score, 1000);
                document.getElementById('final-percent').textContent = `${percent}%`;

                this.playSound('win');
                if (percent >= 80) {
                    this.fireConfetti();
                    document.getElementById('feedback-msg').textContent = "Tuyá»‡t vá»i! Báº¡n lÃ  báº­c tháº§y cá»§a cÃ¡c hÃ¬nh khá»‘i! ğŸ†";
                } else if (percent >= 50) {
                    document.getElementById('feedback-msg').textContent = "LÃ m tá»‘t láº¯m! Kiáº¿n thá»©c cá»§a báº¡n khÃ¡ vá»¯ng cháº¯c. ğŸ’ª";
                } else {
                    document.getElementById('feedback-msg').textContent = "Äá»«ng náº£n lÃ²ng! HÃ£y Ã´n táº­p láº¡i cÃ´ng thá»©c vÃ  thá»­ láº¡i nhÃ©. ğŸŒ±";
                }
            },

            playSound(id) {
                const audio = document.getElementById(`sound-${id}`);
                if (audio) {
                    audio.currentTime = 0;
                    audio.play().catch(e => {});
                }
            },

            fireConfetti() {
                confetti({
                    particleCount: 150,
                    spread: 80,
                    origin: { y: 0.6 },
                    colors: ['#34d399', '#facc15', '#a78bfa']
                });
            },

            animateValue(id, start, end, duration) {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    document.getElementById(id).innerHTML = Math.floor(progress * (end - start) + start);
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }
        };
    </script>
</body>
</html>
