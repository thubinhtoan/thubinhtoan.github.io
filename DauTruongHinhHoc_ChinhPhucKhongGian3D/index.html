<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·∫•u Tr∆∞·ªùng H√¨nh H·ªçc: Chinh Ph·ª•c Kh√¥ng Gian 3D</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #050b14;
            background-image: 
                linear-gradient(rgba(16, 185, 129, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(16, 185, 129, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .title-font {
            font-family: 'Orbitron', sans-serif;
        }

        .arena-card {
            background: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(52, 211, 153, 0.2);
            box-shadow: 0 0 40px rgba(16, 185, 129, 0.1), inset 0 0 20px rgba(16, 185, 129, 0.05);
            border-radius: 20px;
        }

        .btn-option {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            background: rgba(52, 211, 153, 0.1);
            border-color: #34d399;
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.2);
        }
        
        .btn-option.correct {
            background: rgba(5, 150, 105, 0.3) !important;
            border-color: #10b981 !important;
            color: #6ee7b7;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .btn-option.wrong {
            background: rgba(220, 38, 38, 0.2) !important;
            border-color: #ef4444 !important;
            color: #fca5a5;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
        }

        /* Animations */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        .scanner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(52, 211, 153, 0.1), transparent);
            animation: scanline 3s linear infinite;
            pointer-events: none;
        }

        @keyframes pulse-border {
            0% { border-color: rgba(52, 211, 153, 0.3); }
            50% { border-color: rgba(52, 211, 153, 0.8); }
            100% { border-color: rgba(52, 211, 153, 0.3); }
        }
        .pulse-active { animation: pulse-border 2s infinite; }

        .glitch-effect {
            position: relative;
        }
        .glitch-effect::before,
        .glitch-effect::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050b14;
        }
        .glitch-effect::before {
            left: 2px;
            text-shadow: -1px 0 #00ffff;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        .glitch-effect::after {
            left: -2px;
            text-shadow: -1px 0 #ff00c1;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip: rect(11px, 9999px, 81px, 0); }
            20% { clip: rect(88px, 9999px, 12px, 0); }
            40% { clip: rect(4px, 9999px, 142px, 0); }
            60% { clip: rect(109px, 9999px, 78px, 0); }
            80% { clip: rect(27px, 9999px, 51px, 0); }
            100% { clip: rect(144px, 9999px, 2px, 0); }
        }
        @keyframes glitch-anim-2 {
            0% { clip: rect(125px, 9999px, 16px, 0); }
            20% { clip: rect(24px, 9999px, 129px, 0); }
            40% { clip: rect(101px, 9999px, 3px, 0); }
            60% { clip: rect(35px, 9999px, 93px, 0); }
            80% { clip: rect(81px, 9999px, 24px, 0); }
            100% { clip: rect(54px, 9999px, 142px, 0); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- GAME WRAPPER -->
    <div class="w-full max-w-4xl relative min-h-[700px] flex flex-col">
        
        <!-- MAIN CARD -->
        <div class="arena-card flex-1 flex flex-col overflow-hidden relative z-10 scanner">
            
            <!-- START SCREEN -->
            <div id="start-screen" class="absolute inset-0 z-30 flex flex-col items-center justify-center p-8 text-center bg-slate-900/95">
                <div class="mb-8 relative">
                    <div class="absolute -inset-4 bg-emerald-500/20 rounded-full blur-xl animate-pulse"></div>
                    <i class="ph-fill ph-cube-transparent text-emerald-400 text-9xl relative z-10"></i>
                </div>
                <h1 class="text-4xl md:text-6xl font-black text-white mb-2 title-font tracking-wider glitch-effect" data-text="ƒê·∫§U TR∆Ø·ªúNG 3D">ƒê·∫§U TR∆Ø·ªúNG 3D</h1>
                <h2 class="text-xl text-emerald-400 mb-10 font-bold uppercase tracking-widest">√în T·∫≠p Cu·ªëi Ch∆∞∆°ng 3</h2>
                
                <div class="grid grid-cols-2 gap-4 mb-10 text-slate-300 text-sm font-bold w-full max-w-md">
                    <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700 flex flex-col items-center">
                        <i class="ph-bold ph-cube text-2xl text-blue-400 mb-2"></i>
                        <span>H√¨nh H·ªôp - L·∫≠p Ph∆∞∆°ng</span>
                    </div>
                    <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700 flex flex-col items-center">
                        <i class="ph-bold ph-prism text-2xl text-purple-400 mb-2"></i>
                        <span>LƒÉng Tr·ª• ƒê·ª©ng</span>
                    </div>
                </div>

                <button onclick="Game.start()" class="group relative px-12 py-5 bg-emerald-600 text-white font-bold rounded-none skew-x-[-10deg] border border-emerald-400 hover:bg-emerald-500 transition-all hover:scale-105 hover:shadow-[0_0_20px_rgba(16,185,129,0.5)]">
                    <span class="block skew-x-[10deg] text-xl uppercase tracking-widest">Tham Chi·∫øn <i class="ph-bold ph-sword ml-2"></i></span>
                </button>
            </div>

            <!-- GAME SCREEN -->
            <div id="game-screen" class="hidden flex-col h-full">
                <!-- Header -->
                <div class="p-5 flex justify-between items-center border-b border-emerald-500/20 bg-slate-900/80 backdrop-blur-md sticky top-0 z-20">
                    <div class="flex items-center gap-4">
                        <div class="relative w-12 h-12 flex items-center justify-center">
                            <svg class="absolute inset-0 w-full h-full -rotate-90">
                                <circle cx="24" cy="24" r="22" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/>
                                <circle id="progress-ring" cx="24" cy="24" r="22" stroke="#34d399" stroke-width="2" fill="none" stroke-dasharray="138" stroke-dashoffset="138" class="transition-all duration-500"/>
                            </svg>
                            <span id="ui-current" class="text-sm font-bold text-emerald-400">1</span>
                        </div>
                        <div>
                            <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">LEVEL</div>
                            <div class="font-bold text-slate-300 text-sm">REVIEW CH.3</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 bg-slate-800/80 px-5 py-2 rounded border border-emerald-500/30 pulse-active">
                        <i class="ph-fill ph-star text-yellow-400 text-xl"></i>
                        <span id="ui-score" class="font-bold text-xl text-white title-font">0</span>
                    </div>
                </div>

                <!-- Question Area -->
                <div class="flex-1 overflow-y-auto p-6 md:p-10 pb-40">
                    <div class="max-w-3xl mx-auto">
                        <span id="ui-level" class="inline-block px-3 py-1 border border-blue-500/50 bg-blue-500/10 text-blue-400 text-[10px] font-bold uppercase tracking-[0.2em] mb-6">
                            NH·∫¨N BI·∫æT
                        </span>
                        
                        <h2 id="ui-question" class="text-2xl md:text-3xl font-bold text-white mb-10 leading-relaxed font-sans">
                            <!-- Question Text -->
                        </h2>

                        <div id="ui-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Options injected -->
                        </div>
                    </div>
                </div>

                <!-- Feedback Panel -->
                <div id="feedback-panel" class="absolute bottom-0 inset-x-0 bg-slate-900 border-t border-emerald-500/50 p-6 md:p-8 transform translate-y-full transition-transform duration-300 z-30 shadow-[0_-10px_50px_rgba(0,0,0,0.5)]">
                    <div class="max-w-4xl mx-auto flex gap-6 items-start">
                        <div id="fb-icon" class="text-5xl shrink-0"></div>
                        <div class="flex-1">
                            <h3 id="fb-title" class="text-xl font-bold mb-1 title-font"></h3>
                            <p id="fb-rationale" class="text-slate-300 text-lg leading-relaxed mb-3"></p>
                            <div id="fb-hint-box" class="hidden bg-yellow-900/20 text-yellow-200 p-3 rounded border border-yellow-500/30 flex items-start">
                                <i class="ph-bold ph-lightbulb text-xl mr-2 mt-0.5"></i>
                                <span id="fb-hint" class="text-sm font-mono"></span>
                            </div>
                        </div>
                        <button onclick="Game.next()" class="shrink-0 bg-emerald-600 text-white px-8 py-3 font-bold hover:bg-emerald-500 transition-colors flex items-center gap-2 uppercase tracking-wider skew-x-[-10deg]">
                            <span class="skew-x-[10deg]">Ti·∫øp T·ª•c <i class="ph-bold ph-caret-right"></i></span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- END SCREEN -->
            <div id="end-screen" class="hidden absolute inset-0 z-30 flex flex-col items-center justify-center p-8 text-center bg-slate-900">
                <div class="relative mb-8">
                    <div class="absolute inset-0 bg-emerald-500/20 rounded-full animate-ping blur-xl"></div>
                    <i class="ph-fill ph-medal text-9xl text-yellow-400 relative z-10 drop-shadow-[0_0_20px_rgba(250,204,21,0.6)]"></i>
                </div>

                <h2 class="text-4xl font-bold text-white mb-2 title-font tracking-wide">CHI·∫æN D·ªäCH HO√ÄN T·∫§T</h2>
                <p id="end-msg" class="text-slate-400 mb-10 text-lg">D·ªØ li·ªáu kh√¥ng gian ƒë√£ ƒë∆∞·ª£c ph√¢n t√≠ch.</p>

                <div class="grid grid-cols-2 gap-6 w-full max-w-sm mb-10">
                    <div class="bg-slate-800/80 p-5 border border-slate-700">
                        <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">T·ªîNG ƒêI·ªÇM</div>
                        <div class="text-3xl font-black text-emerald-400 title-font" id="end-score">0</div>
                    </div>
                    <div class="bg-slate-800/80 p-5 border border-slate-700">
                        <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">CH√çNH X√ÅC</div>
                        <div class="text-3xl font-black text-blue-400 title-font"><span id="end-correct">0</span>/15</div>
                    </div>
                </div>

                <button onclick="location.reload()" class="px-10 py-4 bg-slate-800 text-white font-bold border border-slate-600 hover:bg-slate-700 hover:border-emerald-500 transition-all flex items-center gap-2 uppercase tracking-widest">
                    <i class="ph-bold ph-arrow-counter-clockwise"></i> Ch∆°i L·∫°i
                </button>
            </div>
        </div>
    </div>

<script>
function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}    
const QUESTIONS = [
        // --- NH·∫¨N BI·∫æT (6 c√¢u) ---
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "H√¨nh l·∫≠p ph∆∞∆°ng c√≥ bao nhi√™u m·∫∑t l√† h√¨nh vu√¥ng?",
            options: [
                { text: "6 m·∫∑t", correct: true, rationale: "Ch√≠nh x√°c! H√¨nh l·∫≠p ph∆∞∆°ng ƒë∆∞·ª£c t·∫°o th√†nh b·ªüi 6 m·∫∑t ƒë·ªÅu l√† h√¨nh vu√¥ng b·∫±ng nhau." },
                { text: "4 m·∫∑t", correct: false, rationale: "Sai. 4 l√† s·ªë m·∫∑t b√™n (n·∫øu coi 2 m·∫∑t kia l√† ƒë√°y), nh∆∞ng t·ªïng c·ªông ph·∫£i l√† 6." },
                { text: "8 m·∫∑t", correct: false, rationale: "Sai. 8 l√† s·ªë ƒë·ªânh." },
                { text: "12 m·∫∑t", correct: false, rationale: "Sai. 12 l√† s·ªë c·∫°nh." }
            ],
            hint: "Nghƒ© ƒë·∫øn con x√∫c x·∫Øc, n√≥ c√≥ c√°c s·ªë t·ª´ 1 ƒë·∫øn m·∫•y?"
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "C√°c m·∫∑t b√™n c·ªßa h√¨nh lƒÉng tr·ª• ƒë·ª©ng tam gi√°c l√† h√¨nh g√¨?",
            options: [
                { text: "H√¨nh ch·ªØ nh·∫≠t", correct: true, rationale: "ƒê√∫ng. Trong lƒÉng tr·ª• ƒë·ª©ng, c√°c m·∫∑t b√™n lu√¥n l√† h√¨nh ch·ªØ nh·∫≠t vu√¥ng g√≥c v·ªõi ƒë√°y." },
                { text: "H√¨nh tam gi√°c", correct: false, rationale: "Sai. H√¨nh tam gi√°c l√† hai m·∫∑t ƒë√°y." },
                { text: "H√¨nh vu√¥ng", correct: false, rationale: "Ch·ªâ ƒë√∫ng trong tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát, kh√¥ng ph·∫£i t·ªïng qu√°t." },
                { text: "H√¨nh b√¨nh h√†nh", correct: false, rationale: "Sai. LƒÉng tr·ª• xi√™n m·ªõi c√≥ m·∫∑t b√™n l√† h√¨nh b√¨nh h√†nh." }
            ],
            hint: "C√°c m·∫∑t t∆∞·ªùng d·ª±ng ƒë·ª©ng c·ªßa lƒÉng tr·ª• c√≥ d·∫°ng h√¨nh g√¨?"
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "C√¥ng th·ª©c t√≠nh th·ªÉ t√≠ch c·ªßa h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ ba k√≠ch th∆∞·ªõc $a, b, c$ l√†:",
            options: [
                { text: "$V = a \\cdot b \\cdot c$", correct: true, rationale: "Ch√≠nh x√°c. Th·ªÉ t√≠ch b·∫±ng t√≠ch ba k√≠ch th∆∞·ªõc (d√†i x r·ªông x cao)." },
                { text: "$V = (a + b) \\cdot c$", correct: false, rationale: "Sai." },
                { text: "$V = 2(a + b) \\cdot c$", correct: false, rationale: "Sai. ƒê√¢y l√† c√¥ng th·ª©c di·ªán t√≠ch xung quanh (n·∫øu c l√† chi·ªÅu cao)." },
                { text: "$V = a^2 \\cdot b$", correct: false, rationale: "Sai." }
            ],
            hint: "Nh√¢n c·∫£ ba chi·ªÅu l·∫°i v·ªõi nhau."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "H√¨nh lƒÉng tr·ª• ƒë·ª©ng t·ª© gi√°c c√≥ bao nhi√™u ƒë·ªânh?",
            options: [
                { text: "8 ƒë·ªânh", correct: true, rationale: "ƒê√∫ng. 4 ƒë·ªânh ·ªü ƒë√°y tr√™n v√† 4 ƒë·ªânh ·ªü ƒë√°y d∆∞·ªõi." },
                { text: "6 ƒë·ªânh", correct: false, rationale: "Sai. ƒê√¢y l√† s·ªë ƒë·ªânh c·ªßa lƒÉng tr·ª• tam gi√°c." },
                { text: "12 ƒë·ªânh", correct: false, rationale: "Sai. ƒê√¢y l√† s·ªë c·∫°nh." },
                { text: "10 ƒë·ªânh", correct: false, rationale: "Sai." }
            ],
            hint: "ƒê√°y l√† t·ª© gi√°c (4 ƒë·ªânh). C√≥ 2 ƒë√°y th√¨ t·ªïng s·ªë ƒë·ªânh l√† bao nhi√™u?"
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "C√¥ng th·ª©c t√≠nh di·ªán t√≠ch xung quanh c·ªßa h√¨nh lƒÉng tr·ª• ƒë·ª©ng l√†:",
            options: [
                { text: "$S_{xq} = C_{ƒë√°y} \\cdot h$", correct: true, rationale: "Ch√≠nh x√°c. Di·ªán t√≠ch xung quanh b·∫±ng chu vi ƒë√°y nh√¢n chi·ªÅu cao." },
                { text: "$S_{xq} = S_{ƒë√°y} \\cdot h$", correct: false, rationale: "Sai. ƒê√¢y l√† c√¥ng th·ª©c th·ªÉ t√≠ch." },
                { text: "$S_{xq} = C_{ƒë√°y} + h$", correct: false, rationale: "Sai ph√©p t√≠nh." },
                { text: "$S_{xq} = \\frac{1}{2} C_{ƒë√°y} \\cdot h$", correct: false, rationale: "Sai." }
            ],
            hint: "L·∫•y chu vi m·∫∑t s√†n nh√¢n v·ªõi ƒë·ªô cao t∆∞·ªùng."
        },
        {
            level: "Nh·∫≠n bi·∫øt",
            text: "ƒê√°y c·ªßa h√¨nh lƒÉng tr·ª• ƒë·ª©ng tam gi√°c l√† h√¨nh g√¨?",
            options: [
                { text: "H√¨nh tam gi√°c", correct: true, rationale: "ƒê√∫ng. T√™n g·ªçi lƒÉng tr·ª• 'tam gi√°c' l√† do ƒë√°y c·ªßa n√≥ l√† tam gi√°c." },
                { text: "H√¨nh ch·ªØ nh·∫≠t", correct: false, rationale: "Sai. ƒê√¢y l√† m·∫∑t b√™n." },
                { text: "H√¨nh vu√¥ng", correct: false, rationale: "Sai." },
                { text: "H√¨nh t·ª© gi√°c", correct: false, rationale: "Sai." }
            ],
            hint: "T√™n g·ªçi ƒë√£ g·ª£i √Ω c√¢u tr·∫£ l·ªùi."
        },

        // --- TH√îNG HI·ªÇU (5 c√¢u) ---
        {
            level: "Th√¥ng hi·ªÉu",
            text: "M·ªôt h√¨nh l·∫≠p ph∆∞∆°ng c√≥ c·∫°nh $4cm$. Th·ªÉ t√≠ch c·ªßa n√≥ l√†:",
            options: [
                { text: "$64 \\, cm^3$", correct: true, rationale: "Xu·∫•t s·∫Øc! $V = a^3 = 4^3 = 64$." },
                { text: "$16 \\, cm^3$", correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch m·ªôt m·∫∑t ($4^2$)." },
                { text: "$96 \\, cm^3$", correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch to√†n ph·∫ßn ($6 \\cdot 4^2$)." },
                { text: "$12 \\, cm^3$", correct: false, rationale: "Sai. ƒê√¢y l√† t·ªïng ƒë·ªô d√†i c·∫°nh ($3 \\cdot 4$)." }
            ],
            hint: "L·∫•y c·∫°nh nh√¢n c·∫°nh nh√¢n c·∫°nh ($4 \\cdot 4 \\cdot 4$)."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "H√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ th·ªÉ t√≠ch $100 \\, cm^3$, ƒë√°y l√† h√¨nh vu√¥ng c·∫°nh $5cm$. Chi·ªÅu cao c·ªßa h√¨nh h·ªôp l√†:",
            options: [
                { text: "$4 \\, cm$", correct: true, rationale: "ƒê√∫ng. Di·ªán t√≠ch ƒë√°y = $5^2 = 25$. Chi·ªÅu cao $h = V : S_{ƒë√°y} = 100 : 25 = 4$." },
                { text: "$20 \\, cm$", correct: false, rationale: "Sai. L·∫•y 100 chia 5 l√† sai." },
                { text: "$5 \\, cm$", correct: false, rationale: "Sai." },
                { text: "$10 \\, cm$", correct: false, rationale: "Sai." }
            ],
            hint: "T√≠nh di·ªán t√≠ch ƒë√°y tr∆∞·ªõc ($5 \\times 5$), sau ƒë√≥ l·∫•y th·ªÉ t√≠ch chia cho di·ªán t√≠ch ƒë√°y."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "M·ªôt h√¨nh lƒÉng tr·ª• ƒë·ª©ng tam gi√°c c√≥ chi·ªÅu cao $10cm$, chu vi ƒë√°y $12cm$. Di·ªán t√≠ch xung quanh l√†:",
            options: [
                { text: "$120 \\, cm^2$", correct: true, rationale: "Ch√≠nh x√°c. $S_{xq} = C_{ƒë√°y} \\cdot h = 12 \\cdot 10 = 120$." },
                { text: "$60 \\, cm^2$", correct: false, rationale: "Sai. Kh√¥ng chia 2." },
                { text: "$1200 \\, cm^2$", correct: false, rationale: "Sai." },
                { text: "$22 \\, cm^2$", correct: false, rationale: "Sai ph√©p c·ªông." }
            ],
            hint: "√Åp d·ª•ng c√¥ng th·ª©c $S_{xq} = C \\cdot h$."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y l√† ƒê√öNG v·ªÅ c√°c c·∫°nh b√™n c·ªßa h√¨nh lƒÉng tr·ª• ƒë·ª©ng?",
            options: [
                { text: "Song song v√† b·∫±ng nhau", correct: true, rationale: "ƒê√∫ng. C√°c c·∫°nh b√™n c·ªßa lƒÉng tr·ª• ƒë·ª©ng ƒë·ªÅu vu√¥ng g√≥c v·ªõi ƒë√°y n√™n ch√∫ng song song v√† b·∫±ng nhau." },
                { text: "Vu√¥ng g√≥c v·ªõi nhau", correct: false, rationale: "Sai." },
                { text: "C·∫Øt nhau t·∫°i m·ªôt ƒëi·ªÉm", correct: false, rationale: "Sai. ƒê√¢y l√† h√¨nh ch√≥p." },
                { text: "C√≥ ƒë·ªô d√†i kh√°c nhau", correct: false, rationale: "Sai." }
            ],
            hint: "H√£y nh√¨n c√°c c·ªôt nh√† th·∫≥ng ƒë·ª©ng."
        },
        {
            level: "Th√¥ng hi·ªÉu",
            text: "Di·ªán t√≠ch xung quanh c·ªßa h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i $3m$, chi·ªÅu r·ªông $2m$, chi·ªÅu cao $5m$ l√†:",
            options: [
                { text: "$50 \\, m^2$", correct: true, rationale: "ƒê√∫ng. $S_{xq} = 2(3 + 2) \\cdot 5 = 2 \\cdot 5 \\cdot 5 = 50$." },
                { text: "$30 \\, m^3$", correct: false, rationale: "Sai. ƒê√¢y l√† th·ªÉ t√≠ch." },
                { text: "$25 \\, m^2$", correct: false, rationale: "Sai. Qu√™n nh√¢n 2." },
                { text: "$60 \\, m^2$", correct: false, rationale: "Sai." }
            ],
            hint: "T√≠nh chu vi ƒë√°y $(3+2) \\times 2$, r·ªìi nh√¢n v·ªõi chi·ªÅu cao $5$."
        },

        // --- V·∫¨N D·ª§NG (3 c√¢u) ---
        {
            level: "V·∫≠n d·ª•ng",
            text: "M·ªôt h√¨nh lƒÉng tr·ª• ƒë·ª©ng c√≥ ƒë√°y l√† tam gi√°c vu√¥ng v·ªõi hai c·∫°nh g√≥c vu√¥ng l√† $3cm$ v√† $4cm$. Chi·ªÅu cao lƒÉng tr·ª• l√† $8cm$. Th·ªÉ t√≠ch lƒÉng tr·ª• l√†:",
            options: [
                { text: "$48 \\, cm^3$", correct: true, rationale: "Tuy·ªát v·ªùi! $S_{ƒë√°y} = \\frac{1}{2} \\cdot 3 \\cdot 4 = 6$. $V = 6 \\cdot 8 = 48$." },
                { text: "$96 \\, cm^3$", correct: false, rationale: "Sai. Qu√™n chia 2 khi t√≠nh di·ªán t√≠ch tam gi√°c." },
                { text: "$24 \\, cm^3$", correct: false, rationale: "Sai." },
                { text: "$12 \\, cm^3$", correct: false, rationale: "Sai." }
            ],
            hint: "B∆∞·ªõc 1: T√≠nh di·ªán t√≠ch ƒë√°y tam gi√°c vu√¥ng. B∆∞·ªõc 2: Nh√¢n v·ªõi chi·ªÅu cao."
        },
        {
            level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
            text: "M·ªôt h·ªì b∆°i d·∫°ng h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i $10m$, chi·ªÅu r·ªông $5m$, ƒë·ªô s√¢u $2m$. C·∫ßn b∆°m bao nhi√™u m√©t kh·ªëi n∆∞·ªõc ƒë·ªÉ ƒë·∫ßy h·ªì?",
            options: [
                { text: "$100 \\, m^3$", correct: true, rationale: "Ch√≠nh x√°c. $V = 10 \\cdot 5 \\cdot 2 = 100$." },
                { text: "$1000 \\, m^3$", correct: false, rationale: "Sai." },
                { text: "$60 \\, m^3$", correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch xung quanh." },
                { text: "$150 \\, m^3$", correct: false, rationale: "Sai." }
            ],
            hint: "T√≠nh th·ªÉ t√≠ch h√¨nh h·ªôp ch·ªØ nh·∫≠t: D√†i x R·ªông x Cao."
        },
        {
            level: "V·∫≠n d·ª•ng",
            text: "C·∫ßn √≠t nh·∫•t bao nhi√™u $cm^2$ b√¨a ƒë·ªÉ l√†m m·ªôt chi·∫øc h·ªôp h√¨nh l·∫≠p ph∆∞∆°ng kh√¥ng n·∫Øp c√≥ c·∫°nh $10cm$ (kh√¥ng t√≠nh m√©p d√°n)?",
            options: [
                { text: "$500 \\, cm^2$", correct: true, rationale: "Th√¥ng minh! H·ªôp kh√¥ng n·∫Øp c√≥ 5 m·∫∑t. Di·ªán t√≠ch = $5 \\cdot 10^2 = 500$." },
                { text: "$600 \\, cm^2$", correct: false, rationale: "Sai. ƒê√¢y l√† h·ªôp c√≥ n·∫Øp (6 m·∫∑t)." },
                { text: "$400 \\, cm^2$", correct: false, rationale: "Sai. ƒê√¢y l√† di·ªán t√≠ch xung quanh (4 m·∫∑t)." },
                { text: "$1000 \\, cm^2$", correct: false, rationale: "Sai. ƒê√¢y l√† th·ªÉ t√≠ch." }
            ],
            hint: "H·ªôp kh√¥ng n·∫Øp ch·ªâ c√≥ 5 m·∫∑t. T√≠nh di·ªán t√≠ch 1 m·∫∑t r·ªìi nh√¢n 5."
        },

        // --- V·∫¨N D·ª§NG CAO (1 c√¢u) ---
        {
            level: "V·∫≠n d·ª•ng cao",
            text: "M·ªôt b·ªÉ n∆∞·ªõc h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ di·ªán t√≠ch ƒë√°y l√† $20m^2$. Ng∆∞·ªùi ta th·∫£ v√†o b·ªÉ m·ªôt h√≤n ƒë√° l√†m m·ª±c n∆∞·ªõc d√¢ng l√™n $0,5m$. Th·ªÉ t√≠ch c·ªßa h√≤n ƒë√° l√†:",
            options: [
                { text: "$10 \\, m^3$", correct: true, rationale: "ƒê·ªânh cao! Th·ªÉ t√≠ch ƒë√° b·∫±ng th·ªÉ t√≠ch n∆∞·ªõc d√¢ng l√™n. $V = S_{ƒë√°y} \\cdot h_{d√¢ng} = 20 \\cdot 0,5 = 10$." },
                { text: "$40 \\, m^3$", correct: false, rationale: "Sai. Ph√©p chia." },
                { text: "$100 \\, m^3$", correct: false, rationale: "Sai." },
                { text: "$20,5 \\, m^3$", correct: false, rationale: "Sai." }
            ],
            hint: "Th·ªÉ t√≠ch v·∫≠t chi·∫øm ch·ªó b·∫±ng di·ªán t√≠ch ƒë√°y nh√¢n v·ªõi chi·ªÅu cao m·ª±c n∆∞·ªõc d√¢ng l√™n."
        }
    ];

    // GAME ENGINE
    const Game = {
        state: { index: 0, score: 0, answered: false },
        
        start() {
            this.state = { index: 0, score: 0, answered: false };
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('flex');
            this.render();
        },

        render() {
            this.state.answered = false;
            document.getElementById('feedback-panel').classList.add('translate-y-full');
            
           const q = QUESTIONS[this.state.index];

          // ‚úÖ RANDOM ƒê√ÅP √ÅN
          shuffleArray(q.options);

            // Stats
            document.getElementById('ui-current').innerText = this.state.index + 1;
            document.getElementById('ui-score').innerText = this.state.score;
            document.getElementById('ui-level').innerText = q.level;
            
            // Progress Ring
            const circle = document.getElementById('progress-ring');
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - ((this.state.index) / QUESTIONS.length) * circumference;
            circle.style.strokeDashoffset = offset;

            // Question
            document.getElementById('ui-question').innerHTML = q.text;
            
            // Options
            const container = document.getElementById('ui-options');
            container.innerHTML = '';
            
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = `btn-option w-full p-5 text-left rounded-lg flex items-center group`;
                btn.innerHTML = `
                    <div class="w-10 h-10 flex items-center justify-center rounded border border-slate-600 text-slate-400 font-bold mr-4 group-hover:border-emerald-500 group-hover:text-emerald-400 transition-colors">
                        ${String.fromCharCode(65 + i)}
                    </div>
                    <span class="text-lg text-slate-300 font-medium group-hover:text-white">${opt.text}</span>
                `;
                btn.onclick = () => this.check(btn, opt, q);
                container.appendChild(btn);
            });

            if(window.MathJax) MathJax.typesetPromise();
        },

        check(btn, opt, q) {
            if(this.state.answered) return;
            this.state.answered = true;

            const allBtns = document.querySelectorAll('.btn-option');
            allBtns.forEach(b => b.classList.add('disabled', 'cursor-default', 'opacity-50'));
            btn.classList.remove('opacity-50');

            const fbIcon = document.getElementById('fb-icon');
            const fbTitle = document.getElementById('fb-title');
            const hintBox = document.getElementById('fb-hint-box');

            if(opt.correct) {
                this.state.score += 10;
                document.getElementById('ui-score').innerText = this.state.score;
                
                btn.classList.add('correct');
                
                fbIcon.innerHTML = 'üéâ';
                fbTitle.innerText = "CH√çNH X√ÅC!";
                fbTitle.className = "text-xl font-bold mb-1 title-font text-emerald-400";
                hintBox.classList.add('hidden');

                this.playSound('win');
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.8 },
                    colors: ['#34d399', '#60a5fa', '#facc15']
                });
            } else {
                btn.classList.add('wrong');
                
                // Highlight correct
                const correctIndex = q.options.findIndex(o => o.correct);
                allBtns[correctIndex].classList.remove('opacity-50');
                allBtns[correctIndex].classList.add('correct');

                fbIcon.innerHTML = '‚ö†Ô∏è';
                fbTitle.innerText = "CH∆ØA ƒê√öNG!";
                fbTitle.className = "text-xl font-bold mb-1 title-font text-red-400";
                
                hintBox.classList.remove('hidden');
                document.getElementById('fb-hint').innerText = q.hint;

                this.playSound('lose');
            }

            document.getElementById('fb-rationale').innerText = opt.rationale;
            document.getElementById('feedback-panel').classList.remove('translate-y-full');
            
            if(window.MathJax) MathJax.typesetPromise();
        },

        next() {
            this.state.index++;
            if(this.state.index < QUESTIONS.length) {
                this.render();
            } else {
                this.end();
            }
        },

        end() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('end-screen').classList.add('flex');
            
            document.getElementById('end-score').innerText = this.state.score;
            document.getElementById('end-correct').innerText = Math.round(this.state.score / 10);
            
            const msg = document.getElementById('end-msg');
            if(this.state.score >= 130) msg.innerText = "Tuy·ªát ƒë·ªânh! B·∫°n l√† B·∫≠c th·∫ßy Kh√¥ng Gian 3D! üåå";
            else if(this.state.score >= 100) msg.innerText = "R·∫•t t·ªët! B·∫°n ƒë√£ n·∫Øm v·ªØng ki·∫øn th·ª©c ch∆∞∆°ng n√†y! üöÄ";
            else msg.innerText = "H√£y √¥n t·∫≠p th√™m ƒë·ªÉ tr·ªü l·∫°i m·∫°nh m·∫Ω h∆°n! üõ†Ô∏è";

            this.playSound('finish');
        },

        playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'win') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } else if (type === 'lose') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } else if (type === 'finish') {
                [440, 554, 659, 880].forEach((f, i) => {
                    setTimeout(() => {
                        const o = ctx.createOscillator();
                        const g = ctx.createGain();
                        o.connect(g);
                        g.connect(ctx.destination);
                        o.type = 'sine';
                        o.frequency.value = f;
                        g.gain.setValueAtTime(0.1, ctx.currentTime);
                        g.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                        o.start();
                        o.stop(ctx.currentTime + 0.3);
                    }, i * 150);
                });
            }
        }
    };
</script>

</body>
</html>
