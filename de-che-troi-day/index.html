<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>ƒê·∫ø Ch·∫ø Tr·ªói D·∫≠y ‚Äì Bi·∫øn ƒë·ªïi cƒÉn b·∫≠c hai</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel ƒë·ªÉ ch·∫°y JSX tr·ª±c ti·∫øp -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="m-0 p-0 bg-amber-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI (15 C√¢u - 4 M·ª©c ƒë·ªô) ---
      const questions = [
        // --- NH·∫¨N BI·∫æT (6 C√¢u) ---
        {
          id: 1,
          level: "Nh·∫≠n bi·∫øt",
          question:
            "V·ªõi a ‚â• 0 v√† b ‚â• 0, ƒë∆∞a th·ª´a s·ªë ra ngo√†i d·∫•u cƒÉn c·ªßa ‚àö(a¬≤b) ta ƒë∆∞·ª£c:",
          options: ["a‚àöb", "-a‚àöb", "|a|b", "ab"],
          correct: 0,
        },
        {
          id: 2,
          level: "Nh·∫≠n bi·∫øt",
          question:
            "V·ªõi a < 0 v√† b ‚â• 0, k·∫øt qu·∫£ c·ªßa ph√©p bi·∫øn ƒë·ªïi ‚àö(a¬≤b) l√†:",
          options: ["a‚àöb", "-a‚àöb", "a¬≤‚àöb", "-‚àöb"],
          correct: 1,
        },
        {
          id: 3,
          level: "Nh·∫≠n bi·∫øt",
          question: "ƒê∆∞a th·ª´a s·ªë v√†o trong d·∫•u cƒÉn c·ªßa 3‚àö2 ta ƒë∆∞·ª£c:",
          options: ["‚àö6", "‚àö12", "‚àö18", "‚àö36"],
          correct: 2,
        },
        {
          id: 4,
          level: "Nh·∫≠n bi·∫øt",
          question:
            "Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y ƒë√∫ng khi ƒë∆∞a th·ª´a s·ªë d∆∞∆°ng A v√†o trong cƒÉn b·∫≠c hai?",
          options: [
            "A‚àöB = ‚àö(A¬≤B)",
            "A‚àöB = -‚àö(A¬≤B)",
            "A‚àöB = ‚àö(AB)",
            "A‚àöB = ‚àö(A + B)",
          ],
          correct: 0,
        },
        {
          id: 5,
          level: "Nh·∫≠n bi·∫øt",
          question:
            "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh ƒë∆∞a th·ª´a s·ªë ra ngo√†i d·∫•u cƒÉn c·ªßa ‚àö12 l√†:",
          options: ["3‚àö2", "2‚àö3", "4‚àö3", "2‚àö2"],
          correct: 1,
        },
        {
          id: 6,
          level: "Nh·∫≠n bi·∫øt",
          question:
            "V·ªõi x ‚â• 0, ƒë∆∞a th·ª´a s·ªë x v√†o trong bi·ªÉu th·ª©c ‚àö5 ta ƒë∆∞·ª£c:",
          options: ["‚àö(5x)", "‚àö(5x¬≤)", "‚àö(x‚àö5)", "5x"],
          correct: 1,
        },

        // --- TH√îNG HI·ªÇU (5 C√¢u) ---
        {
          id: 7,
          level: "Th√¥ng hi·ªÉu",
          question: "R√∫t g·ªçn bi·ªÉu th·ª©c 2‚àö3 + ‚àö27 - ‚àö12:",
          options: ["3‚àö3", "4‚àö3", "2‚àö3", "‚àö3"],
          correct: 0,
        },
        {
          id: 8,
          level: "Th√¥ng hi·ªÉu",
          question:
            "ƒê∆∞a th·ª´a s·ªë v√†o trong d·∫•u cƒÉn c·ªßa bi·ªÉu th·ª©c: -4‚àö2",
          options: ["‚àö32", "-‚àö32", "‚àö(-32)", "-‚àö16"],
          correct: 1,
        },
        {
          id: 9,
          level: "Th√¥ng hi·ªÉu",
          question: "V·ªõi y < 0, r√∫t g·ªçn bi·ªÉu th·ª©c ‚àö(4y¬≤) ta ƒë∆∞·ª£c:",
          options: ["2y", "-2y", "4y", "-4y"],
          correct: 1,
        },
        {
          id: 10,
          level: "Th√¥ng hi·ªÉu",
          question: "So s√°nh 3‚àö2 v√† ‚àö15:",
          options: [
            "3‚àö2 > ‚àö15",
            "3‚àö2 < ‚àö15",
            "3‚àö2 = ‚àö15",
            "Kh√¥ng so s√°nh ƒë∆∞·ª£c",
          ],
          correct: 0,
        },
        {
          id: 11,
          level: "Th√¥ng hi·ªÉu",
          question:
            "R√∫t g·ªçn bi·ªÉu th·ª©c 5‚àöa - 3‚àö25a + 2‚àö9a (v·ªõi a ‚â• 0):",
          options: ["3‚àöa", "-4‚àöa", "5‚àöa", "-5‚àöa"],
          correct: 1,
        },

        // --- V·∫¨N D·ª§NG (3 C√¢u) ---
        {
          id: 12,
          level: "V·∫≠n d·ª•ng",
          question:
            "S·∫Øp x·∫øp c√°c s·ªë sau theo th·ª© t·ª± tƒÉng d·∫ßn: 2‚àö5, 3‚àö2, ‚àö21, 4",
          options: [
            "3‚àö2 < 4 < ‚àö21 < 2‚àö5",
            "4 < 3‚àö2 < 2‚àö5 < ‚àö21",
            "3‚àö2 < 4 < 2‚àö5 < ‚àö21",
            "‚àö21 < 3‚àö2 < 4 < 2‚àö5",
          ],
          correct: 1
        },
        {
          id: 13,
          level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
          question:
            "M·ªôt m·∫£nh ƒë·∫•t h√¨nh vu√¥ng c√≥ di·ªán t√≠ch 72 m¬≤. ƒê·ªô d√†i c·∫°nh c·ªßa m·∫£nh ƒë·∫•t ƒë√≥ d·∫°ng a‚àöb l√†:",
          options: ["36‚àö2 m√©t", "6‚àö2 m√©t", "12‚àö2 m√©t", "6‚àö3 m√©t"],
          correct: 1,
        },
        {
          id: 14,
          level: "V·∫≠n d·ª•ng",
          question:
            "T√¨m x, bi·∫øt ‚àö18x - 2‚àö2x = 8 (v·ªõi x ‚â• 0):",
          options: ["x = 4", "x = 16", "x = 64", "x = 32"],
          correct: 3,
          },

        // --- V·∫¨N D·ª§NG CAO (1 C√¢u) ---
        {
          id: 15,
          level: "V·∫≠n d·ª•ng cao",
          question:
            "R√∫t g·ªçn bi·ªÉu th·ª©c A = ‚àö(4x¬≤ - 4x + 1) - 2x + 5 v·ªõi x < 0,5:",
          options: ["6", "4", "4 - 4x", "6 - 4x"],
          correct: 3,
        },
      ];

      // --- H·ªÜ TH·ªêNG √ÇM THANH ---
      const BrowserAudioContext =
        window.AudioContext || window.webkitAudioContext || null;

      const playSound = (type) => {
        if (!BrowserAudioContext) return;
        const ctx = new BrowserAudioContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();

        const now = ctx.currentTime;

        if (type === "correct") {
          // Fanfare
          osc.type = "sawtooth";
          osc.frequency.setValueAtTime(523.25, now); // C5
          osc.frequency.setValueAtTime(659.25, now + 0.1); // E5
          osc.frequency.setValueAtTime(783.99, now + 0.2); // G5
          gain.gain.setValueAtTime(0.1, now);
          gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
          osc.start(now);
          osc.stop(now + 0.5);
        } else if (type === "wrong") {
          // Thud
          osc.type = "square";
          osc.frequency.setValueAtTime(150, now);
          osc.frequency.exponentialRampToValueAtTime(50, now + 0.3);
          gain.gain.setValueAtTime(0.1, now);
          gain.gain.linearRampToValueAtTime(0, now + 0.3);
          osc.start(now);
          osc.stop(now + 0.3);
        } else if (type === "build") {
          // Hammer
          osc.type = "triangle";
          osc.frequency.setValueAtTime(200, now);
          gain.gain.setValueAtTime(0.1, now);
          gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
          osc.start(now);
          osc.stop(now + 0.1);
        }

        osc.connect(gain);
        gain.connect(ctx.destination);
      };

      // --- CONFETTI ---
      const Confetti = () => (
        <div className="absolute inset-0 pointer-events-none overflow-hidden z-50">
          {[...Array(30)].map((_, i) => (
            <div
              key={i}
              className="absolute w-2 h-2 rounded bg-yellow-400"
              style={{
                left: `${Math.random() * 100}%`,
                top: -10,
                backgroundColor: ["#FFD700", "#FFA500", "#32CD32", "#FF4500"][
                  i % 4
                ],
                animation: `fall ${1 + Math.random()}s linear forwards`,
              }}
            />
          ))}
          <style>{`
            @keyframes fall {
              to { transform: translateY(100vh) rotate(360deg); }
            }
          `}</style>
        </div>
      );

      // --- TR·∫†NG TH√ÅI ƒê·∫æ CH·∫æ ---
      const EmpireView = ({ score }) => {
        const hasHut = score >= 10;
        const hasFarm = score >= 40;
        const hasHouse = score >= 70;
        const hasMarket = score >= 100;
        const hasCastle = score >= 130;
        const hasWonder = score >= 150;

        return (
          <div className="relative w-full h-64 bg-green-100 rounded-xl border-4 border-yellow-700 overflow-hidden shadow-inner mb-4">
            {/* B·∫ßu tr·ªùi */}
            <div className="absolute inset-0 bg-gradient-to-b from-blue-300 to-blue-100 h-1/2" />
            {/* ƒê·∫•t */}
            <div className="absolute inset-x-0 bottom-0 h-1/2 bg-[#8B4513]" />
            <div className="absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-b from-green-500 to-green-700 transform skew-y-2 origin-bottom-left" />

            {/* C·∫£nh v·∫≠t */}
            <div className="absolute bottom-10 left-4 transition-all duration-700 transform translate-y-0">
              {hasHut && <div className="text-4xl animate-bounce">‚õ∫</div>}
            </div>
            <div className="absolute bottom-12 left-1/4 transition-all duration-700 delay-100">
              {hasFarm && <div className="text-5xl">üè°</div>}
            </div>
            <div className="absolute bottom-20 right-1/4 transition-all duration-700 delay-200">
              {hasHouse && <div className="text-5xl">üè†</div>}
            </div>
            <div className="absolute bottom-8 right-8 transition-all duration-700 delay-300">
              {hasMarket && <div className="text-6xl">üõñ</div>}
            </div>

            {/* L√¢u ƒë√†i ch√≠nh */}
            <div
              className={`absolute bottom-16 left-1/2 transform -translate-x-1/2 transition-all duration-1000 ${
                hasCastle ? "opacity-100 scale-100" : "opacity-0 scale-50"
              }`}
            >
              <div className="text-8xl drop-shadow-2xl">üè∞</div>
            </div>

            {/* K·ª≥ quan */}
            {hasWonder && (
              <div className="absolute top-4 right-4 animate-pulse">
                <div className="text-6xl">üóø</div>
              </div>
            )}

            {/* M√¢y */}
            <div className="absolute top-4 left-10 text-white opacity-80 animate-pulse">
              ‚òÅÔ∏è
            </div>
            <div className="absolute top-8 right-20 text-white opacity-60">
              ‚òÅÔ∏è
            </div>
          </div>
        );
      };

      function EmpireRise() {
        const [gameState, setGameState] = useState("start"); // start, playing, end
        const [currentQ, setCurrentQ] = useState(0);
        const [score, setScore] = useState(0);
        const [resources, setResources] = useState({
          gold: 0,
          wood: 0,
          stone: 0,
        });
        const [feedback, setFeedback] = useState(null); // null, correct, wrong
        const [showConfetti, setShowConfetti] = useState(false);

        const startGame = () => {
          setGameState("playing");
          setCurrentQ(0);
          setScore(0);
          setResources({ gold: 0, wood: 0, stone: 0 });
          setFeedback(null);
        };

        const handleAnswer = (index) => {
          if (feedback) return;

          const isCorrect = index === questions[currentQ].correct;

          if (isCorrect) {
            playSound("correct");
            playSound("build");
            setFeedback("correct");
            setShowConfetti(true);

            const points = 10;
            setScore((s) => s + points);
            setResources((prev) => ({
              gold: prev.gold + 50,
              wood: prev.wood + 30,
              stone: prev.stone + 20,
            }));
          } else {
            playSound("wrong");
            setFeedback("wrong");
          }

          setTimeout(() => {
            setShowConfetti(false);
            setFeedback(null);
            if (currentQ < questions.length - 1) {
              setCurrentQ((c) => c + 1);
            } else {
              setGameState("end");
            }
          }, 2000);
        };

        return (
          <div className="min-h-screen bg-amber-50 font-serif text-slate-800 flex items-center justify-center p-4">
            <div className="w-full max-w-4xl bg-white rounded-2xl shadow-2xl border-4 border-yellow-600 overflow-hidden relative">
              {/* Header t√†i nguy√™n */}
              {gameState !== "start" && (
                <div className="bg-slate-800 text-white p-3 flex justify-between items-center border-b-4 border-yellow-600">
                  <div className="flex space-x-6 font-bold text-sm md:text-base">
                    <div className="flex items-center text-yellow-400">
                      <span className="mr-1">ü™ô</span> {resources.gold}
                    </div>
                    <div className="flex items-center text-orange-400">
                      <span className="mr-1">üå≤</span> {resources.wood}
                    </div>
                    <div className="flex items-center text-gray-400">
                      <span className="mr-1">üî®</span> {resources.stone}
                    </div>
                  </div>
                  <div className="flex items-center font-bold text-yellow-500">
                    <span className="mr-2">üëë</span>
                    ƒêi·ªÉm: {score}
                  </div>
                </div>
              )}

              {/* START SCREEN */}
              {gameState === "start" && (
                <div className="p-12 text-center space-y-6 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')]">
                  <div className="text-6xl mx-auto">üè∞</div>
                  <h1 className="text-5xl font-bold text-yellow-800 tracking-wider uppercase drop-shadow-sm">
                    ƒê·∫ø Ch·∫ø Tr·ªói D·∫≠y
                  </h1>
                  <p className="text-xl text-slate-600 font-medium">
                    Ch·ªß ƒë·ªÅ: Bi·∫øn ƒë·ªïi ƒë∆°n gi·∫£n bi·ªÉu th·ª©c ch·ª©a cƒÉn b·∫≠c hai
                    <br />
                    (To√°n 9 - Ch√¢n tr·ªùi s√°ng t·∫°o)
                  </p>
                  <div className="p-6 bg-yellow-50 rounded-xl border-2 border-yellow-200 max-w-md mx-auto">
                    <p className="mb-2">
                      üìú <strong>Nhi·ªám v·ª•:</strong> Tr·∫£ l·ªùi ƒë√∫ng ƒë·ªÉ thu th·∫≠p
                      t√†i nguy√™n v√† x√¢y d·ª±ng v∆∞∆°ng qu·ªëc.
                    </p>
                    <p>
                      üèÜ <strong>M·ª•c ti√™u:</strong> X√¢y d·ª±ng K·ª≥ Quan Th·∫ø Gi·ªõi.
                    </p>
                  </div>
                  <button
                    onClick={startGame}
                    className="px-8 py-4 bg-red-700 text-white text-xl font-bold rounded-lg shadow-[0_4px_0_rgb(153,27,27)] active:shadow-none active:translate-y-1 hover:bg-red-600 transition-all uppercase"
                  >
                    Kh·ªüi T·∫°o Th·∫ø Gi·ªõi
                  </button>
                </div>
              )}

              {/* GAMEPLAY SCREEN */}
              {gameState === "playing" && (
                <div className="p-6 bg-slate-50">
                  <EmpireView score={score} />
                  {showConfetti && <Confetti />}

                  <div className="bg-white p-6 rounded-xl border-2 border-slate-200 shadow-lg relative">
                    <div className="absolute -top-3 left-6 bg-blue-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-widest shadow-sm">
                      {questions[currentQ].level}
                    </div>

                    <div className="mt-4 mb-8">
                      <h2 className="text-2xl font-bold text-slate-800 text-center">
                        {questions[currentQ].question}
                      </h2>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {questions[currentQ].options.map((opt, idx) => {
                        let btnStyle =
                          "bg-slate-100 hover:bg-yellow-50 border-slate-300 text-slate-700";
                        let icon = null;

                        if (feedback) {
                          if (idx === questions[currentQ].correct) {
                            btnStyle =
                              "bg-green-100 border-green-500 text-green-800 ring-2 ring-green-200";
                            icon = (
                              <span className="absolute right-4 text-2xl">
                                ‚úÖ
                              </span>
                            );
                          } else if (
                            feedback === "wrong" &&
                            idx !== questions[currentQ].correct
                          ) {
                            btnStyle = "opacity-50";
                          }
                        }

                        return (
                          <button
                            key={idx}
                            disabled={feedback !== null}
                            onClick={() => handleAnswer(idx)}
                            className={`relative p-4 rounded-lg border-2 font-bold text-lg text-left transition-all active:scale-[0.98] flex items-center ${btnStyle}`}
                          >
                            <span className="w-8 h-8 flex items-center justify-center bg-white rounded-full border border-slate-200 mr-3 text-sm font-black text-slate-500">
                              {["A", "B", "C", "D"][idx]}
                            </span>
                            {opt}
                            {icon}
                          </button>
                        );
                      })}
                    </div>
                  </div>
                </div>
              )}

              {/* END SCREEN */}
              {gameState === "end" && (
                <div className="p-12 text-center bg-yellow-50">
                  <div className="text-6xl mx-auto mb-4 animate-bounce">üèÖ</div>
                  <h2 className="text-4xl font-bold text-slate-800 mb-2">
                    Tri·ªÅu ƒê·∫°i H∆∞ng Th·ªãnh!
                  </h2>
                  <p className="text-slate-600 mb-8">
                    B·∫°n ƒë√£ ho√†n th√†nh s·ª© m·ªánh l·ªãch s·ª≠.
                  </p>

                  <div className="grid grid-cols-3 gap-4 max-w-lg mx-auto mb-8">
                    <div className="bg-white p-4 rounded-lg shadow border border-slate-200">
                      <div className="text-sm text-slate-500">T·ªïng ƒêi·ªÉm</div>
                      <div className="text-2xl font-bold text-slate-800">
                        {score}
                      </div>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow border border-slate-200">
                      <div className="text-sm text-slate-500">C√¢u ƒë√∫ng</div>
                      <div className="text-2xl font-bold text-green-600">
                        {score / 10}/15
                      </div>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow border border-slate-200">
                      <div className="text-sm text-slate-500">Danh hi·ªáu</div>
                      <div className="text-xl font-bold text-purple-600">
                        {score >= 130
                          ? "ƒê·∫°i ƒê·∫ø"
                          : score >= 80
                          ? "L√£nh Ch√∫a"
                          : "T·ªôc Tr∆∞·ªüng"}
                      </div>
                    </div>
                  </div>

                  <button
                    onClick={startGame}
                    className="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-500 shadow-lg flex items-center justify-center mx-auto gap-2"
                  >
                    <span>üîÑ</span> Ch∆°i l·∫°i t·ª´ ƒë·∫ßu
                  </button>
                </div>
              )}

              {/* Footer */}
              <div className="bg-slate-100 p-2 text-center text-xs text-slate-400 border-t border-slate-200">
                To√°n 9 - Ch√¢n tr·ªùi s√°ng t·∫°o - B√†i 4
              </div>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(
        <EmpireRise />
      );
    </script>
  </body>
</html>
