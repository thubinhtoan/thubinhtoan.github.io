<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinh Phục Đỉnh Cao Lũy Thừa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #fdfbf7 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        .game-card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .option-btn {
            transition: all 0.2s;
            border: 2px solid #e2e8f0;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: #8b5cf6;
            background-color: #f5f3ff;
        }

        .option-btn.selected {
            border-color: #8b5cf6;
            background-color: #ede9fe;
        }

        .option-btn.correct {
            border-color: #22c55e;
            background-color: #dcfce7;
            color: #15803d;
        }

        .option-btn.wrong {
            border-color: #ef4444;
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sup {
            vertical-align: super;
            font-size: smaller;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <!-- Audio Elements -->
    <audio id="correctSound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="wrongSound" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
    <audio id="winSound" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

    <div id="app" class="w-full max-w-2xl">
        <!-- Start Screen -->
        <div id="startScreen" class="game-card p-8 text-center fade-in">
            <div class="mb-6">
                <i class="fa-solid fa-cube text-6xl text-violet-500 fa-bounce"></i>
            </div>
            <h1 class="text-4xl font-extrabold text-slate-800 mb-4">Chinh Phục<br><span class="text-violet-600">Đỉnh Cao Lũy Thừa</span></h1>
            <p class="text-slate-600 mb-8 text-lg">Bài 3 - Chương 1 - Toán 7</p>
            
            <div class="grid grid-cols-2 gap-4 mb-8 text-left max-w-md mx-auto bg-slate-50 p-4 rounded-xl">
                <div class="flex items-center space-x-2 text-slate-700">
                    <i class="fa-solid fa-list-ol text-blue-500"></i>
                    <span>15 Câu hỏi</span>
                </div>
                <div class="flex items-center space-x-2 text-slate-700">
                    <i class="fa-solid fa-brain text-pink-500"></i>
                    <span>4 Mức độ</span>
                </div>
            </div>

            <button onclick="startGame()" class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg transform transition hover:-translate-y-1 text-xl w-full sm:w-auto">
                <i class="fa-solid fa-play mr-2"></i> Bắt đầu ngay
            </button>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <!-- Header -->
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-2 bg-white px-4 py-2 rounded-full shadow-sm">
                    <span class="text-sm font-bold text-slate-500">Câu</span>
                    <span id="currentQuestionNum" class="text-xl font-bold text-violet-600">1</span>
                    <span class="text-slate-400">/</span>
                    <span class="text-sm font-bold text-slate-500">15</span>
                </div>
                <div class="flex items-center space-x-2 bg-white px-4 py-2 rounded-full shadow-sm">
                    <i class="fa-solid fa-star text-yellow-500"></i>
                    <span id="scoreDisplay" class="text-xl font-bold text-slate-700">0</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-slate-200 rounded-full h-2.5 mb-6">
                <div id="progressBar" class="bg-violet-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>

            <!-- Question Card -->
            <div class="game-card p-6 mb-6 relative overflow-hidden">
                <div id="levelBadge" class="absolute top-0 right-0 bg-green-100 text-green-800 text-xs font-bold px-3 py-1 rounded-bl-lg">
                    Nhận biết
                </div>
                <h2 id="questionText" class="text-xl sm:text-2xl font-bold text-slate-800 mb-6 mt-4 leading-relaxed">
                    <!-- Question goes here -->
                </h2>

                <div id="optionsContainer" class="grid grid-cols-1 gap-3">
                    <!-- Options go here -->
                </div>
            </div>

            <!-- Feedback / Rationale -->
            <div id="feedbackContainer" class="hidden game-card p-6 border-l-4 border-violet-500 bg-violet-50 fade-in">
                <div class="flex items-start">
                    <div id="feedbackIcon" class="mr-4 mt-1">
                        <!-- Icon -->
                    </div>
                    <div>
                        <h3 id="feedbackTitle" class="font-bold text-lg mb-1">Giải thích</h3>
                        <p id="feedbackText" class="text-slate-700 leading-relaxed"></p>
                    </div>
                </div>
                <div class="mt-4 text-right">
                    <button onclick="nextQuestion()" class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-2 px-6 rounded-lg shadow transition">
                        Tiếp theo <i class="fa-solid fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="resultScreen" class="hidden game-card p-8 text-center fade-in">
            <div id="resultIcon" class="mb-6">
                <!-- Result Icon -->
            </div>
            <h2 class="text-3xl font-bold text-slate-800 mb-2">Hoàn thành!</h2>
            <p class="text-slate-600 mb-6">Bạn đã hoàn thành bài kiểm tra kiến thức.</p>
            
            <div class="text-6xl font-black text-violet-600 mb-2" id="finalScore">0</div>
            <p class="text-slate-500 font-medium mb-8">Tổng điểm của bạn</p>

            <div class="grid grid-cols-3 gap-4 mb-8">
                <div class="bg-slate-50 p-4 rounded-xl">
                    <div class="text-2xl font-bold text-green-500" id="correctCount">0</div>
                    <div class="text-xs text-slate-500 uppercase font-bold">Đúng</div>
                </div>
                <div class="bg-slate-50 p-4 rounded-xl">
                    <div class="text-2xl font-bold text-red-500" id="wrongCount">0</div>
                    <div class="text-xs text-slate-500 uppercase font-bold">Sai</div>
                </div>
                <div class="bg-slate-50 p-4 rounded-xl">
                    <div class="text-2xl font-bold text-blue-500">15</div>
                    <div class="text-xs text-slate-500 uppercase font-bold">Tổng</div>
                </div>
            </div>

            <button onclick="location.reload()" class="bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform transition hover:-translate-y-1">
                <i class="fa-solid fa-rotate-right mr-2"></i> Chơi lại
            </button>
        </div>
    </div>

    <script>
        // Database câu hỏi
        const questions = [
            // Mức độ: Nhận biết (6 câu)
            {
                text: "Luỹ thừa bậc n của số hữu tỉ x, kí hiệu x<sup>n</sup>, là tích của bao nhiêu thừa số x?",
                options: ["n thừa số", "n + 1 thừa số", "n - 1 thừa số", "2n thừa số"],
                correct: 0,
                rationale: "Theo định nghĩa, x<sup>n</sup> là tích của n thừa số x (với n là số tự nhiên lớn hơn 1).",
                level: "Nhận biết"
            },
            {
                text: "Quy ước nào sau đây là ĐÚNG với mọi số hữu tỉ x khác 0?",
                options: ["x<sup>0</sup> = 1", "x<sup>0</sup> = 0", "x<sup>0</sup> = x", "x<sup>0</sup> = -1"],
                correct: 0,
                rationale: "Quy ước: Một số khác 0 mũ 0 luôn bằng 1.",
                level: "Nhận biết"
            },
            {
                text: "Khi nhân hai luỹ thừa cùng cơ số x<sup>m</sup> . x<sup>n</sup>, ta làm thế nào?",
                options: ["Giữ nguyên cơ số, cộng hai số mũ", "Giữ nguyên cơ số, nhân hai số mũ", "Nhân hai cơ số, giữ nguyên số mũ", "Cộng hai cơ số, nhân hai số mũ"],
                correct: 0,
                rationale: "Công thức: x<sup>m</sup> . x<sup>n</sup> = x<sup>m+n</sup>.",
                level: "Nhận biết"
            },
            {
                text: "Công thức tính luỹ thừa của một luỹ thừa (x<sup>m</sup>)<sup>n</sup> là gì?",
                options: ["x<sup>m.n</sup>", "x<sup>m+n</sup>", "x<sup>m-n</sup>", "x<sup>m:n</sup>"],
                correct: 0,
                rationale: "Công thức: (x<sup>m</sup>)<sup>n</sup> = x<sup>m.n</sup>.",
                level: "Nhận biết"
            },
            {
                text: "Kết quả của phép tính (3/4)<sup>1</sup> là:",
                options: ["3/4", "1", "0", "4/3"],
                correct: 0,
                rationale: "Quy ước: x<sup>1</sup> = x.",
                level: "Nhận biết"
            },
            {
                text: "Khi chia hai luỹ thừa cùng cơ số x<sup>m</sup> : x<sup>n</sup> (x ≠ 0, m ≥ n), ta làm thế nào?",
                options: ["Giữ nguyên cơ số, trừ số mũ", "Giữ nguyên cơ số, chia số mũ", "Chia hai cơ số, trừ số mũ", "Trừ hai cơ số, giữ nguyên số mũ"],
                correct: 0,
                rationale: "Công thức: x<sup>m</sup> : x<sup>n</sup> = x<sup>m-n</sup>.",
                level: "Nhận biết"
            },

            // Mức độ: Thông hiểu (5 câu)
            {
                text: "Tính giá trị của luỹ thừa: (-1/3)<sup>3</sup>",
                options: ["-1/27", "1/27", "-1/9", "1/9"],
                correct: 0,
                rationale: "(-1/3)<sup>3</sup> = (-1/3).(-1/3).(-1/3) = -1/27. Mũ lẻ của số âm là số âm.",
                level: "Thông hiểu"
            },
            {
                text: "Viết số 16/81 dưới dạng luỹ thừa của một số hữu tỉ:",
                options: ["(2/3)<sup>4</sup>", "(4/9)<sup>3</sup>", "(2/3)<sup>3</sup>", "(4/9)<sup>4</sup>"],
                correct: 0,
                rationale: "16 = 2<sup>4</sup> và 81 = 3<sup>4</sup>, nên 16/81 = (2/3)<sup>4</sup>. Cũng có thể là (4/9)<sup>2</sup> nhưng đáp án không có.",
                level: "Thông hiểu"
            },
            {
                text: "Kết quả của phép tính: (-0,5)<sup>2</sup> là:",
                options: ["0,25", "-0,25", "0,5", "-0,5"],
                correct: 0,
                rationale: "(-0,5)<sup>2</sup> = (-0,5) . (-0,5) = 0,25. Mũ chẵn của số âm là số dương.",
                level: "Thông hiểu"
            },
            {
                text: "Tìm x biết: x : (-1/2)<sup>3</sup> = -1/2",
                options: [
                    "x = (1/2)<sup>5</sup>",
                    "x = (-1/2)<sup>4</sup>",
                    "x = (-1/2)<sup>2</sup>",
                    "x = 1/8"
                ],
                correct: 1,
                rationale: "Ta có x / (-1/2)<sup>3</sup> = -1/2 ⇒ x = (-1/2) . (-1/2)<sup>3</sup> = (-1/2)<sup>4</sup> = 1/16.",
                level: "Thông hiểu"
            },
            {
                text: "Viết biểu thức 3<sup>4</sup> . 3<sup>5</sup> dưới dạng một luỹ thừa:",
                options: ["3<sup>9</sup>", "3<sup>20</sup>", "9<sup>9</sup>", "9<sup>20</sup>"],
                correct: 0,
                rationale: "Giữ nguyên cơ số, cộng số mũ: 4 + 5 = 9. Kết quả 3<sup>9</sup>.",
                level: "Thông hiểu"
            },

            // Mức độ: Vận dụng (3 câu)
            {
                text: "Tính giá trị biểu thức: 4 . (1/2)<sup>2</sup> + 3",
                options: ["4", "5", "3,5", "2"],
                correct: 0,
                rationale: "4 . (1/4) + 3 = 1 + 3 = 4.",
                level: "Vận dụng"
            },
            {
                text: "Tìm x, biết: (x + 0,5)<sup>2</sup> = 1/4",
                options: ["x = 0 hoặc x = -1", "x = 0", "x = 1/2", "x = -1"],
                correct: 0,
                rationale: "Ta có (1/2)<sup>2</sup> = 1/4 và (-1/2)<sup>2</sup> = 1/4. <br>TH1: x + 0,5 = 0,5 ⇒ x = 0. <br>TH2: x + 0,5 = -0,5 ⇒ x = -1.",
                level: "Vận dụng"
            },
            {
                text: "<b>[Vận dụng thực tế]</b> Một khối Rubik 3x3 có dạng hình lập phương với cạnh dài 5,5 cm. Tính thể tích của khối Rubik đó?",
                options: ["166,375 cm<sup>3</sup>", "30,25 cm<sup>3</sup>", "16,5 cm<sup>3</sup>", "150,25 cm<sup>3</sup>"],
                correct: 0,
                rationale: "Thể tích hình lập phương V = a<sup>3</sup> = (5,5)<sup>3</sup> = 166,375 cm<sup>3</sup>.",
                level: "Vận dụng thực tế"
            },

            // Mức độ: Vận dụng cao (1 câu)
            {
                text: "So sánh hai số: 3<sup>200</sup> và 2<sup>300</sup>",
                options: ["3<sup>200</sup> > 2<sup>300</sup>", "3<sup>200</sup> < 2<sup>300</sup>", "3<sup>200</sup> = 2<sup>300</sup>", "Không so sánh được"],
                correct: 0,
                rationale: "Biến đổi về cùng số mũ 100: <br>3<sup>200</sup> = (3<sup>2</sup>)<sup>100</sup> = 9<sup>100</sup> <br>2<sup>300</sup> = (2<sup>3</sup>)<sup>100</sup> = 8<sup>100</sup> <br>Vì 9 > 8 nên 3<sup>200</sup> > 2<sup>300</sup>.",
                level: "Vận dụng cao"
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswersCount = 0;
        let isAnswering = true;

        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const resultScreen = document.getElementById('resultScreen');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const feedbackTitle = document.getElementById('feedbackTitle');
        const feedbackText = document.getElementById('feedbackText');
        const feedbackIcon = document.getElementById('feedbackIcon');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const currentQuestionNum = document.getElementById('currentQuestionNum');
        const progressBar = document.getElementById('progressBar');
        const levelBadge = document.getElementById('levelBadge');

        // Sounds
        const correctSound = document.getElementById('correctSound');
        const wrongSound = document.getElementById('wrongSound');
        const winSound = document.getElementById('winSound');

        function playSound(type) {
            if(type === 'correct') { correctSound.currentTime = 0; correctSound.play().catch(e => {}); }
            if(type === 'wrong')   { wrongSound.currentTime = 0; wrongSound.play().catch(e => {}); }
            if(type === 'win')     { winSound.currentTime = 0; winSound.play().catch(e => {}); }
        }

        function startGame() {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('fade-in');
            loadQuestion();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadQuestion() {
            isAnswering = true;
            feedbackContainer.classList.add('hidden');

            const q = questions[currentQuestionIndex];

            // Update UI Info
            currentQuestionNum.textContent = currentQuestionIndex + 1;
            const progressPercent = ((currentQuestionIndex) / questions.length) * 100;
            progressBar.style.width = `${progressPercent}%`;

            // Level Badge color
            let badgeClass = "bg-gray-100 text-gray-800";
            if(q.level.includes("Nhận biết"))  badgeClass = "bg-green-100 text-green-800";
            if(q.level.includes("Thông hiểu")) badgeClass = "bg-blue-100 text-blue-800";
            if(q.level.includes("Vận dụng"))   badgeClass = "bg-yellow-100 text-yellow-800";
            if(q.level.includes("cao"))        badgeClass = "bg-purple-100 text-purple-800";
            levelBadge.className = `absolute top-0 right-0 text-xs font-bold px-3 py-1 rounded-bl-lg ${badgeClass}`;
            levelBadge.textContent = q.level;

            // Question Text
            questionText.innerHTML = q.text;

            // Options với shuffle
            optionsContainer.innerHTML = '';
            const indices = shuffleArray([0, 1, 2, 3]);
            q.shuffledCorrectIndex = null;

            indices.forEach((optIndex, displayIndex) => {
                const option = q.options[optIndex];
                const btn = document.createElement('button');
                btn.className = 'option-btn w-full text-left p-4 rounded-xl text-slate-700 font-medium text-lg';
                btn.innerHTML = `
                    <span class="inline-block w-8 h-8 rounded-full bg-slate-100 text-slate-500 text-center leading-8 mr-3 font-bold text-sm">
                        ${String.fromCharCode(65 + displayIndex)}
                    </span> ${option}
                `;
                btn.onclick = () => checkAnswer(displayIndex, btn);
                optionsContainer.appendChild(btn);

                if (optIndex === q.correct) {
                    q.shuffledCorrectIndex = displayIndex;
                }
            });

            // Phòng trường hợp nào đó không set được (rất hiếm)
            if (q.shuffledCorrectIndex === null) {
                q.shuffledCorrectIndex = q.correct;
            }
        }

        function checkAnswer(selectedIndex, btnElement) {
            if (!isAnswering) return;
            isAnswering = false;

            const q = questions[currentQuestionIndex];
            const buttons = optionsContainer.getElementsByTagName('button');
            const correctIndex = q.shuffledCorrectIndex ?? q.correct;

            // Hiển thị kết quả trên các nút
            for (let i = 0; i < buttons.length; i++) {
                buttons[i].disabled = true;
                if (i === correctIndex) {
                    buttons[i].classList.add('correct');
                    buttons[i].innerHTML += ' <i class="fa-solid fa-check float-right mt-1"></i>';
                }
            }

            if (selectedIndex === correctIndex) {
                // Đúng
                score += 10;
                correctAnswersCount++;
                scoreDisplay.textContent = score;
                playSound('correct');
                
                // Hiệu ứng tung hoa (Confetti)
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#8b5cf6', '#22c55e', '#f59e0b']
                });

                showFeedback(true, q.rationale);
            } else {
                // Sai
                btnElement.classList.add('wrong');
                btnElement.innerHTML += ' <i class="fa-solid fa-xmark float-right mt-1"></i>';
                playSound('wrong');
                showFeedback(false, q.rationale);
            }
        }

        function showFeedback(isCorrect, rationale) {
            feedbackContainer.classList.remove('hidden');
            
            if (isCorrect) {
                feedbackContainer.className = "game-card p-6 border-l-4 border-green-500 bg-green-50 fade-in mt-6";
                feedbackIcon.innerHTML = '<i class="fa-regular fa-face-smile text-3xl text-green-500"></i>';
                feedbackTitle.textContent = "Chính xác! Xuất sắc quá!";
                feedbackTitle.className = "font-bold text-lg mb-1 text-green-700";
            } else {
                feedbackContainer.className = "game-card p-6 border-l-4 border-red-500 bg-red-50 fade-in mt-6";
                feedbackIcon.innerHTML = '<i class="fa-regular fa-face-frown-open text-3xl text-red-500"></i>';
                feedbackTitle.textContent = "Tiếc quá, chưa đúng rồi!";
                feedbackTitle.className = "font-bold text-lg mb-1 text-red-700";
            }
            feedbackText.innerHTML = rationale;
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('correctCount').textContent = correctAnswersCount;
            document.getElementById('wrongCount').textContent = questions.length - correctAnswersCount;

            const resultIcon = document.getElementById('resultIcon');
            if (correctAnswersCount >= 12) {
                resultIcon.innerHTML = '<i class="fa-solid fa-crown text-6xl text-yellow-400 fa-bounce"></i>';
                playSound('win');
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            } else if (correctAnswersCount >= 8) {
                resultIcon.innerHTML = '<i class="fa-solid fa-star text-6xl text-blue-400"></i>';
            } else {
                resultIcon.innerHTML = '<i class="fa-solid fa-book-open text-6xl text-slate-400"></i>';
            }
        }
    </script>
</body>
</html>
