<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·∫•u Tr∆∞·ªùng X√°c Su·∫•t - To√°n 8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- MathJax -->
    <script>
        MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #fbcfe8 0%, #f43f5e 100%); /* Rose theme */
            min-height: 100vh;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(225, 29, 72, 0.15), 0 10px 10px -5px rgba(225, 29, 72, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .option-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-width: 2px;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 63, 94, 0.25);
            background-color: #fff1f2;
            border-color: #f43f5e;
        }

        .option-btn.correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #14532d !important;
        }

        .option-btn.wrong {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #7f1d1d !important;
        }

        .feedback-enter {
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-bar {
            transition: width 0.5s ease-in-out;
        }

        .badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="w-full max-w-3xl">
        <!-- Start Screen -->
        <div id="start-screen" class="card p-10 text-center">
            <div class="mb-6 inline-flex p-6 bg-pink-100 rounded-full animate-bounce shadow-inner">
                <span class="text-6xl">üéØ</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-black text-rose-600 mb-4">ƒê·∫•u Tr∆∞·ªùng X√°c Su·∫•t</h1>
            <p class="text-gray-600 mb-8 text-lg font-medium">T·ªïng √¥n Ch∆∞∆°ng 9 - To√°n 8<br>B·∫°n ƒë√£ s·∫µn s√†ng cho th·ª≠ th√°ch cu·ªëi c√πng?</p>
            
            <div class="grid grid-cols-2 gap-4 mb-10 text-left">
                <div class="bg-rose-50 p-4 rounded-xl border border-rose-200">
                    <div class="font-bold text-rose-800 mb-1">üî• Th·ª≠ th√°ch</div>
                    <div class="text-sm text-rose-600">15 C√¢u h·ªèi t·ªïng h·ª£p</div>
                </div>
                <div class="bg-pink-50 p-4 rounded-xl border border-pink-200">
                    <div class="font-bold text-pink-800 mb-1">üèÖ M·ª•c ti√™u</div>
                    <div class="text-sm text-pink-600">Th√†nh th·∫°o x√°c su·∫•t</div>
                </div>
            </div>

            <button onclick="startGame()" class="w-full md:w-auto px-10 py-4 bg-rose-600 hover:bg-rose-700 text-white font-bold rounded-2xl shadow-xl shadow-rose-200 transform transition hover:-translate-y-1 text-xl flex items-center justify-center gap-3 mx-auto">
                <span>V√†o Tr·∫≠n Ngay</span> üé≤
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <!-- Header -->
            <div class="flex justify-between items-end mb-6 px-2">
                <div>
                    <span class="text-rose-700 text-xs font-bold uppercase tracking-wider block mb-1">C√¢u h·ªèi</span>
                    <div class="text-3xl font-black text-gray-800"><span id="current-question">1</span><span class="text-gray-400 text-xl">/15</span></div>
                </div>
                <div class="text-right">
                    <div class="inline-flex items-center gap-2 bg-white px-4 py-2 rounded-xl shadow-sm border border-rose-100">
                        <span class="text-yellow-400 text-xl">‚≠ê</span>
                        <span class="text-2xl font-black text-rose-600" id="score">0</span>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-white rounded-full h-4 mb-8 p-1 shadow-sm border border-rose-100">
                <div id="progress" class="bg-gradient-to-r from-rose-400 to-pink-500 h-full rounded-full progress-bar shadow-md" style="width: 0%"></div>
            </div>

            <!-- Question Card -->
            <div class="card p-6 md:p-10 mb-6 relative overflow-hidden border-b-8 border-rose-200">
                <div id="level-badge" class="badge bg-green-100 text-green-700 absolute top-6 right-6">Nh·∫≠n bi·∫øt</div>
                
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 mt-6 mb-8 leading-relaxed">
                    <!-- Question goes here -->
                </h2>

                <div id="options-container" class="grid gap-3 md:gap-4">
                    <!-- Options injected here -->
                </div>
            </div>

            <!-- Feedback Area -->
            <div id="feedback-area" class="hidden feedback-enter">
                <div id="feedback-card" class="card p-6 border-l-8 shadow-2xl transform scale-100">
                    <div class="flex flex-col md:flex-row items-start gap-5">
                        <div id="feedback-icon" class="text-5xl filter drop-shadow-md shrink-0">üòé</div>
                        <div class="flex-1">
                            <h3 id="feedback-title" class="text-2xl font-bold mb-2 text-rose-700">Ch√≠nh x√°c!</h3>
                            <div class="text-xs font-bold text-gray-400 uppercase mb-2 tracking-wide">Gi·∫£i th√≠ch:</div>
                            <p id="feedback-text" class="text-gray-700 leading-relaxed text-lg font-medium"></p>
                        </div>
                    </div>
                    <button onclick="nextQuestion()" class="mt-6 w-full bg-gray-900 hover:bg-gray-800 text-white font-bold py-4 px-6 rounded-xl transition flex items-center justify-center gap-2 shadow-lg group">
                        C√¢u ti·∫øp theo <span class="group-hover:translate-x-1 transition-transform">‚ûú</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden card p-10 text-center">
            <div class="mb-8 relative">
                <div class="absolute inset-0 bg-rose-200 rounded-full opacity-20 blur-xl animate-pulse"></div>
                <div class="inline-block p-8 rounded-full bg-yellow-50 border-4 border-yellow-200 mb-6 relative z-10">
                    <span class="text-7xl">üèÜ</span>
                </div>
                <h2 class="text-4xl font-extrabold text-gray-800 mb-3">Chi·∫øn Th·∫Øng!</h2>
                <p class="text-gray-500 text-lg">B·∫°n ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc b√†i √¥n t·∫≠p ch∆∞∆°ng 9.</p>
            </div>

            <div class="bg-rose-50 rounded-2xl p-8 mb-8 border-2 border-rose-100 border-dashed">
                <div class="text-rose-500 font-bold uppercase text-xs tracking-widest mb-2">T·ªïng ƒëi·ªÉm ƒë·∫°t ƒë∆∞·ª£c</div>
                <div class="text-6xl font-black text-rose-600 mb-4" id="final-score">0</div>
                <div class="h-1 w-24 bg-rose-200 mx-auto rounded-full mb-4"></div>
                <p id="result-message" class="text-gray-700 font-bold text-xl">Qu√° ƒë·ªânh!</p>
            </div>

            <button onclick="location.reload()" class="bg-rose-600 hover:bg-rose-700 text-white font-bold py-4 px-10 rounded-xl shadow-lg transform transition hover:scale-105 flex items-center justify-center gap-2 mx-auto w-full md:w-auto">
                <span class="text-xl">üîÑ</span> Ch∆°i L·∫°i
            </button>
        </div>
    </div>

    <!-- Sounds -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3"></audio>
    <audio id="sound-finish" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

   <script>
  /* =========================
     GAME DATA (15 QUESTIONS)
     =========================
     - ƒê√£ ch·ªânh ƒë·ªÉ ph√¢n b·ªë ƒë√°p √°n ƒë√∫ng g·∫ßn ƒë·ªÅu: A=4, B=4, C=4, D=3
     - C√ì random th·ª© t·ª± ƒë√°p √°n (A/B/C/D s·∫Ω ƒë·ªïi m·ªói l·∫ßn t·∫£i c√¢u)
     - Ch·∫•m ƒë√∫ng theo ƒë√°p √°n sau khi random
  */

  const questions = [
    // 6 C√¢u Nh·∫≠n bi·∫øt
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Bi·∫øn c·ªë c√≥ x√°c su·∫•t b·∫±ng 1 ƒë∆∞·ª£c g·ªçi l√† g√¨?",
      options: ["Bi·∫øn c·ªë ch·∫Øc ch·∫Øn", "Bi·∫øn c·ªë ng·∫´u nhi√™n", "Bi·∫øn c·ªë kh√¥ng th·ªÉ", "Bi·∫øn c·ªë s∆° c·∫•p"],
      correct: 0,
      rationale: "Bi·∫øn c·ªë ch·∫Øc ch·∫Øn l√† bi·∫øn c·ªë lu√¥n lu√¥n x·∫£y ra, n√™n x√°c su·∫•t c·ªßa n√≥ b·∫±ng 1 (ho·∫∑c 100%)."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Bi·∫øn c·ªë kh√¥ng th·ªÉ c√≥ x√°c su·∫•t l√† bao nhi√™u?",
      options: ["0.5", "1", "L·ªõn h∆°n 1", "0"],
      correct: 3,
      rationale: "Bi·∫øn c·ªë kh√¥ng th·ªÉ l√† bi·∫øn c·ªë kh√¥ng bao gi·ªù x·∫£y ra, n√™n x√°c su·∫•t c·ªßa n√≥ b·∫±ng 0."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "C√¥ng th·ª©c t√≠nh x√°c su·∫•t c·ªßa bi·∫øn c·ªë A khi c√°c k·∫øt qu·∫£ ƒë·ªìng kh·∫£ nƒÉng l√†:",
      options: ["$P(A) = \\frac{n(A)}{n(\\Omega)}$", "$P(A) = n(A) \\cdot n(\\Omega)$", "$P(A) = n(\\Omega) - n(A)$", "$P(A) = \\frac{n(\\Omega)}{n(A)}$"],
      correct: 0,
      rationale: "X√°c su·∫•t b·∫±ng t·ªâ s·ªë gi·ªØa s·ªë k·∫øt qu·∫£ thu·∫≠n l·ª£i cho A v√† t·ªïng s·ªë k·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "M·ªôt h·ªôp c√≥ 5 qu·∫£ b√≥ng xanh v√† 3 qu·∫£ b√≥ng ƒë·ªè. T·ªïng s·ªë k·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra khi l·∫•y ng·∫´u nhi√™n 1 qu·∫£ b√≥ng l√†:",
      options: ["3", "5", "8", "15"],
      correct: 2,
      rationale: "T·ªïng s·ªë b√≥ng trong h·ªôp l√† $5 + 3 = 8$ qu·∫£. M·ªói qu·∫£ b√≥ng ƒë∆∞·ª£c l·∫•y ra l√† m·ªôt k·∫øt qu·∫£."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "Trong m·ªôt tr√≤ ch∆°i tung ƒë·ªìng xu, x√°c su·∫•t th·ª±c nghi·ªám ph·ª• thu·ªôc v√†o:",
      options: ["L√Ω thuy·∫øt to√°n h·ªçc", "K·∫øt qu·∫£ th·ª±c t·∫ø c·ªßa c√°c l·∫ßn tung", "M·ªánh gi√° c·ªßa ƒë·ªìng xu", "Ng∆∞·ªùi tung ƒë·ªìng xu"],
      correct: 1,
      rationale: "X√°c su·∫•t th·ª±c nghi·ªám ƒë∆∞·ª£c t√≠nh d·ª±a tr√™n t·∫ßn su·∫•t xu·∫•t hi·ªán c·ªßa bi·∫øn c·ªë trong m·ªôt chu·ªói c√°c ph√©p th·ª≠ th·ª±c t·∫ø."
    },
    {
      level: "Nh·∫≠n bi·∫øt",
      question: "T·∫≠p h·ª£p c√°c k·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra c·ªßa m·ªôt ph√©p th·ª≠ ƒë∆∞·ª£c g·ªçi l√†:",
      options: ["Bi·∫øn c·ªë", "X√°c su·∫•t", "T·∫≠p h·ª£p con", "Kh√¥ng gian m·∫´u"],
      correct: 3,
      rationale: "Kh√¥ng gian m·∫´u (th∆∞·ªùng k√Ω hi·ªáu l√† $\\Omega$) l√† t·∫≠p h·ª£p ch·ª©a t·∫•t c·∫£ c√°c k·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra c·ªßa ph√©p th·ª≠."
    },

    // 5 C√¢u Th√¥ng hi·ªÉu
    {
      level: "Th√¥ng hi·ªÉu",
      question: "Gieo m·ªôt con x√∫c x·∫Øc 6 m·∫∑t c√¢n ƒë·ªëi. X√°c su·∫•t ƒë·ªÉ gieo ƒë∆∞·ª£c m·∫∑t c√≥ s·ªë ch·∫•m chia h·∫øt cho 3 l√†:",
      options: ["1/2", "1/3", "1/6", "2/3"],
      correct: 1,
      rationale: "C√°c m·∫∑t chia h·∫øt cho 3 l√† {3; 6} (2 k·∫øt qu·∫£). T·ªïng s·ªë k·∫øt qu·∫£ l√† 6. V·∫≠y $P = \\frac{2}{6} = \\frac{1}{3}$."
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "M·ªôt l·ªõp h·ªçc c√≥ 18 nam v√† 12 n·ªØ. Ch·ªçn ng·∫´u nhi√™n m·ªôt b·∫°n l√†m l·ªõp tr∆∞·ªüng. X√°c su·∫•t ƒë·ªÉ b·∫°n nam ƒë∆∞·ª£c ch·ªçn l√†:",
      options: ["3/5", "2/3", "2/5", "1/2"],
      correct: 0,
      rationale: "T·ªïng s·ªë h·ªçc sinh l√† $18 + 12 = 30$. X√°c su·∫•t ch·ªçn nam l√† $\\frac{18}{30} = \\frac{3}{5}$."
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "M·ªôt h·ªôp c√≥ c√°c th·∫ª s·ªë t·ª´ 1 ƒë·∫øn 20. X√°c su·∫•t r√∫t ƒë∆∞·ª£c th·∫ª ghi s·ªë ch√≠nh ph∆∞∆°ng l√†:",
      options: ["1/5", "1/4", "3/20", "1/10"],
      correct: 0,
      rationale: "C√°c s·ªë ch√≠nh ph∆∞∆°ng t·ª´ 1 ƒë·∫øn 20 l√† {1; 4; 9; 16} (4 s·ªë). X√°c su·∫•t l√† $\\frac{4}{20} = \\frac{1}{5}$."
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "Quay v√≤ng quay may m·∫Øn c√≥ 10 √¥, trong ƒë√≥ c√≥ 3 √¥ 'Th∆∞·ªüng l·ªõn'. N·∫øu quay 50 l·∫ßn, s·ªë l·∫ßn 'Th∆∞·ªüng l·ªõn' *k·ª≥ v·ªçng* theo l√Ω thuy·∫øt l√† kho·∫£ng bao nhi√™u?",
      options: ["3 l·∫ßn", "10 l·∫ßn", "15 l·∫ßn", "30 l·∫ßn"],
      correct: 2,
      rationale: "X√°c su·∫•t tr√∫ng th∆∞·ªüng l√† $\\frac{3}{10}$. S·ªë l·∫ßn k·ª≥ v·ªçng = $50 \\times \\frac{3}{10} = 15$ l·∫ßn."
    },
    {
      level: "Th√¥ng hi·ªÉu",
      question: "Th·ª±c hi·ªán gieo ƒë·ªìng xu 20 l·∫ßn, th·∫•y c√≥ 12 l·∫ßn ng·ª≠a. X√°c su·∫•t th·ª±c nghi·ªám c·ªßa bi·∫øn c·ªë 'm·∫∑t s·∫•p' l√†:",
      options: ["0.6", "0.4", "0.5", "0.8"],
      correct: 1,
      rationale: "S·ªë l·∫ßn s·∫•p l√† $20 - 12 = 8$ l·∫ßn. X√°c su·∫•t th·ª±c nghi·ªám = $\\frac{8}{20} = 0.4$."
    },

    // 3 C√¢u V·∫≠n d·ª•ng
    {
      level: "V·∫≠n d·ª•ng",
      question: "M·ªôt h·ªôp ch·ª©a 5 vi√™n bi xanh, 4 vi√™n bi ƒë·ªè v√† $x$ vi√™n bi v√†ng. Bi·∫øt x√°c su·∫•t l·∫•y ƒë∆∞·ª£c bi ƒë·ªè l√† $\\frac{1}{3}$. T√¨m s·ªë bi v√†ng.",
      options: ["2", "3", "4", "5"],
      correct: 1,
      rationale: "T·ªïng s·ªë bi l√† $9+x$. X√°c su·∫•t bi ƒë·ªè l√† $\\frac{4}{9+x} = \\frac{1}{3} \\Rightarrow 12 = 9+x \\Rightarrow x = 3$."
    },
    {
      level: "V·∫≠n d·ª•ng (Th·ª±c t·∫ø)",
      question: "Th·ªëng k√™ cho th·∫•y trong 1000 b√≥ng ƒë√®n s·∫£n xu·∫•t ra th√¨ c√≥ 20 b√≥ng b·ªã h·ªèng. H√£y ∆∞·ªõc l∆∞·ª£ng x√°c su·∫•t mua ph·∫£i m·ªôt b√≥ng ƒë√®n h·ªèng.",
      options: ["0.2", "0.002", "0.05", "0.02"],
      correct: 3,
      rationale: "X√°c su·∫•t th·ª±c nghi·ªám = $\\frac{20}{1000} = 0.02$ (hay 2%)."
    },
    {
      level: "V·∫≠n d·ª•ng",
      question: "Gieo hai con x√∫c x·∫Øc c√¢n ƒë·ªëi. X√°c su·∫•t ƒë·ªÉ t·ªïng s·ªë ch·∫•m tr√™n hai m·∫∑t b·∫±ng 10 l√†:",
      options: ["1/6", "1/9", "1/12", "1/18"],
      correct: 2,
      rationale: "T·ªïng s·ªë k·∫øt qu·∫£ l√† 36. C√°c c·∫∑p c√≥ t·ªïng 10 l√† (4,6), (5,5), (6,4) -> 3 k·∫øt qu·∫£. $P = \\frac{3}{36} = \\frac{1}{12}$."
    },

    // 1 C√¢u V·∫≠n d·ª•ng cao
    {
      level: "V·∫≠n d·ª•ng cao",
      question: "Trong m·ªôt tr√≤ ch∆°i r√∫t thƒÉm, t·ªâ l·ªá tr√∫ng th∆∞·ªüng l√† 20%. B·∫°n An ƒë√£ r√∫t 4 l·∫ßn v√† ƒë·ªÅu tr∆∞·ª£t. H·ªèi x√°c su·∫•t tr√∫ng th∆∞·ªüng ·ªü l·∫ßn r√∫t th·ª© 5 l√† bao nhi√™u (bi·∫øt m·ªói l·∫ßn r√∫t l√† ƒë·ªôc l·∫≠p)?",
      options: ["100%", "80%", "20%", "0%"],
      correct: 2,
      rationale: "V√¨ c√°c l·∫ßn r√∫t l√† ƒë·ªôc l·∫≠p, k·∫øt qu·∫£ qu√° kh·ª© kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn t∆∞∆°ng lai. X√°c su·∫•t tr√∫ng th∆∞·ªüng ·ªü b·∫•t k·ª≥ l·∫ßn n√†o v·∫´n l√† 20%."
    }
  ];

  let currentQuestionIndex = 0;
  let score = 0;
  let isAnswering = false;

  // Audio Elements
  const soundCorrect = document.getElementById('sound-correct');
  const soundWrong = document.getElementById('sound-wrong');
  const soundFinish = document.getElementById('sound-finish');

  function playSound(type) {
    if (type === 'correct') { soundCorrect.currentTime = 0; soundCorrect.play().catch(() => {}); }
    if (type === 'wrong') { soundWrong.currentTime = 0; soundWrong.play().catch(() => {}); }
    if (type === 'finish') { soundFinish.currentTime = 0; soundFinish.play().catch(() => {}); }
  }

  // Fisher‚ÄìYates shuffle
  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function startGame() {
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('quiz-screen').classList.remove('hidden');
    loadQuestion();
  }

  function loadQuestion() {
    isAnswering = true;
    const q = questions[currentQuestionIndex];

    // Update Header
    document.getElementById('current-question').innerText = currentQuestionIndex + 1;
    document.getElementById('score').innerText = score;

    // Progress: cho ƒë·ªß 100% ·ªü c√¢u cu·ªëi
    const progressPercent = ((currentQuestionIndex + 1) / questions.length) * 100;
    document.getElementById('progress').style.width = `${progressPercent}%`;

    // Question Content
    document.getElementById('question-text').innerHTML = q.question;

    // Level Badge
    const badge = document.getElementById('level-badge');
    badge.innerText = q.level;

    let badgeClass = "badge absolute top-6 right-6 ";
    if (q.level.includes("Nh·∫≠n bi·∫øt")) badgeClass += "bg-blue-100 text-blue-700";
    else if (q.level.includes("Th√¥ng hi·ªÉu")) badgeClass += "bg-green-100 text-green-700";
    else if (q.level.includes("V·∫≠n d·ª•ng cao")) badgeClass += "bg-purple-100 text-purple-700";
    else badgeClass += "bg-yellow-100 text-yellow-700";
    badge.className = badgeClass;

    // Reset Feedback
    const feedbackArea = document.getElementById('feedback-area');
    feedbackArea.classList.add('hidden');
    feedbackArea.classList.remove('feedback-enter');

    // ===== RANDOM OPTIONS =====
    // t·∫°o m·∫£ng option objects ƒë·ªÉ random m√† v·∫´n gi·ªØ ƒë√∫ng ƒë√°p √°n
    const optionObjs = q.options.map((text, idx) => ({
      text,
      isCorrect: idx === q.correct
    }));
    shuffleArray(optionObjs);
    q._correctShuffledIndex = optionObjs.findIndex(o => o.isCorrect);

    // Render Options
    const container = document.getElementById('options-container');
    container.innerHTML = '';

    optionObjs.forEach((optObj, index) => {
      const btn = document.createElement('button');
      btn.className = `option-btn w-full text-left p-5 rounded-xl border-2 border-rose-100 bg-white text-gray-700 font-bold text-lg flex items-center shadow-sm`;
      btn.onclick = () => checkAnswer(index, btn);

      btn.innerHTML = `
        <span class="inline-flex items-center justify-center w-10 h-10 bg-rose-50 rounded-lg text-rose-600 font-extrabold mr-4 text-lg border border-rose-100 shrink-0">
          ${String.fromCharCode(65 + index)}
        </span>
        <span>${optObj.text}</span>
      `;
      container.appendChild(btn);
    });

    // Typeset MathJax
    if (window.MathJax) MathJax.typesetPromise();
  }

  function checkAnswer(selectedIndex, btnElement) {
    if (!isAnswering) return;
    isAnswering = false;

    const q = questions[currentQuestionIndex];
    const correctIndex = q._correctShuffledIndex;
    const isCorrect = selectedIndex === correctIndex;
    const buttons = document.querySelectorAll('.option-btn');

    buttons.forEach(btn => btn.disabled = true);

    if (isCorrect) {
      btnElement.classList.add('correct');
      score += 10;
      document.getElementById('score').innerText = score;
      playSound('correct');
      fireConfetti();
      showFeedback(true, q.rationale);
    } else {
      btnElement.classList.add('wrong');
      buttons[correctIndex].classList.add('correct');
      playSound('wrong');
      showFeedback(false, q.rationale);
    }
  }

  function showFeedback(isCorrect, rationale) {
    const area = document.getElementById('feedback-area');
    const title = document.getElementById('feedback-title');
    const text = document.getElementById('feedback-text');
    const icon = document.getElementById('feedback-icon');

    area.classList.remove('hidden');
    void area.offsetWidth;
    area.classList.add('feedback-enter');

    if (isCorrect) {
      title.innerText = "Ch√≠nh x√°c! üéâ";
      title.className = "text-2xl font-bold mb-2 text-green-600";
      icon.innerText = "ü§©";
    } else {
      title.innerText = "Ti·∫øc qu√°... üòÖ";
      title.className = "text-2xl font-bold mb-2 text-rose-600";
      icon.innerText = "ü§î";
    }

    text.innerHTML = rationale;
    if (window.MathJax) MathJax.typesetPromise([text]);
  }

  function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < questions.length) {
      loadQuestion();
    } else {
      showResult();
    }
  }

  function showResult() {
    document.getElementById('quiz-screen').classList.add('hidden');
    document.getElementById('result-screen').classList.remove('hidden');
    document.getElementById('final-score').innerText = score;
    playSound('finish');
    fireConfetti();

    const msg = document.getElementById('result-message');
    if (score >= 130) msg.innerText = "ƒê·ªânh c·ªßa ch√≥p! B·∫°n l√† chuy√™n gia x√°c su·∫•t! üîÆ";
    else if (score >= 100) msg.innerText = "R·∫•t t·ªët! Ki·∫øn th·ª©c v·ªØng v√†ng! üëç";
    else if (score >= 70) msg.innerText = "Kh√° ·ªïn! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
    else msg.innerText = "H√£y √¥n l·∫°i b√†i v√† th·ª≠ l·∫°i nh√©! üìö";
  }

  function fireConfetti() {
    var count = 200;
    var defaults = { origin: { y: 0.7 } };

    function fire(particleRatio, opts) {
      confetti(Object.assign({}, defaults, opts, {
        particleCount: Math.floor(count * particleRatio)
      }));
    }

    fire(0.25, { spread: 26, startVelocity: 55 });
    fire(0.2, { spread: 60 });
    fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
    fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
    fire(0.1, { spread: 120, startVelocity: 45 });
  }
</script>
</body>
</html>
