<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ª≠ th√°ch To√°n 8: Chinh ph·ª•c Ph√¢n th·ª©c</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax for LaTeX rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0fdf4; /* Green-50 */
        }
        .option-card {
            transition: all 0.2s ease;
        }
        .option-card:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .correct-answer {
            background-color: #dcfce7 !important; /* Green-100 */
            border-color: #22c55e !important; /* Green-500 */
            color: #14532d !important; /* Green-900 */
        }
        .wrong-answer {
            background-color: #fee2e2 !important; /* Red-100 */
            border-color: #ef4444 !important; /* Red-500 */
            color: #7f1d1d !important; /* Red-900 */
        }
        .disabled {
            pointer-events: none;
            opacity: 0.8;
        }
        /* Custom scrollbar for rationale */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 3px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-3xl rounded-2xl shadow-xl overflow-hidden flex flex-col" style="min-height: 600px;">
        
        <!-- Header -->
        <div class="bg-green-600 p-6 text-white">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold">To√°n 8: Nh√¢n chia ph√¢n th·ª©c</h1>
                <div class="text-sm font-medium bg-green-700 px-3 py-1 rounded-full">
                    C√¢u <span id="current-q-num">1</span>/<span id="total-q-num">15</span>
                </div>
            </div>
            <!-- Progress Bar -->
            <div class="w-full bg-green-800 h-2 rounded-full mt-4 overflow-hidden">
                <div id="progress-bar" class="bg-yellow-400 h-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="flex-1 flex flex-col items-center justify-center p-8 text-center space-y-6">
            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center text-4xl mb-2">
                üßÆ
            </div>
            <h2 class="text-3xl font-bold text-gray-800">S·∫µn s√†ng th·ª≠ th√°ch?</h2>
            <p class="text-gray-600 max-w-md">
                B√†i ki·ªÉm tra g·ªìm 15 c√¢u h·ªèi v·ªÅ quy t·∫Øc nh√¢n, chia ph√¢n th·ª©c, t√¨m ph√¢n th·ª©c ngh·ªãch ƒë·∫£o v√† r√∫t g·ªçn bi·ªÉu th·ª©c.
            </p>
            <div class="space-y-2 text-sm text-gray-500">
                <p>‚ö° 4 M·ª©c ƒë·ªô: Nh·∫≠n bi·∫øt, Th√¥ng hi·ªÉu, V·∫≠n d·ª•ng, V·∫≠n d·ª•ng cao</p>
                <p>üéØ M·ª•c ti√™u: N·∫Øm v·ªØng ki·∫øn th·ª©c B√†i 7 - Ch∆∞∆°ng 1</p>
            </div>
            <button onclick="startQuiz()" class="px-8 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-lg transition transform hover:scale-105">
                B·∫Øt ƒë·∫ßu ngay
            </button>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="hidden flex-1 flex flex-col p-6">
            <!-- Question -->
            <div class="mb-6">
                <span class="text-xs font-bold tracking-wider text-green-600 uppercase mb-1 block">C√¢u h·ªèi</span>
                <h3 id="question-text" class="text-xl font-medium text-gray-800 leading-relaxed">
                    <!-- Question goes here -->
                </h3>
            </div>

            <!-- Options -->
            <div id="options-container" class="grid grid-cols-1 gap-3 mb-6">
                <!-- Options generated by JS -->
            </div>

            <!-- Feedback Area -->
            <div id="feedback-area" class="hidden mt-auto border-t pt-4 animate-fade-in">
                <div id="feedback-content" class="p-4 rounded-lg mb-4">
                    <div class="flex items-start gap-3">
                        <span id="feedback-icon" class="text-2xl"></span>
                        <div>
                            <h4 id="feedback-title" class="font-bold text-lg mb-1"></h4>
                            <p id="feedback-rationale" class="text-gray-700 text-sm"></p>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-sm text-gray-500 italic" id="hint-text">
                        <!-- Hint text -->
                    </div>
                    <button id="next-btn" onclick="nextQuestion()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition">
                        C√¢u ti·∫øp theo ‚Üí
                    </button>
                </div>
            </div>
            
            <!-- Hint Button (Initially Visible) -->
            <div id="hint-container" class="mt-auto pt-2 flex justify-end">
                <button onclick="showHint()" class="text-sm text-yellow-600 hover:text-yellow-700 font-medium flex items-center gap-1 transition">
                    üí° G·ª£i √Ω
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden flex-1 flex flex-col items-center justify-center p-8 text-center space-y-6">
            <div id="result-icon" class="text-6xl mb-2">üèÜ</div>
            <h2 class="text-3xl font-bold text-gray-800">Ho√†n th√†nh!</h2>
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 w-full max-w-sm">
                <p class="text-gray-500 mb-1">ƒêi·ªÉm s·ªë c·ªßa b·∫°n</p>
                <div class="text-5xl font-black text-green-600 mb-2">
                    <span id="final-score">0</span>/15
                </div>
                <p id="result-message" class="text-gray-700 font-medium"></p>
            </div>
            <div class="flex gap-4">
                <button onclick="location.reload()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold rounded-lg transition">
                    L√†m l·∫°i
                </button>
            </div>
        </div>

    </div>

    <!-- Audio Elements -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
    <audio id="sound-finish" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

   <script>
  // Quiz Data (GI·ªÆ NGUY√äN d·ªØ li·ªáu c√¢u h·ªèi c·ªßa c√¥)
  const quizData = [
    {
      question: "Mu·ªën nh√¢n hai ph√¢n th·ª©c $\\frac{A}{B}$ v√† $\\frac{C}{D}$, ta th·ª±c hi·ªán quy t·∫Øc n√†o sau ƒë√¢y?",
      options: [
        { text: "Nh√¢n t·ª≠ v·ªõi t·ª≠, gi·ªØ nguy√™n m·∫´u.", correct: false, rationale: "Sai. C·∫£ t·ª≠ v√† m·∫´u ƒë·ªÅu ph·∫£i ƒë∆∞·ª£c nh√¢n t∆∞∆°ng ·ª©ng." },
        { text: "Gi·ªØ nguy√™n t·ª≠, nh√¢n m·∫´u v·ªõi m·∫´u.", correct: false, rationale: "Sai. Quy t·∫Øc n√†y kh√¥ng ƒë√∫ng." },
        { text: "Nh√¢n t·ª≠ v·ªõi t·ª≠, nh√¢n m·∫´u v·ªõi m·∫´u.", correct: true, rationale: "Ch√≠nh x√°c! Quy t·∫Øc l√† $\\frac{A}{B} \\cdot \\frac{C}{D} = \\frac{A \\cdot C}{B \\cdot D}$." },
        { text: "Nh√¢n t·ª≠ v·ªõi m·∫´u, nh√¢n m·∫´u v·ªõi t·ª≠.", correct: false, rationale: "Sai. ƒê√¢y l√† quy t·∫Øc nh√¢n ch√©o, th∆∞·ªùng d√πng cho ph√©p chia." }
      ],
      hint: "H√£y nh·ªõ l·∫°i quy t·∫Øc nh√¢n hai ph√¢n s·ªë: t·ª≠ nh√¢n t·ª≠, m·∫´u nh√¢n m·∫´u."
    },

    {
      question: "Ph√¢n th·ª©c ngh·ªãch ƒë·∫£o c·ªßa ph√¢n th·ª©c $\\frac{x - 2}{5}$ l√† g√¨?",
      options: [
        { text: "$-\\frac{x - 2}{5}$", correct: false, rationale: "Sai. ƒê√¢y l√† ph√¢n th·ª©c ƒë·ªëi." },
        { text: "$\\frac{5}{x - 2}$", correct: true, rationale: "Ch√≠nh x√°c! Ph√¢n th·ª©c ngh·ªãch ƒë·∫£o c·ªßa $\\frac{A}{B}$ l√† $\\frac{B}{A}$." },
        { text: "$\\frac{x - 2}{-5}$", correct: false, rationale: "Sai. ƒê√¢y ch·ªâ l√† ƒë·ªïi d·∫•u m·∫´u." },
        { text: "$\\frac{2 - x}{5}$", correct: false, rationale: "Sai. ƒê√¢y l√† ƒë·ªïi d·∫•u t·ª≠." }
      ],
      hint: "ƒê·ªÉ t√¨m ph√¢n th·ª©c ngh·ªãch ƒë·∫£o, h√£y ƒë·∫£o v·ªã tr√≠ c·ªßa t·ª≠ th·ª©c v√† m·∫´u th·ª©c."
    },

    {
      question: "K·∫øt qu·∫£ c·ªßa ph√©p nh√¢n $\\frac{4x}{3y} \\cdot \\frac{3y}{4x}$ (v·ªõi $x, y \\ne 0$) l√† bao nhi√™u?",
      options: [
        { text: "$0$", correct: false, rationale: "Sai. T√≠ch hai s·ªë ngh·ªãch ƒë·∫£o kh√°c 0." },
        { text: "$\\frac{12xy}{12xy}$", correct: false, rationale: "Ch∆∞a g·ªçn. K·∫øt qu·∫£ c·∫ßn r√∫t g·ªçn t·ªëi gi·∫£n." },
        { text: "$1$", correct: true, rationale: "Ch√≠nh x√°c! T√≠ch c·ªßa m·ªôt ph√¢n th·ª©c v√† ngh·ªãch ƒë·∫£o c·ªßa n√≥ lu√¥n b·∫±ng 1." },
        { text: "$-1$", correct: false, rationale: "Sai d·∫•u." }
      ],
      hint: "Nh√¢n t·ª≠ v·ªõi t·ª≠, m·∫´u v·ªõi m·∫´u r·ªìi r√∫t g·ªçn c√°c th·ª´a s·ªë gi·ªëng nhau."
    },

    {
      question: "Mu·ªën chia ph√¢n th·ª©c $\\frac{A}{B}$ cho ph√¢n th·ª©c $\\frac{C}{D}$ (v·ªõi $\\frac{C}{D} \\ne 0$), ta l√†m th·∫ø n√†o?",
      options: [
        { text: "Nh√¢n $\\frac{A}{B}$ v·ªõi $\\frac{C}{D}$.", correct: false, rationale: "Sai. ƒê√¢y l√† ph√©p nh√¢n." },
        { text: "Nh√¢n $\\frac{A}{B}$ v·ªõi ph√¢n th·ª©c ngh·ªãch ƒë·∫£o c·ªßa $\\frac{C}{D}$.", correct: true, rationale: "Ch√≠nh x√°c! $\\frac{A}{B} : \\frac{C}{D} = \\frac{A}{B} \\cdot \\frac{D}{C}$." },
        { text: "Chia t·ª≠ cho t·ª≠, chia m·∫´u cho m·∫´u.", correct: false, rationale: "Sai. Quy t·∫Øc n√†y kh√¥ng √°p d·ª•ng." },
        { text: "C·ªông $\\frac{A}{B}$ v·ªõi ph√¢n th·ª©c ngh·ªãch ƒë·∫£o c·ªßa $\\frac{C}{D}$.", correct: false, rationale: "Sai. Ph√©p chia li√™n quan ƒë·∫øn nh√¢n, kh√¥ng ph·∫£i c·ªông." }
      ],
      hint: "Ph√©p chia l√† ph√©p nh√¢n v·ªõi s·ªë ngh·ªãch ƒë·∫£o."
    },

    {
      question: "Th·ª±c hi·ªán ph√©p t√≠nh $\\frac{x^2}{y} : \\frac{x}{y}$ (v·ªõi $x, y \\ne 0$). K·∫øt qu·∫£ l√†:",
      options: [
        { text: "$x$", correct: true, rationale: "Ch√≠nh x√°c! $\\frac{x^2}{y} \\cdot \\frac{y}{x} = \\frac{x^2y}{xy} = x$." },
        { text: "$\\frac{1}{x}$", correct: false, rationale: "Sai. B·∫°n ƒë√£ nh·∫ßm l·∫´n khi r√∫t g·ªçn." },
        { text: "$x^3$", correct: false, rationale: "Sai. Ph√©p chia l√†m gi·∫£m b·∫≠c, kh√¥ng tƒÉng b·∫≠c." },
        { text: "$\\frac{x}{y^2}$", correct: false, rationale: "Sai. Bi·∫øn y s·∫Ω tri·ªát ti√™u." }
      ],
      hint: "Chuy·ªÉn ph√©p chia th√†nh nh√¢n ngh·ªãch ƒë·∫£o r·ªìi r√∫t g·ªçn."
    },

    {
      question: "ƒêi·ªÅu ki·ªán x√°c ƒë·ªãnh c·ªßa bi·ªÉu th·ª©c $\\frac{A}{B} : \\frac{C}{D}$ l√† g√¨?",
      options: [
        { text: "$B \\ne 0$", correct: false, rationale: "Thi·∫øu ƒëi·ªÅu ki·ªán cho D v√† C." },
        { text: "$B \\ne 0$ v√† $D \\ne 0$", correct: false, rationale: "Thi·∫øu ƒëi·ªÅu ki·ªán cho C (s·ªë chia kh√¥ng ƒë∆∞·ª£c b·∫±ng 0)." },
        { text: "$B \\ne 0, D \\ne 0$ v√† $C \\ne 0$", correct: true, rationale: "Ch√≠nh x√°c! M·∫´u th·ª©c ph·∫£i kh√°c 0 v√† ph√¢n th·ª©c chia c≈©ng ph·∫£i kh√°c 0." },
        { text: "$A \\ne 0, B \\ne 0, C \\ne 0, D \\ne 0$", correct: false, rationale: "T·ª≠ th·ª©c A c√≥ th·ªÉ b·∫±ng 0." }
      ],
      hint: "M·∫´u th·ª©c c·ªßa m·ªçi ph√¢n th·ª©c ph·∫£i kh√°c 0, v√† 's·ªë chia' kh√¥ng ƒë∆∞·ª£c b·∫±ng 0."
    },

    {
      question: "K·∫øt qu·∫£ r√∫t g·ªçn c·ªßa ph√©p nh√¢n $\\frac{5x}{2y} \\cdot \\frac{6y^2}{10x^2}$ l√†:",
      options: [
        { text: "$\\frac{3y}{2x}$", correct: true, rationale: "Ch√≠nh x√°c! $\\frac{30xy^2}{20x^2y} = \\frac{3y}{2x}$." },
        { text: "$\\frac{3x}{2y}$", correct: false, rationale: "Nh·∫ßm l·∫´n v·ªã tr√≠ bi·∫øn x v√† y." },
        { text: "$\\frac{3y^2}{2x}$", correct: false, rationale: "Ch∆∞a r√∫t g·ªçn h·∫øt bi·∫øn y." },
        { text: "$\\frac{30xy^2}{20x^2y}$", correct: false, rationale: "Ch∆∞a r√∫t g·ªçn t·ªëi gi·∫£n." }
      ],
      hint: "Nh√¢n h·ªá s·ªë v·ªõi h·ªá s·ªë, bi·∫øn v·ªõi bi·∫øn r·ªìi r√∫t g·ªçn."
    },

    {
      question: "Th·ª±c hi·ªán ph√©p t√≠nh: $\\frac{x^2 - 1}{y} : \\frac{x + 1}{y}$",
      options: [
        { text: "$x + 1$", correct: false, rationale: "Sai. $x^2-1 = (x-1)(x+1)$ chia cho $(x+1)$ ph·∫£i c√≤n $(x-1)$." },
        { text: "$x - 1$", correct: true, rationale: "Ch√≠nh x√°c! $\\frac{(x-1)(x+1)}{y} \\cdot \\frac{y}{x+1} = x - 1$." },
        { text: "$\\frac{x - 1}{y^2}$", correct: false, rationale: "Sai. Bi·∫øn y ƒë√£ tri·ªát ti√™u." },
        { text: "$\\frac{(x - 1)(x + 1)^2}{y^2}$", correct: false, rationale: "Sai. ƒê√¢y l√† k·∫øt qu·∫£ ph√©p nh√¢n." }
      ],
      hint: "Ph√¢n t√≠ch t·ª≠ th·ª©c $x^2 - 1$ th√†nh nh√¢n t·ª≠ r·ªìi th·ª±c hi·ªán ph√©p chia."
    },

    {
      question: "T√¨m k·∫øt qu·∫£ c·ªßa bi·ªÉu th·ª©c: $\\frac{2x}{x - y} \\cdot \\frac{y - x}{4x^2}$",
      options: [
        { text: "$\\frac{1}{2x}$", correct: false, rationale: "Sai d·∫•u. $y-x = -(x-y)$." },
        { text: "$-\\frac{1}{2x}$", correct: true, rationale: "Ch√≠nh x√°c! R√∫t g·ªçn $(y-x)$ v√† $(x-y)$ ƒë∆∞·ª£c -1." },
        { text: "$-\\frac{1}{2}$", correct: false, rationale: "Sai. V·∫´n c√≤n bi·∫øn x ·ªü m·∫´u." },
        { text: "$\\frac{2}{x}$", correct: false, rationale: "Sai h·ªá s·ªë v√† d·∫•u." }
      ],
      hint: "Ch√∫ √Ω d·∫•u khi r√∫t g·ªçn $(y - x)$ v√† $(x - y)$. Ch√∫ng l√† hai s·ªë ƒë·ªëi nhau."
    },

    {
      question: "T√≠nh t√≠ch: $\\frac{x^2 - 4x + 4}{2x} \\cdot \\frac{6}{3x - 6}$",
      options: [
        { text: "$\\frac{x - 2}{x}$", correct: true, rationale: "Ch√≠nh x√°c! $\\frac{(x-2)^2}{2x} \\cdot \\frac{6}{3(x-2)} = \\frac{x-2}{x}$." },
        { text: "$\\frac{x + 2}{x}$", correct: false, rationale: "Sai h·∫±ng ƒë·∫≥ng th·ª©c." },
        { text: "$\\frac{x - 2}{2x}$", correct: false, rationale: "Sai h·ªá s·ªë r√∫t g·ªçn." },
        { text: "$x - 2$", correct: false, rationale: "Thi·∫øu m·∫´u th·ª©c x." }
      ],
      hint: "Ph√¢n t√≠ch t·ª≠ th·ª©c th·ª© nh·∫•t v√† m·∫´u th·ª©c th·ª© hai th√†nh nh√¢n t·ª≠."
    },

    {
      question: "Bi·ªÉu th·ª©c $M$ th·ªèa m√£n $\\frac{2x}{3y} \\cdot M = \\frac{4x^2}{3y^2}$ l√†:",
      options: [
        { text: "$\\frac{2x}{y}$", correct: true, rationale: "Ch√≠nh x√°c! $M = \\frac{4x^2}{3y^2} : \\frac{2x}{3y} = \\frac{2x}{y}$." },
        { text: "$\\frac{x}{2y}$", correct: false, rationale: "Sai h·ªá s·ªë." },
        { text: "$\\frac{2x^2}{y}$", correct: false, rationale: "Sai b·∫≠c c·ªßa x." },
        { text: "$\\frac{y}{2x}$", correct: false, rationale: "K·∫øt qu·∫£ b·ªã ngh·ªãch ƒë·∫£o." }
      ],
      hint: "Mu·ªën t√¨m th·ª´a s·ªë ch∆∞a bi·∫øt, l·∫•y t√≠ch chia cho th·ª´a s·ªë ƒë√£ bi·∫øt."
    },

    {
      question: "R√∫t g·ªçn bi·ªÉu th·ª©c: $\\frac{x^2 - 9}{2x + 8} \\cdot \\frac{x + 4}{3 - x}$",
      options: [
        { text: "$\\frac{x + 3}{2}$", correct: false, rationale: "Sai d·∫•u. $x-3$ v√† $3-x$ l√† ƒë·ªëi nhau." },
        { text: "$-\\frac{x + 3}{2}$", correct: true, rationale: "Ch√≠nh x√°c! Ch√∫ √Ω ƒë·ªïi d·∫•u khi r√∫t g·ªçn." },
        { text: "$\\frac{x - 3}{2}$", correct: false, rationale: "Sai. Nh√¢n t·ª≠ $(x-3)$ ƒë√£ b·ªã tri·ªát ti√™u." },
        { text: "$\\frac{x + 3}{x + 4}$", correct: false, rationale: "Sai. Ch∆∞a r√∫t g·ªçn h·∫øt." }
      ],
      hint: "Ph√¢n t√≠ch ƒëa th·ª©c th√†nh nh√¢n t·ª≠, ch√∫ √Ω ƒë·ªïi d·∫•u $(3-x)$."
    },

    {
      question: "T√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c $P = \\frac{x^2 - 4x}{3x} : \\frac{x - 4}{x + 1}$ t·∫°i $x = 2$.",
      options: [
        { text: "$0$", correct: false, rationale: "Sai." },
        { text: "$1$", correct: true, rationale: "Ch√≠nh x√°c! R√∫t g·ªçn $P = \\frac{x+1}{3}$. T·∫°i $x=2, P=1$." },
        { text: "$2$", correct: false, rationale: "Sai gi√° tr·ªã." },
        { text: "Kh√¥ng x√°c ƒë·ªãnh", correct: false, rationale: "Bi·ªÉu th·ª©c x√°c ƒë·ªãnh t·∫°i x=2." }
      ],
      hint: "R√∫t g·ªçn bi·ªÉu th·ª©c P tr∆∞·ªõc r·ªìi m·ªõi thay s·ªë."
    },

    {
      question: "M·ªôt m·∫£nh v∆∞·ªùn h√¨nh ch·ªØ nh·∫≠t c√≥ di·ªán t√≠ch l√† $\\frac{x^2 - 25}{2}$ ($m^2$) v√† chi·ªÅu r·ªông l√† $\\frac{x + 5}{4}$ ($m$). Bi·ªÉu th·ª©c bi·ªÉu th·ªã chi·ªÅu d√†i c·ªßa m·∫£nh v∆∞·ªùn l√†:",
      options: [
        { text: "$2(x - 5)$ m√©t", correct: true, rationale: "Ch√≠nh x√°c! D√†i = Di·ªán t√≠ch : R·ªông = $2(x-5)$." },
        { text: "$\\frac{x - 5}{2}$ m√©t", correct: false, rationale: "Sai h·ªá s·ªë." },
        { text: "$2(x + 5)$ m√©t", correct: false, rationale: "Nh·∫ßm l·∫´n h·∫±ng ƒë·∫≥ng th·ª©c." },
        { text: "$\\frac{8}{x - 5}$ m√©t", correct: false, rationale: "Sai quy t·∫Øc chia." }
      ],
      hint: "Chi·ªÅu d√†i = Di·ªán t√≠ch : Chi·ªÅu r·ªông."
    },

    {
      question: "R√∫t g·ªçn bi·ªÉu th·ª©c $A = \\left( \\frac{x^2 + 2x + 1}{x^2 + x} \\cdot \\frac{3x^2}{x + 1} \\right) : 3x$",
      options: [
        { text: "$x$", correct: false, rationale: "Sai." },
        { text: "$1$", correct: true, rationale: "Ch√≠nh x√°c! Bi·ªÉu th·ª©c trong ngo·∫∑c r√∫t g·ªçn th√†nh $3x$. $3x : 3x = 1$." },
        { text: "$x + 1$", correct: false, rationale: "Sai k·∫øt qu·∫£." },
        { text: "$3x$", correct: false, rationale: "Sai b∆∞·ªõc chia cu·ªëi c√πng." }
      ],
      hint: "Th·ª±c hi·ªán trong ngo·∫∑c tr∆∞·ªõc, r√∫t g·ªçn t·ªëi ƒëa r·ªìi m·ªõi chia."
    }
  ];

  // App State
  let currentQuestion = 0;
  let score = 0;
  let answered = false;

  // NEW: l∆∞u options ƒë√£ tr·ªôn c·ªßa t·ª´ng c√¢u (ƒë·ªÉ ch·∫•m ƒë√∫ng sau khi random)
  let shuffledOptions = [];

  // DOM Elements
  const startScreen = document.getElementById('start-screen');
  const quizContainer = document.getElementById('quiz-container');
  const resultScreen = document.getElementById('result-screen');
  const questionText = document.getElementById('question-text');
  const optionsContainer = document.getElementById('options-container');
  const feedbackArea = document.getElementById('feedback-area');
  const feedbackTitle = document.getElementById('feedback-title');
  const feedbackRationale = document.getElementById('feedback-rationale');
  const feedbackIcon = document.getElementById('feedback-icon');
  const feedbackContent = document.getElementById('feedback-content');
  const currentQNumSpan = document.getElementById('current-q-num');
  const progressBar = document.getElementById('progress-bar');
  const nextBtn = document.getElementById('next-btn');
  const hintContainer = document.getElementById('hint-container');

  // NEW: t·∫°o khung hi·ªÉn th·ªã g·ª£i √Ω ngay d∆∞·ªõi c√¢u h·ªèi (kh√¥ng ph·ª• thu·ªôc feedback)
  let hintBox = document.getElementById('hint-box');
  if (!hintBox) {
    hintBox = document.createElement('div');
    hintBox.id = 'hint-box';
    hintBox.className = 'hidden mb-4 p-3 rounded-lg bg-yellow-50 border border-yellow-200 text-sm text-gray-700';
    // ch√®n sau kh·ªëi c√¢u h·ªèi (questionText n·∫±m trong div.mb-6)
    questionText.parentElement.insertAdjacentElement('afterend', hintBox);
  }

  // Sounds
  const soundCorrect = document.getElementById('sound-correct');
  const soundWrong = document.getElementById('sound-wrong');
  const soundFinish = document.getElementById('sound-finish');

  function startQuiz() {
    startScreen.classList.add('hidden');
    quizContainer.classList.remove('hidden');
    renderQuestion();
  }

  // Fisher‚ÄìYates shuffle
  function shuffleArray(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function renderQuestion() {
    answered = false;
    const q = quizData[currentQuestion];

    // Reset UI
    feedbackArea.classList.add('hidden');
    hintContainer.classList.remove('hidden');

    // NEW: reset hint box
    hintBox.classList.add('hidden');
    hintBox.innerHTML = '';

    // Update Header
    currentQNumSpan.textContent = currentQuestion + 1;
    const progress = ((currentQuestion) / quizData.length) * 100;
    progressBar.style.width = `${progress}%`;

    // Set Content
    questionText.innerHTML = q.question;

    // NEW: random options m·ªói c√¢u
    shuffledOptions = shuffleArray(q.options);

    // Generate Options
    optionsContainer.innerHTML = '';
    shuffledOptions.forEach((opt, index) => {
      const btn = document.createElement('button');
      btn.className = `option-card w-full text-left p-4 rounded-lg border-2 border-gray-200 hover:border-green-400 bg-white text-gray-700 font-medium relative overflow-hidden`;
      btn.onclick = () => checkAnswer(index);

      const content = document.createElement('div');
      content.className = 'flex items-center gap-3';
      content.innerHTML = `
        <span class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-sm font-bold text-gray-500 shrink-0">${String.fromCharCode(65 + index)}</span>
        <span class="flex-1">${opt.text}</span>
      `;

      btn.appendChild(content);
      optionsContainer.appendChild(btn);
    });

    // Typeset MathJax
    if (window.MathJax) {
      MathJax.typesetPromise();
    }
  }

  function showHint() {
    const hint = quizData[currentQuestion].hint;
    hintBox.innerHTML = `üí° <strong>G·ª£i √Ω:</strong> ${hint}`;
    hintBox.classList.remove('hidden');
    hintContainer.classList.add('hidden');

    if (window.MathJax) {
      MathJax.typesetPromise([hintBox]);
    }
  }

  function checkAnswer(selectedIndex) {
    if (answered) return;
    answered = true;

    const optionsEls = optionsContainer.children;
    const isCorrect = shuffledOptions[selectedIndex].correct;

    // Visual feedback on options
    for (let i = 0; i < optionsEls.length; i++) {
      optionsEls[i].classList.add('disabled');

      if (shuffledOptions[i].correct) {
        optionsEls[i].classList.add('correct-answer');
        const icon = document.createElement('span');
        icon.innerHTML = '‚úì';
        icon.className = 'absolute right-4 top-1/2 transform -translate-y-1/2 text-green-600 font-bold text-xl';
        optionsEls[i].appendChild(icon);
      } else if (i === selectedIndex && !isCorrect) {
        optionsEls[i].classList.add('wrong-answer');
        const icon = document.createElement('span');
        icon.innerHTML = '‚úó';
        icon.className = 'absolute right-4 top-1/2 transform -translate-y-1/2 text-red-600 font-bold text-xl';
        optionsEls[i].appendChild(icon);
      }
    }

    // Play sound & Update score
    if (isCorrect) {
      score++;
      soundCorrect.currentTime = 0;
      soundCorrect.play().catch(() => {});
      showFeedback(true, shuffledOptions[selectedIndex].rationale);
    } else {
      soundWrong.currentTime = 0;
      soundWrong.play().catch(() => {});
      showFeedback(false, shuffledOptions[selectedIndex].rationale);
    }
  }

  function showFeedback(isCorrect, rationale) {
    // IMPORTANT: kh√¥ng ·∫©n h√†ng n√∫t Next n·ªØa (tr√°nh k·∫πt)
    feedbackArea.classList.remove('hidden');

    if (isCorrect) {
      feedbackContent.className = 'p-4 rounded-lg mb-4 bg-green-50 border border-green-200';
      feedbackIcon.innerHTML = 'üéâ';
      feedbackTitle.innerHTML = 'Ch√≠nh x√°c!';
      feedbackTitle.className = 'font-bold text-lg mb-1 text-green-700';
    } else {
      feedbackContent.className = 'p-4 rounded-lg mb-4 bg-red-50 border border-red-200';
      feedbackIcon.innerHTML = 'ü§î';
      feedbackTitle.innerHTML = 'Ch∆∞a ƒë√∫ng r·ªìi!';
      feedbackTitle.className = 'font-bold text-lg mb-1 text-red-700';
    }

    feedbackRationale.innerHTML = rationale;

    if (currentQuestion === quizData.length - 1) {
      nextBtn.innerHTML = 'Xem k·∫øt qu·∫£ üèÅ';
    } else {
      nextBtn.innerHTML = 'C√¢u ti·∫øp theo ‚Üí';
    }

    if (window.MathJax) {
      MathJax.typesetPromise([feedbackRationale]);
    }
  }

  function nextQuestion() {
    if (currentQuestion < quizData.length - 1) {
      currentQuestion++;
      renderQuestion();
    } else {
      finishQuiz();
    }
  }

  function finishQuiz() {
    quizContainer.classList.add('hidden');
    resultScreen.classList.remove('hidden');
    document.getElementById('final-score').textContent = score;

    soundFinish.play().catch(() => {});

    const percentage = (score / quizData.length) * 100;
    const messageEl = document.getElementById('result-message');

    if (percentage === 100) {
      document.getElementById('result-icon').innerHTML = 'üëë';
      messageEl.textContent = "Xu·∫•t s·∫Øc! B·∫°n l√† b·∫≠c th·∫ßy v·ªÅ ph√¢n th·ª©c!";
    } else if (percentage >= 80) {
      document.getElementById('result-icon').innerHTML = 'üåü';
      messageEl.textContent = "R·∫•t t·ªët! B·∫°n n·∫Øm r·∫•t ch·∫Øc ki·∫øn th·ª©c.";
    } else if (percentage >= 50) {
      document.getElementById('result-icon').innerHTML = 'üëç';
      messageEl.textContent = "Kh√° t·ªët! H√£y √¥n l·∫°i nh·ªØng c√¢u l√†m sai nh√©.";
    } else {
      document.getElementById('result-icon').innerHTML = 'üìö';
      messageEl.textContent = "C·∫ßn c·ªë g·∫Øng h∆°n! H√£y xem l·∫°i l√Ω thuy·∫øt b√†i 7 nh√©.";
    }
  }
</script>
</body>
</html>
